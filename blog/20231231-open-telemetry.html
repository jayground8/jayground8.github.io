<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>OpenTelemetry with Minikube</title><meta name="robots" content="follow, index"/><meta name="description" content="OpenTelemetry collectorë¥¼ ì‚¬ìš©í•˜ì—¬ tracingê³¼ loggingì„ ê°™ì´ í•˜ëŠ” ê²ƒì„ ê²€í† í•˜ì˜€ë‹¤. Kubernetesì™€ ë©€ì–´ì ¸ ìˆë˜ ì‚¬ì´ì— OpenTelemetry ì»¤ë®¤ë‹ˆí‹°ê°€ ì—„ì²­ë‚˜ê²Œ ì„±ì¥í•œ ê²ƒì„ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤. Logì— traceIDë¥¼ ë‚¨ê¸°ê³  ê·¸ê±¸ë¡œ Tracing ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆê³ , Grafana í•˜ë‚˜ì—ì„œ í†µí•©ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ Lokiì™€ Tempoë¥¼ Exporterë¡œ ì‚¬ìš©í–ˆë‹¤. ì•„ì§ Pythonê³¼ Nodejsì—ì„œëŠ” Logìª½ì˜ ìƒíƒœëŠ” Developmentë‚˜ Experimentalì´ê¸° ë•Œë¬¸ì—, receiverì—ì„œ filelogë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes log fileì„ fluentbitì²˜ëŸ¼ tailí•´ì„œ ê°€ì ¸ì˜¤ê³  traceIdë¥¼ logì— ë„£ì–´ì£¼ëŠ” instrument libaryë¥¼ ì‚¬ìš©í–ˆë‹¤."/><meta property="og:url" content="https://jayground8.github.io/blog/20231231-open-telemetry"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="OpenTelemetry collectorë¥¼ ì‚¬ìš©í•˜ì—¬ tracingê³¼ loggingì„ ê°™ì´ í•˜ëŠ” ê²ƒì„ ê²€í† í•˜ì˜€ë‹¤. Kubernetesì™€ ë©€ì–´ì ¸ ìˆë˜ ì‚¬ì´ì— OpenTelemetry ì»¤ë®¤ë‹ˆí‹°ê°€ ì—„ì²­ë‚˜ê²Œ ì„±ì¥í•œ ê²ƒì„ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤. Logì— traceIDë¥¼ ë‚¨ê¸°ê³  ê·¸ê±¸ë¡œ Tracing ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆê³ , Grafana í•˜ë‚˜ì—ì„œ í†µí•©ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ Lokiì™€ Tempoë¥¼ Exporterë¡œ ì‚¬ìš©í–ˆë‹¤. ì•„ì§ Pythonê³¼ Nodejsì—ì„œëŠ” Logìª½ì˜ ìƒíƒœëŠ” Developmentë‚˜ Experimentalì´ê¸° ë•Œë¬¸ì—, receiverì—ì„œ filelogë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes log fileì„ fluentbitì²˜ëŸ¼ tailí•´ì„œ ê°€ì ¸ì˜¤ê³  traceIdë¥¼ logì— ë„£ì–´ì£¼ëŠ” instrument libaryë¥¼ ì‚¬ìš©í–ˆë‹¤."/><meta property="og:title" content="OpenTelemetry with Minikube"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="OpenTelemetry with Minikube"/><meta name="twitter:description" content="OpenTelemetry collectorë¥¼ ì‚¬ìš©í•˜ì—¬ tracingê³¼ loggingì„ ê°™ì´ í•˜ëŠ” ê²ƒì„ ê²€í† í•˜ì˜€ë‹¤. Kubernetesì™€ ë©€ì–´ì ¸ ìˆë˜ ì‚¬ì´ì— OpenTelemetry ì»¤ë®¤ë‹ˆí‹°ê°€ ì—„ì²­ë‚˜ê²Œ ì„±ì¥í•œ ê²ƒì„ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤. Logì— traceIDë¥¼ ë‚¨ê¸°ê³  ê·¸ê±¸ë¡œ Tracing ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆê³ , Grafana í•˜ë‚˜ì—ì„œ í†µí•©ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ Lokiì™€ Tempoë¥¼ Exporterë¡œ ì‚¬ìš©í–ˆë‹¤. ì•„ì§ Pythonê³¼ Nodejsì—ì„œëŠ” Logìª½ì˜ ìƒíƒœëŠ” Developmentë‚˜ Experimentalì´ê¸° ë•Œë¬¸ì—, receiverì—ì„œ filelogë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes log fileì„ fluentbitì²˜ëŸ¼ tailí•´ì„œ ê°€ì ¸ì˜¤ê³  traceIdë¥¼ logì— ë„£ì–´ì£¼ëŠ” instrument libaryë¥¼ ì‚¬ìš©í–ˆë‹¤."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20231231-open-telemetry"/><meta property="article:published_time" content="2023-12-31T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20231231-open-telemetry"
  },
  "headline": "OpenTelemetry with Minikube",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2023-12-31T00:00:00.000Z",
  "dateModified": "2023-12-31T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "OpenTelemetry collectorë¥¼ ì‚¬ìš©í•˜ì—¬ tracingê³¼ loggingì„ ê°™ì´ í•˜ëŠ” ê²ƒì„ ê²€í† í•˜ì˜€ë‹¤. Kubernetesì™€ ë©€ì–´ì ¸ ìˆë˜ ì‚¬ì´ì— OpenTelemetry ì»¤ë®¤ë‹ˆí‹°ê°€ ì—„ì²­ë‚˜ê²Œ ì„±ì¥í•œ ê²ƒì„ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤. Logì— traceIDë¥¼ ë‚¨ê¸°ê³  ê·¸ê±¸ë¡œ Tracing ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆê³ , Grafana í•˜ë‚˜ì—ì„œ í†µí•©ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ Lokiì™€ Tempoë¥¼ Exporterë¡œ ì‚¬ìš©í–ˆë‹¤. ì•„ì§ Pythonê³¼ Nodejsì—ì„œëŠ” Logìª½ì˜ ìƒíƒœëŠ” Developmentë‚˜ Experimentalì´ê¸° ë•Œë¬¸ì—, receiverì—ì„œ filelogë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes log fileì„ fluentbitì²˜ëŸ¼ tailí•´ì„œ ê°€ì ¸ì˜¤ê³  traceIdë¥¼ logì— ë„£ì–´ì£¼ëŠ” instrument libaryë¥¼ ì‚¬ìš©í–ˆë‹¤."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-756caffa13733259.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/lqB8ysPMAnh5eaA73Sesi/_buildManifest.js" defer=""></script><script src="/_next/static/lqB8ysPMAnh5eaA73Sesi/_ssgManifest.js" defer=""></script><script src="/_next/static/lqB8ysPMAnh5eaA73Sesi/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">ë¸”ë¡œê·¸</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">ë¸”ë¡œê·¸</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-12-31T00:00:00.000Z">2023ë…„ 12ì›” 31ì¼ ì¼ìš”ì¼</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">OpenTelemetry with Minikube</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="minikube-í™˜ê²½"><a href="#minikube-í™˜ê²½" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Minikube í™˜ê²½</h2><p>Macì—ì„œ Minikubeë¥¼ ì‚¬ìš©í•˜ì˜€ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ Minikube clusterë¥¼ ì‹¤í–‰í•˜ì˜€ë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">brew <span class="token function">install</span> hyperkit
</span><span class="code-line">minikube start --container-runtime<span class="token operator">=</span>containerd --cni<span class="token operator">=</span>cilium --driver<span class="token operator">=</span>hyperkit --kubernetes-version<span class="token operator">=</span>v1.26.12
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8/example-k8s-with-OTel">ì˜ˆì œ ì†ŒìŠ¤ì½”ë“œ</a>ì„ Cloneí•œë‹¤.</p><h2 id="loki-tempo-grafana"><a href="#loki-tempo-grafana" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Loki, Tempo, Grafana</h2><p>í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œ Loki, Tempo, Grafanaë¥¼ Helmìœ¼ë¡œ ì‹¤í–‰í•œë‹¤.</p><p>Grafanaì—ì„œ Lokì™€ Tempoë¥¼ ì•„ë˜ì™€ ê°™ì´ datasourceë¡œ ì •ì˜í•´ì¤€ë‹¤. ì—¬ê¸°ì„œ trace_idë¥¼ regexë¡œ ì°¾ì•„ì„œ tempoì—ì„œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ í•´ì¤„ ìˆ˜ ìˆë‹¤. ê·¸ë ‡ê²Œ ì„¤ì •í•˜ê³  ë‚˜ë©´ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ labelì— linkë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆê³ , ëˆ„ë¥´ë©´ ë°”ë¡œ Tracing ì •ë³´ë¥¼ ê°™ì´ ë³¼ ìˆ˜ ìˆë‹¤. Grafana Labsì—ì„œ ì´ë ‡ê²Œ OSSë¡œ ì œê³µí•˜ì—¬ ìš°ë¦¬ê°€ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ë¼ëŠ” ê²ƒì— ë‹¤ì‹œ í•œë²ˆ ê°íƒ„ê³¼ ê°ì‚¬í•¨ì„ ëŠë‚€ë‹¤. ğŸ˜</p><img src="/static/images/otel-trace-link.png" alt="tracing link"/><img src="/static/images/otel-grafana-tempo-integration.png" alt="tracing info"/><p><code>values.yml</code></p><div class="relative"><pre><code class="code-highlight language-yml"><span class="code-line"><span class="token atrule key">datasources</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">datasources.yaml</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">    <span class="token atrule key">datasources</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> Loki
</span><span class="code-line">        <span class="token atrule key">type</span><span class="token punctuation">:</span> loki
</span><span class="code-line">        <span class="token atrule key">access</span><span class="token punctuation">:</span> proxy
</span><span class="code-line">        <span class="token atrule key">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki<span class="token punctuation">:</span><span class="token number">3100</span>
</span><span class="code-line">        <span class="token atrule key">basicAuth</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">        <span class="token atrule key">jsonData</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">maxLines</span><span class="token punctuation">:</span> <span class="token number">1000</span>
</span><span class="code-line">          <span class="token atrule key">derivedFields</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">datasourceName</span><span class="token punctuation">:</span> Tempo
</span><span class="code-line">              <span class="token atrule key">datasourceUid</span><span class="token punctuation">:</span> tempo
</span><span class="code-line">              <span class="token atrule key">matcherRegex</span><span class="token punctuation">:</span> trace_id=(\w+)
</span><span class="code-line">              <span class="token atrule key">name</span><span class="token punctuation">:</span> traceID
</span><span class="code-line">              <span class="token atrule key">url</span><span class="token punctuation">:</span> $$<span class="token punctuation">{</span>__value.raw<span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> Tempo
</span><span class="code-line">        <span class="token atrule key">type</span><span class="token punctuation">:</span> tempo
</span><span class="code-line">        <span class="token atrule key">access</span><span class="token punctuation">:</span> proxy
</span><span class="code-line">        <span class="token atrule key">orgId</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">        <span class="token atrule key">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//tempo<span class="token punctuation">:</span><span class="token number">3100</span>
</span><span class="code-line">        <span class="token atrule key">basicAuth</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">        <span class="token atrule key">isDefault</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">        <span class="token atrule key">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">        <span class="token atrule key">editable</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">        <span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">        <span class="token atrule key">uid</span><span class="token punctuation">:</span> tempo
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">helm repo <span class="token function">add</span> grafana https://grafana.github.io/helm-charts
</span><span class="code-line">helm <span class="token function">install</span> loki grafana/loki --values helm/loki/values.yml
</span><span class="code-line">helm <span class="token function">install</span> tempo grafana/tempo
</span><span class="code-line">helm <span class="token function">install</span> grafana grafana/grafana --values helm/grafana/values.yml
</span></code></pre></div><h2 id="opentelemetry-collector"><a href="#opentelemetry-collector" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>OpenTelemetry Collector</h2><p>OpenTelemetry CollectorëŠ” receiver, processor, exporterë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. LogëŠ” <code>filelog</code> receiverë¥¼ ì‚¬ìš©í•˜ì—¬, Kubernetes log fileì˜ logë¥¼ ìˆ˜ì§‘í•œë‹¤. Tracingì€ otlp receiverê°€ OpenTelemetry Protocolë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ grpc, http ì„œë²„ë¥¼ ë„ìš°ê²Œ ëœë‹¤. <code>Nestjs</code> Nodejs Appì—ì„œ í•´ë‹¹ otlp receiverë¡œ tracing ì •ë³´ë¥¼ ë³´ë‚´ê²Œ ë˜ê³ , <code>FastAPI</code> Python Appì—ì„œë„ ë™ì¼í•˜ê²Œ otlp receiverë¡œ tracing ì •ë³´ë¥¼ ë³´ë‚´ê²Œ ëœë‹¤. ì´ë ‡ê²Œ ìˆ˜ì§‘í•œ LogëŠ” exporterë¡œ Loki backendì— ìµœì¢…ì ìœ¼ë¡œ ë³´ë‚´ê³ , TraceëŠ” exporterë¡œ Tempoì— ë³´ë‚¸ë‹¤. ì´ë ‡ê²Œ ë³´ë‚´ì§„ ì •ë³´ëŠ” Grafanaì—ì„œ Visualizeí•˜ì—¬ ë³´ê²Œ ëœë‹¤. LogëŠ” Processorì—ì„œ parsingì„ í•˜ê³ , Lokiì—ì„œ indexingì„ í•˜ëŠ” labelì •ë³´ë¥¼ ì¶”ê°€ í•´ì£¼ëŠ” ì‘ì—…ì„ í•œë‹¤.</p><p>ìµœì¢…ì ìœ¼ë¡œ Helm valuesê°’ì€ ì•„ë˜ì™€ ê°™ë‹¤. jaeger, prometheus, zipkinì€ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ defaultê°’ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šê²Œ nullë¡œ ì„¤ì •ì„ í•´ì£¼ì—ˆë‹¤. Tracingì˜ ê²½ìš°ì— OpenTelemetry Collectorê°€ ì •ìƒì ìœ¼ë¡œ ë°›ì•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ exportersì— <code>debug</code>ë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.</p><p><code>values.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">config</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">jaeger</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">    <span class="token atrule key">prometheus</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">    <span class="token atrule key">zipkin</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">    <span class="token atrule key">filelog</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">include</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> /var/log/pods/<span class="token important">*/*/*.log</span>
</span><span class="code-line">      <span class="token atrule key">start_at</span><span class="token punctuation">:</span> beginning
</span><span class="code-line">      <span class="token atrule key">include_file_path</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">      <span class="token atrule key">include_file_name</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">      <span class="token atrule key">operators</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment"># Find out which format is used by kubernetes</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> router
</span><span class="code-line">          <span class="token atrule key">id</span><span class="token punctuation">:</span> get<span class="token punctuation">-</span>format
</span><span class="code-line">          <span class="token atrule key">routes</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">output</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>containerd
</span><span class="code-line">              <span class="token atrule key">expr</span><span class="token punctuation">:</span> <span class="token string">&#x27;body matches &quot;^[^ Z]+Z&quot;&#x27;</span>
</span><span class="code-line">        <span class="token comment"># Parse CRI-Containerd format</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> regex_parser
</span><span class="code-line">          <span class="token atrule key">id</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>containerd
</span><span class="code-line">          <span class="token atrule key">regex</span><span class="token punctuation">:</span> <span class="token string">&#x27;^(?P&lt;time&gt;[^ ^Z]+Z) (?P&lt;stream&gt;stdout|stderr) (?P&lt;logtag&gt;[^ ]*) ?(?P&lt;log&gt;.*)$&#x27;</span>
</span><span class="code-line">          <span class="token atrule key">output</span><span class="token punctuation">:</span> extract_metadata_from_filepath
</span><span class="code-line">          <span class="token atrule key">timestamp</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">parse_from</span><span class="token punctuation">:</span> attributes.time
</span><span class="code-line">            <span class="token atrule key">layout</span><span class="token punctuation">:</span> <span class="token string">&#x27;%Y-%m-%dT%H:%M:%S.%LZ&#x27;</span>
</span><span class="code-line">        <span class="token comment"># Extract metadata from file path</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> regex_parser
</span><span class="code-line">          <span class="token atrule key">id</span><span class="token punctuation">:</span> extract_metadata_from_filepath
</span><span class="code-line">          <span class="token atrule key">regex</span><span class="token punctuation">:</span> <span class="token string">&#x27;^.*\/(?P&lt;namespace&gt;[^_]+)_(?P&lt;pod_name&gt;[^_]+)_(?P&lt;uid&gt;[a-f0-9\-]{36})\/(?P&lt;container_name&gt;[^\._]+)\/(?P&lt;restart_count&gt;\d+)\.log$&#x27;</span>
</span><span class="code-line">          <span class="token atrule key">parse_from</span><span class="token punctuation">:</span> attributes<span class="token punctuation">[</span><span class="token string">&quot;log.file.path&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">cache</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">size</span><span class="token punctuation">:</span> <span class="token number">128</span> <span class="token comment"># default maximum amount of Pods per Node is 110</span>
</span><span class="code-line">        <span class="token comment"># Rename attributes</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">          <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes<span class="token punctuation">[</span><span class="token string">&quot;log.file.path&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">          <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.container_name
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">          <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.namespace
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">          <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.pod_name
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;pod&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> add
</span><span class="code-line">          <span class="token atrule key">field</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;cluster&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;minikube&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">service</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">pipelines</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">traces</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> otlp
</span><span class="code-line">        <span class="token atrule key">exporters</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> debug
</span><span class="code-line">          <span class="token punctuation">-</span> otlp
</span><span class="code-line">      <span class="token atrule key">metrics</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> otlp
</span><span class="code-line">      <span class="token atrule key">logs</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> filelog
</span><span class="code-line">        <span class="token atrule key">processors</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> resource
</span><span class="code-line">        <span class="token atrule key">exporters</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> loki
</span><span class="code-line">  <span class="token atrule key">processors</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">resource</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">attributes</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">action</span><span class="token punctuation">:</span> insert
</span><span class="code-line">          <span class="token atrule key">key</span><span class="token punctuation">:</span> loki.format
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> json
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">action</span><span class="token punctuation">:</span> insert
</span><span class="code-line">          <span class="token atrule key">key</span><span class="token punctuation">:</span> loki.resource.labels
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> pod<span class="token punctuation">,</span> namespace<span class="token punctuation">,</span> container<span class="token punctuation">,</span> cluster<span class="token punctuation">,</span> filename
</span><span class="code-line">  <span class="token atrule key">exporters</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">loki</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki.default.svc.cluster.local<span class="token punctuation">:</span>3100/loki/api/v1/push
</span><span class="code-line">    <span class="token atrule key">otlp</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">endpoint</span><span class="token punctuation">:</span> tempo.default.svc.cluster.local<span class="token punctuation">:</span><span class="token number">4317</span>
</span><span class="code-line">      <span class="token atrule key">tls</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">insecure</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">    <span class="token atrule key">debug</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">verbosity</span><span class="token punctuation">:</span> detailed
</span><span class="code-line"><span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">jaeger-compact</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">jaeger-thrift</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">jaeger-grpc</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">zipkin</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line"><span class="token atrule key">mode</span><span class="token punctuation">:</span> daemonset
</span><span class="code-line"><span class="token atrule key">presets</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">logsCollection</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">    <span class="token atrule key">storeCheckpoints</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://opentelemetry.io/docs/collector/deployment/agent/">OpenTelemetryë¥¼ Agent ë°©ì‹</a>ìœ¼ë¡œ ë°°í¬ë¥¼ í•œë‹¤. ê·¸ë˜ì„œ DaemonSetìœ¼ë¡œ <code>opentelemetry-collector-agent</code>ê°€ ìƒì„±ëœë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">helm repo <span class="token function">add</span> open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
</span><span class="code-line">helm <span class="token function">install</span> opentelemetry-collector open-telemetry/opentelemetry-collector <span class="token punctuation">\</span>
</span><span class="code-line">--values helm/opentelemetry-collector/values.yml
</span></code></pre></div><h2 id="app"><a href="#app" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>App</h2><p>ì´ì œ ìš°ë¦¬ê°€ ìˆ˜ì§‘í•˜ë ¤ëŠ” Applicationì—ì„œ Log, Trace, Metric ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•œë‹¤. ì—¬ê¸°ì„œ Instrumentationì„ í†µí•´ì„œ source ì½”ë“œë¥¼ ì¼ì¼ì´ ìˆ˜ì •í•´ì„œ Trace ì •ë³´ë¥¼ ë„£ì–´ì£¼ì§€ ì•Šì•„ë„ Trace ì •ë³´ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.</p><h3 id="nodejs"><a href="#nodejs" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nodejs</h3><p>Nestjsë¥¼ ì‚¬ìš©í•˜ê³  ì‡ëŠ”ë°, <code>@opentelemetry/instrumentation-nestjs-core</code>ì²˜ëŸ¼ imstumentation libraryë¥¼ ì œê³µí•˜ê³  ìˆì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-ts"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> NodeSDK <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@opentelemetry/sdk-node&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> OTLPTraceExporter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@opentelemetry/exporter-trace-otlp-http&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpInstrumentation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@opentelemetry/instrumentation-http&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ExpressInstrumentation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@opentelemetry/instrumentation-express&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> NestInstrumentation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@opentelemetry/instrumentation-nestjs-core&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> WinstonInstrumentation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@opentelemetry/instrumentation-winston&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> otelSDK <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeSDK</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  serviceName<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">api-node</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">  traceExporter<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OTLPTraceExporter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    url<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">http://</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_IP</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">:4318/v1/traces</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  instrumentations<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">HttpInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">ExpressInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">NestInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">WinstonInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token function function-variable">logHook</span><span class="token operator">:</span> <span class="token punctuation">(</span>_span<span class="token punctuation">,</span> record<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        record<span class="token punctuation">[</span><span class="token string">&#x27;resource.service.name&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#x27;test-service&#x27;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;SIGTERM&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  otelSDK
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;SDK shut down successfully&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Error shutting down SDK&#x27;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745">Githubì— winston instrumentation libaryê°€ Nestjsì—ì„œ ì˜ë„í•œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²ƒì— ëŒ€í•œ ì´ìŠˆ</a>ê°€ ì¡´ì¬í•˜ì˜€ê³ , ì—¬ê¸°ì„œ ì¶”ì²œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°ì„ í•˜ê²Œ ë˜ì—ˆë‹¤. Nestjs applicationì„ bootstrapí•˜ëŠ” ë¡œì§ì—ì„œ WinstonModuleë¡œ loggerë¥¼ ì„¤ì •í•  ë•Œ, printfë¼ëŠ” í•¨ìˆ˜ì—ì„œ ì§ì ‘ traceì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ì£¼ì…í•´ì£¼ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆë‹¤.</p><p><code>main.ts</code></p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> trace <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;@opentelemetry/api&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  otelSDK<span class="token punctuation">.</span><span class="token property-access function method">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token property-access function method">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">    logger<span class="token operator">:</span> <span class="token maybe-class-name">WinstonModule</span><span class="token punctuation">.</span><span class="token property-access function method">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      transports<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token keyword">new</span> <span class="token class-name">winston<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>Console</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">          format<span class="token operator">:</span> winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">combine</span><span class="token punctuation">(</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token comment">// winston instrumentation library doesn&#x27;t work in Nestjs.</span>
</span><span class="code-line">            <span class="token comment">// https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745</span>
</span><span class="code-line">            <span class="token comment">// followed the idea from the issue to fix the problem.</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token keyword">const</span> activeSpan <span class="token operator">=</span> trace<span class="token punctuation">.</span><span class="token property-access function method">getActiveSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token keyword">const</span> metaData<span class="token operator">:</span> <span class="token punctuation">{</span> span_id<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> trace_id<span class="token operator">?</span><span class="token operator">:</span> string <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">              <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>activeSpan<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                metaData<span class="token punctuation">.</span><span class="token property-access">span_id</span> <span class="token operator">=</span> activeSpan<span class="token punctuation">.</span><span class="token property-access function method">spanContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">spanId</span>
</span><span class="code-line">                metaData<span class="token punctuation">.</span><span class="token property-access">trace_id</span> <span class="token operator">=</span> activeSpan<span class="token punctuation">.</span><span class="token property-access function method">spanContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">traceId</span>
</span><span class="code-line">              <span class="token punctuation">}</span>
</span><span class="code-line">              <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>info<span class="token punctuation">.</span><span class="token property-access">level</span><span class="token punctuation">.</span><span class="token property-access function method">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">] [trace_id=</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>metaData<span class="token punctuation">.</span><span class="token property-access">trace_id</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"> span_id=</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">                metaData<span class="token punctuation">.</span><span class="token property-access">span_id</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">              <span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>info<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span><span class="token class-name known-class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access function method">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">                <span class="token operator spread">...</span>info<span class="token punctuation">,</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token property-access function method">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p>Dockerë¡œ buildí•œ Imageë¥¼ minikube ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ clusterì— loadí•œë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">docker build -t my-node-app ./my-node-app
</span><span class="code-line">minikube image load my-node-app:latest
</span></code></pre></div><p>minikubeì˜ ëª…ë ¹ì–´ë¡œ imageê°€ ì •ìƒì ìœ¼ë¡œ loadë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ minikube image list
</span><span class="code-line">docker.io/library/my-node-app:latest
</span></code></pre></div><p>Localì— ìˆëŠ” Imageë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <code>imagePullPolicy: Never</code>ë¡œ ì„¤ì •ì„ í•´ì¤€ë‹¤. <code>OTEL_LOG_LEVEL</code> í™˜ê²½ë³€ìˆ˜ëŠ” Nodejsì—ì„œ OpenTelemetry SDK libaryì˜ Debug ë¡œê·¸ë¥¼ ë³´ê¸° ìœ„í•´ì„œ ì„¤ì •í–ˆë‹¤. <code>NODE_IP</code>ëŠ” OpenTelmetry Collectorê°€ DaemonSetìœ¼ë¡œ ë„ê³  HostPortë¥¼ ì„¤ì •í•˜ê³  ìˆë‹¤. ê·¸ë˜ì„œ Node IPë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ë„˜ê²¨ì£¼ì—ˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>node<span class="token punctuation">-</span>app
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">3</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>node<span class="token punctuation">-</span>app
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>node<span class="token punctuation">-</span>app
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>node<span class="token punctuation">-</span>app
</span><span class="code-line">          <span class="token atrule key">name</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>node
</span><span class="code-line">          <span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> Never
</span><span class="code-line">          <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> api<span class="token punctuation">-</span>node<span class="token punctuation">-</span>port
</span><span class="code-line">              <span class="token atrule key">containerPort</span><span class="token punctuation">:</span> <span class="token number">3000</span>
</span><span class="code-line">          <span class="token atrule key">env</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> OTEL_LOG_LEVEL
</span><span class="code-line">              <span class="token atrule key">value</span><span class="token punctuation">:</span> DEBUG
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> NODE_IP
</span><span class="code-line">              <span class="token atrule key">valueFrom</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token atrule key">fieldRef</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token atrule key">fieldPath</span><span class="token punctuation">:</span> status.hostIP
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl apply -f k8s/my-node-app/deployment.yml
</span><span class="code-line">kubectl apply -f k8s/my-node-app/service.yml
</span></code></pre></div><h3 id="python"><a href="#python" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Python</h3><p>Pythonì€ FastAPIë¡œ ê°„ë‹¨í•œ API ì„œë²„ë¥¼ ë§Œë“¤ì—ˆë‹¤. ë™ì¼í•˜ê²Œ ì œê³µí•˜ëŠ” intrumentation libraryë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¤ì •í•˜ì˜€ê³ , NodejsëŠ” OpenTelemetry Collectorê°€ ì—°ê²°í•  ë•Œ httpë¡œ ì—´ë ¤ ìˆëŠ” 4318 í¬íŠ¸ ì—°ê²°í–ˆì§€ë§Œ, ì—¬ê¸°ì—ì„œ grpcë¡œ ì—´ë ¤ ìˆëŠ” 4317 í¬íŠ¸ë¡œ ì—°ê²°í•˜ì˜€ë‹¤. Pythonì—ì„œ Logê°€ Experimental statusë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ë™ì¼í•˜ê²Œ <code>opentelemetry.instrumentation.logging</code>ë¥¼ í†µí•´ì„œ logì— Trace IDë¥¼ ë‚¨ê¸°ê³  Kubernetes log fileì„ tailí•˜ë„ë¡ í•˜ì˜€ë‹¤.</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token keyword">import</span> logging
</span><span class="code-line"><span class="token keyword">import</span> os
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry <span class="token keyword">import</span> trace
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span>resources <span class="token keyword">import</span> Resource
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span>trace <span class="token keyword">import</span> TracerProvider
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry<span class="token punctuation">.</span>exporter<span class="token punctuation">.</span>otlp<span class="token punctuation">.</span>proto<span class="token punctuation">.</span>grpc<span class="token punctuation">.</span>trace_exporter <span class="token keyword">import</span> OTLPSpanExporter
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span>trace<span class="token punctuation">.</span>export <span class="token keyword">import</span> BatchSpanProcessor
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry<span class="token punctuation">.</span>instrumentation<span class="token punctuation">.</span>fastapi <span class="token keyword">import</span> FastAPIInstrumentor
</span><span class="code-line"><span class="token keyword">from</span> opentelemetry<span class="token punctuation">.</span>instrumentation<span class="token punctuation">.</span>logging <span class="token keyword">import</span> LoggingInstrumentor
</span><span class="code-line"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI
</span><span class="code-line">
</span><span class="code-line">resource <span class="token operator">=</span> Resource<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;service.name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;api-python&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">trace<span class="token punctuation">.</span>set_tracer_provider<span class="token punctuation">(</span>TracerProvider<span class="token punctuation">(</span>resource<span class="token operator">=</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">trace<span class="token punctuation">.</span>get_tracer_provider<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add_span_processor<span class="token punctuation">(</span>
</span><span class="code-line">    BatchSpanProcessor<span class="token punctuation">(</span>OTLPSpanExporter<span class="token punctuation">(</span>endpoint<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#x27;NODE_IP&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">:4317&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation annotation decorator">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">read_root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;hello world!&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token string">&quot;Hello From Python App!&quot;</span>
</span><span class="code-line">
</span><span class="code-line">FastAPIInstrumentor<span class="token punctuation">.</span>instrument_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
</span><span class="code-line">LoggingInstrumentor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>instrument<span class="token punctuation">(</span>set_logging_format<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</span></code></pre></div><p>ì„œë¹„ìŠ¤ê°„ì˜ í†µì‹ ì„ ìœ„í•´ì„œ ì˜ˆì œì½”ë“œì˜ Python Appë„ ë™ì¼í•˜ê²Œ ë°˜ë³µí•œë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">docker build -t my-python-app ./my-python-app
</span><span class="code-line">minikube image load my-python-app:latest
</span><span class="code-line">kubectl apply -f k8s/my-python-app/deployment.yml
</span><span class="code-line">kubectl apply -f k8s/my-python-app/service.yml
</span></code></pre></div><h3 id="ì„œë¹„ìŠ¤ê°„ì˜-í†µì‹ "><a href="#ì„œë¹„ìŠ¤ê°„ì˜-í†µì‹ " aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ì„œë¹„ìŠ¤ê°„ì˜ í†µì‹ </h3><p>client -&gt; nodejs app -&gt; python appìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ì‹¤í–‰í•´ë³¸ë‹¤.</p><p>nodejs app Serviceì— Port Fowardingì„ í•˜ê³  <code>/something</code>ì— ìš”ì²­í•˜ë©´ nodejs appì´ python app ìš”ì²­í•˜ì—¬ ë°›ì•„ì˜¨ ì‘ë‹µê°’ì„ ì „ë‹¬í•˜ê²Œ ëœë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl port-forward svc/my-node-app-svc <span class="token number">3000</span>:3000
</span><span class="code-line"><span class="token function">curl</span> localhost:3000/something
</span></code></pre></div><p>tempoì—ì„œ ì•„ë˜ì™€ ê°™ì´ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p><img src="/static/images/otel-trace-for-inter-service-communication.png" alt="trace for inter service communication"/><h2 id="metric"><a href="#metric" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Metric</h2><p>Metricì„ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ì´ ìƒê°í•´ë³¼ ìˆ˜ ìˆë‹¤.</p><ol><li><code>@opentelemetry/exporter-prometheus</code>ë¡œ Prometheusì—ì„œ Pull ë°©ì‹ìœ¼ë¡œ ìˆ˜ì§‘</li></ol><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> otelSDK <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeSDK</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  metricReader<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">PrometheusExporter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    port<span class="token operator">:</span> <span class="token number">9464</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><ol start="2"><li>OpenTelemetry collectorê°€ receiverë¡œ ë°›ì•„ì„œ prometheus exporterë¡œ Pull ë°©ì‹ìœ¼ë¡œ ìˆ˜ì§‘</li></ol><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> otelSDK <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeSDK</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  metricReader<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">PeriodicExportingMetricReader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    exporter<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OTLPMetricExporter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      url<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">http://</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_IP</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">:4318/v1/metrics</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><ol start="3"><li>Prometheusì˜ OLTP protocolë¡œ ë°”ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” endpointë¡œ Push ë°©ì‹ìœ¼ë¡œ ìˆ˜ì§‘</li></ol><p>3ë²ˆì§¸ ë°©ë²•ì€ ì˜¬í•´ ì—¬ë¦„ <a target="_blank" rel="noopener noreferrer" href="https://horovits.medium.com/prometheus-now-supports-opentelemetry-metrics-83f85878e46a">Prometheusì—ì„œ ë°”ë¡œ OLTP protocolë¡œ ë°›ì„ ìˆ˜ ìˆëŠ” endpointë¥¼ ì¶”ê°€</a>ê°€ ë˜ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ Experimental featureë¡œ ì œê³µë˜ê³  ìˆë‹¤. ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ì•„ë˜ì²˜ëŸ¼ <code>otlp-write-receiver</code>ë¥¼ enableí•˜ë„ë¡ ì„¤ì •í•´ì¤€ë‹¤.</p><p><code>values.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">server</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">extraFlags</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> enable<span class="token punctuation">-</span>feature=otlp<span class="token punctuation">-</span>write<span class="token punctuation">-</span>receiver
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">helm repo <span class="token function">add</span> prometheus-community https://prometheus-community.github.io/helm-charts
</span><span class="code-line">helm <span class="token function">install</span> prometheus prometheus-community/prometheus --values helm/prometheus/values.yml
</span></code></pre></div><p>prometheus-serverì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ í•´ë‹¹ featureê°€ enableë˜ì—ˆë‹¤ëŠ” logë¥¼ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-log"><span class="code-line">ts<span class="token operator">=</span><span class="token number date">2024-01-03T</span><span class="token number time">01:41:21.711Z</span> caller<span class="token operator">=</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">175</span> level<span class="token operator">=</span>info msg<span class="token operator">=</span><span class="token string">&quot;Experimental OTLP write receiver enabled&quot;</span>
</span></code></pre></div><p>ì´ì œ <code>OTLPMetricExporter</code>ë¥¼ ì‚¬ìš©í•˜ê³ , urlë¥¼ promethues ì„œë²„ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. URL ì„¤ì •ì´ ì¢€ í—›ê°ˆë ¸ëŠ”ë°, otlpì˜ pathë¥¼ ë”°ë¼ì„œ <code>/api/v1/otlp/v1/metrics</code>ë¡œ ì§€ì •í•˜ë©´ ëœë‹¤. <a target="_blank" rel="noopener noreferrer" href="https://github.com/prometheus/docs/pull/2382">Github issueì—ì„œ í•´ë‹¹ featureë¥¼ ì‚¬ìš©í•˜ëŠ” Python ì˜ˆì œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒ</a>ì´ ìˆì–´ì„œ ì°¸ê³ í•  ìˆ˜ ìˆì—ˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">const</span> otelSDK <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeSDK</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  serviceName<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">api-node</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">  metricReader<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">PeriodicExportingMetricReader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    exporter<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OTLPMetricExporter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      url<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">http://prometheus-server/api/v1/otlp/v1/metrics</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  traceExporter<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OTLPTraceExporter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    url<span class="token operator">:</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">http://</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_IP</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">:4318/v1/traces</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  instrumentations<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">HttpInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">ExpressInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">NestInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token keyword">new</span> <span class="token class-name">WinstonInstrumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><p>ì´ì œ ì •ìƒì ìœ¼ë¡œ Metricì´ Prometheusì— ìˆ˜ì§‘ë˜ê³ , Grafanaë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><p>ìœ„ì—ì„œ Grafana values.ymlì— Tempoë¥¼ ì¶”ê°€í•˜ì˜€ëŠ”ë°, <code>traceToLogsV2</code>ì™€ <code>traceToMetrics</code> ì„¤ì •ì„ ì´ìš©í•˜ë©´ ì¶”ê°€ì ìœ¼ë¡œ Traceì—ì„œ ì„¤ì •ëœ í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ê°€ ìˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> Tempo
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> tempo
</span><span class="code-line">  <span class="token atrule key">access</span><span class="token punctuation">:</span> proxy
</span><span class="code-line">  <span class="token atrule key">orgId</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//tempo<span class="token punctuation">:</span><span class="token number">3100</span>
</span><span class="code-line">  <span class="token atrule key">basicAuth</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">isDefault</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">editable</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">uid</span><span class="token punctuation">:</span> tempo
</span><span class="code-line">  <span class="token atrule key">jsonData</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">tracesToLogsV2</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">datasourceUid</span><span class="token punctuation">:</span> <span class="token string">&#x27;Loki&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">spanStartTimeShift</span><span class="token punctuation">:</span> <span class="token string">&#x27;1h&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">spanEndTimeShift</span><span class="token punctuation">:</span> <span class="token string">&#x27;-1h&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token atrule key">key</span><span class="token punctuation">:</span> <span class="token string">&#x27;service.name&#x27;</span><span class="token punctuation">,</span> <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;container&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</span><span class="code-line">      <span class="token atrule key">filterByTraceID</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">      <span class="token atrule key">filterBySpanID</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">      <span class="token atrule key">customQuery</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">      <span class="token atrule key">query</span><span class="token punctuation">:</span> <span class="token string">&#x27;{$${__tags}} |=&quot;$${__span.traceId}&quot;&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">tracesToMetrics</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">datasourceUid</span><span class="token punctuation">:</span> <span class="token string">&#x27;Prometheus&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">spanStartTimeShift</span><span class="token punctuation">:</span> <span class="token string">&#x27;1h&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">spanEndTimeShift</span><span class="token punctuation">:</span> <span class="token string">&#x27;-1h&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token atrule key">key</span><span class="token punctuation">:</span> <span class="token string">&#x27;service.name&#x27;</span><span class="token punctuation">,</span> <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;job&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
</span><span class="code-line">      <span class="token atrule key">queries</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> <span class="token string">&#x27;Sample query&#x27;</span>
</span><span class="code-line">          <span class="token atrule key">query</span><span class="token punctuation">:</span> <span class="token string">&#x27;sum(rate(http_server_duration_milliseconds_bucket{$$__tags}[5m]))&#x27;</span>
</span></code></pre></div><p>ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ Tempo Traceì •ë³´ì—ì„œ <code>related log</code>ì™€ <code>Sample query</code>ë¼ëŠ” ë©”ë‰´ë¥¼ í¼ì³ ë³¼ìˆ˜ê°€ ìˆê²Œ ëœë‹¤.</p><img src="/static/images/otel-trace-log-and-metric.png" alt="link to move log page and trace page"/><p><code>related log</code>ë¥¼ í´ë¦­í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ì—ì„œ ì •ì˜í•œ <code>&#x27;{$${__tags}} |=&quot;$${__span.traceId}&quot;&#x27;</code> í˜•ì‹ëŒ€ë¡œ ë°”ë¡œ ì¿¼ë¦¬í•´ì„œ ë³´ì—¬ì£¼ê²Œ ëœë‹¤.</p><img src="/static/images/otel-trace-to-log.png" alt="log query relating to traceId"/><p><code>Sample query</code>ë¥¼ í´ë¦­í•˜ë©´ ë§ˆì°¬ê°€ì§€ë¡œ ì„¤ì •ì—ì„œ ì •ì˜í•œ ì¿¼ë¦¬ë¡œ ë³´ì—¬ì£¼ê²Œ ëœë‹¤.</p><img src="/static/images/otel-trace-to-metric.png" alt="metric query"/><p>ê·¸ë¦¬ê³  nodeGraphë¥¼ enableí•˜ì—¬ ì•„ë˜ì²˜ëŸ¼ ì–´ë–»ê²Œ í˜¸ì¶œë˜ê³  ìˆëŠ”ì§€ Graphë¡œ ë³¼ ìˆ˜ë„ ìˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> Tempo
</span><span class="code-line">  <span class="token comment"># ...ìƒëµ</span>
</span><span class="code-line">  <span class="token atrule key">nodeGraph</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span></code></pre></div><img src="/static/images/otel-node-graph.png" alt="node graph"/><h3 id="ì•„ì§-ê°œë°œë˜ì§€-ì•Šì€-ê¸°ëŠ¥ë“¤"><a href="#ì•„ì§-ê°œë°œë˜ì§€-ì•Šì€-ê¸°ëŠ¥ë“¤" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ì•„ì§ ê°œë°œë˜ì§€ ì•Šì€ ê¸°ëŠ¥ë“¤</h3><p>Node runtimeì˜ metricì„ Instrumentation libraryë¡œ ì‰½ê²Œ ë°›ìœ¼ë©´ ì¢‹ê² ë‹¤ ì‹¶ì–´ì„œ ì°¾ì•„ë´¤ì§€ë§Œ, ì•„ì§ <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1106">Github issueì— ìš”ì²­</a>ìœ¼ë¡œ ë‚¨ì•„ ìˆëŠ” ìƒíƒœì´ë‹¤. ëŒ€ì•ˆìœ¼ë¡œ <a target="_blank" rel="noopener noreferrer" href="https://github.com/siimon/prom-client">prom-client</a> defaultMetricì„ ìˆ˜ì§‘í•˜ë„ë¡ í•˜ì—¬ ë³„ë„ë¡ Prometheus í¬ë©§ìœ¼ë¡œ ë”°ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê² ë‹¤. Nodejs eventloop lagì´ë‚˜ GCê´€ë ¨ metricì„ defaultë¡œ ì‰½ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ì•„ë˜ì²˜ëŸ¼ Nestjsì— ì¶”ê°€í•˜ê³ , Prometheus scrape configë¡œ PULL ë°©ì‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ë„ë¡ í•  ìˆ˜ ìˆê² ë‹¤.</p><p><code>service.ts</code></p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token maybe-class-name">Injectable</span><span class="token punctuation">,</span> <span class="token maybe-class-name">OnModuleInit</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;@nestjs/common&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword module">as</span> client</span> <span class="token keyword module">from</span> <span class="token string">&#x27;prom-client&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">@<span class="token function"><span class="token maybe-class-name">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name">PrometheusService</span> <span class="token keyword">implements</span> <span class="token class-name">OnModuleInit</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">private</span> register<span class="token operator">:</span> client<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Registry</span></span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">onModuleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> defaultLabels <span class="token operator">=</span> <span class="token punctuation">{</span> service<span class="token operator">:</span> <span class="token string">&#x27;node-api&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> collectDefaultMetric <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token property-access">collectDefaultMetrics</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> <span class="token maybe-class-name">Registry</span> <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Registry</span></span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">const</span> register <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Registry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    register<span class="token punctuation">.</span><span class="token property-access function method">setDefaultLabels</span><span class="token punctuation">(</span>defaultLabels<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">collectDefaultMetric</span><span class="token punctuation">(</span><span class="token punctuation">{</span> register <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">register</span> <span class="token operator">=</span> register<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">getRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">register</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>controller.ts</code></p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line">@<span class="token function"><span class="token maybe-class-name">Controller</span></span><span class="token punctuation">(</span><span class="token string">&#x27;prometheus&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">class</span> <span class="token class-name">PrometheusController</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> readonly prometheusService<span class="token operator">:</span> <span class="token maybe-class-name">PrometheusService</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  @<span class="token function"><span class="token maybe-class-name">Get</span></span><span class="token punctuation">(</span><span class="token string">&#x27;metrics&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token function">getMetrics</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function"><span class="token maybe-class-name">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token operator">:</span> <span class="token maybe-class-name">Response</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> register <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">prometheusService</span><span class="token punctuation">.</span><span class="token property-access function method">getRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    res<span class="token punctuation">.</span><span class="token property-access function method">setHeader</span><span class="token punctuation">(</span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">,</span> register<span class="token punctuation">.</span><span class="token property-access">contentType</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    register<span class="token punctuation">.</span><span class="token property-access function method">metrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access function method">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> res<span class="token punctuation">.</span><span class="token property-access function method">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access function method">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>ê·¸ë¦¬ê³  <a target="_blank" rel="noopener noreferrer" href="https://grafana.com/docs/grafana/latest/fundamentals/exemplars/">Grafanaì—ì„œ Exemplar</a>ë¥¼ í†µí•´ì„œ Metricê³¼ ê´€ë ¨ëœ Trace ì •ë³´ë¥¼ ë°”ë¡œ ì°¾ì•„ ë³¼ ìˆ˜ ìˆê²Œ í•˜ê³  ì‹¶ì—ˆë‹¤. í•˜ì§€ë§Œ ì´ê²ƒë„ <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-js/issues/2594">Github Issueì— ìš”ì²­ë˜ì–´ ìˆëŠ” ìƒíƒœë¡œ ë‚¨ì•„ ìˆë‹¤.</a></p><p>ğŸ¤“ ì•„ì§ ì´í•´ë„ê°€ ë¶€ì¡±í•˜ì§€ë§Œ ì•ìœ¼ë¡œ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ê³ ë¯¼í•  ë•Œ ë§Œë“¤ì–´ë³´ë©´ ì¬ë¯¸ìˆì„ ê²ƒ ê°™ë‹¤.</p><h3 id="updateëœ-ê¸°ëŠ¥"><a href="#updateëœ-ê¸°ëŠ¥" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Updateëœ ê¸°ëŠ¥</h3><p>ì‘ì„±í•  ë‹¹ì‹œì— grafana Helm chart ë²„ì „ 7.0.19ì„ ì‚¬ìš©í–ˆê³ , í•´ë‹¹ Chartë¡œ Grafana <code>10.2.2</code>ê°€ ì„¤ì¹˜ê°€ ë˜ì—ˆë‹¤. Lokiì—ì„œ trace_idê°€ ìˆëŠ” ê²½ìš°ì— ë°”ë¡œ Tempoë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë²„íŠ¼ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ datasource ì„¤ì •ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ì˜€ë‹¤.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">datasources</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> Loki
</span><span class="code-line">    <span class="token atrule key">type</span><span class="token punctuation">:</span> loki
</span><span class="code-line">    <span class="token atrule key">access</span><span class="token punctuation">:</span> proxy
</span><span class="code-line">    <span class="token atrule key">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki<span class="token punctuation">:</span><span class="token number">3100</span>
</span><span class="code-line">    <span class="token atrule key">basicAuth</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">    <span class="token atrule key">jsonData</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">maxLines</span><span class="token punctuation">:</span> <span class="token number">1000</span>
</span><span class="code-line">      <span class="token atrule key">derivedFields</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">datasourceName</span><span class="token punctuation">:</span> Tempo
</span><span class="code-line">          <span class="token atrule key">datasourceUid</span><span class="token punctuation">:</span> tempo
</span><span class="code-line">          <span class="token atrule key">matcherRegex</span><span class="token punctuation">:</span> trace_id=(\w+)
</span><span class="code-line">          <span class="token atrule key">name</span><span class="token punctuation">:</span> traceID
</span><span class="code-line">          <span class="token atrule key">url</span><span class="token punctuation">:</span> $$<span class="token punctuation">{</span>__value.raw<span class="token punctuation">}</span>
</span></code></pre></div><p>ê·¸ë¦¬ê³  regexë¡œ <code>trace_id=(\w+)</code>ì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´ì„œ applicationì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ë•Œ í•´ë‹¹ formatìœ¼ë¡œ ì•„ë˜ì²˜ëŸ¼ ë‚¨ê¸°ë„ë¡ í–ˆì—ˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> trace <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;@opentelemetry/api&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  otelSDK<span class="token punctuation">.</span><span class="token property-access function method">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token property-access function method">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">    logger<span class="token operator">:</span> <span class="token maybe-class-name">WinstonModule</span><span class="token punctuation">.</span><span class="token property-access function method">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      transports<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token keyword">new</span> <span class="token class-name">winston<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>Console</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">          format<span class="token operator">:</span> winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">combine</span><span class="token punctuation">(</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token comment">// winston instrumentation library doesn&#x27;t work in Nestjs.</span>
</span><span class="code-line">            <span class="token comment">// https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745</span>
</span><span class="code-line">            <span class="token comment">// followed the idea from the issue to fix the problem.</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token keyword">const</span> activeSpan <span class="token operator">=</span> trace<span class="token punctuation">.</span><span class="token property-access function method">getActiveSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token keyword">const</span> metaData<span class="token operator">:</span> <span class="token punctuation">{</span> span_id<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">,</span> trace_id<span class="token operator">?</span><span class="token operator">:</span> string <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">              <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>activeSpan<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                metaData<span class="token punctuation">.</span><span class="token property-access">span_id</span> <span class="token operator">=</span> activeSpan<span class="token punctuation">.</span><span class="token property-access function method">spanContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">spanId</span>
</span><span class="code-line">                metaData<span class="token punctuation">.</span><span class="token property-access">trace_id</span> <span class="token operator">=</span> activeSpan<span class="token punctuation">.</span><span class="token property-access function method">spanContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">traceId</span>
</span><span class="code-line">              <span class="token punctuation">}</span>
</span><span class="code-line">              <span class="token keyword control-flow">return</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>info<span class="token punctuation">.</span><span class="token property-access">level</span><span class="token punctuation">.</span><span class="token property-access function method">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">] [trace_id=</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>metaData<span class="token punctuation">.</span><span class="token property-access">trace_id</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"> span_id=</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">                metaData<span class="token punctuation">.</span><span class="token property-access">span_id</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">              <span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>info<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span><span class="token class-name known-class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access function method">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">                <span class="token operator spread">...</span>info<span class="token punctuation">,</span>
</span></span></span><span class="code-line"><span class="token template-string"><span class="token interpolation">              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token property-access function method">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/grafana/grafana/commit/53758ad7642e9d3646bbad3698e55774bdf0623c">Grafana 10.3.1ì— Labelì—ì„œ TraceIDë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ëœ Commitì´ ë°˜ì˜</a>ëœ ê²ƒì„ í™•ì¸í•˜ì˜€ë‹¤. <a target="_blank" rel="noopener noreferrer" href="https://github.com/grafana/grafana/blob/v10.3.1/public/app/plugins/datasource/loki/types.ts">ì†ŒìŠ¤ì½”ë“œ</a>ë¥¼ í™•ì¸í•˜ë©´ <code>matcherType</code>ì´ë¼ëŠ” ê²ƒì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ <code>matcherType</code>ì„ <code>label</code>ë¡œ ì„¤ì •í•˜ê³ , <code>MatcherRegex</code>ë¥¼ label keyì¸ <code>traceID</code>ë¡œ ì •ì˜í•˜ë©´ labelì— ìˆëŠ” <code>traceID</code>ë¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">derivedFields</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">datasourceName</span><span class="token punctuation">:</span> Tempo
</span><span class="code-line">    <span class="token atrule key">datasourceUid</span><span class="token punctuation">:</span> tempo
</span><span class="code-line">    <span class="token atrule key">name</span><span class="token punctuation">:</span> traceID
</span><span class="code-line">    <span class="token atrule key">matcherType</span><span class="token punctuation">:</span> label
</span><span class="code-line">    <span class="token atrule key">matcherRegex</span><span class="token punctuation">:</span> traceID
</span><span class="code-line">    <span class="token atrule key">url</span><span class="token punctuation">:</span> $$<span class="token punctuation">{</span>__value.raw<span class="token punctuation">}</span>
</span></code></pre></div><p>Application Codeì—ì„œëŠ” traceID, spanIDë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ê°™ì´ ë‚¨ê²¼ë‹¤.</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  otelSDK<span class="token punctuation">.</span><span class="token property-access function method">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">NestFactory</span><span class="token punctuation">.</span><span class="token property-access function method">create</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">    logger<span class="token operator">:</span> <span class="token maybe-class-name">WinstonModule</span><span class="token punctuation">.</span><span class="token property-access function method">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">      transports<span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token keyword">new</span> <span class="token class-name">winston<span class="token punctuation">.</span>transports<span class="token punctuation">.</span>Console</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">          format<span class="token operator">:</span> winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">combine</span><span class="token punctuation">(</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token comment">// winston instrumentation library doesn&#x27;t work in Nestjs.</span>
</span><span class="code-line">            <span class="token comment">// https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745</span>
</span><span class="code-line">            <span class="token comment">// followed the idea from the issue to fix the problem.</span>
</span><span class="code-line">            winston<span class="token punctuation">.</span><span class="token property-access">format</span><span class="token punctuation">.</span><span class="token property-access function method">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator arrow">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">              <span class="token keyword">const</span> log <span class="token operator">=</span> info
</span><span class="code-line">              <span class="token keyword">const</span> activeSpan <span class="token operator">=</span> trace<span class="token punctuation">.</span><span class="token property-access function method">getActiveSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>activeSpan<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">[</span><span class="token string">&#x27;spanID&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> activeSpan<span class="token punctuation">.</span><span class="token property-access function method">spanContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">spanId</span>
</span><span class="code-line">                log<span class="token punctuation">[</span><span class="token string">&#x27;traceID&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> activeSpan<span class="token punctuation">.</span><span class="token property-access function method">spanContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">traceId</span>
</span><span class="code-line">              <span class="token punctuation">}</span>
</span><span class="code-line">              <span class="token keyword control-flow">return</span> <span class="token class-name known-class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access function method">stringify</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">          <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">await</span> app<span class="token punctuation">.</span><span class="token property-access function method">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p>ê·¸ë¦¬ê³  OpenTelemetry Collect Helm chartì˜ valueì—ì„œ loki labelì„ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í•˜ë„ë¡ ë³€ê²½í•˜ì˜€ë‹¤. <code>operators</code> ë§ˆì§€ë§‰ì— <code>jsonParser</code>ë¥¼ í†µí•´ì„œ Applicationì´ ë‚¨ê¸´ JSON í˜•ì‹ì˜ string logê°’ì„ parsingí•œë‹¤. ì´ë ‡ê²Œ parsingëœ JSON ê°’ë“¤ì€ attributesì— ì €ì¥ë˜ëŠ”ë°, attributes processorë¥¼ í†µí•´ì„œ loki labelê°’ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì—ˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">config</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">jaeger</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">    <span class="token atrule key">prometheus</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">    <span class="token atrule key">zipkin</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">    <span class="token atrule key">filelog</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">exclude</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">      <span class="token atrule key">include</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> /var/log/pods/dev_aidt<span class="token punctuation">-</span>test<span class="token important">*/*/*.log</span>
</span><span class="code-line">      <span class="token atrule key">include_file_name</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">      <span class="token atrule key">include_file_path</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">      <span class="token atrule key">operators</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> get<span class="token punctuation">-</span>format
</span><span class="code-line">          <span class="token atrule key">routes</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">expr</span><span class="token punctuation">:</span> body matches &quot;^\\<span class="token punctuation">{</span>&quot;
</span><span class="code-line">              <span class="token atrule key">output</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>docker
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">expr</span><span class="token punctuation">:</span> body matches &quot;^<span class="token punctuation">[</span>^ Z<span class="token punctuation">]</span>+ &quot;
</span><span class="code-line">              <span class="token atrule key">output</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>crio
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">expr</span><span class="token punctuation">:</span> body matches &quot;^<span class="token punctuation">[</span>^ Z<span class="token punctuation">]</span>+Z&quot;
</span><span class="code-line">              <span class="token atrule key">output</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>containerd
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> router
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>crio
</span><span class="code-line">          <span class="token atrule key">regex</span><span class="token punctuation">:</span> ^(<span class="token punctuation">?</span>P&lt;time<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>^ Z<span class="token punctuation">]</span>+) (<span class="token punctuation">?</span>P&lt;stream<span class="token punctuation">&gt;</span>stdout<span class="token punctuation">|</span>stderr) (<span class="token punctuation">?</span>P&lt;logtag<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>^ <span class="token punctuation">]</span><span class="token important">*)</span> <span class="token punctuation">?</span>(<span class="token punctuation">?</span>P&lt;log<span class="token punctuation">&gt;</span>.<span class="token important">*)$</span>
</span><span class="code-line">          <span class="token atrule key">timestamp</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">layout</span><span class="token punctuation">:</span> 2006<span class="token punctuation">-</span>01<span class="token punctuation">-</span>02T15<span class="token punctuation">:</span>04<span class="token punctuation">:</span>05.999999999Z07<span class="token punctuation">:</span><span class="token number">00</span>
</span><span class="code-line">            <span class="token atrule key">layout_type</span><span class="token punctuation">:</span> gotime
</span><span class="code-line">            <span class="token atrule key">parse_from</span><span class="token punctuation">:</span> attributes.time
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> regex_parser
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">combine_field</span><span class="token punctuation">:</span> attributes.log
</span><span class="code-line">          <span class="token atrule key">combine_with</span><span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>
</span><span class="code-line">          <span class="token atrule key">id</span><span class="token punctuation">:</span> crio<span class="token punctuation">-</span>recombine
</span><span class="code-line">          <span class="token atrule key">is_last_entry</span><span class="token punctuation">:</span> attributes.logtag == &#x27;F&#x27;
</span><span class="code-line">          <span class="token atrule key">max_log_size</span><span class="token punctuation">:</span> <span class="token number">102400</span>
</span><span class="code-line">          <span class="token atrule key">output</span><span class="token punctuation">:</span> extract_metadata_from_filepath
</span><span class="code-line">          <span class="token atrule key">source_identifier</span><span class="token punctuation">:</span> attributes<span class="token punctuation">[</span><span class="token string">&quot;log.file.path&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> recombine
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>containerd
</span><span class="code-line">          <span class="token atrule key">regex</span><span class="token punctuation">:</span> ^(<span class="token punctuation">?</span>P&lt;time<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>^ ^Z<span class="token punctuation">]</span>+Z) (<span class="token punctuation">?</span>P&lt;stream<span class="token punctuation">&gt;</span>stdout<span class="token punctuation">|</span>stderr) (<span class="token punctuation">?</span>P&lt;logtag<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>^ <span class="token punctuation">]</span><span class="token important">*)</span> <span class="token punctuation">?</span>(<span class="token punctuation">?</span>P&lt;log<span class="token punctuation">&gt;</span>.<span class="token important">*)$</span>
</span><span class="code-line">          <span class="token atrule key">timestamp</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">layout</span><span class="token punctuation">:</span> <span class="token string">&#x27;%Y-%m-%dT%H:%M:%S.%LZ&#x27;</span>
</span><span class="code-line">            <span class="token atrule key">parse_from</span><span class="token punctuation">:</span> attributes.time
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> regex_parser
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">combine_field</span><span class="token punctuation">:</span> attributes.log
</span><span class="code-line">          <span class="token atrule key">combine_with</span><span class="token punctuation">:</span> <span class="token string">&#x27;&#x27;</span>
</span><span class="code-line">          <span class="token atrule key">id</span><span class="token punctuation">:</span> containerd<span class="token punctuation">-</span>recombine
</span><span class="code-line">          <span class="token atrule key">is_last_entry</span><span class="token punctuation">:</span> attributes.logtag == &#x27;F&#x27;
</span><span class="code-line">          <span class="token atrule key">max_log_size</span><span class="token punctuation">:</span> <span class="token number">102400</span>
</span><span class="code-line">          <span class="token atrule key">output</span><span class="token punctuation">:</span> extract_metadata_from_filepath
</span><span class="code-line">          <span class="token atrule key">source_identifier</span><span class="token punctuation">:</span> attributes<span class="token punctuation">[</span><span class="token string">&quot;log.file.path&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> recombine
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> parser<span class="token punctuation">-</span>docker
</span><span class="code-line">          <span class="token atrule key">output</span><span class="token punctuation">:</span> extract_metadata_from_filepath
</span><span class="code-line">          <span class="token atrule key">timestamp</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">layout</span><span class="token punctuation">:</span> <span class="token string">&#x27;%Y-%m-%dT%H:%M:%S.%LZ&#x27;</span>
</span><span class="code-line">            <span class="token atrule key">parse_from</span><span class="token punctuation">:</span> attributes.time
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> json_parser
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> extract_metadata_from_filepath
</span><span class="code-line">          <span class="token atrule key">parse_from</span><span class="token punctuation">:</span> attributes<span class="token punctuation">[</span><span class="token string">&quot;log.file.path&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">regex</span><span class="token punctuation">:</span> ^.<span class="token important">*\/(?P&lt;namespace&gt;</span><span class="token punctuation">[</span>^_<span class="token punctuation">]</span>+)_(<span class="token punctuation">?</span>P&lt;pod_name<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>^_<span class="token punctuation">]</span>+)_(<span class="token punctuation">?</span>P&lt;uid<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>a<span class="token punctuation">-</span>f0<span class="token punctuation">-</span>9\<span class="token punctuation">-</span><span class="token punctuation">]</span>+)\/(<span class="token punctuation">?</span>P&lt;container_name<span class="token punctuation">&gt;</span><span class="token punctuation">[</span>^\._<span class="token punctuation">]</span>+)\/(<span class="token punctuation">?</span>P&lt;restart_count<span class="token punctuation">&gt;</span>\d+)\.log$
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> regex_parser
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.stream
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> attributes<span class="token punctuation">[</span><span class="token string">&quot;log.iostream&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.container_name
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.namespace
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.pod_name
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> resource<span class="token punctuation">[</span><span class="token string">&quot;pod&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">from</span><span class="token punctuation">:</span> attributes.log
</span><span class="code-line">          <span class="token atrule key">to</span><span class="token punctuation">:</span> body
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> move
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">type</span><span class="token punctuation">:</span> json_parser
</span><span class="code-line">          <span class="token atrule key">if</span><span class="token punctuation">:</span> <span class="token string">&#x27;body matches &quot;^{.*}$&quot;&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">poll_interval</span><span class="token punctuation">:</span> 5s
</span><span class="code-line">      <span class="token atrule key">start_at</span><span class="token punctuation">:</span> end
</span><span class="code-line">  <span class="token atrule key">service</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">telemetry</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">logs</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">level</span><span class="token punctuation">:</span> debug
</span><span class="code-line">    <span class="token atrule key">pipelines</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">traces</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> otlp
</span><span class="code-line">        <span class="token atrule key">exporters</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> otlp
</span><span class="code-line">      <span class="token atrule key">metrics</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> otlp
</span><span class="code-line">      <span class="token atrule key">logs</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">receivers</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> filelog
</span><span class="code-line">        <span class="token atrule key">processors</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> resource
</span><span class="code-line">          <span class="token punctuation">-</span> attributes
</span><span class="code-line">        <span class="token atrule key">exporters</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token punctuation">-</span> debug
</span><span class="code-line">          <span class="token punctuation">-</span> loki
</span><span class="code-line">  <span class="token atrule key">processors</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">attributes</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">actions</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">action</span><span class="token punctuation">:</span> insert
</span><span class="code-line">          <span class="token atrule key">key</span><span class="token punctuation">:</span> loki.attribute.labels
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> level<span class="token punctuation">,</span> context<span class="token punctuation">,</span> traceID
</span><span class="code-line">    <span class="token atrule key">resource</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">attributes</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">action</span><span class="token punctuation">:</span> insert
</span><span class="code-line">          <span class="token atrule key">key</span><span class="token punctuation">:</span> loki.format
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> json
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">action</span><span class="token punctuation">:</span> insert
</span><span class="code-line">          <span class="token atrule key">key</span><span class="token punctuation">:</span> loki.resource.labels
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> pod<span class="token punctuation">,</span> namespace<span class="token punctuation">,</span> container
</span><span class="code-line">  <span class="token atrule key">exporters</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">loki</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki<span class="token punctuation">-</span>gateway/loki/api/v1/push
</span><span class="code-line">    <span class="token atrule key">otlp</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">endpoint</span><span class="token punctuation">:</span> tempo<span class="token punctuation">:</span><span class="token number">4317</span>
</span><span class="code-line">      <span class="token atrule key">tls</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">insecure</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">    <span class="token atrule key">debug</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">verbosity</span><span class="token punctuation">:</span> detailed
</span><span class="code-line"><span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">jaeger-compact</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">jaeger-thrift</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">jaeger-grpc</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line">  <span class="token atrule key">zipkin</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">false</span>
</span><span class="code-line"><span class="token atrule key">mode</span><span class="token punctuation">:</span> daemonset
</span><span class="code-line"><span class="token atrule key">presets</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">logsCollection</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span><span class="code-line">    <span class="token atrule key">includeCollectorLogs</span><span class="token punctuation">:</span> <span class="token important boolean">true</span>
</span></code></pre></div><p>ì´ì œ Grafana Loki datasourceì˜ ì„¤ì •ê°’ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. RegexëŠ” í•­ìƒ ì •í™•íˆ ì‘ì„±í•˜ëŠ”ë° ì–´ë ¤ì›€ì´ ìˆëŠ”ë°, Labelì„ í†µí•´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•˜ê³  ê°„ë‹¨í•˜ê²Œ Tempo linkë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë‹¤.</p><img src="/static/images/otel-datasource-new-version.png" alt="datasource derived fields on grafana"/><h2 id="ê²°ë¡ "><a href="#ê²°ë¡ " aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ê²°ë¡ </h2><p>ë§ì€ OpenSource Contributorë“¤ ë•ë¶„ì— Tracingê³¼ Loggingì„ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆì—ˆë‹¤. Lokiì—ì„œ Regexë¡œ Trace IDë¥¼ ì¶”ì¶œí•˜ê³ , ê·¸ê²ƒì„ Tempoì—ì„œ ë°”ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ ë§í¬ë¥¼ ë‹¬ì•„ì¤„ ìˆ˜ ìˆëŠ” ê²ƒì€ ë„ˆë¬´ë‚˜ ì¢‹ì•˜ë‹¤. ê·¸ë¦¬ê³  OpenTelemetry Collectorë¥¼ ì‚¬ìš©í•˜ëŠ” ìƒí™©ì—ì„œ FluentBit ë•Œì‹ ì— Firelog receiverë¥¼ ì´ìš©í•˜ëŠ” ê²ƒë„ ê´œì°®ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ë‹¤ì–‘í•œ Instrumentation libraryë„ ì²´í¬í•´ë´ì•¼ê² ë‹¤. ì•„ì§ Production Readyë¥¼ ìœ„í•´ì„œëŠ” Loki, Tempo, Open Collectorì˜ ê°€ìš©ì„±ì„ ìƒê°í•´ì„œ ë°°í¬ë„ ë‹¤ì‹œ êµ¬ì„±í•´ì•¼í•˜ê³ , í†µì‹ ê°„ì— TLSì™€ ì¸ì¦ ë¶€ë¶„ë„ ì¶”ê°€í•´ì•¼ í•œë‹¤.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/opentelemetry">opentelemetry</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231228-vault-custom-secret-engine">Vault custom secret engine ì‘ì„±í•´ë³´ê¸°</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240106-gptcache">GPTCache</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">â† Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> â€¢ </div><div>Â© 2024</div><div> â€¢ </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var h=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of d(s))!u.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=p(s,e))||c.enumerable});return a},y=a=\u003ek(t(l(a!=null?r(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=h((v,i)=\u003e{i.exports=_jsx_runtime});var w={};N(w,{default:()=\u003eb,frontmatter:()=\u003eg});var n=y(o()),g={title:\"OpenTelemetry with Minikube\",date:\"2023-12-31\",tags:[\"opentelemetry\",\"kubernetes\"],images:[\"/static/images/social-banner.png\"],summary:\"OpenTelemetry collector\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC tracing\\uACFC logging\\uC744 \\uAC19\\uC774 \\uD558\\uB294 \\uAC83\\uC744 \\uAC80\\uD1A0\\uD558\\uC600\\uB2E4. Kubernetes\\uC640 \\uBA40\\uC5B4\\uC838 \\uC788\\uB358 \\uC0AC\\uC774\\uC5D0 OpenTelemetry \\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uAC00 \\uC5C4\\uCCAD\\uB098\\uAC8C \\uC131\\uC7A5\\uD55C \\uAC83\\uC744 \\uAE68\\uB2EB\\uAC8C \\uB418\\uC5C8\\uB2E4. Log\\uC5D0 traceID\\uB97C \\uB0A8\\uAE30\\uACE0 \\uADF8\\uAC78\\uB85C Tracing \\uC815\\uBCF4\\uB97C \\uBCFC \\uC218 \\uC788\\uB3C4\\uB85D \\uAD6C\\uC131\\uD588\\uACE0, Grafana \\uD558\\uB098\\uC5D0\\uC11C \\uD1B5\\uD569\\uC801\\uC73C\\uB85C \\uBCFC \\uC218 \\uC788\\uB3C4\\uB85D Loki\\uC640 Tempo\\uB97C Exporter\\uB85C \\uC0AC\\uC6A9\\uD588\\uB2E4. \\uC544\\uC9C1 Python\\uACFC Nodejs\\uC5D0\\uC11C\\uB294 Log\\uCABD\\uC758 \\uC0C1\\uD0DC\\uB294 Development\\uB098 Experimental\\uC774\\uAE30 \\uB54C\\uBB38\\uC5D0, receiver\\uC5D0\\uC11C filelog\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC Kubernetes log file\\uC744 fluentbit\\uCC98\\uB7FC tail\\uD574\\uC11C \\uAC00\\uC838\\uC624\\uACE0 traceId\\uB97C log\\uC5D0 \\uB123\\uC5B4\\uC8FC\\uB294 instrument libary\\uB97C \\uC0AC\\uC6A9\\uD588\\uB2E4.\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",pre:\"pre\",code:\"code\",h3:\"h3\",ol:\"ol\",li:\"li\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"minikube-\\uD658\\uACBD\",children:[(0,n.jsx)(e.a,{href:\"#minikube-\\uD658\\uACBD\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Minikube \\uD658\\uACBD\"]}),(0,n.jsx)(e.p,{children:\"Mac\\uC5D0\\uC11C Minikube\\uB97C \\uC0AC\\uC6A9\\uD558\\uC600\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 Minikube cluster\\uB97C \\uC2E4\\uD589\\uD558\\uC600\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"brew \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` hyperkit\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"minikube start --container-runtime\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"containerd --cni\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"cilium --driver\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"hyperkit --kubernetes-version\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`v1.26.12\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/jayground8/example-k8s-with-OTel\",children:\"\\uC608\\uC81C \\uC18C\\uC2A4\\uCF54\\uB4DC\"}),\"\\uC744 Clone\\uD55C\\uB2E4.\"]}),(0,n.jsxs)(e.h2,{id:\"loki-tempo-grafana\",children:[(0,n.jsx)(e.a,{href:\"#loki-tempo-grafana\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Loki, Tempo, Grafana\"]}),(0,n.jsx)(e.p,{children:\"\\uD14C\\uC2A4\\uD2B8\\uB97C \\uC704\\uD574\\uC11C Loki, Tempo, Grafana\\uB97C Helm\\uC73C\\uB85C \\uC2E4\\uD589\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.p,{children:\"Grafana\\uC5D0\\uC11C Lok\\uC640 Tempo\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 datasource\\uB85C \\uC815\\uC758\\uD574\\uC900\\uB2E4. \\uC5EC\\uAE30\\uC11C trace_id\\uB97C regex\\uB85C \\uCC3E\\uC544\\uC11C tempo\\uC5D0\\uC11C \\uBCF4\\uC5EC\\uC904 \\uC218 \\uC788\\uB3C4\\uB85D \\uD574\\uC904 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB807\\uAC8C \\uC124\\uC815\\uD558\\uACE0 \\uB098\\uBA74 \\uC544\\uB798 \\uADF8\\uB9BC\\uCC98\\uB7FC label\\uC5D0 link\\uB97C \\uCD94\\uAC00\\uD560 \\uC218 \\uC788\\uACE0, \\uB204\\uB974\\uBA74 \\uBC14\\uB85C Tracing \\uC815\\uBCF4\\uB97C \\uAC19\\uC774 \\uBCFC \\uC218 \\uC788\\uB2E4. Grafana Labs\\uC5D0\\uC11C \\uC774\\uB807\\uAC8C OSS\\uB85C \\uC81C\\uACF5\\uD558\\uC5EC \\uC6B0\\uB9AC\\uAC00 \\uC27D\\uAC8C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4\\uB77C\\uB294 \\uAC83\\uC5D0 \\uB2E4\\uC2DC \\uD55C\\uBC88 \\uAC10\\uD0C4\\uACFC \\uAC10\\uC0AC\\uD568\\uC744 \\uB290\\uB080\\uB2E4. \\u{1F60D}\"}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-trace-link.png\",alt:\"tracing link\"}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-grafana-tempo-integration.png\",alt:\"tracing info\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"values.yml\"})}),(0,n.jsx)(e.pre,{className:\"language-yml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasources.yaml\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Loki\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"access\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` proxy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//loki\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3100\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"basicAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jsonData\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"maxLines\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1000\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"derivedFields\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceUid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"matcherRegex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` trace_id=(\\\\w+)\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` traceID\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $$\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"__value.raw\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"access\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` proxy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"orgId\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//tempo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3100\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"basicAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"isDefault\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"editable\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"uid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm repo \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` grafana https://grafana.github.io/helm-charts\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` loki grafana/loki --values helm/loki/values.yml\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` tempo grafana/tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` grafana grafana/grafana --values helm/grafana/values.yml\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"opentelemetry-collector\",children:[(0,n.jsx)(e.a,{href:\"#opentelemetry-collector\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"OpenTelemetry Collector\"]}),(0,n.jsxs)(e.p,{children:[\"OpenTelemetry Collector\\uB294 receiver, processor, exporter\\uB85C \\uAD6C\\uC131\\uB418\\uC5B4 \\uC788\\uB2E4. Log\\uB294 \",(0,n.jsx)(e.code,{children:\"filelog\"}),\" receiver\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC, Kubernetes log file\\uC758 log\\uB97C \\uC218\\uC9D1\\uD55C\\uB2E4. Tracing\\uC740 otlp receiver\\uAC00 OpenTelemetry Protocol\\uB85C \\uBC1B\\uC744 \\uC218 \\uC788\\uAC8C grpc, http \\uC11C\\uBC84\\uB97C \\uB744\\uC6B0\\uAC8C \\uB41C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"Nestjs\"}),\" Nodejs App\\uC5D0\\uC11C \\uD574\\uB2F9 otlp receiver\\uB85C tracing \\uC815\\uBCF4\\uB97C \\uBCF4\\uB0B4\\uAC8C \\uB418\\uACE0, \",(0,n.jsx)(e.code,{children:\"FastAPI\"}),\" Python App\\uC5D0\\uC11C\\uB3C4 \\uB3D9\\uC77C\\uD558\\uAC8C otlp receiver\\uB85C tracing \\uC815\\uBCF4\\uB97C \\uBCF4\\uB0B4\\uAC8C \\uB41C\\uB2E4. \\uC774\\uB807\\uAC8C \\uC218\\uC9D1\\uD55C Log\\uB294 exporter\\uB85C Loki backend\\uC5D0 \\uCD5C\\uC885\\uC801\\uC73C\\uB85C \\uBCF4\\uB0B4\\uACE0, Trace\\uB294 exporter\\uB85C Tempo\\uC5D0 \\uBCF4\\uB0B8\\uB2E4. \\uC774\\uB807\\uAC8C \\uBCF4\\uB0B4\\uC9C4 \\uC815\\uBCF4\\uB294 Grafana\\uC5D0\\uC11C Visualize\\uD558\\uC5EC \\uBCF4\\uAC8C \\uB41C\\uB2E4. Log\\uB294 Processor\\uC5D0\\uC11C parsing\\uC744 \\uD558\\uACE0, Loki\\uC5D0\\uC11C indexing\\uC744 \\uD558\\uB294 label\\uC815\\uBCF4\\uB97C \\uCD94\\uAC00 \\uD574\\uC8FC\\uB294 \\uC791\\uC5C5\\uC744 \\uD55C\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C Helm values\\uAC12\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4. jaeger, prometheus, zipkin\\uC740 \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uC544\\uC11C default\\uAC12\\uC73C\\uB85C \\uC2E4\\uD589\\uB418\\uC9C0 \\uC54A\\uAC8C null\\uB85C \\uC124\\uC815\\uC744 \\uD574\\uC8FC\\uC5C8\\uB2E4. Tracing\\uC758 \\uACBD\\uC6B0\\uC5D0 OpenTelemetry Collector\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uBC1B\\uC558\\uB294\\uC9C0 \\uD655\\uC778\\uD558\\uAE30 \\uC704\\uD574\\uC11C exporters\\uC5D0 \",(0,n.jsx)(e.code,{children:\"debug\"}),\"\\uB97C \\uCD94\\uAC00\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"values.yml\"})}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"config\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"prometheus\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"zipkin\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"filelog\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"include\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" /var/log/pods/\",(0,n.jsx)(e.span,{className:\"token important\",children:\"*/*/*.log\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"start_at\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` beginning\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"include_file_path\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"include_file_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"operators\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Find out which format is used by kubernetes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` router\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`format\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"routes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`containerd\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"expr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`'body matches \"^[^ Z]+Z\"'`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Parse CRI-Containerd format\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` regex_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`containerd\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"regex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'^(?P\u003ctime\u003e[^ ^Z]+Z) (?P\u003cstream\u003estdout|stderr) (?P\u003clogtag\u003e[^ ]*) ?(?P\u003clog\u003e.*)$'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` extract_metadata_from_filepath\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parse_from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.time\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"layout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'%Y-%m-%dT%H:%M:%S.%LZ'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Extract metadata from file path\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` regex_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` extract_metadata_from_filepath\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"regex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'^.*\\\\/(?P\u003cnamespace\u003e[^_]+)_(?P\u003cpod_name\u003e[^_]+)_(?P\u003cuid\u003e[a-f0-9\\\\-]{36})\\\\/(?P\u003ccontainer_name\u003e[^\\\\._]+)\\\\/(?P\u003crestart_count\u003e\\\\d+)\\\\.log$'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parse_from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"log.file.path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"cache\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"128\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# default maximum amount of Pods per Node is 110\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Rename attributes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"log.file.path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"filename\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.container_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"container\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.namespace\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"namespace\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.pod_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"pod\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` add\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"cluster\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'minikube'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"service\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"pipelines\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"traces\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` otlp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exporters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` debug\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` otlp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metrics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` otlp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"logs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` filelog\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"processors\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` resource\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exporters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` loki\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"processors\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"resource\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"attributes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"action\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` insert\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki.format\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` json\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"action\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` insert\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki.resource.labels\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" container\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cluster\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` filename\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exporters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"loki\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"endpoint\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//loki.default.svc.cluster.local\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`3100/loki/api/v1/push\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"otlp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"endpoint\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" tempo.default.svc.cluster.local\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4317\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"tls\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"insecure\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"debug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"verbosity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` detailed\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"ports\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger-compact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger-thrift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger-grpc\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"zipkin\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"mode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` daemonset\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"presets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"logsCollection\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storeCheckpoints\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://opentelemetry.io/docs/collector/deployment/agent/\",children:\"OpenTelemetry\\uB97C Agent \\uBC29\\uC2DD\"}),\"\\uC73C\\uB85C \\uBC30\\uD3EC\\uB97C \\uD55C\\uB2E4. \\uADF8\\uB798\\uC11C DaemonSet\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"opentelemetry-collector-agent\"}),\"\\uAC00 \\uC0DD\\uC131\\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm repo \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),\" opentelemetry-collector open-telemetry/opentelemetry-collector \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`--values helm/opentelemetry-collector/values.yml\n`})]})}),(0,n.jsxs)(e.h2,{id:\"app\",children:[(0,n.jsx)(e.a,{href:\"#app\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"App\"]}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C \\uC6B0\\uB9AC\\uAC00 \\uC218\\uC9D1\\uD558\\uB824\\uB294 Application\\uC5D0\\uC11C Log, Trace, Metric \\uC815\\uBCF4\\uB97C \\uC81C\\uACF5\\uD574\\uC57C \\uD55C\\uB2E4. \\uC5EC\\uAE30\\uC11C Instrumentation\\uC744 \\uD1B5\\uD574\\uC11C source \\uCF54\\uB4DC\\uB97C \\uC77C\\uC77C\\uC774 \\uC218\\uC815\\uD574\\uC11C Trace \\uC815\\uBCF4\\uB97C \\uB123\\uC5B4\\uC8FC\\uC9C0 \\uC54A\\uC544\\uB3C4 Trace \\uC815\\uBCF4\\uB97C \\uC0DD\\uC131\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsxs)(e.h3,{id:\"nodejs\",children:[(0,n.jsx)(e.a,{href:\"#nodejs\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Nodejs\"]}),(0,n.jsxs)(e.p,{children:[\"Nestjs\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC787\\uB294\\uB370, \",(0,n.jsx)(e.code,{children:\"@opentelemetry/instrumentation-nestjs-core\"}),\"\\uCC98\\uB7FC imstumentation library\\uB97C \\uC81C\\uACF5\\uD558\\uACE0 \\uC788\\uC5B4\\uC11C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-ts\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" NodeSDK \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/sdk-node'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" OTLPTraceExporter \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/exporter-trace-otlp-http'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" HttpInstrumentation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/instrumentation-http'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" ExpressInstrumentation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/instrumentation-express'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" NestInstrumentation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/instrumentation-nestjs-core'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" WinstonInstrumentation \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/instrumentation-winston'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" otelSDK \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"NodeSDK\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  serviceName\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"api-node\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  traceExporter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OTLPTraceExporter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    url\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"http://\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"env\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"NODE_IP\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\":4318/v1/traces\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  instrumentations\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ExpressInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"NestInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WinstonInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      enabled\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function function-variable\",children:\"logHook\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"_span\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" record\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        record\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'resource.service.name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'test-service'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'SIGTERM'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  otelSDK\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"shutdown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"then\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'SDK shut down successfully'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'Error shutting down SDK'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"finally\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"exit\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745\",children:\"Github\\uC5D0 winston instrumentation libary\\uAC00 Nestjs\\uC5D0\\uC11C \\uC758\\uB3C4\\uD55C\\uB300\\uB85C \\uC791\\uB3D9\\uD558\\uC9C0 \\uC54A\\uB294 \\uAC83\\uC5D0 \\uB300\\uD55C \\uC774\\uC288\"}),\"\\uAC00 \\uC874\\uC7AC\\uD558\\uC600\\uACE0, \\uC5EC\\uAE30\\uC11C \\uCD94\\uCC9C\\uD558\\uB294 \\uBC29\\uC2DD\\uC73C\\uB85C \\uD574\\uACB0\\uC744 \\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4. Nestjs application\\uC744 bootstrap\\uD558\\uB294 \\uB85C\\uC9C1\\uC5D0\\uC11C WinstonModule\\uB85C logger\\uB97C \\uC124\\uC815\\uD560 \\uB54C, printf\\uB77C\\uB294 \\uD568\\uC218\\uC5D0\\uC11C \\uC9C1\\uC811 trace\\uC815\\uBCF4\\uB97C \\uAC00\\uC838\\uC640\\uC11C \\uC8FC\\uC785\\uD574\\uC8FC\\uB294 \\uBC29\\uC2DD\\uC744 \\uC0AC\\uC6A9\\uD588\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"main.ts\"})}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" trace \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/api'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"bootstrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  otelSDK\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"start\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" app \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NestFactory\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"AppModule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    logger\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"WinstonModule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"createLogger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      transports\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"transports\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Console\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          format\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"combine\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"ms\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// winston instrumentation library doesn't work in Nestjs.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// followed the idea from the issue to fix the problem.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" activeSpan \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" trace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"getActiveSpan\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" metaData\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" span_id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" string\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" trace_id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" string \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"span_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"spanContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"spanId\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"trace_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"spanContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"traceId\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"[\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"level\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"toUpperCase\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"] [trace_id=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"trace_id\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" span_id=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),`\n`]})]})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"                metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"span_id\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"] \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"message\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"JSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"stringify\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator spread\",children:\"...\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"listen\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3000\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"bootstrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Docker\\uB85C build\\uD55C Image\\uB97C minikube \\uBA85\\uB839\\uC5B4\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C cluster\\uC5D0 load\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`docker build -t my-node-app ./my-node-app\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`minikube image load my-node-app:latest\n`})]})}),(0,n.jsx)(e.p,{children:\"minikube\\uC758 \\uBA85\\uB839\\uC5B4\\uB85C image\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C load\\uB418\\uC5C8\\uB294\\uC9C0 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`$ minikube image list\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`docker.io/library/my-node-app:latest\n`})]})}),(0,n.jsxs)(e.p,{children:[\"Local\\uC5D0 \\uC788\\uB294 Image\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"imagePullPolicy: Never\"}),\"\\uB85C \\uC124\\uC815\\uC744 \\uD574\\uC900\\uB2E4. \",(0,n.jsx)(e.code,{children:\"OTEL_LOG_LEVEL\"}),\" \\uD658\\uACBD\\uBCC0\\uC218\\uB294 Nodejs\\uC5D0\\uC11C OpenTelemetry SDK libary\\uC758 Debug \\uB85C\\uADF8\\uB97C \\uBCF4\\uAE30 \\uC704\\uD574\\uC11C \\uC124\\uC815\\uD588\\uB2E4. \",(0,n.jsx)(e.code,{children:\"NODE_IP\"}),\"\\uB294 OpenTelmetry Collector\\uAC00 DaemonSet\\uC73C\\uB85C \\uB744\\uACE0 HostPort\\uB97C \\uC124\\uC815\\uD558\\uACE0 \\uC788\\uB2E4. \\uADF8\\uB798\\uC11C Node IP\\uB97C \\uD658\\uACBD \\uBCC0\\uC218\\uB85C \\uB118\\uACA8\\uC8FC\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`app\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"replicas\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"revisionHistoryLimit\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"selector\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"app\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`app\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"template\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"labels\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"app\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`app\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`app\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`node\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Never\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"ports\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`port\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3000\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` OTEL_LOG_LEVEL\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` DEBUG\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` NODE_IP\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"valueFrom\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"fieldRef\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"fieldPath\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` status.hostIP\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl apply -f k8s/my-node-app/deployment.yml\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl apply -f k8s/my-node-app/service.yml\n`})]})}),(0,n.jsxs)(e.h3,{id:\"python\",children:[(0,n.jsx)(e.a,{href:\"#python\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Python\"]}),(0,n.jsxs)(e.p,{children:[\"Python\\uC740 FastAPI\\uB85C \\uAC04\\uB2E8\\uD55C API \\uC11C\\uBC84\\uB97C \\uB9CC\\uB4E4\\uC5C8\\uB2E4. \\uB3D9\\uC77C\\uD558\\uAC8C \\uC81C\\uACF5\\uD558\\uB294 intrumentation library\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC124\\uC815\\uD558\\uC600\\uACE0, Nodejs\\uB294 OpenTelemetry Collector\\uAC00 \\uC5F0\\uACB0\\uD560 \\uB54C http\\uB85C \\uC5F4\\uB824 \\uC788\\uB294 4318 \\uD3EC\\uD2B8 \\uC5F0\\uACB0\\uD588\\uC9C0\\uB9CC, \\uC5EC\\uAE30\\uC5D0\\uC11C grpc\\uB85C \\uC5F4\\uB824 \\uC788\\uB294 4317 \\uD3EC\\uD2B8\\uB85C \\uC5F0\\uACB0\\uD558\\uC600\\uB2E4. Python\\uC5D0\\uC11C Log\\uAC00 Experimental status\\uB85C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uC9C0\\uB9CC, \\uB3D9\\uC77C\\uD558\\uAC8C \",(0,n.jsx)(e.code,{children:\"opentelemetry.instrumentation.logging\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C log\\uC5D0 Trace ID\\uB97C \\uB0A8\\uAE30\\uACE0 Kubernetes log file\\uC744 tail\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-python\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` logging\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` trace\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sdk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"resources \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` Resource\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sdk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"trace \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` TracerProvider\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"exporter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"otlp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"proto\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"grpc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"trace_exporter \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` OTLPSpanExporter\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sdk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"trace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"export \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` BatchSpanProcessor\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"instrumentation\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"fastapi \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` FastAPIInstrumentor\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" opentelemetry\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"instrumentation\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logging \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` LoggingInstrumentor\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" fastapi \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` FastAPI\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"create\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"service.name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"api-python\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"trace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"set_tracer_provider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"TracerProvider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"resource\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"trace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get_tracer_provider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"add_span_processor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    BatchSpanProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"OTLPSpanExporter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"endpoint\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"http://'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'NODE_IP'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:':4317\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"app \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" FastAPI\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"logger \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" logging\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"getLogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"__name__\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token punctuation annotation decorator\",children:[\"@app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"read_root\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    logger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"hello world!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Hello From Python App!\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"FastAPIInstrumentor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"instrument_app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"LoggingInstrumentor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"instrument\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"set_logging_format\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uC11C\\uBE44\\uC2A4\\uAC04\\uC758 \\uD1B5\\uC2E0\\uC744 \\uC704\\uD574\\uC11C \\uC608\\uC81C\\uCF54\\uB4DC\\uC758 Python App\\uB3C4 \\uB3D9\\uC77C\\uD558\\uAC8C \\uBC18\\uBCF5\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`docker build -t my-python-app ./my-python-app\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`minikube image load my-python-app:latest\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl apply -f k8s/my-python-app/deployment.yml\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl apply -f k8s/my-python-app/service.yml\n`})]})}),(0,n.jsxs)(e.h3,{id:\"\\uC11C\\uBE44\\uC2A4\\uAC04\\uC758-\\uD1B5\\uC2E0\",children:[(0,n.jsx)(e.a,{href:\"#\\uC11C\\uBE44\\uC2A4\\uAC04\\uC758-\\uD1B5\\uC2E0\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uC11C\\uBE44\\uC2A4\\uAC04\\uC758 \\uD1B5\\uC2E0\"]}),(0,n.jsx)(e.p,{children:\"client -\u003e nodejs app -\u003e python app\\uC73C\\uB85C \\uD638\\uCD9C\\uD558\\uB294 \\uAC83\\uC744 \\uC2E4\\uD589\\uD574\\uBCF8\\uB2E4.\"}),(0,n.jsxs)(e.p,{children:[\"nodejs app Service\\uC5D0 Port Fowarding\\uC744 \\uD558\\uACE0 \",(0,n.jsx)(e.code,{children:\"/something\"}),\"\\uC5D0 \\uC694\\uCCAD\\uD558\\uBA74 nodejs app\\uC774 python app \\uC694\\uCCAD\\uD558\\uC5EC \\uBC1B\\uC544\\uC628 \\uC751\\uB2F5\\uAC12\\uC744 \\uC804\\uB2EC\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"kubectl port-forward svc/my-node-app-svc \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3000\"}),`:3000\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"curl\"}),` localhost:3000/something\n`]})]})}),(0,n.jsx)(e.p,{children:\"tempo\\uC5D0\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-trace-for-inter-service-communication.png\",alt:\"trace for inter service communication\"}),(0,n.jsxs)(e.h2,{id:\"metric\",children:[(0,n.jsx)(e.a,{href:\"#metric\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Metric\"]}),(0,n.jsx)(e.p,{children:\"Metric\\uC744 \\uC218\\uC9D1\\uD558\\uB294 \\uBC29\\uBC95\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC0DD\\uAC01\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.ol,{children:(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"@opentelemetry/exporter-prometheus\"}),\"\\uB85C Prometheus\\uC5D0\\uC11C Pull \\uBC29\\uC2DD\\uC73C\\uB85C \\uC218\\uC9D1\"]})}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" otelSDK \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"NodeSDK\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  metricReader\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PrometheusExporter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    port\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"9464\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.ol,{start:\"2\",children:(0,n.jsx)(e.li,{children:\"OpenTelemetry collector\\uAC00 receiver\\uB85C \\uBC1B\\uC544\\uC11C prometheus exporter\\uB85C Pull \\uBC29\\uC2DD\\uC73C\\uB85C \\uC218\\uC9D1\"})}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" otelSDK \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"NodeSDK\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  metricReader\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PeriodicExportingMetricReader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    exporter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OTLPMetricExporter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      url\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"http://\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"NODE_IP\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\":4318/v1/metrics\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.ol,{start:\"3\",children:(0,n.jsx)(e.li,{children:\"Prometheus\\uC758 OLTP protocol\\uB85C \\uBC14\\uB85C \\uBC1B\\uC744 \\uC218 \\uC788\\uB294 endpoint\\uB85C Push \\uBC29\\uC2DD\\uC73C\\uB85C \\uC218\\uC9D1\"})}),(0,n.jsxs)(e.p,{children:[\"3\\uBC88\\uC9F8 \\uBC29\\uBC95\\uC740 \\uC62C\\uD574 \\uC5EC\\uB984 \",(0,n.jsx)(e.a,{href:\"https://horovits.medium.com/prometheus-now-supports-opentelemetry-metrics-83f85878e46a\",children:\"Prometheus\\uC5D0\\uC11C \\uBC14\\uB85C OLTP protocol\\uB85C \\uBC1B\\uC744 \\uC218 \\uC788\\uB294 endpoint\\uB97C \\uCD94\\uAC00\"}),\"\\uAC00 \\uB418\\uC5B4\\uC11C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uD604\\uC7AC Experimental feature\\uB85C \\uC81C\\uACF5\\uB418\\uACE0 \\uC788\\uB2E4. \\uC774 \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"otlp-write-receiver\"}),\"\\uB97C enable\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD574\\uC900\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"values.yml\"})}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"server\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"extraFlags\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" enable\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"feature=otlp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"write\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`receiver\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm repo \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` prometheus-community https://prometheus-community.github.io/helm-charts\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"helm \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` prometheus prometheus-community/prometheus --values helm/prometheus/values.yml\n`]})]})}),(0,n.jsx)(e.p,{children:\"prometheus-server\\uC758 \\uB85C\\uADF8\\uB97C \\uD655\\uC778\\uD558\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC \\uD574\\uB2F9 feature\\uAC00 enable\\uB418\\uC5C8\\uB2E4\\uB294 log\\uB97C \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-log\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-log\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ts\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number date\",children:\"2024-01-03T\"}),(0,n.jsx)(e.span,{className:\"token number time\",children:\"01:41:21.711Z\"}),\" caller\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"main\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"go\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"175\"}),\" level\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"info msg\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Experimental OTLP write receiver enabled\"'}),`\n`]})})}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"OTLPMetricExporter\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0, url\\uB97C promethues \\uC11C\\uBC84\\uB85C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. URL \\uC124\\uC815\\uC774 \\uC880 \\uD5DB\\uAC08\\uB838\\uB294\\uB370, otlp\\uC758 path\\uB97C \\uB530\\uB77C\\uC11C \",(0,n.jsx)(e.code,{children:\"/api/v1/otlp/v1/metrics\"}),\"\\uB85C \\uC9C0\\uC815\\uD558\\uBA74 \\uB41C\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://github.com/prometheus/docs/pull/2382\",children:\"Github issue\\uC5D0\\uC11C \\uD574\\uB2F9 feature\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 Python \\uC608\\uC81C\\uB97C \\uC791\\uC131\\uD558\\uB294 \\uAC83\"}),\"\\uC774 \\uC788\\uC5B4\\uC11C \\uCC38\\uACE0\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" otelSDK \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"NodeSDK\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  serviceName\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"api-node\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  metricReader\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PeriodicExportingMetricReader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    exporter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OTLPMetricExporter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      url\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"http://prometheus-server/api/v1/otlp/v1/metrics\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  traceExporter\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OTLPTraceExporter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    url\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"http://\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"process\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token constant\",children:\"NODE_IP\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\":4318/v1/traces\"}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  instrumentations\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HttpInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ExpressInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"NestInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"WinstonInstrumentation\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C Metric\\uC774 Prometheus\\uC5D0 \\uC218\\uC9D1\\uB418\\uACE0, Grafana\\uB85C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsxs)(e.p,{children:[\"\\uC704\\uC5D0\\uC11C Grafana values.yml\\uC5D0 Tempo\\uB97C \\uCD94\\uAC00\\uD558\\uC600\\uB294\\uB370, \",(0,n.jsx)(e.code,{children:\"traceToLogsV2\"}),\"\\uC640 \",(0,n.jsx)(e.code,{children:\"traceToMetrics\"}),\" \\uC124\\uC815\\uC744 \\uC774\\uC6A9\\uD558\\uBA74 \\uCD94\\uAC00\\uC801\\uC73C\\uB85C Trace\\uC5D0\\uC11C \\uC124\\uC815\\uB41C \\uD398\\uC774\\uC9C0\\uB85C \\uC774\\uB3D9\\uD560 \\uC218\\uAC00 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"access\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` proxy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"orgId\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//tempo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3100\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"basicAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"isDefault\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"editable\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"uid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jsonData\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"tracesToLogsV2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceUid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Loki'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spanStartTimeShift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1h'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spanEndTimeShift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'-1h'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"tags\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'service.name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'container'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"filterByTraceID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"filterBySpanID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"customQuery\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'{$${__tags}} |=\\\"$${__span.traceId}\\\"'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"tracesToMetrics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceUid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Prometheus'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spanStartTimeShift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1h'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spanEndTimeShift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'-1h'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"tags\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'service.name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'job'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"queries\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Sample query'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"query\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'sum(rate(http_server_duration_milliseconds_bucket{$$__tags}[5m]))'\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC544\\uB798 \\uADF8\\uB9BC\\uCC98\\uB7FC Tempo Trace\\uC815\\uBCF4\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"related log\"}),\"\\uC640 \",(0,n.jsx)(e.code,{children:\"Sample query\"}),\"\\uB77C\\uB294 \\uBA54\\uB274\\uB97C \\uD3BC\\uCCD0 \\uBCFC\\uC218\\uAC00 \\uC788\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-trace-log-and-metric.png\",alt:\"link to move log page and trace page\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"related log\"}),\"\\uB97C \\uD074\\uB9AD\\uD558\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uC5D0\\uC11C \\uC815\\uC758\\uD55C \",(0,n.jsx)(e.code,{children:\"'{$${__tags}} |=\\\"$${__span.traceId}\\\"'\"}),\" \\uD615\\uC2DD\\uB300\\uB85C \\uBC14\\uB85C \\uCFFC\\uB9AC\\uD574\\uC11C \\uBCF4\\uC5EC\\uC8FC\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-trace-to-log.png\",alt:\"log query relating to traceId\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"Sample query\"}),\"\\uB97C \\uD074\\uB9AD\\uD558\\uBA74 \\uB9C8\\uCC2C\\uAC00\\uC9C0\\uB85C \\uC124\\uC815\\uC5D0\\uC11C \\uC815\\uC758\\uD55C \\uCFFC\\uB9AC\\uB85C \\uBCF4\\uC5EC\\uC8FC\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-trace-to-metric.png\",alt:\"metric query\"}),(0,n.jsx)(e.p,{children:\"\\uADF8\\uB9AC\\uACE0 nodeGraph\\uB97C enable\\uD558\\uC5EC \\uC544\\uB798\\uCC98\\uB7FC \\uC5B4\\uB5BB\\uAC8C \\uD638\\uCD9C\\uB418\\uACE0 \\uC788\\uB294\\uC9C0 Graph\\uB85C \\uBCFC \\uC218\\uB3C4 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# ...\\uC0DD\\uB7B5\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"nodeGraph\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]})]})}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-node-graph.png\",alt:\"node graph\"}),(0,n.jsxs)(e.h3,{id:\"\\uC544\\uC9C1-\\uAC1C\\uBC1C\\uB418\\uC9C0-\\uC54A\\uC740-\\uAE30\\uB2A5\\uB4E4\",children:[(0,n.jsx)(e.a,{href:\"#\\uC544\\uC9C1-\\uAC1C\\uBC1C\\uB418\\uC9C0-\\uC54A\\uC740-\\uAE30\\uB2A5\\uB4E4\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uC544\\uC9C1 \\uAC1C\\uBC1C\\uB418\\uC9C0 \\uC54A\\uC740 \\uAE30\\uB2A5\\uB4E4\"]}),(0,n.jsxs)(e.p,{children:[\"Node runtime\\uC758 metric\\uC744 Instrumentation library\\uB85C \\uC27D\\uAC8C \\uBC1B\\uC73C\\uBA74 \\uC88B\\uACA0\\uB2E4 \\uC2F6\\uC5B4\\uC11C \\uCC3E\\uC544\\uBD24\\uC9C0\\uB9CC, \\uC544\\uC9C1 \",(0,n.jsx)(e.a,{href:\"https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1106\",children:\"Github issue\\uC5D0 \\uC694\\uCCAD\"}),\"\\uC73C\\uB85C \\uB0A8\\uC544 \\uC788\\uB294 \\uC0C1\\uD0DC\\uC774\\uB2E4. \\uB300\\uC548\\uC73C\\uB85C \",(0,n.jsx)(e.a,{href:\"https://github.com/siimon/prom-client\",children:\"prom-client\"}),\" defaultMetric\\uC744 \\uC218\\uC9D1\\uD558\\uB3C4\\uB85D \\uD558\\uC5EC \\uBCC4\\uB3C4\\uB85D Prometheus \\uD3EC\\uBA67\\uC73C\\uB85C \\uB530\\uB85C \\uAC00\\uC838\\uC62C \\uC218 \\uC788\\uACA0\\uB2E4. Nodejs eventloop lag\\uC774\\uB098 GC\\uAD00\\uB828 metric\\uC744 default\\uB85C \\uC27D\\uAC8C \\uAC00\\uC838\\uC62C \\uC218 \\uC788\\uB2E4. \\uC544\\uB798\\uCC98\\uB7FC Nestjs\\uC5D0 \\uCD94\\uAC00\\uD558\\uACE0, Prometheus scrape config\\uB85C PULL \\uBC29\\uC2DD\\uC73C\\uB85C \\uAC00\\uC838\\uC624\\uB3C4\\uB85D \\uD560 \\uC218 \\uC788\\uACA0\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"service.ts\"})}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Injectable\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"OnModuleInit\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@nestjs/common'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"as\"}),\" client\"]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'prom-client'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"@\",(0,n.jsx)(e.span,{className:\"token function\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Injectable\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PrometheusService\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"implements\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"OnModuleInit\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" register\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Registry\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"onModuleInit\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" defaultLabels \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" service\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'node-api'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" collectDefaultMetric \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"collectDefaultMetrics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Registry\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Registry\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" register \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Registry\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    register\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"setDefaultLabels\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"defaultLabels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"collectDefaultMetric\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" register \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"register\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" register\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getRegister\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"register\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"controller.ts\"})}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"@\",(0,n.jsx)(e.span,{className:\"token function\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Controller\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'prometheus'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"PrometheusController\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"constructor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"private\"}),\" readonly prometheusService\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"PrometheusService\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  @\",(0,n.jsx)(e.span,{className:\"token function\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Get\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'metrics'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function\",children:\"getMetrics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"@\",(0,n.jsx)(e.span,{className:\"token function\",children:(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Res\"})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" res\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"Response\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" register \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"prometheusService\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"getRegister\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"setHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'Content-Type'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" register\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"contentType\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    register\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"metrics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"then\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"data\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"send\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,n.jsx)(e.a,{href:\"https://grafana.com/docs/grafana/latest/fundamentals/exemplars/\",children:\"Grafana\\uC5D0\\uC11C Exemplar\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C Metric\\uACFC \\uAD00\\uB828\\uB41C Trace \\uC815\\uBCF4\\uB97C \\uBC14\\uB85C \\uCC3E\\uC544 \\uBCFC \\uC218 \\uC788\\uAC8C \\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uC774\\uAC83\\uB3C4 \",(0,n.jsx)(e.a,{href:\"https://github.com/open-telemetry/opentelemetry-js/issues/2594\",children:\"Github Issue\\uC5D0 \\uC694\\uCCAD\\uB418\\uC5B4 \\uC788\\uB294 \\uC0C1\\uD0DC\\uB85C \\uB0A8\\uC544 \\uC788\\uB2E4.\"})]}),(0,n.jsx)(e.p,{children:\"\\u{1F913} \\uC544\\uC9C1 \\uC774\\uD574\\uB3C4\\uAC00 \\uBD80\\uC871\\uD558\\uC9C0\\uB9CC \\uC55E\\uC73C\\uB85C \\uC624\\uD508\\uC18C\\uC2A4 \\uD504\\uB85C\\uC81D\\uD2B8\\uB97C \\uACE0\\uBBFC\\uD560 \\uB54C \\uB9CC\\uB4E4\\uC5B4\\uBCF4\\uBA74 \\uC7AC\\uBBF8\\uC788\\uC744 \\uAC83 \\uAC19\\uB2E4.\"}),(0,n.jsxs)(e.h3,{id:\"update\\uB41C-\\uAE30\\uB2A5\",children:[(0,n.jsx)(e.a,{href:\"#update\\uB41C-\\uAE30\\uB2A5\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Update\\uB41C \\uAE30\\uB2A5\"]}),(0,n.jsxs)(e.p,{children:[\"\\uC791\\uC131\\uD560 \\uB2F9\\uC2DC\\uC5D0 grafana Helm chart \\uBC84\\uC804 7.0.19\\uC744 \\uC0AC\\uC6A9\\uD588\\uACE0, \\uD574\\uB2F9 Chart\\uB85C Grafana \",(0,n.jsx)(e.code,{children:\"10.2.2\"}),\"\\uAC00 \\uC124\\uCE58\\uAC00 \\uB418\\uC5C8\\uB2E4. Loki\\uC5D0\\uC11C trace_id\\uAC00 \\uC788\\uB294 \\uACBD\\uC6B0\\uC5D0 \\uBC14\\uB85C Tempo\\uB85C \\uC774\\uB3D9\\uD560 \\uC218 \\uC788\\uB294 \\uBC84\\uD2BC\\uC744 \\uBCF4\\uC5EC\\uC8FC\\uAE30 \\uC704\\uD574\\uC11C datasource \\uC124\\uC815\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC791\\uC131\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Loki\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"access\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` proxy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//loki\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3100\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"basicAuth\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jsonData\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"maxLines\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1000\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"derivedFields\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceUid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"matcherRegex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` trace_id=(\\\\w+)\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` traceID\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $$\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"__value.raw\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 regex\\uB85C \",(0,n.jsx)(e.code,{children:\"trace_id=(\\\\w+)\"}),\"\\uC744 \\uCD94\\uCD9C\\uD558\\uAE30 \\uC704\\uD574\\uC11C application\\uC5D0\\uC11C \\uB85C\\uADF8\\uB97C \\uB0A8\\uAE38 \\uB54C \\uD574\\uB2F9 format\\uC73C\\uB85C \\uC544\\uB798\\uCC98\\uB7FC \\uB0A8\\uAE30\\uB3C4\\uB85D \\uD588\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" trace \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@opentelemetry/api'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"bootstrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  otelSDK\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"start\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" app \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NestFactory\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"AppModule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    logger\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"WinstonModule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"createLogger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      transports\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"transports\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Console\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          format\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"combine\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"ms\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// winston instrumentation library doesn't work in Nestjs.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// followed the idea from the issue to fix the problem.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" activeSpan \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" trace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"getActiveSpan\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" metaData\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" span_id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" string\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" trace_id\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"?\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" string \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"span_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"spanContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"spanId\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"trace_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"spanContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"traceId\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"[\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"level\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"toUpperCase\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"] [trace_id=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"trace_id\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" span_id=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),`\n`]})]})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"                metaData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"span_id\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"] \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"message\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"JSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"stringify\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token template-string\",children:(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token operator spread\",children:\"...\"}),\"info\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"listen\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3000\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"bootstrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/grafana/grafana/commit/53758ad7642e9d3646bbad3698e55774bdf0623c\",children:\"Grafana 10.3.1\\uC5D0 Label\\uC5D0\\uC11C TraceID\\uB97C \\uAC00\\uC838\\uC62C \\uC218 \\uC788\\uB294 \\uAE30\\uB2A5\\uC774 \\uCD94\\uAC00\\uB41C Commit\\uC774 \\uBC18\\uC601\"}),\"\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD558\\uC600\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://github.com/grafana/grafana/blob/v10.3.1/public/app/plugins/datasource/loki/types.ts\",children:\"\\uC18C\\uC2A4\\uCF54\\uB4DC\"}),\"\\uB97C \\uD655\\uC778\\uD558\\uBA74 \",(0,n.jsx)(e.code,{children:\"matcherType\"}),\"\\uC774\\uB77C\\uB294 \\uAC83\\uC774 \\uCD94\\uAC00\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB798\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,n.jsx)(e.code,{children:\"matcherType\"}),\"\\uC744 \",(0,n.jsx)(e.code,{children:\"label\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uACE0, \",(0,n.jsx)(e.code,{children:\"MatcherRegex\"}),\"\\uB97C label key\\uC778 \",(0,n.jsx)(e.code,{children:\"traceID\"}),\"\\uB85C \\uC815\\uC758\\uD558\\uBA74 label\\uC5D0 \\uC788\\uB294 \",(0,n.jsx)(e.code,{children:\"traceID\"}),\"\\uB85C \\uBCF4\\uC5EC\\uC904 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"derivedFields\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"datasourceUid\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` tempo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` traceID\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"matcherType\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` label\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"matcherRegex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` traceID\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $$\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"__value.raw\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Application Code\\uC5D0\\uC11C\\uB294 traceID, spanID\\uB97C JSON \\uD615\\uC2DD\\uC73C\\uB85C \\uAC19\\uC774 \\uB0A8\\uACBC\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-js\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"bootstrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  otelSDK\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"start\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" app \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"NestFactory\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"AppModule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    logger\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"WinstonModule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"createLogger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      transports\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsxs)(e.span,{className:\"token class-name\",children:[\"winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"transports\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Console\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          format\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"combine\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"ms\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// winston instrumentation library doesn't work in Nestjs.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1745\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// followed the idea from the issue to fix the problem.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            winston\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token parameter\",children:\"info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" log \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` info\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" activeSpan \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" trace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"getActiveSpan\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                log\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'spanID'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"spanContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"spanId\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                log\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'traceID'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" activeSpan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"spanContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"traceId\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name known-class-name\",children:\"JSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"stringify\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"log\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" app\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access function method\",children:\"listen\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3000\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"bootstrap\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 OpenTelemetry Collect Helm chart\\uC758 value\\uC5D0\\uC11C loki label\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uCD94\\uAC00\\uD558\\uB3C4\\uB85D \\uBCC0\\uACBD\\uD558\\uC600\\uB2E4. \",(0,n.jsx)(e.code,{children:\"operators\"}),\" \\uB9C8\\uC9C0\\uB9C9\\uC5D0 \",(0,n.jsx)(e.code,{children:\"jsonParser\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C Application\\uC774 \\uB0A8\\uAE34 JSON \\uD615\\uC2DD\\uC758 string log\\uAC12\\uC744 parsing\\uD55C\\uB2E4. \\uC774\\uB807\\uAC8C parsing\\uB41C JSON \\uAC12\\uB4E4\\uC740 attributes\\uC5D0 \\uC800\\uC7A5\\uB418\\uB294\\uB370, attributes processor\\uB97C \\uD1B5\\uD574\\uC11C loki label\\uAC12\\uC73C\\uB85C \\uC124\\uC815\\uD574\\uC8FC\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"config\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"prometheus\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"zipkin\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"filelog\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exclude\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"include\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" /var/log/pods/dev_aidt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"test\",(0,n.jsx)(e.span,{className:\"token important\",children:\"*/*/*.log\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"include_file_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"include_file_path\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"operators\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`format\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"routes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"expr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),' body matches \"^\\\\\\\\',(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\"\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`docker\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"expr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),' body matches \"^',(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^ Z\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`+ \"\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`crio\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"expr\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),' body matches \"^',(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^ Z\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`+Z\"\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`containerd\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` router\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`crio\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"regex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ^(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003ctime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^ Z\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"+) (\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003cstream\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),\"stdout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),\"stderr) (\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003clogtag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^ \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token important\",children:\"*)\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003clog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),\".\",(0,n.jsx)(e.span,{className:\"token important\",children:\"*)$\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"layout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" 2006\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"01\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"02T15\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"04\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"05.999999999Z07\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"00\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"layout_type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` gotime\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parse_from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.time\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` regex_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"combine_field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.log\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"combine_with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" crio\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`recombine\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"is_last_entry\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.logtag == 'F'\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"max_log_size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"102400\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` extract_metadata_from_filepath\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"source_identifier\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"log.file.path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` recombine\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`containerd\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"regex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ^(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003ctime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^ ^Z\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"+Z) (\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003cstream\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),\"stdout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),\"stderr) (\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003clogtag\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^ \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token important\",children:\"*)\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003clog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),\".\",(0,n.jsx)(e.span,{className:\"token important\",children:\"*)$\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"layout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'%Y-%m-%dT%H:%M:%S.%LZ'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parse_from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.time\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` regex_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"combine_field\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.log\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"combine_with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" containerd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`recombine\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"is_last_entry\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.logtag == 'F'\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"max_log_size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"102400\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` extract_metadata_from_filepath\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"source_identifier\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"log.file.path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` recombine\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" parser\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`docker\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` extract_metadata_from_filepath\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"timestamp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"layout\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'%Y-%m-%dT%H:%M:%S.%LZ'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parse_from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.time\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` json_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` extract_metadata_from_filepath\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parse_from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"log.file.path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"regex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ^.\",(0,n.jsx)(e.span,{className:\"token important\",children:\"*\\\\/(?P\u003cnamespace\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"+)_(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003cpod_name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^_\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"+)_(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003cuid\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"f0\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"9\\\\\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"+)\\\\/(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003ccontainer_name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"^\\\\._\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"+)\\\\/(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"?\"}),\"P\u003crestart_count\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\u003e\"}),`\\\\d+)\\\\.log$\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` regex_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.stream\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" attributes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"log.iostream\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.container_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"container\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.namespace\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"namespace\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.pod_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" resource\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"pod\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` attributes.log\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"to\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` body\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` move\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` json_parser\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"if\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:`'body matches \"^{.*}$\"'`}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"poll_interval\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` 5s\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"start_at\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` end\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"service\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"telemetry\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"logs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"level\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` debug\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"pipelines\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"traces\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` otlp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exporters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` otlp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metrics\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` otlp\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"logs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"receivers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` filelog\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"processors\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` resource\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` attributes\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exporters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` debug\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` loki\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"processors\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"attributes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"actions\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"action\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` insert\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki.attribute.labels\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" level\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` traceID\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"resource\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"attributes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"action\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` insert\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki.format\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` json\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"action\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` insert\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"key\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` loki.resource.labels\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"exporters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"loki\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"endpoint\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"//loki\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`gateway/loki/api/v1/push\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"otlp\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"endpoint\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" tempo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4317\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"tls\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"insecure\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"debug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"verbosity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` detailed\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"ports\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger-compact\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger-thrift\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"jaeger-grpc\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"zipkin\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"mode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` daemonset\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"presets\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"logsCollection\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"enabled\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"includeCollectorLogs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token important boolean\",children:\"true\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C Grafana Loki datasource\\uC758 \\uC124\\uC815\\uAC12\\uC744 \\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. Regex\\uB294 \\uD56D\\uC0C1 \\uC815\\uD655\\uD788 \\uC791\\uC131\\uD558\\uB294\\uB370 \\uC5B4\\uB824\\uC6C0\\uC774 \\uC788\\uB294\\uB370, Label\\uC744 \\uD1B5\\uD574\\uC11C \\uAC00\\uC838\\uC624\\uB294 \\uAC83\\uC774 \\uC2E4\\uC218\\uB97C \\uBC29\\uC9C0\\uD558\\uACE0 \\uAC04\\uB2E8\\uD558\\uAC8C Tempo link\\uB97C \\uC5F0\\uACB0\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(\"img\",{src:\"/static/images/otel-datasource-new-version.png\",alt:\"datasource derived fields on grafana\"}),(0,n.jsxs)(e.h2,{id:\"\\uACB0\\uB860\",children:[(0,n.jsx)(e.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,n.jsx)(e.p,{children:\"\\uB9CE\\uC740 OpenSource Contributor\\uB4E4 \\uB355\\uBD84\\uC5D0 Tracing\\uACFC Logging\\uC744 \\uC27D\\uAC8C \\uAD6C\\uC131\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4. Loki\\uC5D0\\uC11C Regex\\uB85C Trace ID\\uB97C \\uCD94\\uCD9C\\uD558\\uACE0, \\uADF8\\uAC83\\uC744 Tempo\\uC5D0\\uC11C \\uBC14\\uB85C \\uBCFC \\uC218 \\uC788\\uB3C4\\uB85D \\uB9C1\\uD06C\\uB97C \\uB2EC\\uC544\\uC904 \\uC218 \\uC788\\uB294 \\uAC83\\uC740 \\uB108\\uBB34\\uB098 \\uC88B\\uC558\\uB2E4. \\uADF8\\uB9AC\\uACE0 OpenTelemetry Collector\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uC0C1\\uD669\\uC5D0\\uC11C FluentBit \\uB54C\\uC2E0\\uC5D0 Firelog receiver\\uB97C \\uC774\\uC6A9\\uD558\\uB294 \\uAC83\\uB3C4 \\uAD1C\\uCC2E\\uACA0\\uB2E4\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. \\uB2E4\\uC591\\uD55C Instrumentation library\\uB3C4 \\uCCB4\\uD06C\\uD574\\uBD10\\uC57C\\uACA0\\uB2E4. \\uC544\\uC9C1 Production Ready\\uB97C \\uC704\\uD574\\uC11C\\uB294 Loki, Tempo, Open Collector\\uC758 \\uAC00\\uC6A9\\uC131\\uC744 \\uC0DD\\uAC01\\uD574\\uC11C \\uBC30\\uD3EC\\uB3C4 \\uB2E4\\uC2DC \\uAD6C\\uC131\\uD574\\uC57C\\uD558\\uACE0, \\uD1B5\\uC2E0\\uAC04\\uC5D0 TLS\\uC640 \\uC778\\uC99D \\uBD80\\uBD84\\uB3C4 \\uCD94\\uAC00\\uD574\\uC57C \\uD55C\\uB2E4.\"})]})}}var b=f;return w;})();\n;return Component;","toc":[{"value":"Minikube í™˜ê²½","url":"#minikube-í™˜ê²½","depth":2},{"value":"Loki, Tempo, Grafana","url":"#loki-tempo-grafana","depth":2},{"value":"OpenTelemetry Collector","url":"#opentelemetry-collector","depth":2},{"value":"App","url":"#app","depth":2},{"value":"Nodejs","url":"#nodejs","depth":3},{"value":"Python","url":"#python","depth":3},{"value":"ì„œë¹„ìŠ¤ê°„ì˜ í†µì‹ ","url":"#ì„œë¹„ìŠ¤ê°„ì˜-í†µì‹ ","depth":3},{"value":"Metric","url":"#metric","depth":2},{"value":"ì•„ì§ ê°œë°œë˜ì§€ ì•Šì€ ê¸°ëŠ¥ë“¤","url":"#ì•„ì§-ê°œë°œë˜ì§€-ì•Šì€-ê¸°ëŠ¥ë“¤","depth":3},{"value":"Updateëœ ê¸°ëŠ¥","url":"#updateëœ-ê¸°ëŠ¥","depth":3},{"value":"ê²°ë¡ ","url":"#ê²°ë¡ ","depth":2}],"frontMatter":{"readingTime":{"text":"28 min read","minutes":27.805,"time":1668300,"words":5561},"slug":"20231231-open-telemetry","fileName":"20231231-open-telemetry.md","title":"OpenTelemetry with Minikube","date":"2023-12-31T00:00:00.000Z","tags":["opentelemetry","kubernetes"],"images":["/static/images/social-banner.png"],"summary":"OpenTelemetry collectorë¥¼ ì‚¬ìš©í•˜ì—¬ tracingê³¼ loggingì„ ê°™ì´ í•˜ëŠ” ê²ƒì„ ê²€í† í•˜ì˜€ë‹¤. Kubernetesì™€ ë©€ì–´ì ¸ ìˆë˜ ì‚¬ì´ì— OpenTelemetry ì»¤ë®¤ë‹ˆí‹°ê°€ ì—„ì²­ë‚˜ê²Œ ì„±ì¥í•œ ê²ƒì„ ê¹¨ë‹«ê²Œ ë˜ì—ˆë‹¤. Logì— traceIDë¥¼ ë‚¨ê¸°ê³  ê·¸ê±¸ë¡œ Tracing ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆê³ , Grafana í•˜ë‚˜ì—ì„œ í†µí•©ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ Lokiì™€ Tempoë¥¼ Exporterë¡œ ì‚¬ìš©í–ˆë‹¤. ì•„ì§ Pythonê³¼ Nodejsì—ì„œëŠ” Logìª½ì˜ ìƒíƒœëŠ” Developmentë‚˜ Experimentalì´ê¸° ë•Œë¬¸ì—, receiverì—ì„œ filelogë¥¼ ì‚¬ìš©í•˜ì—¬ Kubernetes log fileì„ fluentbitì²˜ëŸ¼ tailí•´ì„œ ê°€ì ¸ì˜¤ê³  traceIdë¥¼ logì— ë„£ì–´ì£¼ëŠ” instrument libaryë¥¼ ì‚¬ìš©í–ˆë‹¤."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Vault custom secret engine ì‘ì„±í•´ë³´ê¸°","date":"2023-12-28T00:00:00.000Z","tags":["vault","ncloud"],"images":["/static/images/social-banner.png"],"summary":"Vaultì˜ secret engineì„ ì‚¬ìš©í•˜ì—¬ ë„¤ì´ë²„ í´ë¼ìš°ë“œì˜ ì„ì‹œ ì¸ì¦í‚¤ë¥¼ ë°œí–‰í•˜ê³  ì‹¶ì—ˆë‹¤. ë„¤ì´ë²„í´ë¼ìš°ë“œëŠ” AWS, Azureì²˜ëŸ¼ builtin pluginìœ¼ë¡œ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤. í•˜ì§€ë§Œ custom secret engineì„ vault framework SDKë¥¼ í†µí•´ì„œ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ë„¤ì´ë²„ í´ë¼ìš°ë“œì—ì„œ STS APIë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì—, custom secret engineì„ í†µí•´ì„œ ì„ì‹œ ì¸ì¦í‚¤ë¥¼ ë°œí–‰í•˜ëŠ” ê²ƒì„ í…ŒìŠ¤íŠ¸ í•´ë³´ê²Œ ë˜ì—ˆë‹¤. ì²˜ìŒì— êµ¬ì¡°ë¥¼ ì´í•´í•˜ëŠ”ë° ì¢€ ì‹œê°„ì´ ê±¸ë ¸ì§€ë§Œ, Vault Tutorialì—ì„œ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•˜ê³  ìˆì–´ì„œ ë¹„êµì  ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆì—ˆë‹¤.","slug":"20231228-vault-custom-secret-engine"},"next":{"title":"GPTCache","date":"2024-01-06T00:00:00.000Z","tags":["GPTCache","ai"],"images":["/static/images/social-banner.png"],"summary":"GPTCacheë¥¼ ì‚¬ìš©í•˜ì—¬ LLMì— ì§ˆì˜ë¥¼ í•  ë•Œ, ì˜ë¯¸ì ìœ¼ë¡œ ìœ ì‚¬í•œ ì§ˆë¬¸ì— ëŒ€í•´ì„œëŠ” Cacheì— ì €ì¥ëœ ë‹µë³€ ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•´ë³´ì•˜ë‹¤. Langchainê³¼ Langserveë¥¼ í†µí•´ì„œ ê°„ë‹¨íˆ Cacheë¥¼ ì œê³µí•˜ëŠ” API serverë¥¼ ë§Œë“¤ ìˆ˜ ìˆì—ˆë‹¤. Defaultë¡œ ì„¤ì •ëœ GPTCacheì—ì„œ ì˜ë¯¸ì ìœ¼ë¡œ ì¶©ë¶„íˆ ë‹¤ë¥¸ ì§ˆì˜ì— ëŒ€í•´ì„œë„ ê¸°ì¡´ Cacheê°’ì„ ì‚¬ìš©í•˜ëŠ” False Positive ê²°ê³¼ë¥¼ ë°›ì•˜ë‹¤. ê·¸ë˜ì„œ Defaultë¡œ ì‚¬ìš©ëœ Similarity Evaluation ë°©ë²•ì´ ì–´ë–»ê²Œ ë™ì‘ë˜ëŠ”ì§€ ì‚´í´ë³´ì•˜ë‹¤. ì´í•´ë¥¼ ë°”íƒ•ìœ¼ë¡œ Thresholdê°’ì„ ë³€ê²½í•˜ì—¬ ë°œìƒí–ˆë˜ False Positive caseë¥¼ ì œê±°í•´ë³´ì•˜ë‹¤. ì•ìœ¼ë¡œ Cache hit rate, Accuracy, Speedë¥¼ ê³ ë ¤í•˜ì—¬ ì„œë¹„ìŠ¤ì— ì í•©í•œ Evaluation ë°©ë²•ì„ ì„ íƒí•˜ê¸° ìœ„í•´ì„œëŠ” Default ë§ê³  ë‹¤ë¥¸ ì˜µì…˜ë“¤ë„ í™•ì¸í•  í•„ìš”ê°€ ìˆê² ë‹¤.","slug":"20240106-gptcache"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20231231-open-telemetry"]},"buildId":"lqB8ysPMAnh5eaA73Sesi","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>