<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Distroless Image에 Package 추가하기</title><meta name="robots" content="follow, index"/><meta name="description" content="컨테이너 이미지에 최소한으로 필요한 software만 포함하는 것이 보안적으로 모범사례이다. 이러한 모범사례를 따르는 가장 쉽고 합리적인 방법은 구글에서 제공하는 Distroless Image를 활용하는 것이다. Distroless Image는 nonroot, debug, debug-nonroot Tag를 가지고 있다. nonroot은 conatiner에게 root 권한을 주지않고, shell도 없어서 Terminal로 접속이 불가능하다. 그런데 Distroless Image에 추가로 필요한 debian package를 설치하면 어떻게 해야할까? 이번 글에서는 bazel로 빌드할 때 원하는 debian package를 추가하는 방법을 알아 본다."/><meta property="og:url" content="https://jayground8.github.io/blog/20240713-add-package-to-distroless-image"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="컨테이너 이미지에 최소한으로 필요한 software만 포함하는 것이 보안적으로 모범사례이다. 이러한 모범사례를 따르는 가장 쉽고 합리적인 방법은 구글에서 제공하는 Distroless Image를 활용하는 것이다. Distroless Image는 nonroot, debug, debug-nonroot Tag를 가지고 있다. nonroot은 conatiner에게 root 권한을 주지않고, shell도 없어서 Terminal로 접속이 불가능하다. 그런데 Distroless Image에 추가로 필요한 debian package를 설치하면 어떻게 해야할까? 이번 글에서는 bazel로 빌드할 때 원하는 debian package를 추가하는 방법을 알아 본다."/><meta property="og:title" content="Distroless Image에 Package 추가하기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Distroless Image에 Package 추가하기"/><meta name="twitter:description" content="컨테이너 이미지에 최소한으로 필요한 software만 포함하는 것이 보안적으로 모범사례이다. 이러한 모범사례를 따르는 가장 쉽고 합리적인 방법은 구글에서 제공하는 Distroless Image를 활용하는 것이다. Distroless Image는 nonroot, debug, debug-nonroot Tag를 가지고 있다. nonroot은 conatiner에게 root 권한을 주지않고, shell도 없어서 Terminal로 접속이 불가능하다. 그런데 Distroless Image에 추가로 필요한 debian package를 설치하면 어떻게 해야할까? 이번 글에서는 bazel로 빌드할 때 원하는 debian package를 추가하는 방법을 알아 본다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20240713-add-package-to-distroless-image"/><meta property="article:published_time" content="2024-07-13T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20240713-add-package-to-distroless-image"
  },
  "headline": "Distroless Image에 Package 추가하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2024-07-13T00:00:00.000Z",
  "dateModified": "2024-07-13T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "컨테이너 이미지에 최소한으로 필요한 software만 포함하는 것이 보안적으로 모범사례이다. 이러한 모범사례를 따르는 가장 쉽고 합리적인 방법은 구글에서 제공하는 Distroless Image를 활용하는 것이다. Distroless Image는 nonroot, debug, debug-nonroot Tag를 가지고 있다. nonroot은 conatiner에게 root 권한을 주지않고, shell도 없어서 Terminal로 접속이 불가능하다. 그런데 Distroless Image에 추가로 필요한 debian package를 설치하면 어떻게 해야할까? 이번 글에서는 bazel로 빌드할 때 원하는 debian package를 추가하는 방법을 알아 본다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fb13019111364e7f.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/QKufPb8z7LtnZRz78-33M/_buildManifest.js" defer=""></script><script src="/_next/static/QKufPb8z7LtnZRz78-33M/_ssgManifest.js" defer=""></script><script src="/_next/static/QKufPb8z7LtnZRz78-33M/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-07-13T00:00:00.000Z">2024년 7월 13일 토요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Distroless Image에 Package 추가하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>컨테이너 이미지에는 최소한으로 필요한 구성요소만 넣는 것이 모범 사례이다. 컨테이너 이미지 크기가 작아져서 이미지를 보관하고 실행할 때 유리하다. 그리고 보안 관점에서는 불필요한 소프트웨어에 의해서 취약점을 노출하는 것을 방지할 수 있다. 이러한 모범 사례를 따르는 가장 쉽고 합리적인 방법은 <a target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleContainerTools/distroless">구글에서 공유하는 Distroless Image</a>를 사용하는 것이다.</p><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleContainerTools/distroless/blob/main/examples/python3-requirements/Dockerfile">Github에서 어떻게 Python3 어플리케이션을 Distroless Image로 빌드하는지 예제</a>를 제공한다. Docker Multi-Stage 빌드방식을 통해서 필요한 python package를 깔고 최종적으로 Distroless Image를 사용한다.</p><div class="relative"><pre><code class="code-highlight language-Dockerfile"><span class="code-line"><span class="token instruction"><span class="token keyword">FROM</span> debian:11-slim <span class="token keyword">AS</span> build</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; <span class="token operator">\</span>
</span></span><span class="code-line"><span class="token instruction">    apt-get install --no-install-suggests --no-install-recommends --yes python3-venv gcc libpython3-dev &amp;&amp; <span class="token operator">\</span>
</span></span><span class="code-line"><span class="token instruction">    python3 -m venv /venv &amp;&amp; <span class="token operator">\</span>
</span></span><span class="code-line"><span class="token instruction">    /venv/bin/pip install --upgrade pip setuptools wheel</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Build the virtualenv as a separate step: Only re-execute this step when requirements.txt changes</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">FROM</span> build <span class="token keyword">AS</span> build-venv</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">COPY</span> requirements.txt /requirements.txt</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">RUN</span> /venv/bin/pip install --disable-pip-version-check -r /requirements.txt</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Copy the virtualenv into a distroless image</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">FROM</span> gcr.io/distroless/python3-debian11</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build-venv</span></span> /venv /venv</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">COPY</span> . /app</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
</span><span class="code-line"><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/venv/bin/python3&quot;</span>, <span class="token string">&quot;psutil_example.py&quot;</span>]</span>
</span></code></pre></div><p>Distroless Image에서는 nonroot, debug, debug-nonroot Tag를 제공한다. 물론 Container에 root 권한을 주지 않는 것이 모범사례이기 때문에, nonroot를 사용하는 것이 바람직하다. 기본적으로 shell을 제공하지 하지 않기 때문에 Container에 Terminal로 접근을 하지 못한다. 따라서 개발환경에서 터미널로 접근하여 디버깅를 해야할 때, debug tag를 사용해서 접근할 수 있다.</p><h2 id="distroless-image-repo-확인"><a href="#distroless-image-repo-확인" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Distroless Image Repo 확인</h2><p>Distroless Image는 최소한으로 필요한 package와 binary들이 설치되어 있다. 심지어 shell 명령어로 제공되지 않아서 Terminal 접근을 할 수 없다.</p><p>그런데 어플리케이션에서 필요한 Debian package를 Distroless Image에 추가하고 싶으면 어떻게 해야할까? 🤔 구글링을 해보니 <a target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleContainerTools/distroless/issues/1321">똑같은 질문이 Github issue</a>에 있었다. 마지막 답변은 Bazel 설정값에서 원하는 debian package를 추가하여 distroless image를 빌드하는 것이다.</p><blockquote><p>Bazel is an open-source build and test tool similar to Make, Maven, and Gradle. It uses a human-readable, high-level build language. Bazel supports projects in multiple languages and builds outputs for multiple platforms. Bazel supports large codebases across multiple repositories, and large numbers of users.</p></blockquote><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleContainerTools/distroless/tree/main/python3">Distroless Image Github Repository</a>에서 보면, Python3의 경우에 아래와 같이 <code>BUILD</code>라는 파일이 보인다. <code>BUILD</code> 파일에 어떻게 bazel이 빌드해야할지 명령어가 설정되어 있다.</p><img src="/static/images/distroless-image-python3.png" alt="Python3 Distroless Image"/><p><code>BUILD</code> 파일을 확인해보니, oci_image에 원하는 package를 추가하면 간단하게 해결될 것처럼 보였다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">oci_image<span class="token punctuation">(</span>
</span><span class="code-line">    name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;python3&quot;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>not mode<span class="token punctuation">)</span> <span class="token keyword">else</span> mode<span class="token punctuation">[</span><span class="token number">1</span>:<span class="token punctuation">]</span><span class="token punctuation">)</span> + <span class="token string">&quot;_&quot;</span> + user + <span class="token string">&quot;_&quot;</span> + arch + <span class="token string">&quot;_&quot;</span> + distro,
</span><span class="code-line">    <span class="token comment"># Based on //cc so that C extensions work properly.</span>
</span><span class="code-line">    base <span class="token operator">=</span> <span class="token string">&quot;//cc&quot;</span> + <span class="token punctuation">(</span>mode <span class="token keyword">if</span> mode <span class="token keyword">else</span> <span class="token string">&quot;:cc&quot;</span><span class="token punctuation">)</span> + <span class="token string">&quot;_&quot;</span> + user + <span class="token string">&quot;_&quot;</span> + arch + <span class="token string">&quot;_&quot;</span> + distro,
</span><span class="code-line">    entrypoint <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token string">&quot;/usr/bin/python&quot;</span> + DISTRO_VERSION<span class="token punctuation">[</span>distro<span class="token punctuation">]</span>,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line">    <span class="token comment"># Use UTF-8 encoding for file system: match modern Linux</span>
</span><span class="code-line">    <span class="token function">env</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;LANG&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;C.UTF-8&quot;</span><span class="token punctuation">}</span>,
</span><span class="code-line">    tars <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libbz2-1.0&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libdb5.3&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libexpat1&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;liblzma5&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libsqlite3-0&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libuuid1&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libncursesw6&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libtinfo6&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;python3-distutils&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;zlib1g&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libcom-err2&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libcrypt1&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libgssapi-krb5-2&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libk5crypto3&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libkeyutils1&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libkrb5-3&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libkrb5support0&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libnsl2&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;libreadline8&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;python3.11-minimal&quot;</span><span class="token punctuation">)</span>,
</span><span class="code-line">        <span class="token string">&quot;:python_aliases_%s&quot;</span> % distro,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre></div><h2 id="bazel-build"><a href="#bazel-build" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Bazel Build</h2><p>bazel을 설치하고,</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">brew <span class="token function">install</span> bazel
</span></code></pre></div><p>Distroless Image Github Repository를 클론한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">git</span> clone https://github.com/GoogleContainerTools/distroless.git
</span></code></pre></div><p>위에서 <code>BUILD</code> 파일에는 name이 이렇게 정의되어 있었다. bazel build 명령어를 사용할 때, <code>//{path}</code>는 BUILD 파일이 있는 경로를 의미하는 것같다. 그리고 <code>//{path}:{name}</code> 세미콜론 뒤에는 정의된 name을 넣는 것으로 보인다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;python3&quot;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>not mode<span class="token punctuation">)</span> <span class="token keyword">else</span> mode<span class="token punctuation">[</span><span class="token number">1</span>:<span class="token punctuation">]</span><span class="token punctuation">)</span> + <span class="token string">&quot;_&quot;</span> + user + <span class="token string">&quot;_&quot;</span> + arch + <span class="token string">&quot;_&quot;</span> + distro,
</span></code></pre></div><p>최종적으로 root 권한이 없고, debian12를 base image로 사용하는 amd64 컨테이너 이미지를 생성하기 위해서 아래와 같이 명령어를 사용한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">bazel build //python3:python3_nonroot_amd64_debian12
</span></code></pre></div><p>Bazel 빌드가 정상적으로 완료되면, 아래와 같이 파일들이 생성된다. <code>bazel-bin</code> 디렉터리 안을 보면 최종적으로 <a target="_blank" rel="noopener noreferrer" href="https://github.com/opencontainers/image-spec/blob/main/image-layout.md">oci 규격에 맞춰서 Image가 생성</a>된 것을 확인할 수 있다.</p><img src="/static/images/distroless-image-bazel-build-output.png" alt="Bazel Build Output files"/><h2 id="debian-package-추가"><a href="#debian-package-추가" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Debian package 추가</h2><p><code>ffmpeg</code>를 추가해야 한다고 가정해보자. 그럼 먼저 <code>BUILD</code> 파일에 아래와 같이 ffmpeg를 추가한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">oci_image<span class="token punctuation">(</span>
</span><span class="code-line">    name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;python3&quot;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>not mode<span class="token punctuation">)</span> <span class="token keyword">else</span> mode<span class="token punctuation">[</span><span class="token number">1</span>:<span class="token punctuation">]</span><span class="token punctuation">)</span> + <span class="token string">&quot;_&quot;</span> + user + <span class="token string">&quot;_&quot;</span> + arch + <span class="token string">&quot;_&quot;</span> + distro,
</span><span class="code-line">    <span class="token comment"># Based on //cc so that C extensions work properly.</span>
</span><span class="code-line">    base <span class="token operator">=</span> <span class="token string">&quot;//cc&quot;</span> + <span class="token punctuation">(</span>mode <span class="token keyword">if</span> mode <span class="token keyword">else</span> <span class="token string">&quot;:cc&quot;</span><span class="token punctuation">)</span> + <span class="token string">&quot;_&quot;</span> + user + <span class="token string">&quot;_&quot;</span> + arch + <span class="token string">&quot;_&quot;</span> + distro,
</span><span class="code-line">    entrypoint <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token string">&quot;/usr/bin/python&quot;</span> + DISTRO_VERSION<span class="token punctuation">[</span>distro<span class="token punctuation">]</span>,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line">    <span class="token comment"># Use UTF-8 encoding for file system: match modern Linux</span>
</span><span class="code-line">    <span class="token function">env</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;LANG&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;C.UTF-8&quot;</span><span class="token punctuation">}</span>,
</span><span class="code-line">    tars <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token punctuation">..</span>.생략
</span><span class="code-line">        deb.package<span class="token punctuation">(</span>arch, distro, <span class="token string">&quot;ffmpeg&quot;</span><span class="token punctuation">)</span>, <span class="token comment"># 추가</span>
</span><span class="code-line">        <span class="token string">&quot;:python_aliases_%s&quot;</span> % distro,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre></div><p>그리고 <code>private/repos/deb</code> 경로에 있는 두가지 파일도 같이 수정해줘야 한다. (<strong>아직 bazel이 익숙하지 않아서 이렇게 수동으로 수정하는 것이 맞는지는 의문이다. <code>_lock</code>이라는 suffix가 있는 것으로 봐서는 package manager로 다운로드 받고 그것에 대한 정보를 남겨 놓는 것 같다는 느낌이 든다. bazel을 잘 모르는 상태에서 이렇게 해결했다.</strong>)</p><ul><li>bookworm_python.yaml</li><li>bookworm_python_lock.json</li></ul><p><code>bookworm_python.yaml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">packages</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> dash
</span><span class="code-line">  <span class="token punctuation">-</span> libbz2<span class="token punctuation">-</span><span class="token number">1.0</span>
</span><span class="code-line">  <span class="token punctuation">-</span> libcom<span class="token punctuation">-</span>err2
</span><span class="code-line">  <span class="token punctuation">-</span> libcrypt1 <span class="token comment"># TODO: glibc library for -lcrypt; maybe should be in cc?</span>
</span><span class="code-line">  <span class="token punctuation">-</span> libdb5.3
</span><span class="code-line">  <span class="token punctuation">-</span> libexpat1
</span><span class="code-line">  <span class="token punctuation">-</span> libffi8
</span><span class="code-line">  <span class="token punctuation">-</span> ffmpeg <span class="token comment"># 추가</span>
</span></code></pre></div><p><code>bookworm_python_lock.json</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token atrule key">&quot;packages&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">		생략<span class="token punctuation">...</span>
</span><span class="code-line">		<span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token atrule key">&quot;arch&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;amd64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;key&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;libffi8_3.4.4-1_amd64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;libffi8&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;sha256&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;6d9f6c25c30efccce6d4bceaa48ea86c329a3432abb360a141f76ac223a4c34a&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://snapshot.debian.org/archive/debian/20240706T203757Z/pool/main/libf/libffi/libffi8_3.4.4-1_amd64.deb&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;3.4.4-1&quot;</span>
</span><span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token atrule key">&quot;arch&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;amd64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;key&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ffmpeg_5.1.5-0_amd64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ffmpeg&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;sha256&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;6cdb48bab871aacf48aa13e6da0f41e14c39b834763fdd72c346a1e0b0c865a5&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://snapshot.debian.org/archive/debian/20240712T023630Z/pool/main/f/ffmpeg/ffmpeg_5.1.5-0+deb12u1_amd64.deb&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token atrule key">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;5.1.5-0&quot;</span>
</span><span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		생략<span class="token punctuation">...</span>
</span><span class="code-line">	<span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token atrule key">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://tracker.debian.org/pkg/ffmpeg">Debian package tracker 페이지</a>를 보면 지금 작성하는 시점에서 <code>5.1.5-0+deb12u1</code>이 stable한 버전이었다.</p><img src="/static/images/distroless-image-debian-ffmpeg.png" alt="stable version of ffmpeg package"/><p>그리고 다른 debian package처럼 <code>snapshot</code> 경로에서 해당 버전을 찾았다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">https://snapshot.debian.org/archive/debian/20240712T023630Z/pool/main/f/ffmpeg/
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://packages.debian.org/bookworm/amd64/ffmpeg/download">sha256 checksum hash값은 debian package 다운로드 페이지</a>에서 찾아서 사용했다.</p><p>이제 다시 bazel build 명령어를 실행하면 해당 package가 추가되고, 최종적으로 빌드가 성공한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ bazel build //python3:python3_nonroot_amd64_debian12
</span><span class="code-line">INFO: Analyzed target //python3:python3_nonroot_amd64_debian12 <span class="token punctuation">(</span><span class="token number">55</span> packages loaded, <span class="token number">465</span> targets configured<span class="token punctuation">)</span>.
</span><span class="code-line">INFO: Found <span class="token number">1</span> target<span class="token punctuation">..</span>.
</span><span class="code-line">INFO: From Writing: bazel-out/darwin_arm64-fastbuild/bin/external/bookworm_python/ffmpeg/amd64/data_statusd.tar:
</span><span class="code-line">/private/var/tmp/_bazel_user/64d7a1035bb5d33ddc81222bbb467eb5/sandbox/darwin-sandbox/230/execroot/distroless/bazel-out/darwin_arm64-opt-exec-2B5CBBC6/bin/external/rules_pkg/pkg/private/tar/build_tar.runfiles/rules_pkg/pkg/private/tar/build_tar.py:29: SyntaxWarning: invalid escape sequence <span class="token string">&#x27;\ &#x27;</span>
</span><span class="code-line">  <span class="token string">&quot;&quot;</span>&quot;Normalize a path to the <span class="token function">format</span> we need it.
</span><span class="code-line">Target //python3:python3_nonroot_amd64_debian12 up-to-date:
</span><span class="code-line">  bazel-bin/python3/python3_nonroot_amd64_debian12
</span><span class="code-line">INFO: Elapsed time: <span class="token number">7</span>.040s, Critical Path: <span class="token number">1</span>.32s
</span><span class="code-line">INFO: <span class="token number">5</span> processes: <span class="token number">2</span> internal, <span class="token number">3</span> darwin-sandbox.
</span><span class="code-line">INFO: Build completed successfully, <span class="token number">5</span> total actions
</span></code></pre></div><h2 id="oci-image를-push"><a href="#oci-image를-push" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>OCI Image를 push</h2><p>bazel build를 해서 OCI Image 규격의 구조로 만들어진 것을 확인했었다.</p><ul><li>blobs</li><li>oci-layout</li><li>index.json</li></ul><p>해당 구조에서 image를 container registry에 push기 위해서 <a target="_blank" rel="noopener noreferrer" href="https://github.com/google/go-containerregistry/blob/main/cmd/crane/doc/crane.md">crane</a>를 사용한다.</p><p>crane push 명령어를 통해서 바로 container registry에 image push를 한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">brew <span class="token function">install</span> crane
</span><span class="code-line">crane push bazel-bin/python3/python3_nonroot_amd64_debian12 <span class="token punctuation">{</span>컨테이너 레지스티 경로<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>Distroless Image는 각 Runtime별로 최소한으로 필요한 Debian package가 설치되어 있다. 하지만 어플리케이션을 개발하다 보면 추가로 다른 debian package를 설치해야 할 수 있다. 감사하게도 Distroless Image Github Repository에 어떻게 bazel로 이미지를 빌드할 수 있는지 공유하고 있다. 따라서 몇 가지 파일들만 변경하여 원하는 debian package가 추가된 Distroless Image를 만들 수 있었다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/distroless">distroless</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/devsecops">devsecops</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240713-vault-audit">Vault Audit Log를 남기기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240714-vault-oidc">구글 계정으로 Vault 로그인하기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003el(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of p(s))!m.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},g=a=\u003ek(i(l(a!=null?r(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((v,t)=\u003e{t.exports=_jsx_runtime});var _={};N(_,{default:()=\u003ef,frontmatter:()=\u003eb});var n=g(o()),b={title:\"Distroless Image\\uC5D0 Package \\uCD94\\uAC00\\uD558\\uAE30\",date:\"2024-07-13\",tags:[\"kubernetes\",\"distroless\",\"devsecops\"],images:[\"/static/images/social-banner.png\"],summary:\"\\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uC5D0 \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uD544\\uC694\\uD55C software\\uB9CC \\uD3EC\\uD568\\uD558\\uB294 \\uAC83\\uC774 \\uBCF4\\uC548\\uC801\\uC73C\\uB85C \\uBAA8\\uBC94\\uC0AC\\uB840\\uC774\\uB2E4. \\uC774\\uB7EC\\uD55C \\uBAA8\\uBC94\\uC0AC\\uB840\\uB97C \\uB530\\uB974\\uB294 \\uAC00\\uC7A5 \\uC27D\\uACE0 \\uD569\\uB9AC\\uC801\\uC778 \\uBC29\\uBC95\\uC740 \\uAD6C\\uAE00\\uC5D0\\uC11C \\uC81C\\uACF5\\uD558\\uB294 Distroless Image\\uB97C \\uD65C\\uC6A9\\uD558\\uB294 \\uAC83\\uC774\\uB2E4. Distroless Image\\uB294 nonroot, debug, debug-nonroot Tag\\uB97C \\uAC00\\uC9C0\\uACE0 \\uC788\\uB2E4. nonroot\\uC740 conatiner\\uC5D0\\uAC8C root \\uAD8C\\uD55C\\uC744 \\uC8FC\\uC9C0\\uC54A\\uACE0, shell\\uB3C4 \\uC5C6\\uC5B4\\uC11C Terminal\\uB85C \\uC811\\uC18D\\uC774 \\uBD88\\uAC00\\uB2A5\\uD558\\uB2E4. \\uADF8\\uB7F0\\uB370 Distroless Image\\uC5D0 \\uCD94\\uAC00\\uB85C \\uD544\\uC694\\uD55C debian package\\uB97C \\uC124\\uCE58\\uD558\\uBA74 \\uC5B4\\uB5BB\\uAC8C \\uD574\\uC57C\\uD560\\uAE4C? \\uC774\\uBC88 \\uAE00\\uC5D0\\uC11C\\uB294 bazel\\uB85C \\uBE4C\\uB4DC\\uD560 \\uB54C \\uC6D0\\uD558\\uB294 debian package\\uB97C \\uCD94\\uAC00\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC54C\\uC544 \\uBCF8\\uB2E4.\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",a:\"a\",pre:\"pre\",code:\"code\",span:\"span\",h2:\"h2\",blockquote:\"blockquote\",strong:\"strong\",ul:\"ul\",li:\"li\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"\\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uC5D0\\uB294 \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uD544\\uC694\\uD55C \\uAD6C\\uC131\\uC694\\uC18C\\uB9CC \\uB123\\uB294 \\uAC83\\uC774 \\uBAA8\\uBC94 \\uC0AC\\uB840\\uC774\\uB2E4. \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0 \\uD06C\\uAE30\\uAC00 \\uC791\\uC544\\uC838\\uC11C \\uC774\\uBBF8\\uC9C0\\uB97C \\uBCF4\\uAD00\\uD558\\uACE0 \\uC2E4\\uD589\\uD560 \\uB54C \\uC720\\uB9AC\\uD558\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uBCF4\\uC548 \\uAD00\\uC810\\uC5D0\\uC11C\\uB294 \\uBD88\\uD544\\uC694\\uD55C \\uC18C\\uD504\\uD2B8\\uC6E8\\uC5B4\\uC5D0 \\uC758\\uD574\\uC11C \\uCDE8\\uC57D\\uC810\\uC744 \\uB178\\uCD9C\\uD558\\uB294 \\uAC83\\uC744 \\uBC29\\uC9C0\\uD560 \\uC218 \\uC788\\uB2E4. \\uC774\\uB7EC\\uD55C \\uBAA8\\uBC94 \\uC0AC\\uB840\\uB97C \\uB530\\uB974\\uB294 \\uAC00\\uC7A5 \\uC27D\\uACE0 \\uD569\\uB9AC\\uC801\\uC778 \\uBC29\\uBC95\\uC740 \",(0,n.jsx)(e.a,{href:\"https://github.com/GoogleContainerTools/distroless\",children:\"\\uAD6C\\uAE00\\uC5D0\\uC11C \\uACF5\\uC720\\uD558\\uB294 Distroless Image\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC774\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/GoogleContainerTools/distroless/blob/main/examples/python3-requirements/Dockerfile\",children:\"Github\\uC5D0\\uC11C \\uC5B4\\uB5BB\\uAC8C Python3 \\uC5B4\\uD50C\\uB9AC\\uCF00\\uC774\\uC158\\uC744 Distroless Image\\uB85C \\uBE4C\\uB4DC\\uD558\\uB294\\uC9C0 \\uC608\\uC81C\"}),\"\\uB97C \\uC81C\\uACF5\\uD55C\\uB2E4. Docker Multi-Stage \\uBE4C\\uB4DC\\uBC29\\uC2DD\\uC744 \\uD1B5\\uD574\\uC11C \\uD544\\uC694\\uD55C python package\\uB97C \\uAE54\\uACE0 \\uCD5C\\uC885\\uC801\\uC73C\\uB85C Distroless Image\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-Dockerfile\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" debian:11-slim \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apt-get update \u0026\u0026 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\\\\\"}),`\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token instruction\",children:[\"    apt-get install --no-install-suggests --no-install-recommends --yes python3-venv gcc libpython3-dev \u0026\u0026 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\\\\\"}),`\n`]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token instruction\",children:[\"    python3 -m venv /venv \u0026\u0026 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\\\\\"}),`\n`]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token instruction\",children:\"    /venv/bin/pip install --upgrade pip setuptools wheel\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Build the virtualenv as a separate step: Only re-execute this step when requirements.txt changes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" build \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" build-venv\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" requirements.txt /requirements.txt\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" /venv/bin/pip install --disable-pip-version-check -r /requirements.txt\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy the virtualenv into a distroless image\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" gcr.io/distroless/python3-debian11\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"build-venv\"})]}),\" /venv /venv\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" . /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENTRYPOINT\"}),\" [\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/venv/bin/python3\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"psutil_example.py\"'}),\"]\"]}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Distroless Image\\uC5D0\\uC11C\\uB294 nonroot, debug, debug-nonroot Tag\\uB97C \\uC81C\\uACF5\\uD55C\\uB2E4. \\uBB3C\\uB860 Container\\uC5D0 root \\uAD8C\\uD55C\\uC744 \\uC8FC\\uC9C0 \\uC54A\\uB294 \\uAC83\\uC774 \\uBAA8\\uBC94\\uC0AC\\uB840\\uC774\\uAE30 \\uB54C\\uBB38\\uC5D0, nonroot\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC774 \\uBC14\\uB78C\\uC9C1\\uD558\\uB2E4. \\uAE30\\uBCF8\\uC801\\uC73C\\uB85C shell\\uC744 \\uC81C\\uACF5\\uD558\\uC9C0 \\uD558\\uC9C0 \\uC54A\\uAE30 \\uB54C\\uBB38\\uC5D0 Container\\uC5D0 Terminal\\uB85C \\uC811\\uADFC\\uC744 \\uD558\\uC9C0 \\uBABB\\uD55C\\uB2E4. \\uB530\\uB77C\\uC11C \\uAC1C\\uBC1C\\uD658\\uACBD\\uC5D0\\uC11C \\uD130\\uBBF8\\uB110\\uB85C \\uC811\\uADFC\\uD558\\uC5EC \\uB514\\uBC84\\uAE45\\uB97C \\uD574\\uC57C\\uD560 \\uB54C, debug tag\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \\uC811\\uADFC\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsxs)(e.h2,{id:\"distroless-image-repo-\\uD655\\uC778\",children:[(0,n.jsx)(e.a,{href:\"#distroless-image-repo-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Distroless Image Repo \\uD655\\uC778\"]}),(0,n.jsx)(e.p,{children:\"Distroless Image\\uB294 \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uD544\\uC694\\uD55C package\\uC640 binary\\uB4E4\\uC774 \\uC124\\uCE58\\uB418\\uC5B4 \\uC788\\uB2E4. \\uC2EC\\uC9C0\\uC5B4 shell \\uBA85\\uB839\\uC5B4\\uB85C \\uC81C\\uACF5\\uB418\\uC9C0 \\uC54A\\uC544\\uC11C Terminal \\uC811\\uADFC\\uC744 \\uD560 \\uC218 \\uC5C6\\uB2E4.\"}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB7F0\\uB370 \\uC5B4\\uD50C\\uB9AC\\uCF00\\uC774\\uC158\\uC5D0\\uC11C \\uD544\\uC694\\uD55C Debian package\\uB97C Distroless Image\\uC5D0 \\uCD94\\uAC00\\uD558\\uACE0 \\uC2F6\\uC73C\\uBA74 \\uC5B4\\uB5BB\\uAC8C \\uD574\\uC57C\\uD560\\uAE4C? \\u{1F914} \\uAD6C\\uAE00\\uB9C1\\uC744 \\uD574\\uBCF4\\uB2C8 \",(0,n.jsx)(e.a,{href:\"https://github.com/GoogleContainerTools/distroless/issues/1321\",children:\"\\uB611\\uAC19\\uC740 \\uC9C8\\uBB38\\uC774 Github issue\"}),\"\\uC5D0 \\uC788\\uC5C8\\uB2E4. \\uB9C8\\uC9C0\\uB9C9 \\uB2F5\\uBCC0\\uC740 Bazel \\uC124\\uC815\\uAC12\\uC5D0\\uC11C \\uC6D0\\uD558\\uB294 debian package\\uB97C \\uCD94\\uAC00\\uD558\\uC5EC distroless image\\uB97C \\uBE4C\\uB4DC\\uD558\\uB294 \\uAC83\\uC774\\uB2E4.\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"Bazel is an open-source build and test tool similar to Make, Maven, and Gradle. It uses a human-readable, high-level build language. Bazel supports projects in multiple languages and builds outputs for multiple platforms. Bazel supports large codebases across multiple repositories, and large numbers of users.\"})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/GoogleContainerTools/distroless/tree/main/python3\",children:\"Distroless Image Github Repository\"}),\"\\uC5D0\\uC11C \\uBCF4\\uBA74, Python3\\uC758 \\uACBD\\uC6B0\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,n.jsx)(e.code,{children:\"BUILD\"}),\"\\uB77C\\uB294 \\uD30C\\uC77C\\uC774 \\uBCF4\\uC778\\uB2E4. \",(0,n.jsx)(e.code,{children:\"BUILD\"}),\" \\uD30C\\uC77C\\uC5D0 \\uC5B4\\uB5BB\\uAC8C bazel\\uC774 \\uBE4C\\uB4DC\\uD574\\uC57C\\uD560\\uC9C0 \\uBA85\\uB839\\uC5B4\\uAC00 \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/distroless-image-python3.png\",alt:\"Python3 Distroless Image\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"BUILD\"}),\" \\uD30C\\uC77C\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uB2C8, oci_image\\uC5D0 \\uC6D0\\uD558\\uB294 package\\uB97C \\uCD94\\uAC00\\uD558\\uBA74 \\uAC04\\uB2E8\\uD558\\uAC8C \\uD574\\uACB0\\uB420 \\uAC83\\uCC98\\uB7FC \\uBCF4\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"oci_image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"python3\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"not mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\":\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + user + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + arch + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),` + distro,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Based on //cc so that C extensions work properly.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    base \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"//cc\"'}),\" + \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mode \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" mode \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\":cc\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + user + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + arch + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),` + distro,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    entrypoint \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/usr/bin/python\"'}),\" + DISTRO_VERSION\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"distro\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Use UTF-8 encoding for file system: match modern Linux\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"env\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"LANG\"'}),(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"C.UTF-8\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    tars \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libbz2-1.0\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libdb5.3\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libexpat1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"liblzma5\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libsqlite3-0\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libuuid1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libncursesw6\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libtinfo6\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"python3-distutils\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"zlib1g\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libcom-err2\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libcrypt1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libgssapi-krb5-2\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libk5crypto3\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libkeyutils1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libkrb5-3\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libkrb5support0\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libnsl2\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libreadline8\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"python3.11-minimal\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\":python_aliases_%s\"'}),` % distro,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"bazel-build\",children:[(0,n.jsx)(e.a,{href:\"#bazel-build\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Bazel Build\"]}),(0,n.jsx)(e.p,{children:\"bazel\\uC744 \\uC124\\uCE58\\uD558\\uACE0,\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"brew \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` bazel\n`]})})}),(0,n.jsx)(e.p,{children:\"Distroless Image Github Repository\\uB97C \\uD074\\uB860\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"git\"}),` clone https://github.com/GoogleContainerTools/distroless.git\n`]})})}),(0,n.jsxs)(e.p,{children:[\"\\uC704\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"BUILD\"}),\" \\uD30C\\uC77C\\uC5D0\\uB294 name\\uC774 \\uC774\\uB807\\uAC8C \\uC815\\uC758\\uB418\\uC5B4 \\uC788\\uC5C8\\uB2E4. bazel build \\uBA85\\uB839\\uC5B4\\uB97C \\uC0AC\\uC6A9\\uD560 \\uB54C, \",(0,n.jsx)(e.code,{children:\"//{path}\"}),\"\\uB294 BUILD \\uD30C\\uC77C\\uC774 \\uC788\\uB294 \\uACBD\\uB85C\\uB97C \\uC758\\uBBF8\\uD558\\uB294 \\uAC83\\uAC19\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,n.jsx)(e.code,{children:\"//{path}:{name}\"}),\" \\uC138\\uBBF8\\uCF5C\\uB860 \\uB4A4\\uC5D0\\uB294 \\uC815\\uC758\\uB41C name\\uC744 \\uB123\\uB294 \\uAC83\\uC73C\\uB85C \\uBCF4\\uC778\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"python3\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"not mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\":\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + user + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + arch + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),` + distro,\n`]})})}),(0,n.jsx)(e.p,{children:\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C root \\uAD8C\\uD55C\\uC774 \\uC5C6\\uACE0, debian12\\uB97C base image\\uB85C \\uC0AC\\uC6A9\\uD558\\uB294 amd64 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC0DD\\uC131\\uD558\\uAE30 \\uC704\\uD574\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uBA85\\uB839\\uC5B4\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`bazel build //python3:python3_nonroot_amd64_debian12\n`})})}),(0,n.jsxs)(e.p,{children:[\"Bazel \\uBE4C\\uB4DC\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC644\\uB8CC\\uB418\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD30C\\uC77C\\uB4E4\\uC774 \\uC0DD\\uC131\\uB41C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"bazel-bin\"}),\" \\uB514\\uB809\\uD130\\uB9AC \\uC548\\uC744 \\uBCF4\\uBA74 \\uCD5C\\uC885\\uC801\\uC73C\\uB85C \",(0,n.jsx)(e.a,{href:\"https://github.com/opencontainers/image-spec/blob/main/image-layout.md\",children:\"oci \\uADDC\\uACA9\\uC5D0 \\uB9DE\\uCDB0\\uC11C Image\\uAC00 \\uC0DD\\uC131\"}),\"\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/distroless-image-bazel-build-output.png\",alt:\"Bazel Build Output files\"}),(0,n.jsxs)(e.h2,{id:\"debian-package-\\uCD94\\uAC00\",children:[(0,n.jsx)(e.a,{href:\"#debian-package-\\uCD94\\uAC00\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Debian package \\uCD94\\uAC00\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"ffmpeg\"}),\"\\uB97C \\uCD94\\uAC00\\uD574\\uC57C \\uD55C\\uB2E4\\uACE0 \\uAC00\\uC815\\uD574\\uBCF4\\uC790. \\uADF8\\uB7FC \\uBA3C\\uC800 \",(0,n.jsx)(e.code,{children:\"BUILD\"}),\" \\uD30C\\uC77C\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 ffmpeg\\uB97C \\uCD94\\uAC00\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"oci_image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"python3\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"not mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\":\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + user + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + arch + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),` + distro,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Based on //cc so that C extensions work properly.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    base \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"//cc\"'}),\" + \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mode \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" mode \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\":cc\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + user + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),\" + arch + \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"_\"'}),` + distro,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    entrypoint \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/usr/bin/python\"'}),\" + DISTRO_VERSION\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"distro\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Use UTF-8 encoding for file system: match modern Linux\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token function\",children:\"env\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"LANG\"'}),(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"C.UTF-8\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    tars \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        deb.package\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"arch, distro, \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"ffmpeg\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\", \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\uCD94\\uAC00\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\":python_aliases_%s\"'}),` % distro,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,n.jsx)(e.code,{children:\"private/repos/deb\"}),\" \\uACBD\\uB85C\\uC5D0 \\uC788\\uB294 \\uB450\\uAC00\\uC9C0 \\uD30C\\uC77C\\uB3C4 \\uAC19\\uC774 \\uC218\\uC815\\uD574\\uC918\\uC57C \\uD55C\\uB2E4. (\",(0,n.jsxs)(e.strong,{children:[\"\\uC544\\uC9C1 bazel\\uC774 \\uC775\\uC219\\uD558\\uC9C0 \\uC54A\\uC544\\uC11C \\uC774\\uB807\\uAC8C \\uC218\\uB3D9\\uC73C\\uB85C \\uC218\\uC815\\uD558\\uB294 \\uAC83\\uC774 \\uB9DE\\uB294\\uC9C0\\uB294 \\uC758\\uBB38\\uC774\\uB2E4. \",(0,n.jsx)(e.code,{children:\"_lock\"}),\"\\uC774\\uB77C\\uB294 suffix\\uAC00 \\uC788\\uB294 \\uAC83\\uC73C\\uB85C \\uBD10\\uC11C\\uB294 package manager\\uB85C \\uB2E4\\uC6B4\\uB85C\\uB4DC \\uBC1B\\uACE0 \\uADF8\\uAC83\\uC5D0 \\uB300\\uD55C \\uC815\\uBCF4\\uB97C \\uB0A8\\uACA8 \\uB193\\uB294 \\uAC83 \\uAC19\\uB2E4\\uB294 \\uB290\\uB08C\\uC774 \\uB4E0\\uB2E4. bazel\\uC744 \\uC798 \\uBAA8\\uB974\\uB294 \\uC0C1\\uD0DC\\uC5D0\\uC11C \\uC774\\uB807\\uAC8C \\uD574\\uACB0\\uD588\\uB2E4.\"]}),\")\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"bookworm_python.yaml\"}),(0,n.jsx)(e.li,{children:\"bookworm_python_lock.json\"})]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"bookworm_python.yaml\"})}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"packages\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` dash\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" libbz2\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1.0\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" libcom\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`err2\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" libcrypt1 \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# TODO: glibc library for -lcrypt; maybe should be in cc?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` libdb5.3\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` libexpat1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` libffi8\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" ffmpeg \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\uCD94\\uAC00\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"bookworm_python_lock.json\"})}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"packages\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\\uC0DD\\uB7B5\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"arch\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"amd64\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"dependencies\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"key\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libffi8_3.4.4-1_amd64\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"libffi8\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"sha256\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"6d9f6c25c30efccce6d4bceaa48ea86c329a3432abb360a141f76ac223a4c34a\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"url\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"https://snapshot.debian.org/archive/debian/20240706T203757Z/pool/main/libf/libffi/libffi8_3.4.4-1_amd64.deb\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"version\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"3.4.4-1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"arch\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"amd64\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"dependencies\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"key\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"ffmpeg_5.1.5-0_amd64\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"ffmpeg\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"sha256\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"6cdb48bab871aacf48aa13e6da0f41e14c39b834763fdd72c346a1e0b0c865a5\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"url\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"https://snapshot.debian.org/archive/debian/20240712T023630Z/pool/main/f/ffmpeg/ffmpeg_5.1.5-0+deb12u1_amd64.deb\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"version\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"5.1.5-0\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\\uC0DD\\uB7B5\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token atrule key\",children:'\"version\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://tracker.debian.org/pkg/ffmpeg\",children:\"Debian package tracker \\uD398\\uC774\\uC9C0\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC9C0\\uAE08 \\uC791\\uC131\\uD558\\uB294 \\uC2DC\\uC810\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"5.1.5-0+deb12u1\"}),\"\\uC774 stable\\uD55C \\uBC84\\uC804\\uC774\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/distroless-image-debian-ffmpeg.png\",alt:\"stable version of ffmpeg package\"}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uB2E4\\uB978 debian package\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"snapshot\"}),\" \\uACBD\\uB85C\\uC5D0\\uC11C \\uD574\\uB2F9 \\uBC84\\uC804\\uC744 \\uCC3E\\uC558\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`https://snapshot.debian.org/archive/debian/20240712T023630Z/pool/main/f/ffmpeg/\n`})})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://packages.debian.org/bookworm/amd64/ffmpeg/download\",children:\"sha256 checksum hash\\uAC12\\uC740 debian package \\uB2E4\\uC6B4\\uB85C\\uB4DC \\uD398\\uC774\\uC9C0\"}),\"\\uC5D0\\uC11C \\uCC3E\\uC544\\uC11C \\uC0AC\\uC6A9\\uD588\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C \\uB2E4\\uC2DC bazel build \\uBA85\\uB839\\uC5B4\\uB97C \\uC2E4\\uD589\\uD558\\uBA74 \\uD574\\uB2F9 package\\uAC00 \\uCD94\\uAC00\\uB418\\uACE0, \\uCD5C\\uC885\\uC801\\uC73C\\uB85C \\uBE4C\\uB4DC\\uAC00 \\uC131\\uACF5\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`$ bazel build //python3:python3_nonroot_amd64_debian12\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"INFO: Analyzed target //python3:python3_nonroot_amd64_debian12 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"55\"}),\" packages loaded, \",(0,n.jsx)(e.span,{className:\"token number\",children:\"465\"}),\" targets configured\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"INFO: Found \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" target\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`INFO: From Writing: bazel-out/darwin_arm64-fastbuild/bin/external/bookworm_python/ffmpeg/amd64/data_statusd.tar:\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"/private/var/tmp/_bazel_user/64d7a1035bb5d33ddc81222bbb467eb5/sandbox/darwin-sandbox/230/execroot/distroless/bazel-out/darwin_arm64-opt-exec-2B5CBBC6/bin/external/rules_pkg/pkg/private/tar/build_tar.runfiles/rules_pkg/pkg/private/tar/build_tar.py:29: SyntaxWarning: invalid escape sequence \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'\\\\ '\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),'\"Normalize a path to the ',(0,n.jsx)(e.span,{className:\"token function\",children:\"format\"}),` we need it.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Target //python3:python3_nonroot_amd64_debian12 up-to-date:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  bazel-bin/python3/python3_nonroot_amd64_debian12\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"INFO: Elapsed time: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"7\"}),\".040s, Critical Path: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`.32s\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"INFO: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),\" processes: \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),\" internal, \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),` darwin-sandbox.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"INFO: Build completed successfully, \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),` total actions\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"oci-image\\uB97C-push\",children:[(0,n.jsx)(e.a,{href:\"#oci-image\\uB97C-push\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"OCI Image\\uB97C push\"]}),(0,n.jsx)(e.p,{children:\"bazel build\\uB97C \\uD574\\uC11C OCI Image \\uADDC\\uACA9\\uC758 \\uAD6C\\uC870\\uB85C \\uB9CC\\uB4E4\\uC5B4\\uC9C4 \\uAC83\\uC744 \\uD655\\uC778\\uD588\\uC5C8\\uB2E4.\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"blobs\"}),(0,n.jsx)(e.li,{children:\"oci-layout\"}),(0,n.jsx)(e.li,{children:\"index.json\"})]}),(0,n.jsxs)(e.p,{children:[\"\\uD574\\uB2F9 \\uAD6C\\uC870\\uC5D0\\uC11C image\\uB97C container registry\\uC5D0 push\\uAE30 \\uC704\\uD574\\uC11C \",(0,n.jsx)(e.a,{href:\"https://github.com/google/go-containerregistry/blob/main/cmd/crane/doc/crane.md\",children:\"crane\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:\"crane push \\uBA85\\uB839\\uC5B4\\uB97C \\uD1B5\\uD574\\uC11C \\uBC14\\uB85C container registry\\uC5D0 image push\\uB97C \\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"brew \",(0,n.jsx)(e.span,{className:\"token function\",children:\"install\"}),` crane\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"crane push bazel-bin/python3/python3_nonroot_amd64_debian12 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"\\uCEE8\\uD14C\\uC774\\uB108 \\uB808\\uC9C0\\uC2A4\\uD2F0 \\uACBD\\uB85C\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"\\uACB0\\uB860\",children:[(0,n.jsx)(e.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,n.jsx)(e.p,{children:\"Distroless Image\\uB294 \\uAC01 Runtime\\uBCC4\\uB85C \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uD544\\uC694\\uD55C Debian package\\uAC00 \\uC124\\uCE58\\uB418\\uC5B4 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uC5B4\\uD50C\\uB9AC\\uCF00\\uC774\\uC158\\uC744 \\uAC1C\\uBC1C\\uD558\\uB2E4 \\uBCF4\\uBA74 \\uCD94\\uAC00\\uB85C \\uB2E4\\uB978 debian package\\uB97C \\uC124\\uCE58\\uD574\\uC57C \\uD560 \\uC218 \\uC788\\uB2E4. \\uAC10\\uC0AC\\uD558\\uAC8C\\uB3C4 Distroless Image Github Repository\\uC5D0 \\uC5B4\\uB5BB\\uAC8C bazel\\uB85C \\uC774\\uBBF8\\uC9C0\\uB97C \\uBE4C\\uB4DC\\uD560 \\uC218 \\uC788\\uB294\\uC9C0 \\uACF5\\uC720\\uD558\\uACE0 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uBA87 \\uAC00\\uC9C0 \\uD30C\\uC77C\\uB4E4\\uB9CC \\uBCC0\\uACBD\\uD558\\uC5EC \\uC6D0\\uD558\\uB294 debian package\\uAC00 \\uCD94\\uAC00\\uB41C Distroless Image\\uB97C \\uB9CC\\uB4E4 \\uC218 \\uC788\\uC5C8\\uB2E4.\"})]})}}var f=y;return _;})();\n;return Component;","toc":[{"value":"Distroless Image Repo 확인","url":"#distroless-image-repo-확인","depth":2},{"value":"Bazel Build","url":"#bazel-build","depth":2},{"value":"Debian package 추가","url":"#debian-package-추가","depth":2},{"value":"OCI Image를 push","url":"#oci-image를-push","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.42,"time":445200,"words":1484},"slug":"20240713-add-package-to-distroless-image","fileName":"20240713-add-package-to-distroless-image.md","title":"Distroless Image에 Package 추가하기","date":"2024-07-13T00:00:00.000Z","tags":["kubernetes","distroless","devsecops"],"images":["/static/images/social-banner.png"],"summary":"컨테이너 이미지에 최소한으로 필요한 software만 포함하는 것이 보안적으로 모범사례이다. 이러한 모범사례를 따르는 가장 쉽고 합리적인 방법은 구글에서 제공하는 Distroless Image를 활용하는 것이다. Distroless Image는 nonroot, debug, debug-nonroot Tag를 가지고 있다. nonroot은 conatiner에게 root 권한을 주지않고, shell도 없어서 Terminal로 접속이 불가능하다. 그런데 Distroless Image에 추가로 필요한 debian package를 설치하면 어떻게 해야할까? 이번 글에서는 bazel로 빌드할 때 원하는 debian package를 추가하는 방법을 알아 본다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Vault Audit Log를 남기기","date":"2024-07-13T00:00:00.000Z","tags":["vault","devsecops"],"images":["/static/images/social-banner.png"],"summary":"Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다.","slug":"20240713-vault-audit"},"next":{"title":"구글 계정으로 Vault 로그인하기","date":"2024-07-14T00:00:00.000Z","tags":["vault","devsecops"],"images":["/static/images/social-banner.png"],"summary":"Vault를 구글 인증을 통해서 로그인하도록 설정해본다. Admin Directory API를 통해서 workspace의 user와 group의 정보를 가져올 수 있고, 해당 정보를 통해서 인증 조건을 추가할 수 있다. 예로 특정 workspace group에 속한 계정만 인증에 성공할 수 있도록 조건을 추가할 수 있다. Admin Directory API에 요청하기 위해서 필요한 권한을 설정할 수 있는데, Service Account의 key 파일을 생성하는 대신에, Application Default Credentials를 활용해보았다. Application Default Credentials를 사용하는 과정에서 삽질을 많이 했는데, 혹시나 동일한 작업을 하는 분들은 나처럼 시간을 허비하지 않기를 바라며 글을 작성한다.🥹","slug":"20240714-vault-oidc"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20240713-add-package-to-distroless-image"]},"buildId":"QKufPb8z7LtnZRz78-33M","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>