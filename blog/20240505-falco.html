<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Falco를 활용하여 Terminal Shell 명령어 로그 수집하기</title><meta name="robots" content="follow, index"/><meta name="description" content="Kubernetes Worker Node와 Pod Container에 Terminal shell로 접근하여 명령어를 입력하면 로그를 남기고, 경우에 따라서 알림을 보내고 싶었다. CNCF 졸업한 Project인 Falco를 활용하면 이를 구현할 수 있지 않을까 하여 테스트를 해보게 되었다. Falco는 kernel module이나 eBPF probe등을 통해서 kernel event를 저장하고, 설정된 rule에 따라서 해당 event를 filter하여 원하는 output 형태로 저장한다. Falco는 모든 로그를 저장하기보다는 Rule에 따라 선택적으로 보안 위협이 있는 이벤트를 수집하고 실시간으로 알림하는 것이 목적이다. 따라서 Falco를 통해서 원하던 기능을 구현하는 것은 합리적인 방법이 아닌 것으로 판단 된다."/><meta property="og:url" content="https://jayground8.github.io/blog/20240505-falco"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Kubernetes Worker Node와 Pod Container에 Terminal shell로 접근하여 명령어를 입력하면 로그를 남기고, 경우에 따라서 알림을 보내고 싶었다. CNCF 졸업한 Project인 Falco를 활용하면 이를 구현할 수 있지 않을까 하여 테스트를 해보게 되었다. Falco는 kernel module이나 eBPF probe등을 통해서 kernel event를 저장하고, 설정된 rule에 따라서 해당 event를 filter하여 원하는 output 형태로 저장한다. Falco는 모든 로그를 저장하기보다는 Rule에 따라 선택적으로 보안 위협이 있는 이벤트를 수집하고 실시간으로 알림하는 것이 목적이다. 따라서 Falco를 통해서 원하던 기능을 구현하는 것은 합리적인 방법이 아닌 것으로 판단 된다."/><meta property="og:title" content="Falco를 활용하여 Terminal Shell 명령어 로그 수집하기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Falco를 활용하여 Terminal Shell 명령어 로그 수집하기"/><meta name="twitter:description" content="Kubernetes Worker Node와 Pod Container에 Terminal shell로 접근하여 명령어를 입력하면 로그를 남기고, 경우에 따라서 알림을 보내고 싶었다. CNCF 졸업한 Project인 Falco를 활용하면 이를 구현할 수 있지 않을까 하여 테스트를 해보게 되었다. Falco는 kernel module이나 eBPF probe등을 통해서 kernel event를 저장하고, 설정된 rule에 따라서 해당 event를 filter하여 원하는 output 형태로 저장한다. Falco는 모든 로그를 저장하기보다는 Rule에 따라 선택적으로 보안 위협이 있는 이벤트를 수집하고 실시간으로 알림하는 것이 목적이다. 따라서 Falco를 통해서 원하던 기능을 구현하는 것은 합리적인 방법이 아닌 것으로 판단 된다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20240505-falco"/><meta property="article:published_time" content="2024-05-05T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20240505-falco"
  },
  "headline": "Falco를 활용하여 Terminal Shell 명령어 로그 수집하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2024-05-05T00:00:00.000Z",
  "dateModified": "2024-05-05T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Kubernetes Worker Node와 Pod Container에 Terminal shell로 접근하여 명령어를 입력하면 로그를 남기고, 경우에 따라서 알림을 보내고 싶었다. CNCF 졸업한 Project인 Falco를 활용하면 이를 구현할 수 있지 않을까 하여 테스트를 해보게 되었다. Falco는 kernel module이나 eBPF probe등을 통해서 kernel event를 저장하고, 설정된 rule에 따라서 해당 event를 filter하여 원하는 output 형태로 저장한다. Falco는 모든 로그를 저장하기보다는 Rule에 따라 선택적으로 보안 위협이 있는 이벤트를 수집하고 실시간으로 알림하는 것이 목적이다. 따라서 Falco를 통해서 원하던 기능을 구현하는 것은 합리적인 방법이 아닌 것으로 판단 된다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a2ca87b783241bde.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/YKuEPKHFWiQ2zWjBQxtAS/_buildManifest.js" defer=""></script><script src="/_next/static/YKuEPKHFWiQ2zWjBQxtAS/_ssgManifest.js" defer=""></script><script src="/_next/static/YKuEPKHFWiQ2zWjBQxtAS/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-05-05T00:00:00.000Z">2024년 5월 5일 일요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Falco를 활용하여 Terminal Shell 명령어 로그 수집하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>Kubernetes에서 Worker Node나 Pod에 Shell로 접근하면 기록을 남기고, 원하는 경우에는 알림을 받고 싶었다. 그래서 <a target="_blank" rel="noopener noreferrer" href="https://falco.org/">CNCF 졸업한 프로젝트인 Falco</a>를 통해서 원하는 시스템을 만들 수 있을지 확인해보았다. <a target="_blank" rel="noopener noreferrer" href="https://falco.org/docs/getting-started/">Falco Architecture가 문서</a>에 아래 그림과 함께 친절히 설명되어 있다.</p><blockquote><p>Falco operates in both kernel and user space. In kernel space, Linux system calls (syscalls) are collected by a driver, for example, the Falco kernel module or Falco eBPF probe. Next, syscalls are placed in a ring buffer from which they are moved into user space for processing. The events are filtered using a rules engine with a Falco rule set.</p></blockquote><img src="/static/images/falco-architecture-v2.png" alt="Falco architecture"/><p>Falco는 Rule을 통해서 선택적으로 이벤트를 저장하는 구조로 되어 있다. 정의된 Falco Rule로 filter된 이벤트를 Standard Output, File Output, Syslog Output, Program Output, HTTP/HTTPS Output, JSON Output등을 통해서 원하는 Output 형식을 정의할 수 있다. <a target="_blank" rel="noopener noreferrer" href="https://github.com/falcosecurity/falco/issues/1983#issuecomment-1126171645">Syslog Output의 경우에는 Falco를 Host에 직접 설치하였을 때, Syslog Service를 통해서 남기는 것으로 보인다.</a>. Kubernetes에서 Pod로 Falco를 실행할 때는 Standard Output을 사용하고, Fluentbit이나 Opentelemetry Filelog Receiver등으로 file을 tail해서 저장할 수 있다.</p><p>또한 <a target="_blank" rel="noopener noreferrer" href="https://falco.org/docs/outputs/forwarding/">Falcosidekick을 통해서 Forwarding</a>을 통해서 원하는 곳에 Falco Alert를 전달할 수 있다. 아래는 공식문서에 있는 그림으로 Falcosidekick을 통해서 편하게 다양한 시스템에 전달할 수 있다. Loki에 push하여 log를 저장할 수도 있고, Slack에 메세지를 보낼 수도 있다. 이 방법은 Falco HTTP/HTTPS Output을 통해서 Falcosidekick에게 Alert를 전송하는 것이다.</p><img src="/static/images/falcosidekick_forwarding.png" alt="falcosidekick forwarding"/><h2 id="helm으로-설치"><a href="#helm으로-설치" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Helm으로 설치</h2><p>Helm Chart를 이용하여 Falco를 설치한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">helm repo <span class="token function">add</span> falcosecurity https://falcosecurity.github.io/charts
</span><span class="code-line">helm repo update
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ helm search repo falcosecurity
</span><span class="code-line">NAME                            CHART VERSION   APP VERSION
</span><span class="code-line">falcosecurity/event-generator   <span class="token number">0.3</span>.3           <span class="token number">0.10</span>.0
</span><span class="code-line">falcosecurity/falco             <span class="token number">4.3</span>.0           <span class="token number">0.37</span>.1
</span><span class="code-line">falcosecurity/falco-exporter    <span class="token number">0.10</span>.0          <span class="token number">0.8</span>.3
</span><span class="code-line">falcosecurity/falcosidekick     <span class="token number">0.7</span>.17          <span class="token number">2.28</span>.0
</span><span class="code-line">falcosecurity/k8s-metacollector <span class="token number">0.1</span>.7           <span class="token number">0.1</span>.0
</span></code></pre></div><p>Kernel module대신에 performance적으로 유리한 ebpf를 사용해서 syscall을 probe하도록 한다. 그리고 falcosidekick을 같이 설치하기 위해서 enabled을 true로 설정해주고, loki와 slack에 Falco alert를 전달하도록 설정하였다. Falco에서는 EMERGENCY, ALERT, CRITICAL, ERROR, WARNING, NOTICE, INFORMATIONAL, DEBUG 순으로 우선순위 정보를 정의할 수 있다. <code>minimumpriority</code>를 통해서 어느 우선순위까지 보낼것인지 정의를 할 수 있는데, 아래에서는 <code>alert</code>로 설정했기 때문에 EMERGENCY와 ALERT에 대해서 메세지를 전달받게 된다. falcosidekick의 slack 설정은 <a target="_blank" rel="noopener noreferrer" href="https://github.com/falcosecurity/falcosidekick/blob/master/docs/outputs/slack.md">이 문서</a>에서 확인 가능하다.</p><p><code>values.yaml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">driver</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">kind</span><span class="token punctuation">:</span> ebpf
</span><span class="code-line"><span class="token atrule key">falcosidekick</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">  <span class="token atrule key">config</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">loki</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">hostport</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki<span class="token punctuation">:</span><span class="token number">3100</span>
</span><span class="code-line">      <span class="token atrule key">tenant</span><span class="token punctuation">:</span> falco
</span><span class="code-line">    <span class="token atrule key">slack</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">webhookurl</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//hooks.slack.com/services/<span class="token punctuation">{</span>something<span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token atrule key">minimumpriority</span><span class="token punctuation">:</span> alert
</span><span class="code-line">			<span class="token atrule key">outputformat</span><span class="token punctuation">:</span> fields
</span></code></pre></div><p>Helm Chart의 value는 기본값으로 아래와 같이 stdout_output이 enable되어 있다. 따라서 Daemonset으로 설치되는 Falco의 container log를 보면 Falco rule에 따른 event들이 남아 있는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">stdout_output</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span></code></pre></div><p>정의한 <code>values.yaml</code>을 통해서 Helm Chart를 배포한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">helm <span class="token function">install</span> falco falcosecurity/falco <span class="token punctuation">\</span>
</span><span class="code-line">--create-namespace <span class="token punctuation">\</span>
</span><span class="code-line">--namespace falco <span class="token punctuation">\</span>
</span><span class="code-line">--values values.yaml
</span></code></pre></div><p>설치과 완료되면 아래와 같이 falco의 설정값들이 ConfigMap에 정의된다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ kubectl get cm -n falco
</span><span class="code-line">NAME               DATA   AGE
</span><span class="code-line">falco              <span class="token number">1</span>      1d
</span><span class="code-line">falco-falcoctl     <span class="token number">1</span>      1d
</span><span class="code-line">falco-rules        <span class="token number">1</span>      1d
</span></code></pre></div><p><code>kubectl get cm falco -o yaml</code>으로 확인해보면 아래와 같이 json 형식의 output이 설정되게 된다. 그리고 falco-facosidekick ClusterIP 서비스로 요청하도록 http_output이 설정되고, stdout_output도 동일하게 true로 설정된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">json_output</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line"><span class="token atrule key">http_output</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token atrule key">ca_bundle</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line">	<span class="token atrule key">ca_cert</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line">	<span class="token atrule key">ca_path</span><span class="token punctuation">:</span> /etc/falco/certs/
</span><span class="code-line">	<span class="token atrule key">client_cert</span><span class="token punctuation">:</span> /etc/falco/certs/client/client.crt
</span><span class="code-line">	<span class="token atrule key">client_key</span><span class="token punctuation">:</span> /etc/falco/certs/client/client.key
</span><span class="code-line">	<span class="token atrule key">compress_uploads</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">	<span class="token atrule key">echo</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">	<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">	<span class="token atrule key">insecure</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">	<span class="token atrule key">keep_alive</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">	<span class="token atrule key">mtls</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">	<span class="token atrule key">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//falco<span class="token punctuation">-</span>falcosidekick<span class="token punctuation">:</span><span class="token number">2801</span>
</span><span class="code-line">	<span class="token atrule key">user_agent</span><span class="token punctuation">:</span> falcosecurity/falco
</span><span class="code-line"><span class="token atrule key">stdout_output</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span></code></pre></div><h2 id="falco-rule"><a href="#falco-rule" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Falco Rule</h2><p>Falco rules을 기본적으로 <code>stable</code> 상태에 있는 rule들 자동으로 설정이 된다. <a target="_blank" rel="noopener noreferrer" href="https://falco.org/docs/reference/rules/default-rules/">Community에서 관리되는 rule들은 여기</a>에서 확인할 수 있다. <code>incubating</code>, <code>sandbox</code> 상태의 rule도 추가하고 싶으면 Helm Chart Value에 정의하여 추가할 수 있다.</p><p>stable 상태의 rule들은 <a target="_blank" rel="noopener noreferrer" href="https://github.com/falcosecurity/rules/blob/main/rules/falco_rules.yaml">Github Repo의 falco_rules.yaml</a>에서도 확인할 수 있다. 예를 들어서 <code>falco_rules.yaml</code>에서 아래와 같은 Rule이 정의되어 있다. <code>macro</code>는 다시 재사용할 수 있도록 특정한 조건들을 정의해 놓는 것이고, <code>list</code>를 통해서 여러 개의 값을 묶어서 정의할 수 있다. <code>Terminal shell in container</code>에서 <code>macro</code>와 <code>list</code>를 사용해서 정의하고 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">macro</span><span class="token punctuation">:</span> spawned_process
</span><span class="code-line">  <span class="token atrule key">condition</span><span class="token punctuation">:</span> (evt.type in (execve<span class="token punctuation">,</span> execveat) and evt.dir=&lt;)
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">macro</span><span class="token punctuation">:</span> container
</span><span class="code-line">  <span class="token atrule key">condition</span><span class="token punctuation">:</span> (container.id <span class="token tag">!=</span> host)
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">macro</span><span class="token punctuation">:</span> container_entrypoint
</span><span class="code-line">  <span class="token atrule key">condition</span><span class="token punctuation">:</span> (not proc.pname exists or proc.pname in (runc<span class="token punctuation">:</span><span class="token punctuation">[</span>0<span class="token punctuation">:</span>PARENT<span class="token punctuation">]</span><span class="token punctuation">,</span> runc<span class="token punctuation">:</span><span class="token punctuation">[</span>1<span class="token punctuation">:</span>CHILD<span class="token punctuation">]</span><span class="token punctuation">,</span> runc<span class="token punctuation">,</span> docker<span class="token punctuation">-</span>runc<span class="token punctuation">,</span> exe<span class="token punctuation">,</span> docker<span class="token punctuation">-</span>runc<span class="token punctuation">-</span>cur<span class="token punctuation">,</span> containerd<span class="token punctuation">-</span>shim<span class="token punctuation">,</span> systemd<span class="token punctuation">,</span> crio))
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">macro</span><span class="token punctuation">:</span> user_expected_terminal_shell_in_container_conditions
</span><span class="code-line">  <span class="token atrule key">condition</span><span class="token punctuation">:</span> (never_true)
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">list</span><span class="token punctuation">:</span> shell_binaries
</span><span class="code-line">  <span class="token atrule key">items</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ash<span class="token punctuation">,</span> bash<span class="token punctuation">,</span> csh<span class="token punctuation">,</span> ksh<span class="token punctuation">,</span> sh<span class="token punctuation">,</span> tcsh<span class="token punctuation">,</span> zsh<span class="token punctuation">,</span> dash<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">macro</span><span class="token punctuation">:</span> shell_procs
</span><span class="code-line">  <span class="token atrule key">condition</span><span class="token punctuation">:</span> (proc.name in (shell_binaries))
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">rule</span><span class="token punctuation">:</span> Terminal shell in container
</span><span class="code-line">  <span class="token atrule key">desc</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">    A shell was used as the entrypoint/exec point into a container with an attached terminal. Parent process may have 
</span></span><span class="code-line"><span class="token string scalar">    legitimately already exited and be null (read container_entrypoint macro). Common when using &quot;kubectl exec&quot; in Kubernetes. 
</span></span><span class="code-line"><span class="token string scalar">    Correlate with k8saudit exec logs if possible to find user or serviceaccount token used (fuzzy correlation by namespace and pod name). 
</span></span><span class="code-line"><span class="token string scalar">    Rather than considering it a standalone rule, it may be best used as generic auditing rule while examining other triggered 
</span></span><span class="code-line"><span class="token string scalar">    rules in this container/tty.</span>
</span><span class="code-line">  <span class="token atrule key">condition</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">    spawned_process 
</span></span><span class="code-line"><span class="token string scalar">    and container
</span></span><span class="code-line"><span class="token string scalar">    and shell_procs 
</span></span><span class="code-line"><span class="token string scalar">    and proc.tty != 0
</span></span><span class="code-line"><span class="token string scalar">    and container_entrypoint
</span></span><span class="code-line"><span class="token string scalar">    and not user_expected_terminal_shell_in_container_conditions</span>
</span><span class="code-line">  <span class="token atrule key">output</span><span class="token punctuation">:</span> A shell was spawned in a container with an attached terminal (evt_type=%evt.type user=%user.name user_uid=%user.uid user_loginuid=%user.loginuid process=%proc.name proc_exepath=%proc.exepath parent=%proc.pname command=%proc.cmdline terminal=%proc.tty exe_flags=%evt.arg.flags %container.info)
</span><span class="code-line">  <span class="token atrule key">priority</span><span class="token punctuation">:</span> NOTICE
</span><span class="code-line">  <span class="token atrule key">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>maturity_stable<span class="token punctuation">,</span> container<span class="token punctuation">,</span> shell<span class="token punctuation">,</span> mitre_execution<span class="token punctuation">,</span> T1059<span class="token punctuation">]</span>
</span></code></pre></div><p>이제 Pod에 접근하면</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it nginx-pod -- /bin/sh
</span></code></pre></div><p>아래와 같은 log가 남게 된다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10:31:35.913486795: Notice A shell was spawned in a container with an attached terminal (evt_type=execve user=root user_uid=0 user_loginuid=-1 process=sh proc_exepath=/usr/bin/dash parent=containerd-shim command=sh terminal=34816 exe_flags=EXE_WRITABLE container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name)&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;priority&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Notice&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Terminal shell in container&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;syscall&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;T1059&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;container&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;maturity_stable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mitre_execution&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shell&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-05-03T10:31:35.913486795Z&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;container.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6fec6323ae4c&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker.io/library/nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.arg.flags&quot;</span><span class="token operator">:</span> <span class="token string">&quot;EXE_WRITABLE&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.time&quot;</span><span class="token operator">:</span> <span class="token number">1714732295913486795</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;execve&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.ns.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.pod.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.cmdline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.exepath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/usr/bin/dash&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.pname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;containerd-shim&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.tty&quot;</span><span class="token operator">:</span> <span class="token number">34816</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.loginuid&quot;</span><span class="token operator">:</span> <span class="token number">-1</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.uid&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>테스트를 한 환경의 Container Runtime이 containerd이기 때문에, parent process명은 <code>containerd-shim</code>으로 표시가 된다. <code>evt.type</code>는 syscall event을 가지는데, <a target="_blank" rel="noopener noreferrer" href="https://falco.org/docs/reference/rules/supported-events/">공식문서에서 지원하는 events 종류</a>를 확인할 수 있다. <a target="_blank" rel="noopener noreferrer" href="https://man7.org/linux/man-pages/man2/execve.2.html">execve는 프로그램을 실행할 때의 syscall</a>인데, <code>/usr/bin/dash</code> binary file이 실행되었기 때문에 evt.type은 <code>execve</code>가 되고 proc.exepath가 <code>usr/bin/dash</code>가 된다. 그리고 아래처럼 문서에 syscall이 불렸을 때 <code>&gt;</code>, 끝났을 때 <code>&lt;</code>로 표시하게 된다. <code>&gt;</code>는 filepath로 실행하고, <code>&lt;</code>는 systemcall이 끝나고 기타 정보들을 반환한다.</p><img src="/static/images/falco-execve.png" alt="falco execve event"/><h2 id="custom-rule"><a href="#custom-rule" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Custom Rule</h2><p>기본으로 설정되어 있는 Rule을 살펴보았고, <code>marcro</code>, <code>list</code>, <code>rule</code> Syntax로 원하는 custom rule을 설정할 수 있다. accept, listen은 <code>&lt;</code> 에서 fd params을 가지고, recvfrom, recvmsg는 <code>&gt;</code>에서 fd params를 가지고 있다. 이제 params <code>fd</code>를 통해서 <code>fd.sport</code> Server Port가 22인지 확인한다. 이 조건을 만족하면 output으로 <code>fd.cip</code> client IP address와 <code>fd.cport</code> client Port 값을 남기도록 하였다.</p><p><code>custom-rules.yaml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">customRules</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">rules-ssh.yaml</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">list</span><span class="token punctuation">:</span> ssh_standard_ports
</span><span class="code-line">      <span class="token atrule key">items</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">macro</span><span class="token punctuation">:</span> ssh_standard_ports_network
</span><span class="code-line">      <span class="token atrule key">condition</span><span class="token punctuation">:</span> (fd.sport in (ssh_standard_ports))
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">rule</span><span class="token punctuation">:</span> Inbound SSH Connection
</span><span class="code-line">      <span class="token atrule key">desc</span><span class="token punctuation">:</span> Detect Inbound SSH Connection
</span><span class="code-line">      <span class="token atrule key">condition</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">        ((evt.type in (accept,listen) and evt.dir=&lt;) or
</span></span><span class="code-line"><span class="token string scalar">          (evt.type in (recvfrom,recvmsg))) and ssh_standard_ports_network</span>
</span><span class="code-line">      <span class="token atrule key">output</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">        Inbound SSH connection (user=%user.name client_ip=%fd.cip client_port=%fd.cport server_ip=%fd.sip)</span>
</span><span class="code-line">      <span class="token atrule key">priority</span><span class="token punctuation">:</span> ALERT
</span><span class="code-line">      <span class="token atrule key">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>network<span class="token punctuation">]</span>
</span></code></pre></div><p>정의한 costom rule을 아래와 같이 적용한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">helm upgrade falco falcosecurity/falco <span class="token punctuation">\</span>
</span><span class="code-line">-f ./custom-rules.yaml <span class="token punctuation">\</span>
</span><span class="code-line">--namespace falco <span class="token punctuation">\</span>
</span><span class="code-line">--values values.yaml
</span></code></pre></div><p>custom rule에 의해서 아래와 같이 log가 남는다. 그리고 <code>container.id</code>가 <code>host</code>이기 때문에 Kubernetes 관련된 정보는 <code>&lt;NA&gt;</code>로 표시된다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;11:37:53.059395044: Alert Inbound SSH connection (user=root client_ip=x.x.x.x client_port=56483 server_ip=x.x.x.x) container_id=host container_image=&lt;NA&gt; container_image_tag=&lt;NA&gt; container_name=host k8s_ns=&lt;NA&gt; k8s_pod_name=&lt;NA&gt;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;priority&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Alert&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Inbound SSH Connection&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;syscall&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;network&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-05-03T11:37:53.059395044Z&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;container.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;host&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.repository&quot;</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.tag&quot;</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;host&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.time&quot;</span><span class="token operator">:</span> <span class="token number">1714736273059395044</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;fd.cip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x.x.x.x&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;fd.cport&quot;</span><span class="token operator">:</span> <span class="token number">56483</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;fd.sip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x.x.x.x&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.ns.name&quot;</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.pod.name&quot;</span><span class="token operator">:</span> <span class="token keyword null">null</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>그리고 위에서 <code>falcosidekick</code>에서 slack도 설정을 했기 때문에 아래처럼 슬랙 메세지가 오게 된다.</p><img src="/static/images/falco-slack.png" alt="falco slack message"/><h2 id="원하는-결과"><a href="#원하는-결과" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>원하는 결과</h2><p>최종적으로 Falco로 구현하고 싶은 것은 Worker Node나 Pod의 Container에 Terminal shell로 연결했을 때, 모든 명령어들을 저장하고 알림을 필요시에 받고 싶다.</p><p>Falco는 Rule을 통해서 특정 조건에 해당되는 Event를 저장하는 구조로 되어있다. 따라서 이렇게 모든 명령어들을 저장하고 싶다면, 그렇게 할 수 있도록 Custom Rule을 정의해야 한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">rule</span><span class="token punctuation">:</span> shell_in_container
</span><span class="code-line">	<span class="token atrule key">desc</span><span class="token punctuation">:</span> notice shell activity within a container
</span><span class="code-line">	<span class="token atrule key">condition</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		evt.type = execve and
</span></span><span class="code-line"><span class="token string scalar">		evt.dir = &lt; and
</span></span><span class="code-line"><span class="token string scalar">		container.id != host and
</span></span><span class="code-line"><span class="token string scalar">		proc.pname = sh</span>
</span><span class="code-line">	<span class="token atrule key">output</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		shell in a container
</span></span><span class="code-line"><span class="token string scalar">		(user=%user.name container_id=%container.id container_name=%container.name
</span></span><span class="code-line"><span class="token string scalar">		shell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)</span>
</span><span class="code-line">	<span class="token atrule key">priority</span><span class="token punctuation">:</span> WARNING
</span></code></pre></div><p><code>ls</code>의 경우에는 <code>execve</code>가 사용되고 아래처럼 log가 남게 된다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ kubectl <span class="token builtin class-name">exec</span> -it nginx-pod -- /bin/sh
</span><span class="code-line"><span class="token comment"># ls</span>
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12:03:52.176355678: Warning shell in a container (user=root container_id=6fec6323ae4c container_name=nginx  shell=ls parent=sh cmdline=ls /bin) container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;priority&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shell_in_container&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;syscall&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-05-03T12:03:52.176355678Z&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;container.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6fec6323ae4c&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker.io/library/nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.time&quot;</span><span class="token operator">:</span> <span class="token number">1714737832176355678</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.ns.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.pod.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.cmdline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ls /bin&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.pname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Pod container말고 host를 하고 싶다면 Condition에서 <code>container.id = host</code>로 설정할 수 있다. 동일한 방식으로 rule을 추가하면 다양한 명령어들이 Shell을 통해서 실행되고 있는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">rule</span><span class="token punctuation">:</span> shell_in host
</span><span class="code-line">	<span class="token atrule key">desc</span><span class="token punctuation">:</span> notice shell activity within a host
</span><span class="code-line">	<span class="token atrule key">condition</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		evt.type = execve and
</span></span><span class="code-line"><span class="token string scalar">		evt.dir = &lt; and
</span></span><span class="code-line"><span class="token string scalar">		container.id = host and
</span></span><span class="code-line"><span class="token string scalar">		proc.pname = sh</span>
</span><span class="code-line">	<span class="token atrule key">output</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		shell in a host
</span></span><span class="code-line"><span class="token string scalar">		(user=%user.name shell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)</span>
</span><span class="code-line">	<span class="token atrule key">priority</span><span class="token punctuation">:</span> WARNING
</span></code></pre></div><p>그런데 <a target="_blank" rel="noopener noreferrer" href="https://man7.org/linux/man-pages/man2/mkdir.2.html"><code>mkdir</code></a>의 경우에는 <code>evt.type = mkdir</code>로 추가해줘야한다. 따라서 condition에서 <code>in</code>으로 <code>mkdir</code>도 추가한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">rule</span><span class="token punctuation">:</span> shell_in_container
</span><span class="code-line">	<span class="token atrule key">desc</span><span class="token punctuation">:</span> notice shell activity within a container
</span><span class="code-line">	<span class="token atrule key">condition</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		evt.type in (execve, mkdir) and
</span></span><span class="code-line"><span class="token string scalar">		evt.dir = &lt; and
</span></span><span class="code-line"><span class="token string scalar">		container.id != host and
</span></span><span class="code-line"><span class="token string scalar">		proc.pname = sh</span>
</span><span class="code-line">	<span class="token atrule key">output</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		shell in a container
</span></span><span class="code-line"><span class="token string scalar">		(user=%user.name container_id=%container.id container_name=%container.name
</span></span><span class="code-line"><span class="token string scalar">		shell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)</span>
</span><span class="code-line">	<span class="token atrule key">priority</span><span class="token punctuation">:</span> WARNING
</span></code></pre></div><p>그러면 이제 <code>mkdir</code>도 아래처럼 로그가 남는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ kubectl <span class="token builtin class-name">exec</span> -it nginx-pod -- /bin/sh
</span><span class="code-line"><span class="token comment"># mkdir /hellofalco</span>
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;20:29:06.389110693: Warning shell in a container (user=root container_id=6fec6323ae4c container_name=nginx  shell=mkdir parent=sh cmdline=mkdir /hellofalco) container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;priority&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shell_in_container&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;syscall&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-05-03T20:29:06.389110693Z&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;container.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6fec6323ae4c&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker.io/library/nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.time&quot;</span><span class="token operator">:</span> <span class="token number">1714768146389110693</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.ns.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.pod.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.cmdline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mkdir /hellofalco&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mkdir&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.pname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>하지만 <code>echo &quot;hello world&quot; &gt; example.txt</code> 명령어를 했을 때는 위의 Rule에 포함되지 않는다. 따라서 아래처럼 추가해본다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">rule</span><span class="token punctuation">:</span> shell_in_container
</span><span class="code-line">	<span class="token atrule key">desc</span><span class="token punctuation">:</span> notice shell activity within a container
</span><span class="code-line">	<span class="token atrule key">condition</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		evt.type in (open, openat, openat2) and
</span></span><span class="code-line"><span class="token string scalar">		evt.dir = &lt; and
</span></span><span class="code-line"><span class="token string scalar">		fd.filename in (example.txt) and
</span></span><span class="code-line"><span class="token string scalar">		container.id != host</span>
</span><span class="code-line">	<span class="token atrule key">output</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		shell in a container
</span></span><span class="code-line"><span class="token string scalar">		(file=%fd.name evt_type=%evt.type user=%user.name container_id=%container.id container_name=%container.name
</span></span><span class="code-line"><span class="token string scalar">		shell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)</span>
</span><span class="code-line">	<span class="token atrule key">priority</span><span class="token punctuation">:</span> WARNING
</span></code></pre></div><p>이제 <code>example.txt</code>를 아래와 같이 <code>echo</code>로 생성해본다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ kubectl <span class="token builtin class-name">exec</span> -it nginx-pod -- /bin/sh
</span><span class="code-line"><span class="token comment"># echo &quot;hello world&quot; &gt; example.txt</span>
</span></code></pre></div><p>그러면 <code>fd.name</code>을 통해서 수정된 파일명을 알 수 있다. 하지만 <code>echo &quot;hello world&quot; &gt; example.txt</code> 전체 명령어를 남길 방법이 보이지 않는다. 🤔 그리고 <code>open</code>의 경우에는 너무나 많은 프로세스에서 call하고 있기 때문에 좀더 구체적인 조건을 작성하지 않으면 불필요하게 너무 많은 이벤트 로그가 남게 된다. Falco stable Rule 중에 <code>/var/log/auth.log</code>나 <code>/var/log/syslog</code>처럼 시스템 로그들을 수정하면 알림이 오도록 설정되어 있다. 이처럼 구체적인 조건을 통해서 특정 행위에 대한 이벤트를 발생시킨다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output&quot;</span><span class="token operator">:</span> <span class="token string">&quot;21:41:34.978625505: Warning shell in a container (file=/example.txt evt_type=openat user=root container_id=6fec6323ae4c container_name=nginx  shell=sh parent=containerd-shim cmdline=sh) container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;priority&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;rule&quot;</span><span class="token operator">:</span> <span class="token string">&quot;shell_in_container&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;syscall&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-05-03T21:41:34.978625505Z&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;output_fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;container.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6fec6323ae4c&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.repository&quot;</span><span class="token operator">:</span> <span class="token string">&quot;docker.io/library/nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.image.tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;container.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.time&quot;</span><span class="token operator">:</span> <span class="token number">1714772494978625505</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;evt.type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;openat&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;fd.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/example.txt&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.ns.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;k8s.pod.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pod-name&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.cmdline&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;proc.pname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;containerd-shim&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;user.name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>Kubernetes Worker Node와 Pod Container에 직접 Terminal shell을 통해서 어떠한 명령어들을 실행했을 때, 그것들을 모두 저장하고 특정한 조건에 따라 실시간 알림을 보내고 싶었다. Falco는 Rule 정의를 통해서 선택적으로 Kernel event를 보안 위협이 되는 이벤트를 저장하고 실시간성으로 알림을 보낼 수 있다. 따라서 Falco Rule을 정의하여 sh, bash등이 Parent Process로 있으면서 <code>ls</code>, <code>cat</code>등을 execve syscall로 실행할 때 event를 수집하도록 하였다. 하지만 <code>mkdir</code> 명령어에 대해서 <code>mkdir</code>이나 <code>mkdirat</code> 조건을 추가 해줘야 한다. <code>echo &quot;hello world&quot; &gt; example.txt</code>의 경우에는 example.txt를 수정/삭제할 때 이벤트를 남길 수 있지만, 전체 shell에서 실행한 전체 명령어를 남기는 방법이 보이지 않았다. 그리고 너무 많은 곳에서 파일을 읽고 쓰기 때문에 필터 조건을 구체적으로 설정하지 않으면 원하지 않은 이벤트들이 너무 많이 남게 된다. 따라서 내가 원하던 구현을 위해서 Falco는 적합하지 않다는 결론을 내리게 되었다.</p><p>그러면 원하는 구현에 더 적합한 다른 오픈소스 소프트웨어가 있을까? 🧐</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/falco">falco</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/devsecops">devsecops</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240501-opentelemetry-syslog">OpenTelmetry로 auth.log와 syslog 수집하기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240518-book-review-manager">책 &quot;팀장의 탄생&quot;을 읽고...</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of d(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=p(s,n))||c.enumerable});return a},g=a=\u003ek(t(l(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((v,i)=\u003e{i.exports=_jsx_runtime});var b={};u(b,{default:()=\u003e_,frontmatter:()=\u003ey});var e=g(r()),y={title:\"Falco\\uB97C \\uD65C\\uC6A9\\uD558\\uC5EC Terminal Shell \\uBA85\\uB839\\uC5B4 \\uB85C\\uADF8 \\uC218\\uC9D1\\uD558\\uAE30\",date:\"2024-05-05\",tags:[\"kubernetes\",\"falco\",\"devsecops\"],images:[\"/static/images/social-banner.png\"],summary:\"Kubernetes Worker Node\\uC640 Pod Container\\uC5D0 Terminal shell\\uB85C \\uC811\\uADFC\\uD558\\uC5EC \\uBA85\\uB839\\uC5B4\\uB97C \\uC785\\uB825\\uD558\\uBA74 \\uB85C\\uADF8\\uB97C \\uB0A8\\uAE30\\uACE0, \\uACBD\\uC6B0\\uC5D0 \\uB530\\uB77C\\uC11C \\uC54C\\uB9BC\\uC744 \\uBCF4\\uB0B4\\uACE0 \\uC2F6\\uC5C8\\uB2E4. CNCF \\uC878\\uC5C5\\uD55C Project\\uC778 Falco\\uB97C \\uD65C\\uC6A9\\uD558\\uBA74 \\uC774\\uB97C \\uAD6C\\uD604\\uD560 \\uC218 \\uC788\\uC9C0 \\uC54A\\uC744\\uAE4C \\uD558\\uC5EC \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD574\\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4. Falco\\uB294 kernel module\\uC774\\uB098 eBPF probe\\uB4F1\\uC744 \\uD1B5\\uD574\\uC11C kernel event\\uB97C \\uC800\\uC7A5\\uD558\\uACE0, \\uC124\\uC815\\uB41C rule\\uC5D0 \\uB530\\uB77C\\uC11C \\uD574\\uB2F9 event\\uB97C filter\\uD558\\uC5EC \\uC6D0\\uD558\\uB294 output \\uD615\\uD0DC\\uB85C \\uC800\\uC7A5\\uD55C\\uB2E4. Falco\\uB294 \\uBAA8\\uB4E0 \\uB85C\\uADF8\\uB97C \\uC800\\uC7A5\\uD558\\uAE30\\uBCF4\\uB2E4\\uB294 Rule\\uC5D0 \\uB530\\uB77C \\uC120\\uD0DD\\uC801\\uC73C\\uB85C \\uBCF4\\uC548 \\uC704\\uD611\\uC774 \\uC788\\uB294 \\uC774\\uBCA4\\uD2B8\\uB97C \\uC218\\uC9D1\\uD558\\uACE0 \\uC2E4\\uC2DC\\uAC04\\uC73C\\uB85C \\uC54C\\uB9BC\\uD558\\uB294 \\uAC83\\uC774 \\uBAA9\\uC801\\uC774\\uB2E4. \\uB530\\uB77C\\uC11C Falco\\uB97C \\uD1B5\\uD574\\uC11C \\uC6D0\\uD558\\uB358 \\uAE30\\uB2A5\\uC744 \\uAD6C\\uD604\\uD558\\uB294 \\uAC83\\uC740 \\uD569\\uB9AC\\uC801\\uC778 \\uBC29\\uBC95\\uC774 \\uC544\\uB2CC \\uAC83\\uC73C\\uB85C \\uD310\\uB2E8 \\uB41C\\uB2E4.\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",blockquote:\"blockquote\",h2:\"h2\",span:\"span\",pre:\"pre\",code:\"code\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"Kubernetes\\uC5D0\\uC11C Worker Node\\uB098 Pod\\uC5D0 Shell\\uB85C \\uC811\\uADFC\\uD558\\uBA74 \\uAE30\\uB85D\\uC744 \\uB0A8\\uAE30\\uACE0, \\uC6D0\\uD558\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uC54C\\uB9BC\\uC744 \\uBC1B\\uACE0 \\uC2F6\\uC5C8\\uB2E4. \\uADF8\\uB798\\uC11C \",(0,e.jsx)(n.a,{href:\"https://falco.org/\",children:\"CNCF \\uC878\\uC5C5\\uD55C \\uD504\\uB85C\\uC81D\\uD2B8\\uC778 Falco\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \\uC6D0\\uD558\\uB294 \\uC2DC\\uC2A4\\uD15C\\uC744 \\uB9CC\\uB4E4 \\uC218 \\uC788\\uC744\\uC9C0 \\uD655\\uC778\\uD574\\uBCF4\\uC558\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://falco.org/docs/getting-started/\",children:\"Falco Architecture\\uAC00 \\uBB38\\uC11C\"}),\"\\uC5D0 \\uC544\\uB798 \\uADF8\\uB9BC\\uACFC \\uD568\\uAED8 \\uCE5C\\uC808\\uD788 \\uC124\\uBA85\\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Falco operates in both kernel and user space. In kernel space, Linux system calls (syscalls) are collected by a driver, for example, the Falco kernel module or Falco eBPF probe. Next, syscalls are placed in a ring buffer from which they are moved into user space for processing. The events are filtered using a rules engine with a Falco rule set.\"})}),(0,e.jsx)(\"img\",{src:\"/static/images/falco-architecture-v2.png\",alt:\"Falco architecture\"}),(0,e.jsxs)(n.p,{children:[\"Falco\\uB294 Rule\\uC744 \\uD1B5\\uD574\\uC11C \\uC120\\uD0DD\\uC801\\uC73C\\uB85C \\uC774\\uBCA4\\uD2B8\\uB97C \\uC800\\uC7A5\\uD558\\uB294 \\uAD6C\\uC870\\uB85C \\uB418\\uC5B4 \\uC788\\uB2E4. \\uC815\\uC758\\uB41C Falco Rule\\uB85C filter\\uB41C \\uC774\\uBCA4\\uD2B8\\uB97C Standard Output, File Output, Syslog Output, Program Output, HTTP/HTTPS Output, JSON Output\\uB4F1\\uC744 \\uD1B5\\uD574\\uC11C \\uC6D0\\uD558\\uB294 Output \\uD615\\uC2DD\\uC744 \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://github.com/falcosecurity/falco/issues/1983#issuecomment-1126171645\",children:\"Syslog Output\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 Falco\\uB97C Host\\uC5D0 \\uC9C1\\uC811 \\uC124\\uCE58\\uD558\\uC600\\uC744 \\uB54C, Syslog Service\\uB97C \\uD1B5\\uD574\\uC11C \\uB0A8\\uAE30\\uB294 \\uAC83\\uC73C\\uB85C \\uBCF4\\uC778\\uB2E4.\"}),\". Kubernetes\\uC5D0\\uC11C Pod\\uB85C Falco\\uB97C \\uC2E4\\uD589\\uD560 \\uB54C\\uB294 Standard Output\\uC744 \\uC0AC\\uC6A9\\uD558\\uACE0, Fluentbit\\uC774\\uB098 Opentelemetry Filelog Receiver\\uB4F1\\uC73C\\uB85C file\\uC744 tail\\uD574\\uC11C \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uB610\\uD55C \",(0,e.jsx)(n.a,{href:\"https://falco.org/docs/outputs/forwarding/\",children:\"Falcosidekick\\uC744 \\uD1B5\\uD574\\uC11C Forwarding\"}),\"\\uC744 \\uD1B5\\uD574\\uC11C \\uC6D0\\uD558\\uB294 \\uACF3\\uC5D0 Falco Alert\\uB97C \\uC804\\uB2EC\\uD560 \\uC218 \\uC788\\uB2E4. \\uC544\\uB798\\uB294 \\uACF5\\uC2DD\\uBB38\\uC11C\\uC5D0 \\uC788\\uB294 \\uADF8\\uB9BC\\uC73C\\uB85C Falcosidekick\\uC744 \\uD1B5\\uD574\\uC11C \\uD3B8\\uD558\\uAC8C \\uB2E4\\uC591\\uD55C \\uC2DC\\uC2A4\\uD15C\\uC5D0 \\uC804\\uB2EC\\uD560 \\uC218 \\uC788\\uB2E4. Loki\\uC5D0 push\\uD558\\uC5EC log\\uB97C \\uC800\\uC7A5\\uD560 \\uC218\\uB3C4 \\uC788\\uACE0, Slack\\uC5D0 \\uBA54\\uC138\\uC9C0\\uB97C \\uBCF4\\uB0BC \\uC218\\uB3C4 \\uC788\\uB2E4. \\uC774 \\uBC29\\uBC95\\uC740 Falco HTTP/HTTPS Output\\uC744 \\uD1B5\\uD574\\uC11C Falcosidekick\\uC5D0\\uAC8C Alert\\uB97C \\uC804\\uC1A1\\uD558\\uB294 \\uAC83\\uC774\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/falcosidekick_forwarding.png\",alt:\"falcosidekick forwarding\"}),(0,e.jsxs)(n.h2,{id:\"helm\\uC73C\\uB85C-\\uC124\\uCE58\",children:[(0,e.jsx)(n.a,{href:\"#helm\\uC73C\\uB85C-\\uC124\\uCE58\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Helm\\uC73C\\uB85C \\uC124\\uCE58\"]}),(0,e.jsx)(n.p,{children:\"Helm Chart\\uB97C \\uC774\\uC6A9\\uD558\\uC5EC Falco\\uB97C \\uC124\\uCE58\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"helm repo \",(0,e.jsx)(n.span,{className:\"token function\",children:\"add\"}),` falcosecurity https://falcosecurity.github.io/charts\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`helm repo update\n`})]})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ helm search repo falcosecurity\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME                            CHART VERSION   APP VERSION\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falcosecurity/event-generator   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.3\"}),\".3           \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.10\"}),`.0\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falcosecurity/falco             \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4.3\"}),\".0           \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.37\"}),`.1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falcosecurity/falco-exporter    \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.10\"}),\".0          \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.8\"}),`.3\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falcosecurity/falcosidekick     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.7\"}),\".17          \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2.28\"}),`.0\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falcosecurity/k8s-metacollector \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.1\"}),\".7           \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.1\"}),`.0\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Kernel module\\uB300\\uC2E0\\uC5D0 performance\\uC801\\uC73C\\uB85C \\uC720\\uB9AC\\uD55C ebpf\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C syscall\\uC744 probe\\uD558\\uB3C4\\uB85D \\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 falcosidekick\\uC744 \\uAC19\\uC774 \\uC124\\uCE58\\uD558\\uAE30 \\uC704\\uD574\\uC11C enabled\\uC744 true\\uB85C \\uC124\\uC815\\uD574\\uC8FC\\uACE0, loki\\uC640 slack\\uC5D0 Falco alert\\uB97C \\uC804\\uB2EC\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD558\\uC600\\uB2E4. Falco\\uC5D0\\uC11C\\uB294 EMERGENCY, ALERT, CRITICAL, ERROR, WARNING, NOTICE, INFORMATIONAL, DEBUG \\uC21C\\uC73C\\uB85C \\uC6B0\\uC120\\uC21C\\uC704 \\uC815\\uBCF4\\uB97C \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"minimumpriority\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \\uC5B4\\uB290 \\uC6B0\\uC120\\uC21C\\uC704\\uAE4C\\uC9C0 \\uBCF4\\uB0BC\\uAC83\\uC778\\uC9C0 \\uC815\\uC758\\uB97C \\uD560 \\uC218 \\uC788\\uB294\\uB370, \\uC544\\uB798\\uC5D0\\uC11C\\uB294 \",(0,e.jsx)(n.code,{children:\"alert\"}),\"\\uB85C \\uC124\\uC815\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 EMERGENCY\\uC640 ALERT\\uC5D0 \\uB300\\uD574\\uC11C \\uBA54\\uC138\\uC9C0\\uB97C \\uC804\\uB2EC\\uBC1B\\uAC8C \\uB41C\\uB2E4. falcosidekick\\uC758 slack \\uC124\\uC815\\uC740 \",(0,e.jsx)(n.a,{href:\"https://github.com/falcosecurity/falcosidekick/blob/master/docs/outputs/slack.md\",children:\"\\uC774 \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uD655\\uC778 \\uAC00\\uB2A5\\uD558\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"values.yaml\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"driver\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ebpf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"falcosidekick\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"loki\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"hostport\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//loki\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3100\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"tenant\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` falco\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"slack\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"webhookurl\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//hooks.slack.com/services/\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"something\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"minimumpriority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` alert\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"outputformat\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` fields\n`]})]})}),(0,e.jsx)(n.p,{children:\"Helm Chart\\uC758 value\\uB294 \\uAE30\\uBCF8\\uAC12\\uC73C\\uB85C \\uC544\\uB798\\uC640 \\uAC19\\uC774 stdout_output\\uC774 enable\\uB418\\uC5B4 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C Daemonset\\uC73C\\uB85C \\uC124\\uCE58\\uB418\\uB294 Falco\\uC758 container log\\uB97C \\uBCF4\\uBA74 Falco rule\\uC5D0 \\uB530\\uB978 event\\uB4E4\\uC774 \\uB0A8\\uC544 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"stdout_output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC815\\uC758\\uD55C \",(0,e.jsx)(n.code,{children:\"values.yaml\"}),\"\\uC744 \\uD1B5\\uD574\\uC11C Helm Chart\\uB97C \\uBC30\\uD3EC\\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"helm \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),\" falco falcosecurity/falco \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--create-namespace \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--namespace falco \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`--values values.yaml\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC124\\uCE58\\uACFC \\uC644\\uB8CC\\uB418\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 falco\\uC758 \\uC124\\uC815\\uAC12\\uB4E4\\uC774 ConfigMap\\uC5D0 \\uC815\\uC758\\uB41C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ kubectl get cm -n falco\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NAME               DATA   AGE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falco              \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`      1d\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falco-falcoctl     \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`      1d\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"falco-rules        \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`      1d\n`]})]})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"kubectl get cm falco -o yaml\"}),\"\\uC73C\\uB85C \\uD655\\uC778\\uD574\\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 json \\uD615\\uC2DD\\uC758 output\\uC774 \\uC124\\uC815\\uB418\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB9AC\\uACE0 falco-facosidekick ClusterIP \\uC11C\\uBE44\\uC2A4\\uB85C \\uC694\\uCCAD\\uD558\\uB3C4\\uB85D http_output\\uC774 \\uC124\\uC815\\uB418\\uACE0, stdout_output\\uB3C4 \\uB3D9\\uC77C\\uD558\\uAC8C true\\uB85C \\uC124\\uC815\\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"json_output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"http_output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ca_bundle\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ca_cert\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ca_path\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /etc/falco/certs/\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"client_cert\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /etc/falco/certs/client/client.crt\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"client_key\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /etc/falco/certs/client/client.key\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"compress_uploads\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"echo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"insecure\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"keep_alive\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mtls\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"url\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"//falco\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"falcosidekick\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2801\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"user_agent\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` falcosecurity/falco\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"stdout_output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"falco-rule\",children:[(0,e.jsx)(n.a,{href:\"#falco-rule\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Falco Rule\"]}),(0,e.jsxs)(n.p,{children:[\"Falco rules\\uC744 \\uAE30\\uBCF8\\uC801\\uC73C\\uB85C \",(0,e.jsx)(n.code,{children:\"stable\"}),\" \\uC0C1\\uD0DC\\uC5D0 \\uC788\\uB294 rule\\uB4E4 \\uC790\\uB3D9\\uC73C\\uB85C \\uC124\\uC815\\uC774 \\uB41C\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://falco.org/docs/reference/rules/default-rules/\",children:\"Community\\uC5D0\\uC11C \\uAD00\\uB9AC\\uB418\\uB294 rule\\uB4E4\\uC740 \\uC5EC\\uAE30\"}),\"\\uC5D0\\uC11C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"incubating\"}),\", \",(0,e.jsx)(n.code,{children:\"sandbox\"}),\" \\uC0C1\\uD0DC\\uC758 rule\\uB3C4 \\uCD94\\uAC00\\uD558\\uACE0 \\uC2F6\\uC73C\\uBA74 Helm Chart Value\\uC5D0 \\uC815\\uC758\\uD558\\uC5EC \\uCD94\\uAC00\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"stable \\uC0C1\\uD0DC\\uC758 rule\\uB4E4\\uC740 \",(0,e.jsx)(n.a,{href:\"https://github.com/falcosecurity/rules/blob/main/rules/falco_rules.yaml\",children:\"Github Repo\\uC758 falco_rules.yaml\"}),\"\\uC5D0\\uC11C\\uB3C4 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \\uC608\\uB97C \\uB4E4\\uC5B4\\uC11C \",(0,e.jsx)(n.code,{children:\"falco_rules.yaml\"}),\"\\uC5D0\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC740 Rule\\uC774 \\uC815\\uC758\\uB418\\uC5B4 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"macro\"}),\"\\uB294 \\uB2E4\\uC2DC \\uC7AC\\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uD2B9\\uC815\\uD55C \\uC870\\uAC74\\uB4E4\\uC744 \\uC815\\uC758\\uD574 \\uB193\\uB294 \\uAC83\\uC774\\uACE0, \",(0,e.jsx)(n.code,{children:\"list\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \\uC5EC\\uB7EC \\uAC1C\\uC758 \\uAC12\\uC744 \\uBB36\\uC5B4\\uC11C \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"Terminal shell in container\"}),\"\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"macro\"}),\"\\uC640 \",(0,e.jsx)(n.code,{children:\"list\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \\uC815\\uC758\\uD558\\uACE0 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"macro\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` spawned_process\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" (evt.type in (execve\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` execveat) and evt.dir=\u003c)\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"macro\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" (container.id \",(0,e.jsx)(n.span,{className:\"token tag\",children:\"!=\"}),` host)\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"macro\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` container_entrypoint\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" (not proc.pname exists or proc.pname in (runc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"PARENT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" runc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"CHILD\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" runc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" docker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"runc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" exe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" docker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"runc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cur\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" containerd\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"shim\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" systemd\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` crio))\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"macro\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` user_expected_terminal_shell_in_container_conditions\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` (never_true)\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"list\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shell_binaries\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"items\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"ash\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" bash\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" csh\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ksh\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sh\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" tcsh\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" zsh\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" dash\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"macro\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shell_procs\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` (proc.name in (shell_binaries))\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Terminal shell in container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"desc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    A shell was used as the entrypoint/exec point into a container with an attached terminal. Parent process may have \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    legitimately already exited and be null (read container_entrypoint macro). Common when using \"kubectl exec\" in Kubernetes. \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    Correlate with k8saudit exec logs if possible to find user or serviceaccount token used (fuzzy correlation by namespace and pod name). \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    Rather than considering it a standalone rule, it may be best used as generic auditing rule while examining other triggered \n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"    rules in this container/tty.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    spawned_process \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    and container\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    and shell_procs \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    and proc.tty != 0\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    and container_entrypoint\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"    and not user_expected_terminal_shell_in_container_conditions\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` A shell was spawned in a container with an attached terminal (evt_type=%evt.type user=%user.name user_uid=%user.uid user_loginuid=%user.loginuid process=%proc.name proc_exepath=%proc.exepath parent=%proc.pname command=%proc.cmdline terminal=%proc.tty exe_flags=%evt.arg.flags %container.info)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` NOTICE\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"tags\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"maturity_stable\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" container\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" shell\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" mitre_execution\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" T1059\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C Pod\\uC5D0 \\uC811\\uADFC\\uD558\\uBA74\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it nginx-pod -- /bin/sh\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uC544\\uB798\\uC640 \\uAC19\\uC740 log\\uAC00 \\uB0A8\\uAC8C \\uB41C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"hostname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"node-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10:31:35.913486795: Notice A shell was spawned in a container with an attached terminal (evt_type=execve user=root user_uid=0 user_loginuid=-1 process=sh proc_exepath=/usr/bin/dash parent=containerd-shim command=sh terminal=34816 exe_flags=EXE_WRITABLE container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name)\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"priority\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Notice\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rule\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Terminal shell in container\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"source\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"syscall\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"T1059\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"container\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"maturity_stable\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"mitre_execution\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"shell\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2024-05-03T10:31:35.913486795Z\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output_fields\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"6fec6323ae4c\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.repository\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"docker.io/library/nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.tag\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"latest\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.arg.flags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"EXE_WRITABLE\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1714732295913486795\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"execve\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.ns.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"default\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.pod.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.cmdline\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sh\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.exepath\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/usr/bin/dash\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sh\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.pname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"containerd-shim\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.tty\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"34816\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.loginuid\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"-1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"root\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.uid\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uD14C\\uC2A4\\uD2B8\\uB97C \\uD55C \\uD658\\uACBD\\uC758 Container Runtime\\uC774 containerd\\uC774\\uAE30 \\uB54C\\uBB38\\uC5D0, parent process\\uBA85\\uC740 \",(0,e.jsx)(n.code,{children:\"containerd-shim\"}),\"\\uC73C\\uB85C \\uD45C\\uC2DC\\uAC00 \\uB41C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"evt.type\"}),\"\\uB294 syscall event\\uC744 \\uAC00\\uC9C0\\uB294\\uB370, \",(0,e.jsx)(n.a,{href:\"https://falco.org/docs/reference/rules/supported-events/\",children:\"\\uACF5\\uC2DD\\uBB38\\uC11C\\uC5D0\\uC11C \\uC9C0\\uC6D0\\uD558\\uB294 events \\uC885\\uB958\"}),\"\\uB97C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://man7.org/linux/man-pages/man2/execve.2.html\",children:\"execve\\uB294 \\uD504\\uB85C\\uADF8\\uB7A8\\uC744 \\uC2E4\\uD589\\uD560 \\uB54C\\uC758 syscall\"}),\"\\uC778\\uB370, \",(0,e.jsx)(n.code,{children:\"/usr/bin/dash\"}),\" binary file\\uC774 \\uC2E4\\uD589\\uB418\\uC5C8\\uAE30 \\uB54C\\uBB38\\uC5D0 evt.type\\uC740 \",(0,e.jsx)(n.code,{children:\"execve\"}),\"\\uAC00 \\uB418\\uACE0 proc.exepath\\uAC00 \",(0,e.jsx)(n.code,{children:\"usr/bin/dash\"}),\"\\uAC00 \\uB41C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uC544\\uB798\\uCC98\\uB7FC \\uBB38\\uC11C\\uC5D0 syscall\\uC774 \\uBD88\\uB838\\uC744 \\uB54C \",(0,e.jsx)(n.code,{children:\"\u003e\"}),\", \\uB05D\\uB0AC\\uC744 \\uB54C \",(0,e.jsx)(n.code,{children:\"\u003c\"}),\"\\uB85C \\uD45C\\uC2DC\\uD558\\uAC8C \\uB41C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"\u003e\"}),\"\\uB294 filepath\\uB85C \\uC2E4\\uD589\\uD558\\uACE0, \",(0,e.jsx)(n.code,{children:\"\u003c\"}),\"\\uB294 systemcall\\uC774 \\uB05D\\uB098\\uACE0 \\uAE30\\uD0C0 \\uC815\\uBCF4\\uB4E4\\uC744 \\uBC18\\uD658\\uD55C\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/falco-execve.png\",alt:\"falco execve event\"}),(0,e.jsxs)(n.h2,{id:\"custom-rule\",children:[(0,e.jsx)(n.a,{href:\"#custom-rule\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Custom Rule\"]}),(0,e.jsxs)(n.p,{children:[\"\\uAE30\\uBCF8\\uC73C\\uB85C \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB294 Rule\\uC744 \\uC0B4\\uD3B4\\uBCF4\\uC558\\uACE0, \",(0,e.jsx)(n.code,{children:\"marcro\"}),\", \",(0,e.jsx)(n.code,{children:\"list\"}),\", \",(0,e.jsx)(n.code,{children:\"rule\"}),\" Syntax\\uB85C \\uC6D0\\uD558\\uB294 custom rule\\uC744 \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. accept, listen\\uC740 \",(0,e.jsx)(n.code,{children:\"\u003c\"}),\" \\uC5D0\\uC11C fd params\\uC744 \\uAC00\\uC9C0\\uACE0, recvfrom, recvmsg\\uB294 \",(0,e.jsx)(n.code,{children:\"\u003e\"}),\"\\uC5D0\\uC11C fd params\\uB97C \\uAC00\\uC9C0\\uACE0 \\uC788\\uB2E4. \\uC774\\uC81C params \",(0,e.jsx)(n.code,{children:\"fd\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \",(0,e.jsx)(n.code,{children:\"fd.sport\"}),\" Server Port\\uAC00 22\\uC778\\uC9C0 \\uD655\\uC778\\uD55C\\uB2E4. \\uC774 \\uC870\\uAC74\\uC744 \\uB9CC\\uC871\\uD558\\uBA74 output\\uC73C\\uB85C \",(0,e.jsx)(n.code,{children:\"fd.cip\"}),\" client IP address\\uC640 \",(0,e.jsx)(n.code,{children:\"fd.cport\"}),\" client Port \\uAC12\\uC744 \\uB0A8\\uAE30\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"custom-rules.yaml\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"customRules\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rules-ssh.yaml\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"list\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ssh_standard_ports\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"items\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"macro\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ssh_standard_ports_network\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` (fd.sport in (ssh_standard_ports))\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Inbound SSH Connection\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"desc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Detect Inbound SSH Connection\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        ((evt.type in (accept,listen) and evt.dir=\u003c) or\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"          (evt.type in (recvfrom,recvmsg))) and ssh_standard_ports_network\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"        Inbound SSH connection (user=%user.name client_ip=%fd.cip client_port=%fd.cport server_ip=%fd.sip)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ALERT\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"tags\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"network\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC815\\uC758\\uD55C costom rule\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC801\\uC6A9\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"helm upgrade falco falcosecurity/falco \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-f ./custom-rules.yaml \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--namespace falco \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`--values values.yaml\n`})]})}),(0,e.jsxs)(n.p,{children:[\"custom rule\\uC5D0 \\uC758\\uD574\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 log\\uAC00 \\uB0A8\\uB294\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"container.id\"}),\"\\uAC00 \",(0,e.jsx)(n.code,{children:\"host\"}),\"\\uC774\\uAE30 \\uB54C\\uBB38\\uC5D0 Kubernetes \\uAD00\\uB828\\uB41C \\uC815\\uBCF4\\uB294 \",(0,e.jsx)(n.code,{children:\"\u003cNA\u003e\"}),\"\\uB85C \\uD45C\\uC2DC\\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"hostname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"node-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"11:37:53.059395044: Alert Inbound SSH connection (user=root client_ip=x.x.x.x client_port=56483 server_ip=x.x.x.x) container_id=host container_image=\u003cNA\u003e container_image_tag=\u003cNA\u003e container_name=host k8s_ns=\u003cNA\u003e k8s_pod_name=\u003cNA\u003e\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"priority\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Alert\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rule\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Inbound SSH Connection\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"source\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"syscall\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"network\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2024-05-03T11:37:53.059395044Z\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output_fields\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"host\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.repository\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword null\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.tag\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword null\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"host\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1714736273059395044\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fd.cip\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"x.x.x.x\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fd.cport\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"56483\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fd.sip\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"x.x.x.x\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.ns.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword null\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.pod.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword null\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"root\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uC704\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"falcosidekick\"}),\"\\uC5D0\\uC11C slack\\uB3C4 \\uC124\\uC815\\uC744 \\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC544\\uB798\\uCC98\\uB7FC \\uC2AC\\uB799 \\uBA54\\uC138\\uC9C0\\uAC00 \\uC624\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/falco-slack.png\",alt:\"falco slack message\"}),(0,e.jsxs)(n.h2,{id:\"\\uC6D0\\uD558\\uB294-\\uACB0\\uACFC\",children:[(0,e.jsx)(n.a,{href:\"#\\uC6D0\\uD558\\uB294-\\uACB0\\uACFC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uC6D0\\uD558\\uB294 \\uACB0\\uACFC\"]}),(0,e.jsx)(n.p,{children:\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C Falco\\uB85C \\uAD6C\\uD604\\uD558\\uACE0 \\uC2F6\\uC740 \\uAC83\\uC740 Worker Node\\uB098 Pod\\uC758 Container\\uC5D0 Terminal shell\\uB85C \\uC5F0\\uACB0\\uD588\\uC744 \\uB54C, \\uBAA8\\uB4E0 \\uBA85\\uB839\\uC5B4\\uB4E4\\uC744 \\uC800\\uC7A5\\uD558\\uACE0 \\uC54C\\uB9BC\\uC744 \\uD544\\uC694\\uC2DC\\uC5D0 \\uBC1B\\uACE0 \\uC2F6\\uB2E4.\"}),(0,e.jsx)(n.p,{children:\"Falco\\uB294 Rule\\uC744 \\uD1B5\\uD574\\uC11C \\uD2B9\\uC815 \\uC870\\uAC74\\uC5D0 \\uD574\\uB2F9\\uB418\\uB294 Event\\uB97C \\uC800\\uC7A5\\uD558\\uB294 \\uAD6C\\uC870\\uB85C \\uB418\\uC5B4\\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uC774\\uB807\\uAC8C \\uBAA8\\uB4E0 \\uBA85\\uB839\\uC5B4\\uB4E4\\uC744 \\uC800\\uC7A5\\uD558\\uACE0 \\uC2F6\\uB2E4\\uBA74, \\uADF8\\uB807\\uAC8C \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D Custom Rule\\uC744 \\uC815\\uC758\\uD574\\uC57C \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shell_in_container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"desc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` notice shell activity within a container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.type = execve and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.dir = \u003c and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tcontainer.id != host and\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tproc.pname = sh\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tshell in a container\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\t(user=%user.name container_id=%container.id container_name=%container.name\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tshell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` WARNING\n`]})]})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"ls\"}),\"\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 \",(0,e.jsx)(n.code,{children:\"execve\"}),\"\\uAC00 \\uC0AC\\uC6A9\\uB418\\uACE0 \\uC544\\uB798\\uCC98\\uB7FC log\\uAC00 \\uB0A8\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it nginx-pod -- /bin/sh\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# ls\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"hostname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"node-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"12:03:52.176355678: Warning shell in a container (user=root container_id=6fec6323ae4c container_name=nginx  shell=ls parent=sh cmdline=ls /bin) container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"priority\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Warning\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rule\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"shell_in_container\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"source\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"syscall\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2024-05-03T12:03:52.176355678Z\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output_fields\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"6fec6323ae4c\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.repository\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"docker.io/library/nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.tag\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"latest\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1714737832176355678\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.ns.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"default\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.pod.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.cmdline\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ls /bin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ls\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.pname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sh\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"root\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Pod container\\uB9D0\\uACE0 host\\uB97C \\uD558\\uACE0 \\uC2F6\\uB2E4\\uBA74 Condition\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"container.id = host\"}),\"\\uB85C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uB3D9\\uC77C\\uD55C \\uBC29\\uC2DD\\uC73C\\uB85C rule\\uC744 \\uCD94\\uAC00\\uD558\\uBA74 \\uB2E4\\uC591\\uD55C \\uBA85\\uB839\\uC5B4\\uB4E4\\uC774 Shell\\uC744 \\uD1B5\\uD574\\uC11C \\uC2E4\\uD589\\uB418\\uACE0 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shell_in host\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"desc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` notice shell activity within a host\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.type = execve and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.dir = \u003c and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tcontainer.id = host and\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tproc.pname = sh\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tshell in a host\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\t(user=%user.name shell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` WARNING\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB7F0\\uB370 \",(0,e.jsx)(n.a,{href:\"https://man7.org/linux/man-pages/man2/mkdir.2.html\",children:(0,e.jsx)(n.code,{children:\"mkdir\"})}),\"\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 \",(0,e.jsx)(n.code,{children:\"evt.type = mkdir\"}),\"\\uB85C \\uCD94\\uAC00\\uD574\\uC918\\uC57C\\uD55C\\uB2E4. \\uB530\\uB77C\\uC11C condition\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"in\"}),\"\\uC73C\\uB85C \",(0,e.jsx)(n.code,{children:\"mkdir\"}),\"\\uB3C4 \\uCD94\\uAC00\\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shell_in_container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"desc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` notice shell activity within a container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.type in (execve, mkdir) and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.dir = \u003c and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tcontainer.id != host and\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tproc.pname = sh\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tshell in a container\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\t(user=%user.name container_id=%container.id container_name=%container.name\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tshell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` WARNING\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB7EC\\uBA74 \\uC774\\uC81C \",(0,e.jsx)(n.code,{children:\"mkdir\"}),\"\\uB3C4 \\uC544\\uB798\\uCC98\\uB7FC \\uB85C\\uADF8\\uAC00 \\uB0A8\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it nginx-pod -- /bin/sh\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# mkdir /hellofalco\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"hostname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"node-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"20:29:06.389110693: Warning shell in a container (user=root container_id=6fec6323ae4c container_name=nginx  shell=mkdir parent=sh cmdline=mkdir /hellofalco) container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"priority\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Warning\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rule\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"shell_in_container\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"source\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"syscall\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2024-05-03T20:29:06.389110693Z\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output_fields\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"6fec6323ae4c\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.repository\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"docker.io/library/nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.tag\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"latest\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1714768146389110693\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.ns.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"default\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.pod.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.cmdline\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"mkdir /hellofalco\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"mkdir\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.pname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sh\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"root\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:'echo \"hello world\" \u003e example.txt'}),\" \\uBA85\\uB839\\uC5B4\\uB97C \\uD588\\uC744 \\uB54C\\uB294 \\uC704\\uC758 Rule\\uC5D0 \\uD3EC\\uD568\\uB418\\uC9C0 \\uC54A\\uB294\\uB2E4. \\uB530\\uB77C\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \\uCD94\\uAC00\\uD574\\uBCF8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"rule\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shell_in_container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"desc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` notice shell activity within a container\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"condition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.type in (open, openat, openat2) and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tevt.dir = \u003c and\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tfd.filename in (example.txt) and\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tcontainer.id != host\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"output\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tshell in a container\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\t(file=%fd.name evt_type=%evt.type user=%user.name container_id=%container.id container_name=%container.name\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\tshell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` WARNING\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C \",(0,e.jsx)(n.code,{children:\"example.txt\"}),\"\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,e.jsx)(n.code,{children:\"echo\"}),\"\\uB85C \\uC0DD\\uC131\\uD574\\uBCF8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it nginx-pod -- /bin/sh\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:'# echo \"hello world\" \u003e example.txt'}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB7EC\\uBA74 \",(0,e.jsx)(n.code,{children:\"fd.name\"}),\"\\uC744 \\uD1B5\\uD574\\uC11C \\uC218\\uC815\\uB41C \\uD30C\\uC77C\\uBA85\\uC744 \\uC54C \\uC218 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:'echo \"hello world\" \u003e example.txt'}),\" \\uC804\\uCCB4 \\uBA85\\uB839\\uC5B4\\uB97C \\uB0A8\\uAE38 \\uBC29\\uBC95\\uC774 \\uBCF4\\uC774\\uC9C0 \\uC54A\\uB294\\uB2E4. \\u{1F914} \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"open\"}),\"\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uB108\\uBB34\\uB098 \\uB9CE\\uC740 \\uD504\\uB85C\\uC138\\uC2A4\\uC5D0\\uC11C call\\uD558\\uACE0 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC880\\uB354 \\uAD6C\\uCCB4\\uC801\\uC778 \\uC870\\uAC74\\uC744 \\uC791\\uC131\\uD558\\uC9C0 \\uC54A\\uC73C\\uBA74 \\uBD88\\uD544\\uC694\\uD558\\uAC8C \\uB108\\uBB34 \\uB9CE\\uC740 \\uC774\\uBCA4\\uD2B8 \\uB85C\\uADF8\\uAC00 \\uB0A8\\uAC8C \\uB41C\\uB2E4. Falco stable Rule \\uC911\\uC5D0 \",(0,e.jsx)(n.code,{children:\"/var/log/auth.log\"}),\"\\uB098 \",(0,e.jsx)(n.code,{children:\"/var/log/syslog\"}),\"\\uCC98\\uB7FC \\uC2DC\\uC2A4\\uD15C \\uB85C\\uADF8\\uB4E4\\uC744 \\uC218\\uC815\\uD558\\uBA74 \\uC54C\\uB9BC\\uC774 \\uC624\\uB3C4\\uB85D \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB2E4. \\uC774\\uCC98\\uB7FC \\uAD6C\\uCCB4\\uC801\\uC778 \\uC870\\uAC74\\uC744 \\uD1B5\\uD574\\uC11C \\uD2B9\\uC815 \\uD589\\uC704\\uC5D0 \\uB300\\uD55C \\uC774\\uBCA4\\uD2B8\\uB97C \\uBC1C\\uC0DD\\uC2DC\\uD0A8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"hostname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"node-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"21:41:34.978625505: Warning shell in a container (file=/example.txt evt_type=openat user=root container_id=6fec6323ae4c container_name=nginx  shell=sh parent=containerd-shim cmdline=sh) container_id=6fec6323ae4c container_image=docker.io/library/nginx container_image_tag=latest container_name=nginx k8s_ns=default k8s_pod_name=pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"priority\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Warning\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rule\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"shell_in_container\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"source\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"syscall\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2024-05-03T21:41:34.978625505Z\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"output_fields\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"6fec6323ae4c\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.repository\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"docker.io/library/nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.image.tag\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"latest\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"container.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nginx\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.time\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1714772494978625505\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"evt.type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"openat\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fd.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/example.txt\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.ns.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"default\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"k8s.pod.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"pod-name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.cmdline\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sh\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sh\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"proc.pname\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"containerd-shim\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"user.name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"root\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsxs)(n.p,{children:[\"Kubernetes Worker Node\\uC640 Pod Container\\uC5D0 \\uC9C1\\uC811 Terminal shell\\uC744 \\uD1B5\\uD574\\uC11C \\uC5B4\\uB5A0\\uD55C \\uBA85\\uB839\\uC5B4\\uB4E4\\uC744 \\uC2E4\\uD589\\uD588\\uC744 \\uB54C, \\uADF8\\uAC83\\uB4E4\\uC744 \\uBAA8\\uB450 \\uC800\\uC7A5\\uD558\\uACE0 \\uD2B9\\uC815\\uD55C \\uC870\\uAC74\\uC5D0 \\uB530\\uB77C \\uC2E4\\uC2DC\\uAC04 \\uC54C\\uB9BC\\uC744 \\uBCF4\\uB0B4\\uACE0 \\uC2F6\\uC5C8\\uB2E4. Falco\\uB294 Rule \\uC815\\uC758\\uB97C \\uD1B5\\uD574\\uC11C \\uC120\\uD0DD\\uC801\\uC73C\\uB85C Kernel event\\uB97C \\uBCF4\\uC548 \\uC704\\uD611\\uC774 \\uB418\\uB294 \\uC774\\uBCA4\\uD2B8\\uB97C \\uC800\\uC7A5\\uD558\\uACE0 \\uC2E4\\uC2DC\\uAC04\\uC131\\uC73C\\uB85C \\uC54C\\uB9BC\\uC744 \\uBCF4\\uB0BC \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C Falco Rule\\uC744 \\uC815\\uC758\\uD558\\uC5EC sh, bash\\uB4F1\\uC774 Parent Process\\uB85C \\uC788\\uC73C\\uBA74\\uC11C \",(0,e.jsx)(n.code,{children:\"ls\"}),\", \",(0,e.jsx)(n.code,{children:\"cat\"}),\"\\uB4F1\\uC744 execve syscall\\uB85C \\uC2E4\\uD589\\uD560 \\uB54C event\\uB97C \\uC218\\uC9D1\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4. \\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:\"mkdir\"}),\" \\uBA85\\uB839\\uC5B4\\uC5D0 \\uB300\\uD574\\uC11C \",(0,e.jsx)(n.code,{children:\"mkdir\"}),\"\\uC774\\uB098 \",(0,e.jsx)(n.code,{children:\"mkdirat\"}),\" \\uC870\\uAC74\\uC744 \\uCD94\\uAC00 \\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:'echo \"hello world\" \u003e example.txt'}),\"\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 example.txt\\uB97C \\uC218\\uC815/\\uC0AD\\uC81C\\uD560 \\uB54C \\uC774\\uBCA4\\uD2B8\\uB97C \\uB0A8\\uAE38 \\uC218 \\uC788\\uC9C0\\uB9CC, \\uC804\\uCCB4 shell\\uC5D0\\uC11C \\uC2E4\\uD589\\uD55C \\uC804\\uCCB4 \\uBA85\\uB839\\uC5B4\\uB97C \\uB0A8\\uAE30\\uB294 \\uBC29\\uBC95\\uC774 \\uBCF4\\uC774\\uC9C0 \\uC54A\\uC558\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uB108\\uBB34 \\uB9CE\\uC740 \\uACF3\\uC5D0\\uC11C \\uD30C\\uC77C\\uC744 \\uC77D\\uACE0 \\uC4F0\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uD544\\uD130 \\uC870\\uAC74\\uC744 \\uAD6C\\uCCB4\\uC801\\uC73C\\uB85C \\uC124\\uC815\\uD558\\uC9C0 \\uC54A\\uC73C\\uBA74 \\uC6D0\\uD558\\uC9C0 \\uC54A\\uC740 \\uC774\\uBCA4\\uD2B8\\uB4E4\\uC774 \\uB108\\uBB34 \\uB9CE\\uC774 \\uB0A8\\uAC8C \\uB41C\\uB2E4. \\uB530\\uB77C\\uC11C \\uB0B4\\uAC00 \\uC6D0\\uD558\\uB358 \\uAD6C\\uD604\\uC744 \\uC704\\uD574\\uC11C Falco\\uB294 \\uC801\\uD569\\uD558\\uC9C0 \\uC54A\\uB2E4\\uB294 \\uACB0\\uB860\\uC744 \\uB0B4\\uB9AC\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB7EC\\uBA74 \\uC6D0\\uD558\\uB294 \\uAD6C\\uD604\\uC5D0 \\uB354 \\uC801\\uD569\\uD55C \\uB2E4\\uB978 \\uC624\\uD508\\uC18C\\uC2A4 \\uC18C\\uD504\\uD2B8\\uC6E8\\uC5B4\\uAC00 \\uC788\\uC744\\uAE4C? \\u{1F9D0}\"})]})}}var _=f;return b;})();\n;return Component;","toc":[{"value":"Helm으로 설치","url":"#helm으로-설치","depth":2},{"value":"Falco Rule","url":"#falco-rule","depth":2},{"value":"Custom Rule","url":"#custom-rule","depth":2},{"value":"원하는 결과","url":"#원하는-결과","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"16 min read","minutes":15.27,"time":916200,"words":3054},"slug":"20240505-falco","fileName":"20240505-falco.md","title":"Falco를 활용하여 Terminal Shell 명령어 로그 수집하기","date":"2024-05-05T00:00:00.000Z","tags":["kubernetes","falco","devsecops"],"images":["/static/images/social-banner.png"],"summary":"Kubernetes Worker Node와 Pod Container에 Terminal shell로 접근하여 명령어를 입력하면 로그를 남기고, 경우에 따라서 알림을 보내고 싶었다. CNCF 졸업한 Project인 Falco를 활용하면 이를 구현할 수 있지 않을까 하여 테스트를 해보게 되었다. Falco는 kernel module이나 eBPF probe등을 통해서 kernel event를 저장하고, 설정된 rule에 따라서 해당 event를 filter하여 원하는 output 형태로 저장한다. Falco는 모든 로그를 저장하기보다는 Rule에 따라 선택적으로 보안 위협이 있는 이벤트를 수집하고 실시간으로 알림하는 것이 목적이다. 따라서 Falco를 통해서 원하던 기능을 구현하는 것은 합리적인 방법이 아닌 것으로 판단 된다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"OpenTelmetry로 auth.log와 syslog 수집하기","date":"2024-05-01T00:00:00.000Z","tags":["kubernetes","opentelemetry","devsecops"],"images":["/static/images/social-banner.png"],"summary":"Ubuntu 20.04 서버의 auth.log, syslog 로그 값들을 OpenTelemetry를 통해서 수집하고 싶었다. 처음에는 Filelog Receiver를 통해서 수집하려고 하였고, rsyslog의 설정값을 변경하여 Filelog로 수집하도록 구성했다. 그런데 이후에 Syslog Receiver가 존재하는 것을 확인하게 되었고, 훨씬 간단하게 syslog를 수집할 수 있었다.","slug":"20240501-opentelemetry-syslog"},"next":{"title":"책 \"팀장의 탄생\"을 읽고...","date":"2024-05-18T00:00:00.000Z","tags":["book"],"images":["/static/images/social-banner.png"],"summary":"나도 어느덧 개발자의 길을 들어선지 8년 정도가 지났다. 나는 어떻게 하면 시니어다운 개발자가 될 수 있을지 계속 질문을 하고 있다. 나는 풍부한 개발 지식과 경험을 통해서 리더쉽을 발휘할 수 있는 시니어가 되고 싶다. 그렇게 되기 위해서 개발자 커리어 동안 항상 배움에 목말라 했고 성장에 집착했었다. 나의 개발자 커리어에서 잠깐동안 5명 정도 되는 팀을 이끄는 팀장 역할을 하기도 했지만, 나머지 기간은 팀원의 역할로 다양한 업무를 맡았다. 이렇게 나는 어떠한 조직을 이끄는 매니저 역할을 고민하기보다는, 팀원으로 회사에 어떻게 기여하고 성과를 낼 수 있는지 고민하는 시간을 주로 가졌다. 따라서 \"팀장의 탄생\" 책을 읽으면서 과거 나의 팀을 이끌던 팀장분들을 떠올려보았고, 앞으로 내가 팀장 같은 역할을 가지면 기억해야할 점을 남겨보았다.","slug":"20240518-book-review-manager"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20240505-falco"]},"buildId":"YKuEPKHFWiQ2zWjBQxtAS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>