<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Bitbucket OIDC with GCP</title><meta name="robots" content="follow, index"/><meta name="description" content="Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다."/><meta property="og:url" content="https://jayground8.github.io/blog/20250117-google-oidc-bitbucket"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다."/><meta property="og:title" content="Bitbucket OIDC with GCP"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Bitbucket OIDC with GCP"/><meta name="twitter:description" content="Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20250117-google-oidc-bitbucket"/><meta property="article:published_time" content="2025-01-17T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20250117-google-oidc-bitbucket"
  },
  "headline": "Bitbucket OIDC with GCP",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2025-01-17T00:00:00.000Z",
  "dateModified": "2025-01-17T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5b5ab7804f808f5a.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/aZB0OZMJIIlSfZorUzSCa/_buildManifest.js" defer=""></script><script src="/_next/static/aZB0OZMJIIlSfZorUzSCa/_ssgManifest.js" defer=""></script><script src="/_next/static/aZB0OZMJIIlSfZorUzSCa/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-01-17T00:00:00.000Z">2025년 1월 17일 금요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Bitbucket OIDC with GCP</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>이번에는 Bitbucket Pipeline를 이용할 때 OIDC를 통해서 GCP Resource에 접근하는 방법을 설명한다. <a target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleCloudPlatform/gcp-bitbucket-wif">Bitbucket OIDC를 통해서 GCP에 접근하는 예제</a>를 참고하여 설정을 완료할 수 있었다.</p><h2 id="workload-identity-pool-생성"><a href="#workload-identity-pool-생성" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>workload identity pool 생성</h2><blockquote><p>A workload identity pool is an entity that lets you manage external identities.</p></blockquote><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">gcloud iam workload-identity-pools create bitbucket-pool <span class="token punctuation">\</span>
</span><span class="code-line">--location<span class="token operator">=</span><span class="token string">&quot;global&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">--display-name<span class="token operator">=</span><span class="token string">&quot;bitbucket-pool&quot;</span>
</span></code></pre></div><h2 id="bitbucket-oidc-설정값들-확인"><a href="#bitbucket-oidc-설정값들-확인" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>bitbucket OIDC 설정값들 확인</h2><p>Bitbucket Repository 화면에서 왼쪽 아래 <code>Repository settings</code> 메뉴를 클릭하면, 아래와 같이 OpenID Connect라는 메뉴에 접근할 수 있다.</p><img src="/static/images/bitbucket-settings-oidc.png" alt="bitbucket oidc settings"/><p>issuer-uri와 allowed-audiences 설정값을 위에서 확인한 값으로 설정한다. 그리고 <a target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/workload-identity-federation#mapping">attribute-mapping은 GCP 문서에 설명한 대로</a> 설정을 한다. Bitbucket에서 발급하는 Token의 payload에 sub, workspaceUuid, respositoryUuid등이 claims로 저장되어 있다. <a target="_blank" rel="noopener noreferrer" href="https://support.atlassian.com/bitbucket-cloud/docs/integrate-pipelines-with-resource-servers-using-oidc/">이 글을 확인하면 어떤 claims들이 있는지 예제를 확인할 수 있다.</a> custom attribute로 attribute.repository_uuid를 설정했는데, 해당 attribute로 특정 repository만 권한을 받을 수 있게 설정할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">gcloud iam workload-identity-pools providers create-oidc bitbucket-provider <span class="token punctuation">\</span>
</span><span class="code-line">--location<span class="token operator">=</span><span class="token string">&quot;global&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">--workload-identity-pool<span class="token operator">=</span><span class="token string">&quot;bitbucket-pool&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">--issuer-uri<span class="token operator">=</span><span class="token string">&quot;https://api.bitbucket.org/2.0/workspaces/myworkspace/pipelines-config/identity/oidc&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">--allowed-audiences<span class="token operator">=</span><span class="token string">&quot;ari:cloud:bitbucket::workspace/31c366db-0cb6-454a-8c0a-6d174be5c298&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">--attribute-mapping<span class="token operator">=</span><span class="token string">&quot;google.subject=assertion.sub,attribute.workspace_uuid=assertion.workspaceUuid,attribute.repository_uuid=assertion.repositoryUuid&quot;</span>
</span></code></pre></div><h2 id="service-account-생성-및-권한-부여"><a href="#service-account-생성-및-권한-부여" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Service Account 생성 및 권한 부여</h2><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">gcloud iam service-accounts create bitbucket-sa
</span></code></pre></div><p>이번 예제에서는 GCP Artifact Registry에 Container Image를 push할 수 있도록 Role을 부여한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">gcloud artifacts repositories add-iam-policy-binding <span class="token variable">${REPO_NAME}</span> <span class="token punctuation">\</span>
</span><span class="code-line">--location us-west1 <span class="token punctuation">\</span>
</span><span class="code-line">--member serviceAccount:bitbucket-sa@<span class="token variable">${MY_PRJ_NAME}</span>.iam.gserviceaccount.com <span class="token punctuation">\</span>
</span><span class="code-line">--role roles/artifactregistry.writer
</span></code></pre></div><h2 id="repository별로-role-binding"><a href="#repository별로-role-binding" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Repository별로 role binding</h2><p>위에서 custom attribute <code>resposiory_uuid</code>를 추가했었다. 따라서 특정 Bitbucket Repository의 UUID와 동일한 경우에만 Service Account impersonation으로 Access Token을 발급할 수 있도록 아래와 같이 설정한다. 여기서 주의해야할 점은 repository_uuid가 <code>{}</code>도 포함된다는 점이다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">gcloud iam service-accounts add-iam-policy-binding <span class="token punctuation">\</span>
</span><span class="code-line">--role roles/iam.serviceAccountTokenCreator <span class="token punctuation">\</span>
</span><span class="code-line">--member <span class="token string">&quot;principalSet://iam.googleapis.com/projects/<span class="token variable">${MY_PRJ_ID}</span>/locations/global/workloadIdentityPools/bitbucket-pool/attribute.repository_uuid/{02ac571e-4a7f-415a-bc5a-10fec861d9a6}&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">bitbucket-sa@<span class="token variable">${MY_PRJ_NAME}</span>.iam.gserviceaccount.com
</span></code></pre></div><h2 id="bitbucket-pipeline-yaml-작성"><a href="#bitbucket-pipeline-yaml-작성" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Bitbucket Pipeline YAML 작성</h2><p><code>bitbucket-pipelines.yml</code>을 아래와 같이 작성한다. <code>BITBUCKET_STEP_OIDC_TOKEN</code>을 사용하려면 <code>oidc: true</code>를 설정해야 한다. 위에서 IAM Policy Binding을 정상적으로 진행하지 않으면, Access Token을 발급하지 못하여 에러가 발생한다. 정상적으로 설정이 완료되었다면 Artifact Repository에 새로 빌드된 컨테이너 이미지를 Push할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">pipelines</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">branches</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">main</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">step</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">name</span><span class="token punctuation">:</span> Example
</span><span class="code-line">          <span class="token atrule key">oidc</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">          <span class="token atrule key">image</span><span class="token punctuation">:</span> google/cloud<span class="token punctuation">-</span>sdk
</span><span class="code-line">          <span class="token atrule key">script</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> echo $<span class="token punctuation">{</span>BITBUCKET_STEP_OIDC_TOKEN<span class="token punctuation">}</span> <span class="token punctuation">&gt;</span> /tmp/gcp_access_token.out
</span><span class="code-line">            <span class="token punctuation">-</span> gcloud iam workload<span class="token punctuation">-</span>identity<span class="token punctuation">-</span>pools create<span class="token punctuation">-</span>cred<span class="token punctuation">-</span>config projects/$<span class="token punctuation">{</span>MY_PRJ_ID<span class="token punctuation">}</span>/locations/global/workloadIdentityPools/bitbucket<span class="token punctuation">-</span>pool/providers/bitbucket<span class="token punctuation">-</span>provider <span class="token punctuation">-</span><span class="token punctuation">-</span>service<span class="token punctuation">-</span>account=&quot;bitbucket<span class="token punctuation">-</span>sa@$<span class="token punctuation">{</span>MY_PRJ_NAME<span class="token punctuation">}</span>.iam.gserviceaccount.com&quot; <span class="token punctuation">-</span><span class="token punctuation">-</span>output<span class="token punctuation">-</span>file=$<span class="token punctuation">{</span>BITBUCKET_CLONE_DIR<span class="token punctuation">}</span>/gcp_temp_cred.json <span class="token punctuation">-</span><span class="token punctuation">-</span>credential<span class="token punctuation">-</span>source<span class="token punctuation">-</span>file=/tmp/gcp_access_token.out
</span><span class="code-line">            <span class="token punctuation">-</span> gcloud auth login <span class="token punctuation">-</span><span class="token punctuation">-</span>cred<span class="token punctuation">-</span>file=$<span class="token punctuation">{</span>BITBUCKET_CLONE_DIR<span class="token punctuation">}</span>/gcp_temp_cred.json
</span><span class="code-line">            <span class="token punctuation">-</span> gcloud auth configure<span class="token punctuation">-</span>docker us<span class="token punctuation">-</span>west1<span class="token punctuation">-</span>docker.pkg.dev <span class="token punctuation">-</span><span class="token punctuation">-</span>quiet
</span><span class="code-line">            <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>t us<span class="token punctuation">-</span>west1<span class="token punctuation">-</span>docker.pkg.dev/$<span class="token punctuation">{</span>MY_PRJ_NAME<span class="token punctuation">}</span>/$<span class="token punctuation">{</span>REPO_NAME<span class="token punctuation">}</span>/tutorial<span class="token punctuation">:</span>$<span class="token punctuation">{</span>BITBUCKET_COMMIT<span class="token punctuation">}</span> .
</span><span class="code-line">            <span class="token punctuation">-</span> docker push us<span class="token punctuation">-</span>west1<span class="token punctuation">-</span>docker.pkg.dev/$<span class="token punctuation">{</span>MY_PRJ_NAME<span class="token punctuation">}</span>/$<span class="token punctuation">{</span>REPO_NAME<span class="token punctuation">}</span>/tutorial<span class="token punctuation">:</span>$<span class="token punctuation">{</span>BITBUCKET_COMMIT<span class="token punctuation">}</span>
</span><span class="code-line">          <span class="token atrule key">services</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> docker
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>Service Account의 key를 발급해서 사용하는 것을 지양하고, 임시 credential를 사용하는 것이 바람직하다. Github Action이나 Bitbucket Pipeline을 사용하여 Cloud에 리소스를 배포/변경할 때, 만료기간이 없는 Key 발급하여 사용하는 대신에 OIDC를 통해서 임시 credential를 사용할 수 있다. 이번 글에서는 다른 누군가 Bitbucket OIDC로 GCP에 접근하도록 설정할 때, 참고할 수 있는 완전한 예제를 작성해보았다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/gcp">gcp</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/oidc">oidc</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/bitbucket">bitbucket</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250105-opentofu">GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250119-otel-gcp-detector">OpenTelemetry GcpDetector를 이해하기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=\u003ei(a,\"__esModule\",{value:!0});var m=(a,c)=\u003e()=\u003e(c||a((c={exports:{}}).exports,c),c.exports),k=(a,c)=\u003e{t(a);for(var s in c)i(a,s,{get:c[s],enumerable:!0})},N=(a,c,s)=\u003e{if(c\u0026\u0026typeof c==\"object\"||typeof c==\"function\")for(let n of p(c))!h.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026i(a,n,{get:()=\u003ec[n],enumerable:!(s=d(c,n))||s.enumerable});return a},b=a=\u003eN(t(i(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((f,l)=\u003e{l.exports=_jsx_runtime});var C={};k(C,{default:()=\u003e_,frontmatter:()=\u003eg});var e=b(o()),g={title:\"Bitbucket OIDC with GCP\",date:\"2025-01-17\",tags:[\"gcp\",\"oidc\",\"bitbucket\"],images:[\"/static/images/social-banner.png\"],summary:\"Bitbucket OIDC\\uB97C \\uC774\\uC6A9\\uD558\\uC5EC GCP \\uB9AC\\uC18C\\uC2A4\\uB97C \\uC811\\uADFC\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC124\\uBA85\\uD55C\\uB2E4. Bitbucket Pipeline\\uC73C\\uB85C GCP \\uB9AC\\uC18C\\uC2A4\\uB97C \\uBC30\\uD3EC/\\uBCC0\\uACBD\\uD560 \\uB54C OIDC\\uB97C \\uD1B5\\uD574\\uC11C \\uC784\\uC2DC Credential\\uB97C \\uBC1C\\uAE09\\uD560 \\uC218 \\uC788\\uB2E4. \\uB2E4\\uB978 \\uC0AC\\uB78C\\uC774 \\uB3D9\\uC77C\\uD55C \\uC791\\uC5C5\\uC744 \\uD560 \\uB54C, \\uC0BD\\uC9C8\\uD558\\uC9C0 \\uC54A\\uB3C4\\uB85D \\uC644\\uC804\\uD55C \\uC608\\uC81C\\uB97C \\uACF5\\uC720\\uD558\\uACE0\\uC790 \\uC791\\uC131\\uD55C\\uB2E4.\"};function y(a={}){let{wrapper:c}=a.components||{};return c?(0,e.jsx)(c,Object.assign({},a,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",blockquote:\"blockquote\",pre:\"pre\",code:\"code\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"\\uC774\\uBC88\\uC5D0\\uB294 Bitbucket Pipeline\\uB97C \\uC774\\uC6A9\\uD560 \\uB54C OIDC\\uB97C \\uD1B5\\uD574\\uC11C GCP Resource\\uC5D0 \\uC811\\uADFC\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC124\\uBA85\\uD55C\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://github.com/GoogleCloudPlatform/gcp-bitbucket-wif\",children:\"Bitbucket OIDC\\uB97C \\uD1B5\\uD574\\uC11C GCP\\uC5D0 \\uC811\\uADFC\\uD558\\uB294 \\uC608\\uC81C\"}),\"\\uB97C \\uCC38\\uACE0\\uD558\\uC5EC \\uC124\\uC815\\uC744 \\uC644\\uB8CC\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"workload-identity-pool-\\uC0DD\\uC131\",children:[(0,e.jsx)(n.a,{href:\"#workload-identity-pool-\\uC0DD\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"workload identity pool \\uC0DD\\uC131\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"A workload identity pool is an entity that lets you manage external identities.\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud iam workload-identity-pools create bitbucket-pool \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--location\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"global\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--display-name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"bitbucket-pool\"'}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"bitbucket-oidc-\\uC124\\uC815\\uAC12\\uB4E4-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{href:\"#bitbucket-oidc-\\uC124\\uC815\\uAC12\\uB4E4-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"bitbucket OIDC \\uC124\\uC815\\uAC12\\uB4E4 \\uD655\\uC778\"]}),(0,e.jsxs)(n.p,{children:[\"Bitbucket Repository \\uD654\\uBA74\\uC5D0\\uC11C \\uC67C\\uCABD \\uC544\\uB798 \",(0,e.jsx)(n.code,{children:\"Repository settings\"}),\" \\uBA54\\uB274\\uB97C \\uD074\\uB9AD\\uD558\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 OpenID Connect\\uB77C\\uB294 \\uBA54\\uB274\\uC5D0 \\uC811\\uADFC\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/bitbucket-settings-oidc.png\",alt:\"bitbucket oidc settings\"}),(0,e.jsxs)(n.p,{children:[\"issuer-uri\\uC640 allowed-audiences \\uC124\\uC815\\uAC12\\uC744 \\uC704\\uC5D0\\uC11C \\uD655\\uC778\\uD55C \\uAC12\\uC73C\\uB85C \\uC124\\uC815\\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.a,{href:\"https://cloud.google.com/iam/docs/workload-identity-federation#mapping\",children:\"attribute-mapping\\uC740 GCP \\uBB38\\uC11C\\uC5D0 \\uC124\\uBA85\\uD55C \\uB300\\uB85C\"}),\" \\uC124\\uC815\\uC744 \\uD55C\\uB2E4. Bitbucket\\uC5D0\\uC11C \\uBC1C\\uAE09\\uD558\\uB294 Token\\uC758 payload\\uC5D0 sub, workspaceUuid, respositoryUuid\\uB4F1\\uC774 claims\\uB85C \\uC800\\uC7A5\\uB418\\uC5B4 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://support.atlassian.com/bitbucket-cloud/docs/integrate-pipelines-with-resource-servers-using-oidc/\",children:\"\\uC774 \\uAE00\\uC744 \\uD655\\uC778\\uD558\\uBA74 \\uC5B4\\uB5A4 claims\\uB4E4\\uC774 \\uC788\\uB294\\uC9C0 \\uC608\\uC81C\\uB97C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),\" custom attribute\\uB85C attribute.repository_uuid\\uB97C \\uC124\\uC815\\uD588\\uB294\\uB370, \\uD574\\uB2F9 attribute\\uB85C \\uD2B9\\uC815 repository\\uB9CC \\uAD8C\\uD55C\\uC744 \\uBC1B\\uC744 \\uC218 \\uC788\\uAC8C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud iam workload-identity-pools providers create-oidc bitbucket-provider \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--location\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"global\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--workload-identity-pool\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"bitbucket-pool\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--issuer-uri\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"https://api.bitbucket.org/2.0/workspaces/myworkspace/pipelines-config/identity/oidc\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--allowed-audiences\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"ari:cloud:bitbucket::workspace/31c366db-0cb6-454a-8c0a-6d174be5c298\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--attribute-mapping\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.subject=assertion.sub,attribute.workspace_uuid=assertion.workspaceUuid,attribute.repository_uuid=assertion.repositoryUuid\"'}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"service-account-\\uC0DD\\uC131-\\uBC0F-\\uAD8C\\uD55C-\\uBD80\\uC5EC\",children:[(0,e.jsx)(n.a,{href:\"#service-account-\\uC0DD\\uC131-\\uBC0F-\\uAD8C\\uD55C-\\uBD80\\uC5EC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Service Account \\uC0DD\\uC131 \\uBC0F \\uAD8C\\uD55C \\uBD80\\uC5EC\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`gcloud iam service-accounts create bitbucket-sa\n`})})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uBC88 \\uC608\\uC81C\\uC5D0\\uC11C\\uB294 GCP Artifact Registry\\uC5D0 Container Image\\uB97C push\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D Role\\uC744 \\uBD80\\uC5EC\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud artifacts repositories add-iam-policy-binding \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"${REPO_NAME}\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--location us-west1 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--member serviceAccount:bitbucket-sa@\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"${MY_PRJ_NAME}\"}),\".iam.gserviceaccount.com \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`--role roles/artifactregistry.writer\n`})]})}),(0,e.jsxs)(n.h2,{id:\"repository\\uBCC4\\uB85C-role-binding\",children:[(0,e.jsx)(n.a,{href:\"#repository\\uBCC4\\uB85C-role-binding\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Repository\\uBCC4\\uB85C role binding\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC704\\uC5D0\\uC11C custom attribute \",(0,e.jsx)(n.code,{children:\"resposiory_uuid\"}),\"\\uB97C \\uCD94\\uAC00\\uD588\\uC5C8\\uB2E4. \\uB530\\uB77C\\uC11C \\uD2B9\\uC815 Bitbucket Repository\\uC758 UUID\\uC640 \\uB3D9\\uC77C\\uD55C \\uACBD\\uC6B0\\uC5D0\\uB9CC Service Account impersonation\\uC73C\\uB85C Access Token\\uC744 \\uBC1C\\uAE09\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uD55C\\uB2E4. \\uC5EC\\uAE30\\uC11C \\uC8FC\\uC758\\uD574\\uC57C\\uD560 \\uC810\\uC740 repository_uuid\\uAC00 \",(0,e.jsx)(n.code,{children:\"{}\"}),\"\\uB3C4 \\uD3EC\\uD568\\uB41C\\uB2E4\\uB294 \\uC810\\uC774\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud iam service-accounts add-iam-policy-binding \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--role roles/iam.serviceAccountTokenCreator \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--member \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"principalSet://iam.googleapis.com/projects/',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${MY_PRJ_ID}\"}),'/locations/global/workloadIdentityPools/bitbucket-pool/attribute.repository_uuid/{02ac571e-4a7f-415a-bc5a-10fec861d9a6}\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"bitbucket-sa@\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"${MY_PRJ_NAME}\"}),`.iam.gserviceaccount.com\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"bitbucket-pipeline-yaml-\\uC791\\uC131\",children:[(0,e.jsx)(n.a,{href:\"#bitbucket-pipeline-yaml-\\uC791\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Bitbucket Pipeline YAML \\uC791\\uC131\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"bitbucket-pipelines.yml\"}),\"\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC791\\uC131\\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"BITBUCKET_STEP_OIDC_TOKEN\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD558\\uB824\\uBA74 \",(0,e.jsx)(n.code,{children:\"oidc: true\"}),\"\\uB97C \\uC124\\uC815\\uD574\\uC57C \\uD55C\\uB2E4. \\uC704\\uC5D0\\uC11C IAM Policy Binding\\uC744 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC9C4\\uD589\\uD558\\uC9C0 \\uC54A\\uC73C\\uBA74, Access Token\\uC744 \\uBC1C\\uAE09\\uD558\\uC9C0 \\uBABB\\uD558\\uC5EC \\uC5D0\\uB7EC\\uAC00 \\uBC1C\\uC0DD\\uD55C\\uB2E4. \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC124\\uC815\\uC774 \\uC644\\uB8CC\\uB418\\uC5C8\\uB2E4\\uBA74 Artifact Repository\\uC5D0 \\uC0C8\\uB85C \\uBE4C\\uB4DC\\uB41C \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C Push\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"pipelines\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"branches\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"step\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Example\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"oidc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" google/cloud\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sdk\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"script\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" echo $\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_STEP_OIDC_TOKEN\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),` /tmp/gcp_access_token.out\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" gcloud iam workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"pools create\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cred\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"config projects/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_ID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/locations/global/workloadIdentityPools/bitbucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"pool/providers/bitbucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"provider \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),'account=\"bitbucket',(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"sa@$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),'.iam.gserviceaccount.com\" ',(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"output\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"file=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_CLONE_DIR\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/gcp_temp_cred.json \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"credential\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`file=/tmp/gcp_access_token.out\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" gcloud auth login \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cred\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"file=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_CLONE_DIR\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`/gcp_temp_cred.json\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" gcloud auth configure\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker us\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"west1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker.pkg.dev \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`quiet\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" docker build \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"t us\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"west1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker.pkg.dev/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"REPO_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/tutorial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_COMMIT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),` .\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" docker push us\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"west1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker.pkg.dev/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"REPO_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/tutorial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_COMMIT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"services\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` docker\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(n.p,{children:\"Service Account\\uC758 key\\uB97C \\uBC1C\\uAE09\\uD574\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC744 \\uC9C0\\uC591\\uD558\\uACE0, \\uC784\\uC2DC credential\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC774 \\uBC14\\uB78C\\uC9C1\\uD558\\uB2E4. Github Action\\uC774\\uB098 Bitbucket Pipeline\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC Cloud\\uC5D0 \\uB9AC\\uC18C\\uC2A4\\uB97C \\uBC30\\uD3EC/\\uBCC0\\uACBD\\uD560 \\uB54C, \\uB9CC\\uB8CC\\uAE30\\uAC04\\uC774 \\uC5C6\\uB294 Key \\uBC1C\\uAE09\\uD558\\uC5EC \\uC0AC\\uC6A9\\uD558\\uB294 \\uB300\\uC2E0\\uC5D0 OIDC\\uB97C \\uD1B5\\uD574\\uC11C \\uC784\\uC2DC credential\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uC774\\uBC88 \\uAE00\\uC5D0\\uC11C\\uB294 \\uB2E4\\uB978 \\uB204\\uAD70\\uAC00 Bitbucket OIDC\\uB85C GCP\\uC5D0 \\uC811\\uADFC\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD560 \\uB54C, \\uCC38\\uACE0\\uD560 \\uC218 \\uC788\\uB294 \\uC644\\uC804\\uD55C \\uC608\\uC81C\\uB97C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4.\"})]})}}var _=y;return C;})();\n;return Component;","toc":[{"value":"workload identity pool 생성","url":"#workload-identity-pool-생성","depth":2},{"value":"bitbucket OIDC 설정값들 확인","url":"#bitbucket-oidc-설정값들-확인","depth":2},{"value":"Service Account 생성 및 권한 부여","url":"#service-account-생성-및-권한-부여","depth":2},{"value":"Repository별로 role binding","url":"#repository별로-role-binding","depth":2},{"value":"Bitbucket Pipeline YAML 작성","url":"#bitbucket-pipeline-yaml-작성","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"3 min read","minutes":2.815,"time":168900,"words":563},"slug":"20250117-google-oidc-bitbucket","fileName":"20250117-google-oidc-bitbucket.md","title":"Bitbucket OIDC with GCP","date":"2025-01-17T00:00:00.000Z","tags":["gcp","oidc","bitbucket"],"images":["/static/images/social-banner.png"],"summary":"Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기","date":"2025-01-05T00:00:00.000Z","tags":["gcp","terraform","opentofu"],"images":["/static/images/social-banner.png"],"summary":"GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다.","slug":"20250105-opentofu"},"next":{"title":"OpenTelemetry GcpDetector를 이해하기","date":"2025-01-19T00:00:00.000Z","tags":["gcp","kubernetes","opentelemetry"],"images":["/static/images/social-banner.png"],"summary":"OpenTelemetry Operator로 Auto-Instrumentation을 주입할 수 있다. 그런데 환경변수 설정을 올바르게 하지 않거나 OpenTelemetry Collector에서 proccessor 설정을 제대로 해주지 않으면, Resource attribute중 k8s.namespace.name가 빈문자열로 보내질 수 있다. 이러한 경우에 Auto-Instrumentation에서 Resource attribute가 어떻게 자동으로 설정되는지 resourceDetector들을 이해하면 쉽게 해결할 수 있다. 따라서 이번 글에서는 Resource Detector들에 대해서 자세히 살펴본다.","slug":"20250119-otel-gcp-detector"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20250117-google-oidc-bitbucket"]},"buildId":"aZB0OZMJIIlSfZorUzSCa","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>