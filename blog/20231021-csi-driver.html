<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>aws-ebs-csi-driver 코드로 csi driver 이해하기</title><meta name="robots" content="follow, index"/><meta name="description" content="aws-ebs-csi-driver 소스코드를 보고 csi driver가 하는 역할을 이해해보았다. 크게 Controller plugin과 Node plugin으로 구성되어 있고, 다양한 sidecar container들이 존재한다. 이 sidecar container들이 Volume을 생성하고, 노드에 부착하고, Host 혹은 container directory에 mount하는 것을 진행한다. 이과정에서 CSI driver로 cloud vendor마다 다른 로직으로 그들의 volume을 제어하게 된다. 네이버 클라우드에서 storage가 처음 생성될 때 서버에 부착이 되어야만 하는 제약사항이 있어서, PVC로 PV 동적 할당을 할 때 volumeBindingMode이 Immediate이면 자동으로 Node에 부착이 된다."/><meta property="og:url" content="https://jayground8.github.io/blog/20231021-csi-driver"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="aws-ebs-csi-driver 소스코드를 보고 csi driver가 하는 역할을 이해해보았다. 크게 Controller plugin과 Node plugin으로 구성되어 있고, 다양한 sidecar container들이 존재한다. 이 sidecar container들이 Volume을 생성하고, 노드에 부착하고, Host 혹은 container directory에 mount하는 것을 진행한다. 이과정에서 CSI driver로 cloud vendor마다 다른 로직으로 그들의 volume을 제어하게 된다. 네이버 클라우드에서 storage가 처음 생성될 때 서버에 부착이 되어야만 하는 제약사항이 있어서, PVC로 PV 동적 할당을 할 때 volumeBindingMode이 Immediate이면 자동으로 Node에 부착이 된다."/><meta property="og:title" content="aws-ebs-csi-driver 코드로 csi driver 이해하기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="aws-ebs-csi-driver 코드로 csi driver 이해하기"/><meta name="twitter:description" content="aws-ebs-csi-driver 소스코드를 보고 csi driver가 하는 역할을 이해해보았다. 크게 Controller plugin과 Node plugin으로 구성되어 있고, 다양한 sidecar container들이 존재한다. 이 sidecar container들이 Volume을 생성하고, 노드에 부착하고, Host 혹은 container directory에 mount하는 것을 진행한다. 이과정에서 CSI driver로 cloud vendor마다 다른 로직으로 그들의 volume을 제어하게 된다. 네이버 클라우드에서 storage가 처음 생성될 때 서버에 부착이 되어야만 하는 제약사항이 있어서, PVC로 PV 동적 할당을 할 때 volumeBindingMode이 Immediate이면 자동으로 Node에 부착이 된다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20231021-csi-driver"/><meta property="article:published_time" content="2023-10-21T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20231021-csi-driver"
  },
  "headline": "aws-ebs-csi-driver 코드로 csi driver 이해하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2023-10-21T00:00:00.000Z",
  "dateModified": "2023-10-21T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "aws-ebs-csi-driver 소스코드를 보고 csi driver가 하는 역할을 이해해보았다. 크게 Controller plugin과 Node plugin으로 구성되어 있고, 다양한 sidecar container들이 존재한다. 이 sidecar container들이 Volume을 생성하고, 노드에 부착하고, Host 혹은 container directory에 mount하는 것을 진행한다. 이과정에서 CSI driver로 cloud vendor마다 다른 로직으로 그들의 volume을 제어하게 된다. 네이버 클라우드에서 storage가 처음 생성될 때 서버에 부착이 되어야만 하는 제약사항이 있어서, PVC로 PV 동적 할당을 할 때 volumeBindingMode이 Immediate이면 자동으로 Node에 부착이 된다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6dd7291d49ac5368.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/5rA2lt33gP673HPCttyyC/_buildManifest.js" defer=""></script><script src="/_next/static/5rA2lt33gP673HPCttyyC/_ssgManifest.js" defer=""></script><script src="/_next/static/5rA2lt33gP673HPCttyyC/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-10-21T00:00:00.000Z">2023년 10월 21일 토요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">aws-ebs-csi-driver 코드로 csi driver 이해하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="aws-ebs-csi-driver"><a href="#aws-ebs-csi-driver" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>aws ebs csi driver</h2><p>Kubernetes에서 csi driver는 크게 deployment나 statefulset으로 관리되는 controller plugin과 daemonset으로 관리되는 node plugin으로 구성되어 있다. <a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes/design-proposals-archive/blob/main/storage/container-storage-interface.md#recommended-mechanism-for-deploying-csi-drivers-on-kubernetes">Kubernetes의 design proposals 문서</a>에 아래와 같은 다이아그램 이미지로 잘 설명하고 있다.</p><img src="/static/images/container-storage-interface_diagram1.png" alt="csi diagram"/><p><code>controller</code>라는 이름에서 알 수 있듯이 controller plugin은 API server의 object 변경에 따라서 작업을 해주고, Node plugin은 Node의 kubelet이 csi driver를 통해서 작업을 할 수 있도록 Daemonset으로 Node마다 존재한다.</p><h3 id="controller-plugin"><a href="#controller-plugin" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>controller plugin</h3><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/deploy/kubernetes/base/controller.yaml">aws-ebs-csi-driver</a>의 k8s manifest를 보면 <code>Deployment</code> kind로 정의되어 있는 것을 볼 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> ebs<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>controller
</span><span class="code-line">  <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/name</span><span class="token punctuation">:</span> aws<span class="token punctuation">-</span>ebs<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>driver
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
</span></code></pre></div><p>그리고 아래처럼 6가지의 container들이 정의되어 있는 것도 확인할 수 있다.</p><ul><li>ebs-plugin</li><li>csi-provisioner</li><li>csi-attacher</li><li>csi-snapshotter</li><li>csi-resizer</li><li>liveness-probe</li></ul><h4 id="ebs-plugin"><a href="#ebs-plugin" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ebs-plugin</h4><p>이제 cloud vendor별의 interface가 csi driver에 들어가게 되고, <code>ebs-plugin</code>이 그 부분이다. <a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/pkg/driver/controller.go">aws-ebs-csi-driver의 controller.go</a> 소스 코드를 보면 아래와 같은 method들이 보인다.</p><ul><li>CreateVolume</li><li>DeleteVolume</li><li>ControllerPublishVolume</li><li>ControllerUnpublishVolume</li><li>ControllerExpandVolume</li><li>CreateSnapshot</li><li>DeleteSnapshot</li></ul><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/pkg/driver/driver.go">aws-ebs-csi-driver의 driver.go</a> 소스 코드를 보면 아래처럼 <code>ControllerMode</code>로 설정이 되었을 때 위의 ControllerService의 instance를 만드는 것을 볼 수가 있다. <code>AllMode</code>일 때는 아래처럼 controllerService와 nodeService 모두 instance를 만들어서 설정하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">switch</span> driverOptions<span class="token punctuation">.</span>mode <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">case</span> ControllerMode<span class="token punctuation">:</span>
</span><span class="code-line">		driver<span class="token punctuation">.</span>controllerService <span class="token operator">=</span> <span class="token function">newControllerService</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>driverOptions<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">case</span> NodeMode<span class="token punctuation">:</span>
</span><span class="code-line">		driver<span class="token punctuation">.</span>nodeService <span class="token operator">=</span> <span class="token function">newNodeService</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>driverOptions<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">case</span> AllMode<span class="token punctuation">:</span>
</span><span class="code-line">		driver<span class="token punctuation">.</span>controllerService <span class="token operator">=</span> <span class="token function">newControllerService</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>driverOptions<span class="token punctuation">)</span>
</span><span class="code-line">		driver<span class="token punctuation">.</span>nodeService <span class="token operator">=</span> <span class="token function">newNodeService</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>driverOptions<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">default</span><span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;unknown mode: %s&quot;</span><span class="token punctuation">,</span> driverOptions<span class="token punctuation">.</span>mode<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span></code></pre></div><p>그래서 <a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/deploy/kubernetes/base/controller.yaml">aws-ebs-csi-driver의 controller.yaml</a>을 보면 인자로 driver의 mode를 설정할 수 있다. 기본값이 <code>AllMode</code>이고 controller plugin과 node plugin에서 따로 인자를 설정하지 않고 공용으로 쓰고 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> ebs<span class="token punctuation">-</span>plugin
</span><span class="code-line">    <span class="token atrule key">image</span><span class="token punctuation">:</span> public.ecr.aws/ebs<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>driver/aws<span class="token punctuation">-</span>ebs<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>driver<span class="token punctuation">:</span>v1.24.0
</span><span class="code-line">    <span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
</span><span class="code-line">    <span class="token atrule key">args</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token comment"># - {all,controller,node} # specify the driver mode</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>endpoint=$(CSI_ENDPOINT)
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>logging<span class="token punctuation">-</span>format=text
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>user<span class="token punctuation">-</span>agent<span class="token punctuation">-</span>extra=kustomize
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>v=2
</span></code></pre></div><p>이제 위의 다이아그램 이미지에서 잘 설명한 것처럼, Node plugin은 node에 있는 kubelet과 연결하기 위해서 hostPath를 사용한다. 하지만 controller plugin은 csi-provisioner, csi-attacher, csi-snapshotter, csi-resizer, liveness-probe들이 연결되고 이들이 API server와 통신하기 때문에 emptyDir로 설정된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">volumeMounts</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> socket<span class="token punctuation">-</span>dir
</span><span class="code-line">    <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /var/lib/csi/sockets/pluginproxy/
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> socket<span class="token punctuation">-</span>dir
</span><span class="code-line">    <span class="token atrule key">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><h4 id="csi-provisioner"><a href="#csi-provisioner" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>csi-provisioner</h4><blockquote><p>The external-provisioner is a sidecar container that dynamically provisions volumes by calling <code>CreateVolume</code> and <code>DeleteVolume</code> functions of CSI drivers.</p></blockquote><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/external-provisioner/blob/ae4c14dfe82168a00304ebaf0d991ef61869ab78/pkg/controller/controller.go#L1331">external-provisioner 소스코드 controller.go</a>를 보면 아래처럼 csi driver를 통해서 <code>CreateVolume</code>과 <code>DeleteVolume</code>을 호출하는 것을 확일 할 수 있다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">rep<span class="token punctuation">,</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span>csiClient<span class="token punctuation">.</span><span class="token function">CreateVolume</span><span class="token punctuation">(</span>createCtx<span class="token punctuation">,</span> req<span class="token punctuation">)</span>
</span></code></pre></div><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> p<span class="token punctuation">.</span>csiClient<span class="token punctuation">.</span><span class="token function">DeleteVolume</span><span class="token punctuation">(</span>deleteCtx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span>
</span></code></pre></div><h4 id="csi-attacher"><a href="#csi-attacher" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>csi-attacher</h4><blockquote><p>The CSI external-attacher is a sidecar container that watches the Kubernetes API server for VolumeAttachment objects and triggers Controller[Publish|Unpublish]Volume operations against a CSI endpoint. <a target="_blank" rel="noopener noreferrer" href="https://kubernetes-csi.github.io/docs/external-attacher.html#description">from doc</a></p></blockquote><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/external-attacher/blob/e0704123505a9cd034ca4c38745ee9abf3240e7d/pkg/attacher/attacher.go">external-attacher 소스코드 attacher.go</a>를 보면 아래처럼 csi driver를 통해서 <code>ControllerPublishVolume</code>, <code>ControllerUnpublishVolume</code> 를 호출하는 것을 확인 할 수 있다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>attacher<span class="token punctuation">)</span> <span class="token function">Attach</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> volumeID <span class="token builtin">string</span><span class="token punctuation">,</span> readOnly <span class="token builtin">bool</span><span class="token punctuation">,</span> nodeID <span class="token builtin">string</span><span class="token punctuation">,</span> caps <span class="token operator">*</span>csi<span class="token punctuation">.</span>VolumeCapability<span class="token punctuation">,</span> context<span class="token punctuation">,</span> secrets <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>metadata <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> detached <span class="token builtin">bool</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	req <span class="token operator">:=</span> csi<span class="token punctuation">.</span>ControllerPublishVolumeRequest<span class="token punctuation">{</span>
</span><span class="code-line">		VolumeId<span class="token punctuation">:</span>         volumeID<span class="token punctuation">,</span>
</span><span class="code-line">		NodeId<span class="token punctuation">:</span>           nodeID<span class="token punctuation">,</span>
</span><span class="code-line">		VolumeCapability<span class="token punctuation">:</span> caps<span class="token punctuation">,</span>
</span><span class="code-line">		Readonly<span class="token punctuation">:</span>         readOnly<span class="token punctuation">,</span>
</span><span class="code-line">		VolumeContext<span class="token punctuation">:</span>    context<span class="token punctuation">,</span>
</span><span class="code-line">		Secrets<span class="token punctuation">:</span>          secrets<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	rsp<span class="token punctuation">,</span> err <span class="token operator">:=</span> a<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">ControllerPublishVolume</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token function">isFinalError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> rsp<span class="token punctuation">.</span>PublishContext<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>attacher<span class="token punctuation">)</span> <span class="token function">Detach</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> volumeID <span class="token builtin">string</span><span class="token punctuation">,</span> nodeID <span class="token builtin">string</span><span class="token punctuation">,</span> secrets <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">	req <span class="token operator">:=</span> csi<span class="token punctuation">.</span>ControllerUnpublishVolumeRequest<span class="token punctuation">{</span>
</span><span class="code-line">		VolumeId<span class="token punctuation">:</span> volumeID<span class="token punctuation">,</span>
</span><span class="code-line">		NodeId<span class="token punctuation">:</span>   nodeID<span class="token punctuation">,</span>
</span><span class="code-line">		Secrets<span class="token punctuation">:</span>  secrets<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> a<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">ControllerUnpublishVolume</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">return</span> err
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/external-attacher/blob/master/pkg/controller/controller.go">external-attacher 소스코드 controller.go</a>를 보면 아래처럼 Informer에 VolumeAttachment object가 Add, Update, Delete할 때 수행될 로직을 추가하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">volumeAttachmentInformer<span class="token punctuation">.</span><span class="token function">Informer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddEventHandler</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">{</span>
</span><span class="code-line">  AddFunc<span class="token punctuation">:</span>    ctrl<span class="token punctuation">.</span>vaAdded<span class="token punctuation">,</span>
</span><span class="code-line">  UpdateFunc<span class="token punctuation">:</span> ctrl<span class="token punctuation">.</span>vaUpdated<span class="token punctuation">,</span>
</span><span class="code-line">  DeleteFunc<span class="token punctuation">:</span> ctrl<span class="token punctuation">.</span>vaDeleted<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">pvInformer<span class="token punctuation">.</span><span class="token function">Informer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddEventHandler</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">{</span>
</span><span class="code-line">  AddFunc<span class="token punctuation">:</span>    ctrl<span class="token punctuation">.</span>pvAdded<span class="token punctuation">,</span>
</span><span class="code-line">  UpdateFunc<span class="token punctuation">:</span> ctrl<span class="token punctuation">.</span>pvUpdated<span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token comment">//DeleteFunc: ctrl.pvDeleted, TODO: do we need this?</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/external-attacher/blob/e0704123505a9cd034ca4c38745ee9abf3240e7d/pkg/controller/csi_handler.go">external-attacher 소스코드 cis_handler.go</a>에서 최종적으로 VolumeAttachment에 DeletetionTimestamp 값이 있으면 <code>Detach</code>를 호출하게 되고, 없으면 <code>Attach</code>를 호출하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>csiHandler<span class="token punctuation">)</span> <span class="token function">SyncNewOrUpdatedVolumeAttachment</span><span class="token punctuation">(</span>va <span class="token operator">*</span>storage<span class="token punctuation">.</span>VolumeAttachment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	klog<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;CSIHandler: processing VA %q&quot;</span><span class="token punctuation">,</span> va<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">var</span> err <span class="token builtin">error</span>
</span><span class="code-line">	<span class="token keyword">if</span> va<span class="token punctuation">.</span>DeletionTimestamp <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		err <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">syncAttach</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">		err <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">syncDetach</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token comment">// Re-queue with exponential backoff</span>
</span><span class="code-line">		klog<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Error processing %q: %s&quot;</span><span class="token punctuation">,</span> va<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">		h<span class="token punctuation">.</span>vaQueue<span class="token punctuation">.</span><span class="token function">AddRateLimited</span><span class="token punctuation">(</span>va<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">return</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token comment">// The operation has finished successfully, reset exponential backoff</span>
</span><span class="code-line">	h<span class="token punctuation">.</span>vaQueue<span class="token punctuation">.</span><span class="token function">Forget</span><span class="token punctuation">(</span>va<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
</span><span class="code-line">	klog<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;CSIHandler: finished processing %q&quot;</span><span class="token punctuation">,</span> va<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>csiHandler<span class="token punctuation">)</span> <span class="token function">syncAttach</span><span class="token punctuation">(</span>va <span class="token operator">*</span>storage<span class="token punctuation">.</span>VolumeAttachment<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">  va<span class="token punctuation">,</span> metadata<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">csiAttach</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>csiHandler<span class="token punctuation">)</span> <span class="token function">syncDetach</span><span class="token punctuation">(</span>va <span class="token operator">*</span>storage<span class="token punctuation">.</span>VolumeAttachment<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">  va<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">csiDetach</span><span class="token punctuation">(</span>va<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h4 id="csi-snapshotter"><a href="#csi-snapshotter" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>csi-snapshotter</h4><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">rsp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CreateSnapshot</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span>
</span></code></pre></div><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">DeleteSnapshot</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> err
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/external-snapshotter/blob/37c4599885bb4d1e580c76c74190a34b896a9b1f/pkg/common-controller/snapshot_controller_base.go">snapshot_controller_base.go</a>에서 마찬가지로 VolumeSnapshot Object가 Add, Update, Delete가 되면 <code>CreateSnapshot</code>과 <code>DeleteSnapshot</code>이 실행된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">volumeSnapshotContentInformer<span class="token punctuation">.</span><span class="token function">Informer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddEventHandlerWithResyncPeriod</span><span class="token punctuation">(</span>
</span><span class="code-line">  cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">{</span>
</span><span class="code-line">    AddFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ctrl<span class="token punctuation">.</span><span class="token function">enqueueContentWork</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    UpdateFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>oldObj<span class="token punctuation">,</span> newObj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token comment">// Considering the object is modified more than once during the workflow we are not relying on the</span>
</span><span class="code-line">      <span class="token comment">// &quot;AnnVolumeSnapshotBeingCreated&quot; annotation. Instead we will just check if newobj status has error</span>
</span><span class="code-line">      <span class="token comment">// and avoid the immediate re-queue. This allows the retry to happen with exponential backoff.</span>
</span><span class="code-line">      newSnapContent <span class="token operator">:=</span> newObj<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>crdv1<span class="token punctuation">.</span>VolumeSnapshotContent<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token keyword">if</span> newSnapContent<span class="token punctuation">.</span>Status <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> newSnapContent<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">      ctrl<span class="token punctuation">.</span><span class="token function">enqueueContentWork</span><span class="token punctuation">(</span>newObj<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    DeleteFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ctrl<span class="token punctuation">.</span><span class="token function">enqueueContentWork</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  ctrl<span class="token punctuation">.</span>resyncPeriod<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span></code></pre></div><h4 id="external-resizer"><a href="#external-resizer" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>external-resizer</h4><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/external-resizer/blob/35392a4b8a4dfd7543bd0e3328a524887c1920dd/pkg/csi/client.go">client.go</a>에서 <code>ControllerExpandVolume</code>이 호출되는 걸 확인할 수 있다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>client<span class="token punctuation">)</span> <span class="token function">Expand</span><span class="token punctuation">(</span>
</span><span class="code-line">	ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span>
</span><span class="code-line">	volumeID <span class="token builtin">string</span><span class="token punctuation">,</span>
</span><span class="code-line">	requestBytes <span class="token builtin">int64</span><span class="token punctuation">,</span>
</span><span class="code-line">	secrets <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span>
</span><span class="code-line">	capability <span class="token operator">*</span>csi<span class="token punctuation">.</span>VolumeCapability<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	req <span class="token operator">:=</span> <span class="token operator">&amp;</span>csi<span class="token punctuation">.</span>ControllerExpandVolumeRequest<span class="token punctuation">{</span>
</span><span class="code-line">		Secrets<span class="token punctuation">:</span>          secrets<span class="token punctuation">,</span>
</span><span class="code-line">		VolumeId<span class="token punctuation">:</span>         volumeID<span class="token punctuation">,</span>
</span><span class="code-line">		CapacityRange<span class="token punctuation">:</span>    <span class="token operator">&amp;</span>csi<span class="token punctuation">.</span>CapacityRange<span class="token punctuation">{</span>RequiredBytes<span class="token punctuation">:</span> requestBytes<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		VolumeCapability<span class="token punctuation">:</span> capability<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>ctrlClient<span class="token punctuation">.</span><span class="token function">ControllerExpandVolume</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> resp<span class="token punctuation">.</span>CapacityBytes<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>NodeExpansionRequired<span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>마찬가지로 Informer에 addEventHandler로 Add, Update, Delete 될 때 로직을 추가하였고, 결국은 Workqueue에 들어간 PVC 정보로 필요시에는 위의 <code>Expand</code> 메소드를 호출하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">pvcInformer<span class="token punctuation">.</span><span class="token function">Informer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddEventHandlerWithResyncPeriod</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">{</span>
</span><span class="code-line">  AddFunc<span class="token punctuation">:</span>    ctrl<span class="token punctuation">.</span>addPVC<span class="token punctuation">,</span>
</span><span class="code-line">  UpdateFunc<span class="token punctuation">:</span> ctrl<span class="token punctuation">.</span>updatePVC<span class="token punctuation">,</span>
</span><span class="code-line">  DeleteFunc<span class="token punctuation">:</span> ctrl<span class="token punctuation">.</span>deletePVC<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span> resyncPeriod<span class="token punctuation">)</span>
</span></code></pre></div><h4 id="election"><a href="#election" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>election</h4><p>그리고 controller의 deployment k8s manifest를 보면 replica가 2로 되어 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> ebs<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>controller
</span><span class="code-line">  <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/name</span><span class="token punctuation">:</span> aws<span class="token punctuation">-</span>ebs<span class="token punctuation">-</span>csi<span class="token punctuation">-</span>driver
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
</span></code></pre></div><p>그래서 lead election을 통해서 하나의 pod만 active하게 각 container의 option(<code>--leader-election=true</code>)으로 정의하고 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>provisioner
</span><span class="code-line">  <span class="token atrule key">image</span><span class="token punctuation">:</span> public.ecr.aws/eks<span class="token punctuation">-</span>distro/kubernetes<span class="token punctuation">-</span>csi/external<span class="token punctuation">-</span>provisioner<span class="token punctuation">:</span>v3.5.0<span class="token punctuation">-</span>eks<span class="token punctuation">-</span>1<span class="token punctuation">-</span>28<span class="token punctuation">-</span><span class="token number">6</span>
</span><span class="code-line">  <span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
</span><span class="code-line">  <span class="token atrule key">args</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>csi<span class="token punctuation">-</span>address=$(ADDRESS)
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>v=2
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>feature<span class="token punctuation">-</span>gates=Topology=true
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>extra<span class="token punctuation">-</span>create<span class="token punctuation">-</span>metadata
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>leader<span class="token punctuation">-</span>election=true
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>fstype=ext4
</span></code></pre></div><h3 id="node-plugin"><a href="#node-plugin" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>node plugin</h3><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/pkg/driver/node.go">aws-ebs-csi-driver의 node.go</a>에서는</p><ul><li>NodePublishVolume</li><li>NodeUnpublishVolume</li><li>NodeStageVolume</li><li>NodeUnstageVolume</li></ul><p>NodePublishVolume과 NodeStageVolume이 어떤 일을 하는지 <a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes-csi/docs/issues/24#issuecomment-408342071">Github issue</a>에 설명이 되어 있다.</p><blockquote><p>ControllerPublishVolume is used to attach disk to a node. NodeStageVolume is used to partition and format the disk and mount the disk on a node global directory. NodePublishVolume is used to bind mount the global directory on a container directory.</p></blockquote><p>결국은 pod가 생성되어서 kubelet이 Node host나 container에 mount를 할때 사용되는 것으로 보인다.</p><h4 id="node-driver-registrar"><a href="#node-driver-registrar" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>node-driver-registrar</h4><blockquote><p>The CSI node-driver-registrar is a sidecar container that fetches driver information (using NodeGetInfo) from a CSI endpoint and registers it with the kubelet on that node using the kubelet plugin registration mechanism.</p></blockquote><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>Storage Class에 연결된 PVC object를 생성하면, PV가 자동으로 생성되게 된다. <a target="_blank" rel="noopener noreferrer" href="https://kubernetes-csi.github.io/docs/external-provisioner.html">이 문서</a>에 따르면 <code>external-provisioner</code>가 CSI driver로 volume을 생성하고 PV object를 생성한다고 한다. 🤔 그런데 <code>external-provisioner</code> 소스코드를 보면 PV를 k8s client로 생성하는 것을 찾을 수가 없다. 이부분은 어떤 코드를 봐야 하는 걸까?</p><p>이제 PVC와 PV가 생성되고 나고, VolumeAttachment object가 생성되면 해당 volume이 특정 node에 attach가 된다. <code>external-attacher</code> sidecar container가 VolumeAttachment object를 monitoring하다가 CSI driver로 attach를 한다. 🤔 그런데 PVC와 PV가 생성되고, pod에 <code>persistentVolumeClaim</code>으로 PVC를 설정하면 VolumeAttachment object가 자동으로 생성된다. pod가 생성될 때 pod가 띄는 Node에 attach될 수 있도록 <code>persistentVolumeClaim</code>이 생기는데 어디서 생기는거지?</p><p>PVC의 size를 변경하면 <code>external-resizer</code> sidecar container가 Volume을 업데이트 하게 되고, <code>VolumeSnapshot</code> object를 생성하면 <code>external-snapshotter</code> sidecar container CSI driver로 snapshot을 생성하게 된다.</p><p>마지막으로 kubelet이 volume을 Node host나 container의 directory에 mount할 수 있도록 CSI driver를 연결해주는 <code>node-driver-registrar</code>가 있다. 이렇게 각 sidecar container가 역할을 맞아서 CSI driver로 Volume을 생성하고 attach/mount를 할 수 있게 된다.</p><h2 id="ncloud에서"><a href="#ncloud에서" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>NCloud에서</h2><h3 id="static-pv-provisioning"><a href="#static-pv-provisioning" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>static PV provisioning</h3><p>네이버 클라우드 콘솔에서 Storage를 하나 생성한다. 그리고 아래와 같이 <code>StroageClass</code>를 정의한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> StorageClass
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">storageclass.kubernetes.io/is-default-class</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line"><span class="token atrule key">provisioner</span><span class="token punctuation">:</span> blk.csi.ncloud.com
</span><span class="code-line"><span class="token atrule key">volumeBindingMode</span><span class="token punctuation">:</span> Immediate
</span><span class="code-line"><span class="token atrule key">reclaimPolicy</span><span class="token punctuation">:</span> Retain
</span><span class="code-line"><span class="token atrule key">allowVolumeExpansion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line"><span class="token atrule key">parameters</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> SSD
</span></code></pre></div><p>그다음에 생성된 storage를 통해서 PV를 정의한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> PersistentVolume
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>existing<span class="token punctuation">-</span><span class="token number">01</span>
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">pv.kubernetes.io/provisioned-by</span><span class="token punctuation">:</span> blk.csi.ncloud.com <span class="token comment"># 블록 스토리지와 연동될 provisoner 이름</span>
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">storageClassName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage <span class="token comment"># 블록 스토리지의 스토리지 클래스 이름</span>
</span><span class="code-line">  <span class="token atrule key">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Retain
</span><span class="code-line">  <span class="token atrule key">capacity</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">storage</span><span class="token punctuation">:</span> 10Gi <span class="token comment"># 블록 스토리지 크기</span>
</span><span class="code-line">  <span class="token atrule key">accessModes</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> ReadWriteOnce
</span><span class="code-line">  <span class="token atrule key">csi</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">driver</span><span class="token punctuation">:</span> blk.csi.ncloud.com
</span><span class="code-line">    <span class="token atrule key">fsType</span><span class="token punctuation">:</span> ext4
</span><span class="code-line">    <span class="token atrule key">volumeHandle</span><span class="token punctuation">:</span> <span class="token string">&#x27;999999&#x27;</span> <span class="token comment"># Block Storage Instance ID</span>
</span><span class="code-line">    <span class="token atrule key">volumeAttributes</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">blk.csi.ncloud.com/noformat</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span> <span class="token comment"># 블록스토리지를 포맷하지 않음</span>
</span></code></pre></div><p>그리고 PVC object를 생성한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>pvc
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">accessModes</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> ReadWriteOnce
</span><span class="code-line">  <span class="token atrule key">resources</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">requests</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">storage</span><span class="token punctuation">:</span> 10Gi
</span><span class="code-line">  <span class="token atrule key">storageClassName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage
</span></code></pre></div><p>네이버 클라우드의 storage 정보를 보면, 아래와 같이 연결정보가 없는 것을 확인 할 수 있다.</p><img src="/static/images/naver-cloud-storage-info.png" alt="naver cloud storage console"/><p>마지막으로 <code>VolumeAttachment</code> object를 생성해주면 연결정보가 <code>nodeName</code>로 연결된 것을 확인 할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> VolumeAttachment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> test
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">attacher</span><span class="token punctuation">:</span> blk.csi.ncloud.com
</span><span class="code-line">  <span class="token atrule key">nodeName</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span><span class="token number">01</span>
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">persistentVolumeName</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>existing<span class="token punctuation">-</span><span class="token number">01</span>
</span></code></pre></div><h3 id="dynamic-provisioning"><a href="#dynamic-provisioning" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>dynamic provisioning</h3><p>StorageClass의 volumeBindingMode를 Immediate로 설정한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> StorageClass
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">storageclass.kubernetes.io/is-default-class</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line"><span class="token atrule key">provisioner</span><span class="token punctuation">:</span> blk.csi.ncloud.com
</span><span class="code-line"><span class="token atrule key">volumeBindingMode</span><span class="token punctuation">:</span> Immediate
</span><span class="code-line"><span class="token atrule key">reclaimPolicy</span><span class="token punctuation">:</span> Retain
</span><span class="code-line"><span class="token atrule key">allowVolumeExpansion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line"><span class="token atrule key">parameters</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> SSD
</span></code></pre></div><p>그리고 PVC object를 생성하면 dynamic하게 PV가 생성되고, 네이버 클라우드에 storage가 생성된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> csi<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>pvc
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">accessModes</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> ReadWriteOnce
</span><span class="code-line">  <span class="token atrule key">resources</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">requests</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">storage</span><span class="token punctuation">:</span> 10Gi
</span><span class="code-line">  <span class="token atrule key">storageClassName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage
</span></code></pre></div><p>🤔 그런데 VolumeAttachment object가 없는데도, storage 연결정보에서 node가 연결되어 있다. 이것이 의도한 결과인가? (네이버 클라우드에서 Block storage를 생성할 때 서버에 부착이 되어야 하는 상황이라 Immediate로 PV가 생성될 때 자동으로 Node에 부착된다. 하지만 Pod에 PVC로 연결하면 이제 해당 Pod가 돌고 있는 노드로 다시 재부착이 된다.)</p><p><a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/concepts/storage/storage-classes/#volume-binding-mode">문서</a>에 아래처럼 설명되어 있다.</p><blockquote><p>The Immediate mode indicates that volume binding and dynamic provisioning occurs once the PersistentVolumeClaim is created.</p></blockquote><p>아래처럼 volumeBindingMode를 <code>WaitForFirstConsumer</code>로 설정하면, pod가 PVC를 사용할 때까지 Pending 상태가 있다가 사용하면 pod의 Node에 붙게 된다. PV와 VolumeAttachment object가 같이 생기게 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> StorageClass
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">storageclass.kubernetes.io/is-default-class</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line"><span class="token atrule key">provisioner</span><span class="token punctuation">:</span> blk.csi.ncloud.com
</span><span class="code-line"><span class="token atrule key">volumeBindingMode</span><span class="token punctuation">:</span> WaitForFirstConsumer
</span><span class="code-line"><span class="token atrule key">reclaimPolicy</span><span class="token punctuation">:</span> Retain
</span><span class="code-line"><span class="token atrule key">allowVolumeExpansion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line"><span class="token atrule key">parameters</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> SSD
</span></code></pre></div><h3 id="snapshot"><a href="#snapshot" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>snapshot</h3><p>StorageClass와 마찬가지로 VolumeSnapshotClass도 default로 하나 만들어져 있다. 따라서 아래처럼 object를 생성하면 snapshot이 만들어진다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> snapshot.storage.k8s.io/v1beta1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> VolumeSnapshot
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> new<span class="token punctuation">-</span>snapshot<span class="token punctuation">-</span>test
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">volumeSnapshotClassName</span><span class="token punctuation">:</span> nks<span class="token punctuation">-</span>block<span class="token punctuation">-</span>storage
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">persistentVolumeClaimName</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>name
</span></code></pre></div><p>snapshot을 주기적으로 하고, 최신 몇개만 유지하고 싶은데 보니깐 여러 사람들이 Custom Controller로 만든 것들이 보인다. Custom Controller를 직접 만들어 보는 것도 재미있겠다. 😋</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231014-ncloud-certificate-manater">네이버 클라우드 certificate manager에 Lets encrypt 인증서 등록하기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231029-gpu-on-k8s">Kubernetes에서 GPU 사용하기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var m=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of p(s))!h.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},g=a=\u003ek(t(l(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((C,i)=\u003e{i.exports=_jsx_runtime});var f={};N(f,{default:()=\u003ev,frontmatter:()=\u003eb});var n=g(o()),b={title:\"aws-ebs-csi-driver \\uCF54\\uB4DC\\uB85C csi driver \\uC774\\uD574\\uD558\\uAE30\",date:\"2023-10-21\",tags:[\"kubernetes\"],images:[\"/static/images/social-banner.png\"],summary:\"aws-ebs-csi-driver \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB97C \\uBCF4\\uACE0 csi driver\\uAC00 \\uD558\\uB294 \\uC5ED\\uD560\\uC744 \\uC774\\uD574\\uD574\\uBCF4\\uC558\\uB2E4. \\uD06C\\uAC8C Controller plugin\\uACFC Node plugin\\uC73C\\uB85C \\uAD6C\\uC131\\uB418\\uC5B4 \\uC788\\uACE0, \\uB2E4\\uC591\\uD55C sidecar container\\uB4E4\\uC774 \\uC874\\uC7AC\\uD55C\\uB2E4. \\uC774 sidecar container\\uB4E4\\uC774 Volume\\uC744 \\uC0DD\\uC131\\uD558\\uACE0, \\uB178\\uB4DC\\uC5D0 \\uBD80\\uCC29\\uD558\\uACE0, Host \\uD639\\uC740 container directory\\uC5D0 mount\\uD558\\uB294 \\uAC83\\uC744 \\uC9C4\\uD589\\uD55C\\uB2E4. \\uC774\\uACFC\\uC815\\uC5D0\\uC11C CSI driver\\uB85C cloud vendor\\uB9C8\\uB2E4 \\uB2E4\\uB978 \\uB85C\\uC9C1\\uC73C\\uB85C \\uADF8\\uB4E4\\uC758 volume\\uC744 \\uC81C\\uC5B4\\uD558\\uAC8C \\uB41C\\uB2E4. \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC5D0\\uC11C storage\\uAC00 \\uCC98\\uC74C \\uC0DD\\uC131\\uB420 \\uB54C \\uC11C\\uBC84\\uC5D0 \\uBD80\\uCC29\\uC774 \\uB418\\uC5B4\\uC57C\\uB9CC \\uD558\\uB294 \\uC81C\\uC57D\\uC0AC\\uD56D\\uC774 \\uC788\\uC5B4\\uC11C, PVC\\uB85C PV \\uB3D9\\uC801 \\uD560\\uB2F9\\uC744 \\uD560 \\uB54C volumeBindingMode\\uC774 Immediate\\uC774\\uBA74 \\uC790\\uB3D9\\uC73C\\uB85C Node\\uC5D0 \\uBD80\\uCC29\\uC774 \\uB41C\\uB2E4.\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",h3:\"h3\",pre:\"pre\",ul:\"ul\",li:\"li\",h4:\"h4\",blockquote:\"blockquote\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"aws-ebs-csi-driver\",children:[(0,n.jsx)(e.a,{href:\"#aws-ebs-csi-driver\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"aws ebs csi driver\"]}),(0,n.jsxs)(e.p,{children:[\"Kubernetes\\uC5D0\\uC11C csi driver\\uB294 \\uD06C\\uAC8C deployment\\uB098 statefulset\\uC73C\\uB85C \\uAD00\\uB9AC\\uB418\\uB294 controller plugin\\uACFC daemonset\\uC73C\\uB85C \\uAD00\\uB9AC\\uB418\\uB294 node plugin\\uC73C\\uB85C \\uAD6C\\uC131\\uB418\\uC5B4 \\uC788\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes/design-proposals-archive/blob/main/storage/container-storage-interface.md#recommended-mechanism-for-deploying-csi-drivers-on-kubernetes\",children:\"Kubernetes\\uC758 design proposals \\uBB38\\uC11C\"}),\"\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uB2E4\\uC774\\uC544\\uADF8\\uB7A8 \\uC774\\uBBF8\\uC9C0\\uB85C \\uC798 \\uC124\\uBA85\\uD558\\uACE0 \\uC788\\uB2E4.\"]}),(0,n.jsx)(\"img\",{src:\"/static/images/container-storage-interface_diagram1.png\",alt:\"csi diagram\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"controller\"}),\"\\uB77C\\uB294 \\uC774\\uB984\\uC5D0\\uC11C \\uC54C \\uC218 \\uC788\\uB4EF\\uC774 controller plugin\\uC740 API server\\uC758 object \\uBCC0\\uACBD\\uC5D0 \\uB530\\uB77C\\uC11C \\uC791\\uC5C5\\uC744 \\uD574\\uC8FC\\uACE0, Node plugin\\uC740 Node\\uC758 kubelet\\uC774 csi driver\\uB97C \\uD1B5\\uD574\\uC11C \\uC791\\uC5C5\\uC744 \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D Daemonset\\uC73C\\uB85C Node\\uB9C8\\uB2E4 \\uC874\\uC7AC\\uD55C\\uB2E4.\"]}),(0,n.jsxs)(e.h3,{id:\"controller-plugin\",children:[(0,n.jsx)(e.a,{href:\"#controller-plugin\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"controller plugin\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/deploy/kubernetes/base/controller.yaml\",children:\"aws-ebs-csi-driver\"}),\"\\uC758 k8s manifest\\uB97C \\uBCF4\\uBA74 \",(0,n.jsx)(e.code,{children:\"Deployment\"}),\" kind\\uB85C \\uC815\\uC758\\uB418\\uC5B4 \\uC788\\uB294 \\uAC83\\uC744 \\uBCFC \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`controller\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"labels\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"app.kubernetes.io/name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" aws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`driver\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"replicas\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uADF8\\uB9AC\\uACE0 \\uC544\\uB798\\uCC98\\uB7FC 6\\uAC00\\uC9C0\\uC758 container\\uB4E4\\uC774 \\uC815\\uC758\\uB418\\uC5B4 \\uC788\\uB294 \\uAC83\\uB3C4 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"ebs-plugin\"}),(0,n.jsx)(e.li,{children:\"csi-provisioner\"}),(0,n.jsx)(e.li,{children:\"csi-attacher\"}),(0,n.jsx)(e.li,{children:\"csi-snapshotter\"}),(0,n.jsx)(e.li,{children:\"csi-resizer\"}),(0,n.jsx)(e.li,{children:\"liveness-probe\"})]}),(0,n.jsxs)(e.h4,{id:\"ebs-plugin\",children:[(0,n.jsx)(e.a,{href:\"#ebs-plugin\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"ebs-plugin\"]}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C cloud vendor\\uBCC4\\uC758 interface\\uAC00 csi driver\\uC5D0 \\uB4E4\\uC5B4\\uAC00\\uAC8C \\uB418\\uACE0, \",(0,n.jsx)(e.code,{children:\"ebs-plugin\"}),\"\\uC774 \\uADF8 \\uBD80\\uBD84\\uC774\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/pkg/driver/controller.go\",children:\"aws-ebs-csi-driver\\uC758 controller.go\"}),\" \\uC18C\\uC2A4 \\uCF54\\uB4DC\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC740 method\\uB4E4\\uC774 \\uBCF4\\uC778\\uB2E4.\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"CreateVolume\"}),(0,n.jsx)(e.li,{children:\"DeleteVolume\"}),(0,n.jsx)(e.li,{children:\"ControllerPublishVolume\"}),(0,n.jsx)(e.li,{children:\"ControllerUnpublishVolume\"}),(0,n.jsx)(e.li,{children:\"ControllerExpandVolume\"}),(0,n.jsx)(e.li,{children:\"CreateSnapshot\"}),(0,n.jsx)(e.li,{children:\"DeleteSnapshot\"})]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/pkg/driver/driver.go\",children:\"aws-ebs-csi-driver\\uC758 driver.go\"}),\" \\uC18C\\uC2A4 \\uCF54\\uB4DC\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"ControllerMode\"}),\"\\uB85C \\uC124\\uC815\\uC774 \\uB418\\uC5C8\\uC744 \\uB54C \\uC704\\uC758 ControllerService\\uC758 instance\\uB97C \\uB9CC\\uB4DC\\uB294 \\uAC83\\uC744 \\uBCFC \\uC218\\uAC00 \\uC788\\uB2E4. \",(0,n.jsx)(e.code,{children:\"AllMode\"}),\"\\uC77C \\uB54C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC controllerService\\uC640 nodeService \\uBAA8\\uB450 instance\\uB97C \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uC124\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"switch\"}),\" driverOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mode \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" ControllerMode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"controllerService \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newControllerService\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"driverOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" NodeMode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nodeService \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newNodeService\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"driverOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" AllMode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"controllerService \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newControllerService\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"driverOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tdriver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"nodeService \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newNodeService\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"driverOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"unknown mode: %s\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" driverOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"mode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB798\\uC11C \",(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/deploy/kubernetes/base/controller.yaml\",children:\"aws-ebs-csi-driver\\uC758 controller.yaml\"}),\"\\uC744 \\uBCF4\\uBA74 \\uC778\\uC790\\uB85C driver\\uC758 mode\\uB97C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uAE30\\uBCF8\\uAC12\\uC774 \",(0,n.jsx)(e.code,{children:\"AllMode\"}),\"\\uC774\\uACE0 controller plugin\\uACFC node plugin\\uC5D0\\uC11C \\uB530\\uB85C \\uC778\\uC790\\uB97C \\uC124\\uC815\\uD558\\uC9C0 \\uC54A\\uACE0 \\uACF5\\uC6A9\\uC73C\\uB85C \\uC4F0\\uACE0 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`plugin\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" public.ecr.aws/ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"driver/aws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"driver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`v1.24.0\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` IfNotPresent\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"args\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# - {all,controller,node} # specify the driver mode\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`endpoint=$(CSI_ENDPOINT)\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"logging\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`format=text\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"agent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`extra=kustomize\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`v=2\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C \\uC704\\uC758 \\uB2E4\\uC774\\uC544\\uADF8\\uB7A8 \\uC774\\uBBF8\\uC9C0\\uC5D0\\uC11C \\uC798 \\uC124\\uBA85\\uD55C \\uAC83\\uCC98\\uB7FC, Node plugin\\uC740 node\\uC5D0 \\uC788\\uB294 kubelet\\uACFC \\uC5F0\\uACB0\\uD558\\uAE30 \\uC704\\uD574\\uC11C hostPath\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4. \\uD558\\uC9C0\\uB9CC controller plugin\\uC740 csi-provisioner, csi-attacher, csi-snapshotter, csi-resizer, liveness-probe\\uB4E4\\uC774 \\uC5F0\\uACB0\\uB418\\uACE0 \\uC774\\uB4E4\\uC774 API server\\uC640 \\uD1B5\\uC2E0\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 emptyDir\\uB85C \\uC124\\uC815\\uB41C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" socket\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`dir\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` /var/lib/csi/sockets/pluginproxy/\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" socket\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`dir\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"emptyDir\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h4,{id:\"csi-provisioner\",children:[(0,n.jsx)(e.a,{href:\"#csi-provisioner\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"csi-provisioner\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"The external-provisioner is a sidecar container that dynamically provisions volumes by calling \",(0,n.jsx)(e.code,{children:\"CreateVolume\"}),\" and \",(0,n.jsx)(e.code,{children:\"DeleteVolume\"}),\" functions of CSI drivers.\"]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/external-provisioner/blob/ae4c14dfe82168a00304ebaf0d991ef61869ab78/pkg/controller/controller.go#L1331\",children:\"external-provisioner \\uC18C\\uC2A4\\uCF54\\uB4DC controller.go\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC csi driver\\uB97C \\uD1B5\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"CreateVolume\"}),\"\\uACFC \",(0,n.jsx)(e.code,{children:\"DeleteVolume\"}),\"\\uC744 \\uD638\\uCD9C\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC77C \\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"rep\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" p\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"csiClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"CreateVolume\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"createCtx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" p\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"csiClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DeleteVolume\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"deleteCtx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h4,{id:\"csi-attacher\",children:[(0,n.jsx)(e.a,{href:\"#csi-attacher\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"csi-attacher\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsxs)(e.p,{children:[\"The CSI external-attacher is a sidecar container that watches the Kubernetes API server for VolumeAttachment objects and triggers Controller[Publish|Unpublish]Volume operations against a CSI endpoint. \",(0,n.jsx)(e.a,{href:\"https://kubernetes-csi.github.io/docs/external-attacher.html#description\",children:\"from doc\"})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/external-attacher/blob/e0704123505a9cd034ca4c38745ee9abf3240e7d/pkg/attacher/attacher.go\",children:\"external-attacher \\uC18C\\uC2A4\\uCF54\\uB4DC attacher.go\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC csi driver\\uB97C \\uD1B5\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"ControllerPublishVolume\"}),\", \",(0,n.jsx)(e.code,{children:\"ControllerUnpublishVolume\"}),\" \\uB97C \\uD638\\uCD9C\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"attacher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Attach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" volumeID \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" readOnly \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bool\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nodeID \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" caps \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VolumeCapability\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" secrets \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"metadata \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" detached \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bool\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\treq \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ControllerPublishVolumeRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tVolumeId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"         volumeID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tNodeId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"           nodeID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tVolumeCapability\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" caps\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tReadonly\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"         readOnly\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tVolumeContext\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tSecrets\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"          secrets\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\trsp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ControllerPublishVolume\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"isFinalError\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" rsp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PublishContext\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"attacher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Detach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" volumeID \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nodeID \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" secrets \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\treq \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ControllerUnpublishVolumeRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tVolumeId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" volumeID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tNodeId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   nodeID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tSecrets\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"  secrets\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ControllerUnpublishVolume\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/external-attacher/blob/master/pkg/controller/controller.go\",children:\"external-attacher \\uC18C\\uC2A4\\uCF54\\uB4DC controller.go\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC Informer\\uC5D0 VolumeAttachment object\\uAC00 Add, Update, Delete\\uD560 \\uB54C \\uC218\\uD589\\uB420 \\uB85C\\uC9C1\\uC744 \\uCD94\\uAC00\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"volumeAttachmentInformer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Informer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddEventHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceEventHandlerFuncs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  AddFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"vaAdded\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  UpdateFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"vaUpdated\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  DeleteFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"vaDeleted\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"pvInformer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Informer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddEventHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceEventHandlerFuncs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  AddFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pvAdded\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  UpdateFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pvUpdated\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"//DeleteFunc: ctrl.pvDeleted, TODO: do we need this?\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/external-attacher/blob/e0704123505a9cd034ca4c38745ee9abf3240e7d/pkg/controller/csi_handler.go\",children:\"external-attacher \\uC18C\\uC2A4\\uCF54\\uB4DC cis_handler.go\"}),\"\\uC5D0\\uC11C \\uCD5C\\uC885\\uC801\\uC73C\\uB85C VolumeAttachment\\uC5D0 DeletetionTimestamp \\uAC12\\uC774 \\uC788\\uC73C\\uBA74 \",(0,n.jsx)(e.code,{children:\"Detach\"}),\"\\uB97C \\uD638\\uCD9C\\uD558\\uAC8C \\uB418\\uACE0, \\uC5C6\\uC73C\\uBA74 \",(0,n.jsx)(e.code,{children:\"Attach\"}),\"\\uB97C \\uD638\\uCD9C\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"h \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"csiHandler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SyncNewOrUpdatedVolumeAttachment\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"storage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VolumeAttachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tklog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"V\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Infof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"CSIHandler: processing VA %q\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" err \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"DeletionTimestamp \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" h\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"syncAttach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" h\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"syncDetach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Re-queue with exponential backoff\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tklog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"V\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Infof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Error processing %q: %s\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\th\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"vaQueue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddRateLimited\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// The operation has finished successfully, reset exponential backoff\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\th\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"vaQueue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Forget\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tklog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"V\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Infof\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"CSIHandler: finished processing %q\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"h \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"csiHandler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"syncAttach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"storage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VolumeAttachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" metadata\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" h\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"csiAttach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"h \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"csiHandler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"syncDetach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"storage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VolumeAttachment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" h\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"csiDetach\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"va\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h4,{id:\"csi-snapshotter\",children:[(0,n.jsx)(e.a,{href:\"#csi-snapshotter\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"csi-snapshotter\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"rsp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"CreateSnapshot\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DeleteSnapshot\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/external-snapshotter/blob/37c4599885bb4d1e580c76c74190a34b896a9b1f/pkg/common-controller/snapshot_controller_base.go\",children:\"snapshot_controller_base.go\"}),\"\\uC5D0\\uC11C \\uB9C8\\uCC2C\\uAC00\\uC9C0\\uB85C VolumeSnapshot Object\\uAC00 Add, Update, Delete\\uAC00 \\uB418\\uBA74 \",(0,n.jsx)(e.code,{children:\"CreateSnapshot\"}),\"\\uACFC \",(0,n.jsx)(e.code,{children:\"DeleteSnapshot\"}),\"\\uC774 \\uC2E4\\uD589\\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"volumeSnapshotContentInformer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Informer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddEventHandlerWithResyncPeriod\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceEventHandlerFuncs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    AddFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"enqueueContentWork\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    UpdateFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"oldObj\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" newObj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Considering the object is modified more than once during the workflow we are not relying on the\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// \"AnnVolumeSnapshotBeingCreated\" annotation. Instead we will just check if newobj status has error'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// and avoid the immediate re-queue. This allows the retry to happen with exponential backoff.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      newSnapContent \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" newObj\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"crdv1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VolumeSnapshotContent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" newSnapContent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" newSnapContent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Error \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"enqueueContentWork\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"newObj\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    DeleteFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"enqueueContentWork\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"resyncPeriod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h4,{id:\"external-resizer\",children:[(0,n.jsx)(e.a,{href:\"#external-resizer\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"external-resizer\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/external-resizer/blob/35392a4b8a4dfd7543bd0e3328a524887c1920dd/pkg/csi/client.go\",children:\"client.go\"}),\"\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"ControllerExpandVolume\"}),\"\\uC774 \\uD638\\uCD9C\\uB418\\uB294 \\uAC78 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Expand\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tvolumeID \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\trequestBytes \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tsecrets \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tcapability \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VolumeCapability\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bool\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\treq \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ControllerExpandVolumeRequest\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tSecrets\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"          secrets\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tVolumeId\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"         volumeID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tCapacityRange\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CapacityRange\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"RequiredBytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" requestBytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tVolumeCapability\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" capability\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tresp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ctrlClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ControllerExpandVolume\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" resp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CapacityBytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" resp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NodeExpansionRequired\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uB9C8\\uCC2C\\uAC00\\uC9C0\\uB85C Informer\\uC5D0 addEventHandler\\uB85C Add, Update, Delete \\uB420 \\uB54C \\uB85C\\uC9C1\\uC744 \\uCD94\\uAC00\\uD558\\uC600\\uACE0, \\uACB0\\uAD6D\\uC740 Workqueue\\uC5D0 \\uB4E4\\uC5B4\\uAC04 PVC \\uC815\\uBCF4\\uB85C \\uD544\\uC694\\uC2DC\\uC5D0\\uB294 \\uC704\\uC758 \",(0,n.jsx)(e.code,{children:\"Expand\"}),\" \\uBA54\\uC18C\\uB4DC\\uB97C \\uD638\\uCD9C\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"pvcInformer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Informer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddEventHandlerWithResyncPeriod\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceEventHandlerFuncs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  AddFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"addPVC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  UpdateFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"updatePVC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  DeleteFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"deletePVC\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" resyncPeriod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h4,{id:\"election\",children:[(0,n.jsx)(e.a,{href:\"#election\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"election\"]}),(0,n.jsx)(e.p,{children:\"\\uADF8\\uB9AC\\uACE0 controller\\uC758 deployment k8s manifest\\uB97C \\uBCF4\\uBA74 replica\\uAC00 2\\uB85C \\uB418\\uC5B4 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`controller\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"labels\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"app.kubernetes.io/name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" aws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"ebs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`driver\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"replicas\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB798\\uC11C lead election\\uC744 \\uD1B5\\uD574\\uC11C \\uD558\\uB098\\uC758 pod\\uB9CC active\\uD558\\uAC8C \\uAC01 container\\uC758 option(\",(0,n.jsx)(e.code,{children:\"--leader-election=true\"}),\")\\uC73C\\uB85C \\uC815\\uC758\\uD558\\uACE0 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`provisioner\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" public.ecr.aws/eks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"distro/kubernetes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi/external\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"provisioner\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"v3.5.0\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"eks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"28\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"6\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` IfNotPresent\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"args\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`address=$(ADDRESS)\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`v=2\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"feature\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`gates=Topology=true\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"extra\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"create\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`metadata\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"leader\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`election=true\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"default\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`fstype=ext4\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"node-plugin\",children:[(0,n.jsx)(e.a,{href:\"#node-plugin\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"node plugin\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/pkg/driver/node.go\",children:\"aws-ebs-csi-driver\\uC758 node.go\"}),\"\\uC5D0\\uC11C\\uB294\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"NodePublishVolume\"}),(0,n.jsx)(e.li,{children:\"NodeUnpublishVolume\"}),(0,n.jsx)(e.li,{children:\"NodeStageVolume\"}),(0,n.jsx)(e.li,{children:\"NodeUnstageVolume\"})]}),(0,n.jsxs)(e.p,{children:[\"NodePublishVolume\\uACFC NodeStageVolume\\uC774 \\uC5B4\\uB5A4 \\uC77C\\uC744 \\uD558\\uB294\\uC9C0 \",(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes-csi/docs/issues/24#issuecomment-408342071\",children:\"Github issue\"}),\"\\uC5D0 \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"ControllerPublishVolume is used to attach disk to a node. NodeStageVolume is used to partition and format the disk and mount the disk on a node global directory. NodePublishVolume is used to bind mount the global directory on a container directory.\"})}),(0,n.jsx)(e.p,{children:\"\\uACB0\\uAD6D\\uC740 pod\\uAC00 \\uC0DD\\uC131\\uB418\\uC5B4\\uC11C kubelet\\uC774 Node host\\uB098 container\\uC5D0 mount\\uB97C \\uD560\\uB54C \\uC0AC\\uC6A9\\uB418\\uB294 \\uAC83\\uC73C\\uB85C \\uBCF4\\uC778\\uB2E4.\"}),(0,n.jsxs)(e.h4,{id:\"node-driver-registrar\",children:[(0,n.jsx)(e.a,{href:\"#node-driver-registrar\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"node-driver-registrar\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"The CSI node-driver-registrar is a sidecar container that fetches driver information (using NodeGetInfo) from a CSI endpoint and registers it with the kubelet on that node using the kubelet plugin registration mechanism.\"})}),(0,n.jsxs)(e.h2,{id:\"\\uACB0\\uB860\",children:[(0,n.jsx)(e.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,n.jsxs)(e.p,{children:[\"Storage Class\\uC5D0 \\uC5F0\\uACB0\\uB41C PVC object\\uB97C \\uC0DD\\uC131\\uD558\\uBA74, PV\\uAC00 \\uC790\\uB3D9\\uC73C\\uB85C \\uC0DD\\uC131\\uB418\\uAC8C \\uB41C\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://kubernetes-csi.github.io/docs/external-provisioner.html\",children:\"\\uC774 \\uBB38\\uC11C\"}),\"\\uC5D0 \\uB530\\uB974\\uBA74 \",(0,n.jsx)(e.code,{children:\"external-provisioner\"}),\"\\uAC00 CSI driver\\uB85C volume\\uC744 \\uC0DD\\uC131\\uD558\\uACE0 PV object\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4\\uACE0 \\uD55C\\uB2E4. \\u{1F914} \\uADF8\\uB7F0\\uB370 \",(0,n.jsx)(e.code,{children:\"external-provisioner\"}),\" \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB97C \\uBCF4\\uBA74 PV\\uB97C k8s client\\uB85C \\uC0DD\\uC131\\uD558\\uB294 \\uAC83\\uC744 \\uCC3E\\uC744 \\uC218\\uAC00 \\uC5C6\\uB2E4. \\uC774\\uBD80\\uBD84\\uC740 \\uC5B4\\uB5A4 \\uCF54\\uB4DC\\uB97C \\uBD10\\uC57C \\uD558\\uB294 \\uAC78\\uAE4C?\"]}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C PVC\\uC640 PV\\uAC00 \\uC0DD\\uC131\\uB418\\uACE0 \\uB098\\uACE0, VolumeAttachment object\\uAC00 \\uC0DD\\uC131\\uB418\\uBA74 \\uD574\\uB2F9 volume\\uC774 \\uD2B9\\uC815 node\\uC5D0 attach\\uAC00 \\uB41C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"external-attacher\"}),\" sidecar container\\uAC00 VolumeAttachment object\\uB97C monitoring\\uD558\\uB2E4\\uAC00 CSI driver\\uB85C attach\\uB97C \\uD55C\\uB2E4. \\u{1F914} \\uADF8\\uB7F0\\uB370 PVC\\uC640 PV\\uAC00 \\uC0DD\\uC131\\uB418\\uACE0, pod\\uC5D0 \",(0,n.jsx)(e.code,{children:\"persistentVolumeClaim\"}),\"\\uC73C\\uB85C PVC\\uB97C \\uC124\\uC815\\uD558\\uBA74 VolumeAttachment object\\uAC00 \\uC790\\uB3D9\\uC73C\\uB85C \\uC0DD\\uC131\\uB41C\\uB2E4. pod\\uAC00 \\uC0DD\\uC131\\uB420 \\uB54C pod\\uAC00 \\uB744\\uB294 Node\\uC5D0 attach\\uB420 \\uC218 \\uC788\\uB3C4\\uB85D \",(0,n.jsx)(e.code,{children:\"persistentVolumeClaim\"}),\"\\uC774 \\uC0DD\\uAE30\\uB294\\uB370 \\uC5B4\\uB514\\uC11C \\uC0DD\\uAE30\\uB294\\uAC70\\uC9C0?\"]}),(0,n.jsxs)(e.p,{children:[\"PVC\\uC758 size\\uB97C \\uBCC0\\uACBD\\uD558\\uBA74 \",(0,n.jsx)(e.code,{children:\"external-resizer\"}),\" sidecar container\\uAC00 Volume\\uC744 \\uC5C5\\uB370\\uC774\\uD2B8 \\uD558\\uAC8C \\uB418\\uACE0, \",(0,n.jsx)(e.code,{children:\"VolumeSnapshot\"}),\" object\\uB97C \\uC0DD\\uC131\\uD558\\uBA74 \",(0,n.jsx)(e.code,{children:\"external-snapshotter\"}),\" sidecar container CSI driver\\uB85C snapshot\\uC744 \\uC0DD\\uC131\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C kubelet\\uC774 volume\\uC744 Node host\\uB098 container\\uC758 directory\\uC5D0 mount\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D CSI driver\\uB97C \\uC5F0\\uACB0\\uD574\\uC8FC\\uB294 \",(0,n.jsx)(e.code,{children:\"node-driver-registrar\"}),\"\\uAC00 \\uC788\\uB2E4. \\uC774\\uB807\\uAC8C \\uAC01 sidecar container\\uAC00 \\uC5ED\\uD560\\uC744 \\uB9DE\\uC544\\uC11C CSI driver\\uB85C Volume\\uC744 \\uC0DD\\uC131\\uD558\\uACE0 attach/mount\\uB97C \\uD560 \\uC218 \\uC788\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsxs)(e.h2,{id:\"ncloud\\uC5D0\\uC11C\",children:[(0,n.jsx)(e.a,{href:\"#ncloud\\uC5D0\\uC11C\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"NCloud\\uC5D0\\uC11C\"]}),(0,n.jsxs)(e.h3,{id:\"static-pv-provisioning\",children:[(0,n.jsx)(e.a,{href:\"#static-pv-provisioning\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"static PV provisioning\"]}),(0,n.jsxs)(e.p,{children:[\"\\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC \\uCF58\\uC194\\uC5D0\\uC11C Storage\\uB97C \\uD558\\uB098 \\uC0DD\\uC131\\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,n.jsx)(e.code,{children:\"StroageClass\"}),\"\\uB97C \\uC815\\uC758\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` StorageClass\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` storage.k8s.io/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`storage\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" kube\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`system\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storageclass.kubernetes.io/is-default-class\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"provisioner\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blk.csi.ncloud.com\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeBindingMode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Immediate\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"reclaimPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Retain\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"allowVolumeExpansion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parameters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` SSD\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uADF8\\uB2E4\\uC74C\\uC5D0 \\uC0DD\\uC131\\uB41C storage\\uB97C \\uD1B5\\uD574\\uC11C PV\\uB97C \\uC815\\uC758\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` PersistentVolume\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" volume\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"existing\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"01\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"pv.kubernetes.io/provisioned-by\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blk.csi.ncloud.com \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\uBE14\\uB85D \\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uC640 \\uC5F0\\uB3D9\\uB420 provisoner \\uC774\\uB984\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storageClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"storage \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\uBE14\\uB85D \\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uC758 \\uC2A4\\uD1A0\\uB9AC\\uC9C0 \\uD074\\uB798\\uC2A4 \\uC774\\uB984\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"persistentVolumeReclaimPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Retain\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"capacity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" 10Gi \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\uBE14\\uB85D \\uC2A4\\uD1A0\\uB9AC\\uC9C0 \\uD06C\\uAE30\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"accessModes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` ReadWriteOnce\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"csi\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"driver\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blk.csi.ncloud.com\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"fsType\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` ext4\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeHandle\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'999999'\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Block Storage Instance ID\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeAttributes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"blk.csi.ncloud.com/noformat\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'true'\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# \\uBE14\\uB85D\\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uB97C \\uD3EC\\uB9F7\\uD558\\uC9C0 \\uC54A\\uC74C\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uADF8\\uB9AC\\uACE0 PVC object\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` PersistentVolumeClaim\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`pvc\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"accessModes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` ReadWriteOnce\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"resources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"requests\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` 10Gi\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storageClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`storage\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC758 storage \\uC815\\uBCF4\\uB97C \\uBCF4\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC5F0\\uACB0\\uC815\\uBCF4\\uAC00 \\uC5C6\\uB294 \\uAC83\\uC744 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(\"img\",{src:\"/static/images/naver-cloud-storage-info.png\",alt:\"naver cloud storage console\"}),(0,n.jsxs)(e.p,{children:[\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"VolumeAttachment\"}),\" object\\uB97C \\uC0DD\\uC131\\uD574\\uC8FC\\uBA74 \\uC5F0\\uACB0\\uC815\\uBCF4\\uAC00 \",(0,n.jsx)(e.code,{children:\"nodeName\"}),\"\\uB85C \\uC5F0\\uACB0\\uB41C \\uAC83\\uC744 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` storage.k8s.io/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` VolumeAttachment\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` test\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"attacher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blk.csi.ncloud.com\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"nodeName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" node\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"01\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"source\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"persistentVolumeName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" volume\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"existing\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"01\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"dynamic-provisioning\",children:[(0,n.jsx)(e.a,{href:\"#dynamic-provisioning\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"dynamic provisioning\"]}),(0,n.jsx)(e.p,{children:\"StorageClass\\uC758 volumeBindingMode\\uB97C Immediate\\uB85C \\uC124\\uC815\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` StorageClass\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` storage.k8s.io/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`storage\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" kube\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`system\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storageclass.kubernetes.io/is-default-class\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"provisioner\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blk.csi.ncloud.com\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeBindingMode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Immediate\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"reclaimPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Retain\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"allowVolumeExpansion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parameters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` SSD\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uADF8\\uB9AC\\uACE0 PVC object\\uB97C \\uC0DD\\uC131\\uD558\\uBA74 dynamic\\uD558\\uAC8C PV\\uAC00 \\uC0DD\\uC131\\uB418\\uACE0, \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC5D0 storage\\uAC00 \\uC0DD\\uC131\\uB41C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` PersistentVolumeClaim\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" csi\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`pvc\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"accessModes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` ReadWriteOnce\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"resources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"requests\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` 10Gi\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storageClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`storage\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\u{1F914} \\uADF8\\uB7F0\\uB370 VolumeAttachment object\\uAC00 \\uC5C6\\uB294\\uB370\\uB3C4, storage \\uC5F0\\uACB0\\uC815\\uBCF4\\uC5D0\\uC11C node\\uAC00 \\uC5F0\\uACB0\\uB418\\uC5B4 \\uC788\\uB2E4. \\uC774\\uAC83\\uC774 \\uC758\\uB3C4\\uD55C \\uACB0\\uACFC\\uC778\\uAC00? (\\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC5D0\\uC11C Block storage\\uB97C \\uC0DD\\uC131\\uD560 \\uB54C \\uC11C\\uBC84\\uC5D0 \\uBD80\\uCC29\\uC774 \\uB418\\uC5B4\\uC57C \\uD558\\uB294 \\uC0C1\\uD669\\uC774\\uB77C Immediate\\uB85C PV\\uAC00 \\uC0DD\\uC131\\uB420 \\uB54C \\uC790\\uB3D9\\uC73C\\uB85C Node\\uC5D0 \\uBD80\\uCC29\\uB41C\\uB2E4. \\uD558\\uC9C0\\uB9CC Pod\\uC5D0 PVC\\uB85C \\uC5F0\\uACB0\\uD558\\uBA74 \\uC774\\uC81C \\uD574\\uB2F9 Pod\\uAC00 \\uB3CC\\uACE0 \\uC788\\uB294 \\uB178\\uB4DC\\uB85C \\uB2E4\\uC2DC \\uC7AC\\uBD80\\uCC29\\uC774 \\uB41C\\uB2E4.)\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://kubernetes.io/docs/concepts/storage/storage-classes/#volume-binding-mode\",children:\"\\uBB38\\uC11C\"}),\"\\uC5D0 \\uC544\\uB798\\uCC98\\uB7FC \\uC124\\uBA85\\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.blockquote,{children:(0,n.jsx)(e.p,{children:\"The Immediate mode indicates that volume binding and dynamic provisioning occurs once the PersistentVolumeClaim is created.\"})}),(0,n.jsxs)(e.p,{children:[\"\\uC544\\uB798\\uCC98\\uB7FC volumeBindingMode\\uB97C \",(0,n.jsx)(e.code,{children:\"WaitForFirstConsumer\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uBA74, pod\\uAC00 PVC\\uB97C \\uC0AC\\uC6A9\\uD560 \\uB54C\\uAE4C\\uC9C0 Pending \\uC0C1\\uD0DC\\uAC00 \\uC788\\uB2E4\\uAC00 \\uC0AC\\uC6A9\\uD558\\uBA74 pod\\uC758 Node\\uC5D0 \\uBD99\\uAC8C \\uB41C\\uB2E4. PV\\uC640 VolumeAttachment object\\uAC00 \\uAC19\\uC774 \\uC0DD\\uAE30\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` StorageClass\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` storage.k8s.io/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`storage\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"namespace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" kube\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`system\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storageclass.kubernetes.io/is-default-class\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"provisioner\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blk.csi.ncloud.com\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeBindingMode\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` WaitForFirstConsumer\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"reclaimPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Retain\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"allowVolumeExpansion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"parameters\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` SSD\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"snapshot\",children:[(0,n.jsx)(e.a,{href:\"#snapshot\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"snapshot\"]}),(0,n.jsx)(e.p,{children:\"StorageClass\\uC640 \\uB9C8\\uCC2C\\uAC00\\uC9C0\\uB85C VolumeSnapshotClass\\uB3C4 default\\uB85C \\uD558\\uB098 \\uB9CC\\uB4E4\\uC5B4\\uC838 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uC544\\uB798\\uCC98\\uB7FC object\\uB97C \\uC0DD\\uC131\\uD558\\uBA74 snapshot\\uC774 \\uB9CC\\uB4E4\\uC5B4\\uC9C4\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` snapshot.storage.k8s.io/v1beta1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` VolumeSnapshot\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" new\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"snapshot\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`test\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"volumeSnapshotClassName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" nks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"block\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`storage\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"source\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"persistentVolumeClaimName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" pvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`name\n`]})]})}),(0,n.jsx)(e.p,{children:\"snapshot\\uC744 \\uC8FC\\uAE30\\uC801\\uC73C\\uB85C \\uD558\\uACE0, \\uCD5C\\uC2E0 \\uBA87\\uAC1C\\uB9CC \\uC720\\uC9C0\\uD558\\uACE0 \\uC2F6\\uC740\\uB370 \\uBCF4\\uB2C8\\uAE50 \\uC5EC\\uB7EC \\uC0AC\\uB78C\\uB4E4\\uC774 Custom Controller\\uB85C \\uB9CC\\uB4E0 \\uAC83\\uB4E4\\uC774 \\uBCF4\\uC778\\uB2E4. Custom Controller\\uB97C \\uC9C1\\uC811 \\uB9CC\\uB4E4\\uC5B4 \\uBCF4\\uB294 \\uAC83\\uB3C4 \\uC7AC\\uBBF8\\uC788\\uACA0\\uB2E4. \\u{1F60B}\"})]})}}var v=y;return f;})();\n;return Component;","toc":[{"value":"aws ebs csi driver","url":"#aws-ebs-csi-driver","depth":2},{"value":"controller plugin","url":"#controller-plugin","depth":3},{"value":"ebs-plugin","url":"#ebs-plugin","depth":4},{"value":"csi-provisioner","url":"#csi-provisioner","depth":4},{"value":"csi-attacher","url":"#csi-attacher","depth":4},{"value":"csi-snapshotter","url":"#csi-snapshotter","depth":4},{"value":"external-resizer","url":"#external-resizer","depth":4},{"value":"election","url":"#election","depth":4},{"value":"node plugin","url":"#node-plugin","depth":3},{"value":"node-driver-registrar","url":"#node-driver-registrar","depth":4},{"value":"결론","url":"#결론","depth":2},{"value":"NCloud에서","url":"#ncloud에서","depth":2},{"value":"static PV provisioning","url":"#static-pv-provisioning","depth":3},{"value":"dynamic provisioning","url":"#dynamic-provisioning","depth":3},{"value":"snapshot","url":"#snapshot","depth":3}],"frontMatter":{"readingTime":{"text":"14 min read","minutes":13.99,"time":839400,"words":2798},"slug":"20231021-csi-driver","fileName":"20231021-csi-driver.md","title":"aws-ebs-csi-driver 코드로 csi driver 이해하기","date":"2023-10-21T00:00:00.000Z","tags":["kubernetes"],"images":["/static/images/social-banner.png"],"summary":"aws-ebs-csi-driver 소스코드를 보고 csi driver가 하는 역할을 이해해보았다. 크게 Controller plugin과 Node plugin으로 구성되어 있고, 다양한 sidecar container들이 존재한다. 이 sidecar container들이 Volume을 생성하고, 노드에 부착하고, Host 혹은 container directory에 mount하는 것을 진행한다. 이과정에서 CSI driver로 cloud vendor마다 다른 로직으로 그들의 volume을 제어하게 된다. 네이버 클라우드에서 storage가 처음 생성될 때 서버에 부착이 되어야만 하는 제약사항이 있어서, PVC로 PV 동적 할당을 할 때 volumeBindingMode이 Immediate이면 자동으로 Node에 부착이 된다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"네이버 클라우드 certificate manager에 Lets encrypt 인증서 등록하기","date":"2023-10-14T00:00:00.000Z","tags":["ncloud"],"images":["/static/images/social-banner.png"],"summary":"Lets encrypt로 인증서를 발급하여 이것을 Naver Cloud Certificate Manager에 등록하려고 하였다. certbot을 통해서 인증서를 발급받고 해당 파일들을 Certificate manager에 등록하려고 하니 에러가 발생하였다. 이번 블로그 포스팅은 두 가지의 에러를 해결한 삽질기이다.","slug":"20231014-ncloud-certificate-manater"},"next":{"title":"Kubernetes에서 GPU 사용하기","date":"2023-10-29T00:00:00.000Z","tags":["kubernetes"],"images":["/static/images/social-banner.png"],"summary":"Pytorch를 컨테이너로 띄우고 GPU를 사용하고 싶었다. 따라서 Docker container에서 NVIDIA GPU를 사용할 수 있도록 셋팅을 해보았다. 그리고 최종적으로 Kubernetes에서 GPU hardware를 사용할 수 있도록 nvidia device plugin을 DaemonSet으로 띄우고 Pod를 실행해보았다.","slug":"20231029-gpu-on-k8s"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20231021-csi-driver"]},"buildId":"5rA2lt33gP673HPCttyyC","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>