<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Kubernetes custom controller 작성해보기</title><meta name="robots" content="follow, index"/><meta name="description" content="Programming Kubernetes 책에서 나온 예제를 따라서 custom controller를 작성해보았다. CustomResourceDefinition를 어떻게 정의하고, kubebuilder로 어떻게 나만의 business logic을 작성할 수 있는지 예제를 통해서 이해했다."/><meta property="og:url" content="https://jayground8.github.io/blog/20230715-k8s-controller"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Programming Kubernetes 책에서 나온 예제를 따라서 custom controller를 작성해보았다. CustomResourceDefinition를 어떻게 정의하고, kubebuilder로 어떻게 나만의 business logic을 작성할 수 있는지 예제를 통해서 이해했다."/><meta property="og:title" content="Kubernetes custom controller 작성해보기"/><meta property="og:image" content="https://jayground8.github.iosocial-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Kubernetes custom controller 작성해보기"/><meta name="twitter:description" content="Programming Kubernetes 책에서 나온 예제를 따라서 custom controller를 작성해보았다. CustomResourceDefinition를 어떻게 정의하고, kubebuilder로 어떻게 나만의 business logic을 작성할 수 있는지 예제를 통해서 이해했다."/><meta name="twitter:image" content="https://jayground8.github.iosocial-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20230715-k8s-controller"/><meta property="article:published_time" content="2023-07-15T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20230715-k8s-controller"
  },
  "headline": "Kubernetes custom controller 작성해보기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.iosocial-banner.png"
    }
  ],
  "datePublished": "2023-07-15T00:00:00.000Z",
  "dateModified": "2023-07-15T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Programming Kubernetes 책에서 나온 예제를 따라서 custom controller를 작성해보았다. CustomResourceDefinition를 어떻게 정의하고, kubebuilder로 어떻게 나만의 business logic을 작성할 수 있는지 예제를 통해서 이해했다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e09938309a0df51.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/S2XwMqrz3A7mhdDV7kmrA/_buildManifest.js" defer=""></script><script src="/_next/static/S2XwMqrz3A7mhdDV7kmrA/_ssgManifest.js" defer=""></script><script src="/_next/static/S2XwMqrz3A7mhdDV7kmrA/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-07-15T00:00:00.000Z">2023년 7월 15일 토요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Kubernetes custom controller 작성해보기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p><code>Programming Kubernetes</code> 책에서 나온 예제를 따라서 custom controller를 작성해보았다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">curl</span> -L -o kubebuilder <span class="token string">&quot;https://go.kubebuilder.io/dl/latest/<span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOOS<span class="token variable">)</span></span>/<span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOARCH<span class="token variable">)</span></span>&quot;</span><span class="token punctuation">\</span>n
</span><span class="code-line"><span class="token function">chmod</span> +x kubebuilder <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> kubebuilder /usr/local/bin/
</span><span class="code-line">kubebuilder init --domain study.jayground8
</span><span class="code-line">kubebuilder create api --group cnat --version v1alpha1 --kind At
</span></code></pre></div><p>이제 Kind At의 Spec에 언제 실행될지 Schdule과 어떤 명령어가 실행될지 Command 프로퍼티들을 가지도록 정의한다. 그리고 Kind At의 Status는 Phase 프로퍼티를 가지고, PENDING, RUNNING, DONE 값을 가지도록 할 것이다.</p><p><code>api/v1alpha1/at_types.go</code></p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">const</span> <span class="token punctuation">(</span>
</span><span class="code-line">	PhasePending <span class="token operator">=</span> <span class="token string">&quot;PENDING&quot;</span>
</span><span class="code-line">	PhaseRunning <span class="token operator">=</span> <span class="token string">&quot;RUNNING&quot;</span>
</span><span class="code-line">	PhaseDone    <span class="token operator">=</span> <span class="token string">&quot;DONE&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> AtSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	Schedule <span class="token builtin">string</span> <span class="token string">`json:&quot;schedule,omitempty&quot;`</span>
</span><span class="code-line">	Command  <span class="token builtin">string</span> <span class="token string">`json:&quot;command,omitempty&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> AtStatus <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	Phase <span class="token builtin">string</span> <span class="token string">`json:&quot;phase,omitempty&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>make manifest</code> 명령어를 실행하면 <code>/config/crd/bases/</code>에 <code>cnat.study.jayground8_ats.yaml</code> 파일이 아래처럼 생성된다. <code>at_types.go</code>에 정의한 내용대로 <code>CustomResourceDefinition</code> 정의가 되었다. 내가 참고한 <code>Programming Kubernetes</code> 책은 2019년에 발간되었고, <code>apiextensions.k8s.io/v1beta1</code> 버전을 사용하고 있다. 하지만 <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/blog/2021/07/14/upcoming-changes-in-kubernetes-1-22/">Kubernetes v1.22에서 apiextensions.k8s.io/v1beta1는 제거 되었다.</a> 나는 Minikube로 Local에서 Kubernetes v1.26.3으로 테스트를 해보고 있다. <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/reference/using-api/deprecation-guide/#customresourcedefinition-v122">v1에서 변경된 점을 문서로 확인</a>하였고, 책에서 사용된 예제에서는 아래와 같은 점이 변경이 되었다.</p><ul><li>spec.version is removed in v1; use spec.versions instead</li><li>spec.subresources is removed in v1; use spec.versions[*].subresources instead</li><li>spec.versions[*] .schema.openAPIV3Schema is now required when creating v1 CustomResourceDefinition objects, and must be a structural schema</li></ul><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apiextensions.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> CustomResourceDefinition
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">controller-gen.kubebuilder.io/version</span><span class="token punctuation">:</span> v0.12.0
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> ats.cnat.study.jayground8
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">group</span><span class="token punctuation">:</span> cnat.study.jayground8
</span><span class="code-line">  <span class="token atrule key">names</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">kind</span><span class="token punctuation">:</span> At
</span><span class="code-line">    <span class="token atrule key">listKind</span><span class="token punctuation">:</span> AtList
</span><span class="code-line">    <span class="token atrule key">plural</span><span class="token punctuation">:</span> ats
</span><span class="code-line">    <span class="token atrule key">singular</span><span class="token punctuation">:</span> at
</span><span class="code-line">  <span class="token atrule key">scope</span><span class="token punctuation">:</span> Namespaced
</span><span class="code-line">  <span class="token atrule key">versions</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> v1alpha1
</span><span class="code-line">      <span class="token atrule key">schema</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">openAPIV3Schema</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">description</span><span class="token punctuation">:</span> At is the Schema for the ats API
</span><span class="code-line">          <span class="token atrule key">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">apiVersion</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">            <span class="token atrule key">kind</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">            <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">            <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token atrule key">command</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">                <span class="token atrule key">schedule</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">              <span class="token atrule key">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">            <span class="token atrule key">status</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token atrule key">phase</span><span class="token punctuation">:</span>
</span><span class="code-line">                  <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">              <span class="token atrule key">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">          <span class="token atrule key">type</span><span class="token punctuation">:</span> object
</span><span class="code-line">      <span class="token atrule key">served</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token atrule key">storage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token atrule key">subresources</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><p>OpenAPI V3 schema를 정의하면 apiextensions-apiserver에서 validation을 하게 된다. 그리고 kubectl를 사용할 때 해당 정보를 통해서 client-side validation을 한다. <code>required</code> field를 설정하려면 아래와 같이 추가할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token comment">// AtSpec defines the desired state of At</span>
</span><span class="code-line"><span class="token keyword">type</span> AtSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">// +kubebuilder:validation:Required</span>
</span><span class="code-line">	Schedule <span class="token builtin">string</span> <span class="token string">`json:&quot;schedule&quot;`</span>
</span><span class="code-line">	<span class="token comment">// +kubebuilder:validation:Required</span>
</span><span class="code-line">	Command  <span class="token builtin">string</span> <span class="token string">`json:&quot;command&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>다시 <code>make manifest</code>를 해보면 아래와 같이 <code>required</code>가 추가된 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">description</span><span class="token punctuation">:</span> AtSpec defines the desired state of At
</span><span class="code-line">  <span class="token atrule key">properties</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">command</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">    <span class="token atrule key">schedule</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">  <span class="token atrule key">required</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> command
</span><span class="code-line">    <span class="token punctuation">-</span> schedule
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> object
</span></code></pre></div><p><code>make install</code>로 변경된 CRD를 적용하고, 아래처럼 required로 정의된 command property가 빠지면 <code>The At &quot;example-at&quot; is invalid: spec.command: Required value</code> 메세지를 보여주게 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> cnat.study.jayground8/v1alpha1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> At
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">controller-tools.k8s.io</span><span class="token punctuation">:</span> <span class="token string">&#x27;1.0&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>at
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">schedule</span><span class="token punctuation">:</span> <span class="token string">&#x27;2023-07-14T10:12:00Z&#x27;</span>
</span></code></pre></div><p>이제 특정 Regex로 validation을 설정할 수 있는데, kubebuilder에서 아래처럼 정의하여 <code>make manifest</code>를 할 수 있다. schedule property는 regex pattern을 정의해놨기 때문에,regex가 맞지 않으면 <code>The At &quot;example-at&quot; is invalid: spec.schedule: Invalid value: &quot;2019-04-12T10:12Z&quot;: spec.schedule in body should match &#x27;^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d&#x27;</code> 메세지를 보여주게 된다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token comment">// AtSpec defines the desired state of At</span>
</span><span class="code-line"><span class="token keyword">type</span> AtSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">// +kubebuilder:validation:Required</span>
</span><span class="code-line">	<span class="token comment">// +kubebuilder:validation:Pattern=`^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d`</span>
</span><span class="code-line">	Schedule <span class="token builtin">string</span> <span class="token string">`json:&quot;schedule&quot;`</span>
</span><span class="code-line">	<span class="token comment">// +kubebuilder:validation:Required</span>
</span><span class="code-line">	Command  <span class="token builtin">string</span> <span class="token string">`json:&quot;command&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>기본 설정에서 <code>kubectl</code>로 Kind At을 가져왔을 때 아래처럼 보이게 된다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ kubectl get ats
</span><span class="code-line">NAME         AGE
</span><span class="code-line">example-at   4s
</span></code></pre></div><p><code>additionalPrinterColumns</code>를 아래와 같이 Kubebuilder에서 정의해주면</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token comment">//+kubebuilder:printcolumn:name=&quot;schedule&quot;,type=string,JSONPath=`.spec.schedule`</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:printcolumn:name=&quot;command&quot;,type=string,JSONPath=`.spec.command`</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:printcolumn:name=&quot;phase&quot;,type=string,JSONPath=`.status.phase`</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// At is the Schema for the ats API</span>
</span><span class="code-line"><span class="token keyword">type</span> At <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	metav1<span class="token punctuation">.</span>TypeMeta   <span class="token string">`json:&quot;,inline&quot;`</span>
</span><span class="code-line">	metav1<span class="token punctuation">.</span>ObjectMeta <span class="token string">`json:&quot;metadata,omitempty&quot;`</span>
</span><span class="code-line">
</span><span class="code-line">	Spec   AtSpec   <span class="token string">`json:&quot;spec,omitempty&quot;`</span>
</span><span class="code-line">	Status AtStatus <span class="token string">`json:&quot;status,omitempty&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>이제는 아래처럼 정의된 추가 정보가 보이게 된다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ kubectl get ats
</span><span class="code-line">NAME         SCHEDULE               COMMAND    PHASE
</span><span class="code-line">example-at   <span class="token number">2023</span>-07-14T10:12:00Z   <span class="token builtin class-name">echo</span> YAY   DONE
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#subresources">Custom Resource는 subresource로 /status와 /scale이 지원된다.</a> kubebuilder에서 아래와 같이 subresource status를 enable하도록 설정했다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token comment">//+kubebuilder:subresource:status</span>
</span></code></pre></div><p>따라서 subresource를 통해서 RBAC를 아래와 같이 분리할 수 있다. metadata나 spec 데이터를 같이 보내도 그것들은 무시하고 status만 업데이트 할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">apiGroups</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> cnat.study.jayground8
</span><span class="code-line">  <span class="token atrule key">resources</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> ats/status
</span><span class="code-line">  <span class="token atrule key">verbs</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> get
</span><span class="code-line">    <span class="token punctuation">-</span> patch
</span><span class="code-line">    <span class="token punctuation">-</span> update
</span></code></pre></div><p>이제 <code>internal/controller</code> 경로의 <code>at_controller.go</code>에 business logic을 추가한다. At resource를 가져오고 상태값에 따라서 로직을 수행한다. CRD의 schedule의 시간이 지나면 이제 phase를 RUNNING으로 변경하고, busybox에 CRD의 command 명령어를 실행하기 위한 pod를 name과 namespace로 가져와서 없으면 이제 pod를 생성하게 된다. pod의 상태값이 failed나 succeeded이면 이제 phase는 DONE이 된다.</p><p>return 되는 것에 따라서 다시 reconcilation을 하게 된다.</p><ul><li><code>return reconcile.Result{}, nil</code> : 이제 reconcilation이 성공해서 retry를 할 필요가 없다.</li><li><code>return reconcile.Result{}, err</code> : error가 발생해서 retry가 필요하다.</li><li><code>return reconcile.Result{RequeueAfter: d}, nil</code> : d만큼 기다렸다가 다시 work queue에 들어가서 다시 reconcilation을 하게 된다. Schedule 값이 아직 미래라면 그때까지 기다렸다가 다시 Reconcilation을 하도록 한다.</li></ul><p><code>SetControllerReference</code>는 Custom resource에 pod가 자식 관계를 가지게 한다. 그래서 custom resource가 delete되면 관계된 pod도 GC되도록 하려고 설정한다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line">err <span class="token operator">:=</span> controllerutil<span class="token punctuation">.</span><span class="token function">SetControllerReference</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> pod<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Scheme<span class="token punctuation">)</span>
</span></code></pre></div><p>subresource status를 enable했기 때문에 이렇게 Status만 업데이트 할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line">err <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span>
</span></code></pre></div><p>최종적으로 아래와 같이 작성이 되었다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">package</span> controller
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line">	<span class="token string">&quot;context&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;strings&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;time&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	corev1 <span class="token string">&quot;k8s.io/api/core/v1&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;k8s.io/apimachinery/pkg/api/errors&quot;</span>
</span><span class="code-line">	metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;k8s.io/apimachinery/pkg/types&quot;</span>
</span><span class="code-line">	ctrl <span class="token string">&quot;sigs.k8s.io/controller-runtime&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/client&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/controller/controllerutil&quot;</span>
</span><span class="code-line">	logf <span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/log&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/reconcile&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	cnatv1alpha1 <span class="token string">&quot;my_controller/api/v1alpha1&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">var</span> globalLog <span class="token operator">=</span> logf<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">WithName</span><span class="token punctuation">(</span><span class="token string">&quot;global&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// AtReconciler reconciles a At object</span>
</span><span class="code-line"><span class="token keyword">type</span> AtReconciler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	client<span class="token punctuation">.</span>Client
</span><span class="code-line">	Scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=&quot;&quot;,resources=pods,verbs=get;list;create;watch;</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=cnat.study.jayground8,resources=ats,verbs=get;list;watch;create;update;patch;delete</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=cnat.study.jayground8,resources=ats/status,verbs=get;update;patch</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=cnat.study.jayground8,resources=ats/finalizers,verbs=update</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Reconcile is part of the main kubernetes reconciliation loop which aims to</span>
</span><span class="code-line"><span class="token comment">// move the current state of the cluster closer to the desired state.</span>
</span><span class="code-line"><span class="token comment">// TODO(user): Modify the Reconcile function to compare the state specified by</span>
</span><span class="code-line"><span class="token comment">// the At object against the actual cluster state, and then</span>
</span><span class="code-line"><span class="token comment">// perform operations to make the cluster state reflect the state specified by</span>
</span><span class="code-line"><span class="token comment">// the user.</span>
</span><span class="code-line"><span class="token comment">//</span>
</span><span class="code-line"><span class="token comment">// For more details, check Reconcile and its Result here:</span>
</span><span class="code-line"><span class="token comment">// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.15.0/pkg/reconcile</span>
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>AtReconciler<span class="token punctuation">)</span> <span class="token function">Reconcile</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req ctrl<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	reqLogger <span class="token operator">:=</span> globalLog<span class="token punctuation">.</span><span class="token function">WithValues</span><span class="token punctuation">(</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span> <span class="token string">&quot;at&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
</span><span class="code-line">	reqLogger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;=== Reconciling At&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token comment">// TODO(user): your logic here</span>
</span><span class="code-line">	instance <span class="token operator">:=</span> <span class="token operator">&amp;</span>cnatv1alpha1<span class="token punctuation">.</span>At<span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">	err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>NamespacedName<span class="token punctuation">,</span> instance<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">IsNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">if</span> instance<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">		instance<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">=</span> cnatv1alpha1<span class="token punctuation">.</span>PhasePending
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">switch</span> instance<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">case</span> cnatv1alpha1<span class="token punctuation">.</span>PhasePending<span class="token punctuation">:</span>
</span><span class="code-line">		d<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">timeUntilSchedule</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Schedule<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		<span class="token keyword">if</span> d <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span>RequeueAfter<span class="token punctuation">:</span> d<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		instance<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">=</span> cnatv1alpha1<span class="token punctuation">.</span>PhaseRunning
</span><span class="code-line">	<span class="token keyword">case</span> cnatv1alpha1<span class="token punctuation">.</span>PhaseRunning<span class="token punctuation">:</span>
</span><span class="code-line">		pod <span class="token operator">:=</span> <span class="token function">newPodForCR</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
</span><span class="code-line">		err <span class="token operator">:=</span> controllerutil<span class="token punctuation">.</span><span class="token function">SetControllerReference</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> pod<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Scheme<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		found <span class="token operator">:=</span> <span class="token operator">&amp;</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">		nsName <span class="token operator">:=</span> types<span class="token punctuation">.</span>NamespacedName<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> pod<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Namespace<span class="token punctuation">:</span> pod<span class="token punctuation">.</span>Namespace<span class="token punctuation">}</span>
</span><span class="code-line">		err <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nsName<span class="token punctuation">,</span> found<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> errors<span class="token punctuation">.</span><span class="token function">IsNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">			err <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pod<span class="token punctuation">)</span>
</span><span class="code-line">			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">				<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
</span><span class="code-line">			<span class="token punctuation">}</span>
</span><span class="code-line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
</span><span class="code-line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> found<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">==</span> corev1<span class="token punctuation">.</span>PodFailed <span class="token operator">||</span> found<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">==</span> corev1<span class="token punctuation">.</span>PodSucceeded <span class="token punctuation">{</span>
</span><span class="code-line">			instance<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">=</span> cnatv1alpha1<span class="token punctuation">.</span>PhaseDone
</span><span class="code-line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">case</span> cnatv1alpha1<span class="token punctuation">.</span>PhaseDone<span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">	<span class="token keyword">default</span><span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	err <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// SetupWithManager sets up the controller with the Manager.</span>
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>AtReconciler<span class="token punctuation">)</span> <span class="token function">SetupWithManager</span><span class="token punctuation">(</span>mgr ctrl<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span><span class="token function">NewControllerManagedBy</span><span class="token punctuation">(</span>mgr<span class="token punctuation">)</span><span class="token punctuation">.</span>
</span><span class="code-line">		<span class="token function">For</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cnatv1alpha1<span class="token punctuation">.</span>At<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
</span><span class="code-line">		<span class="token function">Complete</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token function">timeUntilSchedule</span><span class="token punctuation">(</span>schedule <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">	layout <span class="token operator">:=</span> <span class="token string">&quot;2006-01-02T15:04:05Z&quot;</span>
</span><span class="code-line">	s<span class="token punctuation">,</span> err <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> schedule<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token function">newPodForCR</span><span class="token punctuation">(</span>cr <span class="token operator">*</span>cnatv1alpha1<span class="token punctuation">.</span>At<span class="token punctuation">)</span> <span class="token operator">*</span>corev1<span class="token punctuation">.</span>Pod <span class="token punctuation">{</span>
</span><span class="code-line">	labels <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token string">&quot;app&quot;</span><span class="token punctuation">:</span> cr<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> <span class="token operator">&amp;</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">{</span>
</span><span class="code-line">		ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">{</span>
</span><span class="code-line">			Name<span class="token punctuation">:</span>      cr<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;-pod&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			Namespace<span class="token punctuation">:</span> cr<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span>
</span><span class="code-line">			Labels<span class="token punctuation">:</span>    labels<span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		Spec<span class="token punctuation">:</span> corev1<span class="token punctuation">.</span>PodSpec<span class="token punctuation">{</span>
</span><span class="code-line">			Containers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>corev1<span class="token punctuation">.</span>Container<span class="token punctuation">{</span>
</span><span class="code-line">				<span class="token punctuation">{</span>
</span><span class="code-line">					Name<span class="token punctuation">:</span>    <span class="token string">&quot;busybox&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">					Image<span class="token punctuation">:</span>   <span class="token string">&quot;busybox&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">					Command<span class="token punctuation">:</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>cr<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">				<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			RestartPolicy<span class="token punctuation">:</span> corev1<span class="token punctuation">.</span>RestartPolicyOnFailure<span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>아래와 같이 image를 생성하고, minikube에 해당 image를 load한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">make</span> docker-build <span class="token variable assign-left">IMG</span><span class="token operator">=</span>controller:latest
</span><span class="code-line">minikube image load controller:latest
</span></code></pre></div><p>그리고 local에 있는 image를 사용도록 아래처럼 <code>imagePullPolicy</code>를 변경해줬다.</p><p><code>/config/manager/manager.yaml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">image</span><span class="token punctuation">:</span> controller<span class="token punctuation">:</span>latest
</span><span class="code-line"><span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> Never
</span></code></pre></div><p>마지막으로 Minikube cluster에 배포를 한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">make</span> deploy
</span></code></pre></div><p>controller business logic중에 pod에 대해서 get하고 create하는게 있기 때문에, RBAC에 pod 관련 권한을 주기 위해서 <code>at_controller.go</code>에서 아래처럼 설정해놨다.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=&quot;&quot;,resources=pods,verbs=get;list;create;watch;</span>
</span></code></pre></div><p>custom resource At을 생성하면, informer가 event를 받아서 busybox container를 생성하여 command를 수행하는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl apply -f config/crd/samples/cnat.study.jayground8_ats.yaml
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230703-k8s-community-days">흑역사 하나 더 만들기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230716-if-kakao-2022-k8s-controller">if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var h=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of p(s))!m.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=d(s,e))||c.enumerable});return a},g=a=\u003ek(t(l(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=h((R,i)=\u003e{i.exports=_jsx_runtime});var v={};N(v,{default:()=\u003ef,frontmatter:()=\u003ey});var n=g(o()),y={title:\"Kubernetes custom controller \\uC791\\uC131\\uD574\\uBCF4\\uAE30\",date:\"2023-07-15\",tags:[\"kubernetes\"],summary:\"Programming Kubernetes \\uCC45\\uC5D0\\uC11C \\uB098\\uC628 \\uC608\\uC81C\\uB97C \\uB530\\uB77C\\uC11C custom controller\\uB97C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4. CustomResourceDefinition\\uB97C \\uC5B4\\uB5BB\\uAC8C \\uC815\\uC758\\uD558\\uACE0, kubebuilder\\uB85C \\uC5B4\\uB5BB\\uAC8C \\uB098\\uB9CC\\uC758 business logic\\uC744 \\uC791\\uC131\\uD560 \\uC218 \\uC788\\uB294\\uC9C0 \\uC608\\uC81C\\uB97C \\uD1B5\\uD574\\uC11C \\uC774\\uD574\\uD588\\uB2E4.\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",code:\"code\",pre:\"pre\",span:\"span\",a:\"a\",ul:\"ul\",li:\"li\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"Programming Kubernetes\"}),\" \\uCC45\\uC5D0\\uC11C \\uB098\\uC628 \\uC608\\uC81C\\uB97C \\uB530\\uB77C\\uC11C custom controller\\uB97C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"curl\"}),\" -L -o kubebuilder \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"https://go.kubebuilder.io/dl/latest/',(0,n.jsxs)(e.span,{className:\"token variable\",children:[(0,n.jsx)(e.span,{className:\"token variable\",children:\"$(\"}),\"go \",(0,n.jsx)(e.span,{className:\"token function\",children:\"env\"}),\" GOOS\",(0,n.jsx)(e.span,{className:\"token variable\",children:\")\"})]}),\"/\",(0,n.jsxs)(e.span,{className:\"token variable\",children:[(0,n.jsx)(e.span,{className:\"token variable\",children:\"$(\"}),\"go \",(0,n.jsx)(e.span,{className:\"token function\",children:\"env\"}),\" GOARCH\",(0,n.jsx)(e.span,{className:\"token variable\",children:\")\"})]}),'\"']}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"\\\\\"}),`n\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"chmod\"}),\" +x kubebuilder \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"mv\"}),` kubebuilder /usr/local/bin/\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubebuilder init --domain study.jayground8\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubebuilder create api --group cnat --version v1alpha1 --kind At\n`})]})}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C Kind At\\uC758 Spec\\uC5D0 \\uC5B8\\uC81C \\uC2E4\\uD589\\uB420\\uC9C0 Schdule\\uACFC \\uC5B4\\uB5A4 \\uBA85\\uB839\\uC5B4\\uAC00 \\uC2E4\\uD589\\uB420\\uC9C0 Command \\uD504\\uB85C\\uD37C\\uD2F0\\uB4E4\\uC744 \\uAC00\\uC9C0\\uB3C4\\uB85D \\uC815\\uC758\\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 Kind At\\uC758 Status\\uB294 Phase \\uD504\\uB85C\\uD37C\\uD2F0\\uB97C \\uAC00\\uC9C0\\uACE0, PENDING, RUNNING, DONE \\uAC12\\uC744 \\uAC00\\uC9C0\\uB3C4\\uB85D \\uD560 \\uAC83\\uC774\\uB2E4.\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"api/v1alpha1/at_types.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tPhasePending \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"PENDING\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tPhaseRunning \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"RUNNING\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tPhaseDone    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"DONE\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" AtSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tSchedule \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"schedule,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tCommand  \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"command,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" AtStatus \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tPhase \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"phase,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make manifest\"}),\" \\uBA85\\uB839\\uC5B4\\uB97C \\uC2E4\\uD589\\uD558\\uBA74 \",(0,n.jsx)(e.code,{children:\"/config/crd/bases/\"}),\"\\uC5D0 \",(0,n.jsx)(e.code,{children:\"cnat.study.jayground8_ats.yaml\"}),\" \\uD30C\\uC77C\\uC774 \\uC544\\uB798\\uCC98\\uB7FC \\uC0DD\\uC131\\uB41C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"at_types.go\"}),\"\\uC5D0 \\uC815\\uC758\\uD55C \\uB0B4\\uC6A9\\uB300\\uB85C \",(0,n.jsx)(e.code,{children:\"CustomResourceDefinition\"}),\" \\uC815\\uC758\\uAC00 \\uB418\\uC5C8\\uB2E4. \\uB0B4\\uAC00 \\uCC38\\uACE0\\uD55C \",(0,n.jsx)(e.code,{children:\"Programming Kubernetes\"}),\" \\uCC45\\uC740 2019\\uB144\\uC5D0 \\uBC1C\\uAC04\\uB418\\uC5C8\\uACE0, \",(0,n.jsx)(e.code,{children:\"apiextensions.k8s.io/v1beta1\"}),\" \\uBC84\\uC804\\uC744 \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \",(0,n.jsx)(e.a,{href:\"https://kubernetes.io/blog/2021/07/14/upcoming-changes-in-kubernetes-1-22/\",children:\"Kubernetes v1.22\\uC5D0\\uC11C apiextensions.k8s.io/v1beta1\\uB294 \\uC81C\\uAC70 \\uB418\\uC5C8\\uB2E4.\"}),\" \\uB098\\uB294 Minikube\\uB85C Local\\uC5D0\\uC11C Kubernetes v1.26.3\\uC73C\\uB85C \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD574\\uBCF4\\uACE0 \\uC788\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://kubernetes.io/docs/reference/using-api/deprecation-guide/#customresourcedefinition-v122\",children:\"v1\\uC5D0\\uC11C \\uBCC0\\uACBD\\uB41C \\uC810\\uC744 \\uBB38\\uC11C\\uB85C \\uD655\\uC778\"}),\"\\uD558\\uC600\\uACE0, \\uCC45\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uB41C \\uC608\\uC81C\\uC5D0\\uC11C\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uC810\\uC774 \\uBCC0\\uACBD\\uC774 \\uB418\\uC5C8\\uB2E4.\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"spec.version is removed in v1; use spec.versions instead\"}),(0,n.jsx)(e.li,{children:\"spec.subresources is removed in v1; use spec.versions[*].subresources instead\"}),(0,n.jsx)(e.li,{children:\"spec.versions[*] .schema.openAPIV3Schema is now required when creating v1 CustomResourceDefinition objects, and must be a structural schema\"})]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` apiextensions.k8s.io/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` CustomResourceDefinition\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"annotations\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"controller-gen.kubebuilder.io/version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` v0.12.0\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` ats.cnat.study.jayground8\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"group\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` cnat.study.jayground8\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"names\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` At\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"listKind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` AtList\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"plural\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` ats\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"singular\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` at\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"scope\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Namespaced\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"versions\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` v1alpha1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"schema\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"openAPIV3Schema\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"description\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` At is the Schema for the ats API\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"command\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"schedule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"phase\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` object\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"served\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"storage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"subresources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"OpenAPI V3 schema\\uB97C \\uC815\\uC758\\uD558\\uBA74 apiextensions-apiserver\\uC5D0\\uC11C validation\\uC744 \\uD558\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB9AC\\uACE0 kubectl\\uB97C \\uC0AC\\uC6A9\\uD560 \\uB54C \\uD574\\uB2F9 \\uC815\\uBCF4\\uB97C \\uD1B5\\uD574\\uC11C client-side validation\\uC744 \\uD55C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"required\"}),\" field\\uB97C \\uC124\\uC815\\uD558\\uB824\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uCD94\\uAC00\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// AtSpec defines the desired state of At\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" AtSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +kubebuilder:validation:Required\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tSchedule \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"schedule\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +kubebuilder:validation:Required\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tCommand  \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"command\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uB2E4\\uC2DC \",(0,n.jsx)(e.code,{children:\"make manifest\"}),\"\\uB97C \\uD574\\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,n.jsx)(e.code,{children:\"required\"}),\"\\uAC00 \\uCD94\\uAC00\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"description\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` AtSpec defines the desired state of At\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"properties\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"command\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"schedule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"required\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` command\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` schedule\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"type\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` object\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make install\"}),\"\\uB85C \\uBCC0\\uACBD\\uB41C CRD\\uB97C \\uC801\\uC6A9\\uD558\\uACE0, \\uC544\\uB798\\uCC98\\uB7FC required\\uB85C \\uC815\\uC758\\uB41C command property\\uAC00 \\uBE60\\uC9C0\\uBA74 \",(0,n.jsx)(e.code,{children:'The At \"example-at\" is invalid: spec.command: Required value'}),\" \\uBA54\\uC138\\uC9C0\\uB97C \\uBCF4\\uC5EC\\uC8FC\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` cnat.study.jayground8/v1alpha1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` At\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"labels\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"controller-tools.k8s.io\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'1.0'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" example\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`at\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"schedule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'2023-07-14T10:12:00Z'\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \\uD2B9\\uC815 Regex\\uB85C validation\\uC744 \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB294\\uB370, kubebuilder\\uC5D0\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \\uC815\\uC758\\uD558\\uC5EC \",(0,n.jsx)(e.code,{children:\"make manifest\"}),\"\\uB97C \\uD560 \\uC218 \\uC788\\uB2E4. schedule property\\uB294 regex pattern\\uC744 \\uC815\\uC758\\uD574\\uB1A8\\uAE30 \\uB54C\\uBB38\\uC5D0,regex\\uAC00 \\uB9DE\\uC9C0 \\uC54A\\uC73C\\uBA74 \",(0,n.jsx)(e.code,{children:`The At \"example-at\" is invalid: spec.schedule: Invalid value: \"2019-04-12T10:12Z\": spec.schedule in body should match '^\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d:[0-5]\\\\d'`}),\" \\uBA54\\uC138\\uC9C0\\uB97C \\uBCF4\\uC5EC\\uC8FC\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// AtSpec defines the desired state of At\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" AtSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +kubebuilder:validation:Required\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +kubebuilder:validation:Pattern=`^\\\\d{4}-[01]\\\\d-[0-3]\\\\dT[0-2]\\\\d:[0-5]\\\\d:[0-5]\\\\d`\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tSchedule \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"schedule\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// +kubebuilder:validation:Required\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tCommand  \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"command\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uAE30\\uBCF8 \\uC124\\uC815\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"kubectl\"}),\"\\uB85C Kind At\\uC744 \\uAC00\\uC838\\uC654\\uC744 \\uB54C \\uC544\\uB798\\uCC98\\uB7FC \\uBCF4\\uC774\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`$ kubectl get ats\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`NAME         AGE\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`example-at   4s\n`})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"additionalPrinterColumns\"}),\"\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 Kubebuilder\\uC5D0\\uC11C \\uC815\\uC758\\uD574\\uC8FC\\uBA74\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'//+kubebuilder:printcolumn:name=\"schedule\",type=string,JSONPath=`.spec.schedule`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'//+kubebuilder:printcolumn:name=\"command\",type=string,JSONPath=`.spec.command`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'//+kubebuilder:printcolumn:name=\"phase\",type=string,JSONPath=`.status.phase`'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// At is the Schema for the ats API\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" At \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tmetav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"TypeMeta   \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\",inline\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tmetav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"metadata,omitempty\"`'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tSpec   AtSpec   \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"spec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tStatus AtStatus \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"status,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uC774\\uC81C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC \\uC815\\uC758\\uB41C \\uCD94\\uAC00 \\uC815\\uBCF4\\uAC00 \\uBCF4\\uC774\\uAC8C \\uB41C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`$ kubectl get ats\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`NAME         SCHEDULE               COMMAND    PHASE\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"example-at   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),\"-07-14T10:12:00Z   \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\"echo\"}),` YAY   DONE\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#subresources\",children:\"Custom Resource\\uB294 subresource\\uB85C /status\\uC640 /scale\\uC774 \\uC9C0\\uC6D0\\uB41C\\uB2E4.\"}),\" kubebuilder\\uC5D0\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 subresource status\\uB97C enable\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD588\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-go\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:subresource:status\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"\\uB530\\uB77C\\uC11C subresource\\uB97C \\uD1B5\\uD574\\uC11C RBAC\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uBD84\\uB9AC\\uD560 \\uC218 \\uC788\\uB2E4. metadata\\uB098 spec \\uB370\\uC774\\uD130\\uB97C \\uAC19\\uC774 \\uBCF4\\uB0B4\\uB3C4 \\uADF8\\uAC83\\uB4E4\\uC740 \\uBB34\\uC2DC\\uD558\\uACE0 status\\uB9CC \\uC5C5\\uB370\\uC774\\uD2B8 \\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiGroups\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` cnat.study.jayground8\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"resources\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` ats/status\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"verbs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` get\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` patch\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` update\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"internal/controller\"}),\" \\uACBD\\uB85C\\uC758 \",(0,n.jsx)(e.code,{children:\"at_controller.go\"}),\"\\uC5D0 business logic\\uC744 \\uCD94\\uAC00\\uD55C\\uB2E4. At resource\\uB97C \\uAC00\\uC838\\uC624\\uACE0 \\uC0C1\\uD0DC\\uAC12\\uC5D0 \\uB530\\uB77C\\uC11C \\uB85C\\uC9C1\\uC744 \\uC218\\uD589\\uD55C\\uB2E4. CRD\\uC758 schedule\\uC758 \\uC2DC\\uAC04\\uC774 \\uC9C0\\uB098\\uBA74 \\uC774\\uC81C phase\\uB97C RUNNING\\uC73C\\uB85C \\uBCC0\\uACBD\\uD558\\uACE0, busybox\\uC5D0 CRD\\uC758 command \\uBA85\\uB839\\uC5B4\\uB97C \\uC2E4\\uD589\\uD558\\uAE30 \\uC704\\uD55C pod\\uB97C name\\uACFC namespace\\uB85C \\uAC00\\uC838\\uC640\\uC11C \\uC5C6\\uC73C\\uBA74 \\uC774\\uC81C pod\\uB97C \\uC0DD\\uC131\\uD558\\uAC8C \\uB41C\\uB2E4. pod\\uC758 \\uC0C1\\uD0DC\\uAC12\\uC774 failed\\uB098 succeeded\\uC774\\uBA74 \\uC774\\uC81C phase\\uB294 DONE\\uC774 \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:\"return \\uB418\\uB294 \\uAC83\\uC5D0 \\uB530\\uB77C\\uC11C \\uB2E4\\uC2DC reconcilation\\uC744 \\uD558\\uAC8C \\uB41C\\uB2E4.\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"return reconcile.Result{}, nil\"}),\" : \\uC774\\uC81C reconcilation\\uC774 \\uC131\\uACF5\\uD574\\uC11C retry\\uB97C \\uD560 \\uD544\\uC694\\uAC00 \\uC5C6\\uB2E4.\"]}),(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"return reconcile.Result{}, err\"}),\" : error\\uAC00 \\uBC1C\\uC0DD\\uD574\\uC11C retry\\uAC00 \\uD544\\uC694\\uD558\\uB2E4.\"]}),(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"return reconcile.Result{RequeueAfter: d}, nil\"}),\" : d\\uB9CC\\uD07C \\uAE30\\uB2E4\\uB838\\uB2E4\\uAC00 \\uB2E4\\uC2DC work queue\\uC5D0 \\uB4E4\\uC5B4\\uAC00\\uC11C \\uB2E4\\uC2DC reconcilation\\uC744 \\uD558\\uAC8C \\uB41C\\uB2E4. Schedule \\uAC12\\uC774 \\uC544\\uC9C1 \\uBBF8\\uB798\\uB77C\\uBA74 \\uADF8\\uB54C\\uAE4C\\uC9C0 \\uAE30\\uB2E4\\uB838\\uB2E4\\uAC00 \\uB2E4\\uC2DC Reconcilation\\uC744 \\uD558\\uB3C4\\uB85D \\uD55C\\uB2E4.\"]})]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"SetControllerReference\"}),\"\\uB294 Custom resource\\uC5D0 pod\\uAC00 \\uC790\\uC2DD \\uAD00\\uACC4\\uB97C \\uAC00\\uC9C0\\uAC8C \\uD55C\\uB2E4. \\uADF8\\uB798\\uC11C custom resource\\uAC00 delete\\uB418\\uBA74 \\uAD00\\uACC4\\uB41C pod\\uB3C4 GC\\uB418\\uB3C4\\uB85D \\uD558\\uB824\\uACE0 \\uC124\\uC815\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-go\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" controllerutil\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetControllerReference\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scheme\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"subresource status\\uB97C enable\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC774\\uB807\\uAC8C Status\\uB9CC \\uC5C5\\uB370\\uC774\\uD2B8 \\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-go\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TODO\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC791\\uC131\\uC774 \\uB418\\uC5C8\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` controller\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"strings\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"time\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tcorev1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/api/core/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/api/errors\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tmetav1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/apis/meta/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/runtime\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/types\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tctrl \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/client\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/controller/controllerutil\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogf \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/log\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/reconcile\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tcnatv1alpha1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"my_controller/api/v1alpha1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" globalLog \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" logf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Log\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"global\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// AtReconciler reconciles a At object\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" AtReconciler \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tclient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Client\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tScheme \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"runtime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Scheme\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'//+kubebuilder:rbac:groups=\"\",resources=pods,verbs=get;list;create;watch;'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=cnat.study.jayground8,resources=ats,verbs=get;list;watch;create;update;patch;delete\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=cnat.study.jayground8,resources=ats/status,verbs=get;update;patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=cnat.study.jayground8,resources=ats/finalizers,verbs=update\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Reconcile is part of the main kubernetes reconciliation loop which aims to\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// move the current state of the cluster closer to the desired state.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// TODO(user): Modify the Reconcile function to compare the state specified by\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// the At object against the actual cluster state, and then\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// perform operations to make the cluster state reflect the state specified by\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// the user.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// For more details, check Reconcile and its Result here:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.15.0/pkg/reconcile\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"AtReconciler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Reconcile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\treqLogger \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" globalLog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithValues\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"namespace\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"at\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\treqLogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=== Reconciling At\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// TODO(user): your logic here\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tinstance \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"At\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TODO\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NamespacedName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" errors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IsNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tinstance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PhasePending\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"switch\"}),\" instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PhasePending\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\td\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"timeUntilSchedule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Schedule\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" d \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"RequeueAfter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" d\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tinstance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PhaseRunning\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PhaseRunning\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tpod \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newPodForCR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" controllerutil\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetControllerReference\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scheme\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tfound \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tnsName \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" types\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NamespacedName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TODO\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" nsName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" found\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" errors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IsNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TODO\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" found\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodFailed \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"||\"}),\" found\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSucceeded \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tinstance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PhaseDone\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PhaseDone\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TODO\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" instance\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// SetupWithManager sets up the controller with the Manager.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"AtReconciler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SetupWithManager\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mgr ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Manager\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewControllerManagedBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mgr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"For\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"At\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"Complete\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"timeUntilSchedule\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"schedule \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Duration\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tnow \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Now\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"UTC\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlayout \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"2006-01-02T15:04:05Z\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\ts\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"layout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" schedule\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Duration\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" s\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Sub\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"now\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newPodForCR\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"cnatv1alpha1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"At\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Pod \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlabels \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" cr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"      cr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"-pod\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tNamespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" cr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tLabels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    labels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tContainers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Container\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\tName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"busybox\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\tImage\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"busybox\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\tCommand\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" strings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Split\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Command\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tRestartPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RestartPolicyOnFailure\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uC544\\uB798\\uC640 \\uAC19\\uC774 image\\uB97C \\uC0DD\\uC131\\uD558\\uACE0, minikube\\uC5D0 \\uD574\\uB2F9 image\\uB97C load\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"make\"}),\" docker-build \",(0,n.jsx)(e.span,{className:\"token variable assign-left\",children:\"IMG\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`controller:latest\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`minikube image load controller:latest\n`})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 local\\uC5D0 \\uC788\\uB294 image\\uB97C \\uC0AC\\uC6A9\\uB3C4\\uB85D \\uC544\\uB798\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"imagePullPolicy\"}),\"\\uB97C \\uBCC0\\uACBD\\uD574\\uC92C\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"/config/manager/manager.yaml\"})}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" controller\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Never\n`]})]})}),(0,n.jsx)(e.p,{children:\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C Minikube cluster\\uC5D0 \\uBC30\\uD3EC\\uB97C \\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"make\"}),` deploy\n`]})})}),(0,n.jsxs)(e.p,{children:[\"controller business logic\\uC911\\uC5D0 pod\\uC5D0 \\uB300\\uD574\\uC11C get\\uD558\\uACE0 create\\uD558\\uB294\\uAC8C \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, RBAC\\uC5D0 pod \\uAD00\\uB828 \\uAD8C\\uD55C\\uC744 \\uC8FC\\uAE30 \\uC704\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"at_controller.go\"}),\"\\uC5D0\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \\uC124\\uC815\\uD574\\uB1A8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-go\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'//+kubebuilder:rbac:groups=\"\",resources=pods,verbs=get;list;create;watch;'}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"custom resource At\\uC744 \\uC0DD\\uC131\\uD558\\uBA74, informer\\uAC00 event\\uB97C \\uBC1B\\uC544\\uC11C busybox container\\uB97C \\uC0DD\\uC131\\uD558\\uC5EC command\\uB97C \\uC218\\uD589\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl apply -f config/crd/samples/cnat.study.jayground8_ats.yaml\n`})})})]})}}var f=b;return v;})();\n;return Component;","toc":[],"frontMatter":{"readingTime":{"text":"12 min read","minutes":11.255,"time":675300,"words":2251},"slug":"20230715-k8s-controller","fileName":"20230715-k8s-controller.mdx","title":"Kubernetes custom controller 작성해보기","date":"2023-07-15T00:00:00.000Z","tags":["kubernetes"],"summary":"Programming Kubernetes 책에서 나온 예제를 따라서 custom controller를 작성해보았다. CustomResourceDefinition를 어떻게 정의하고, kubebuilder로 어떻게 나만의 business logic을 작성할 수 있는지 예제를 통해서 이해했다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"흑역사 하나 더 만들기","date":"2023-07-03T00:00:00.000Z","tags":["kubernetes","presentation"],"summary":"오늘 대왕 흑역사를 생산했다. Kubernetes Community Days에서 발표를 하게 되었는데, 30분 발표시간에 맞춰서 발표자료를 잘 준비하지 못해서 부끄러웠다. 30분에 너무 많은 내용을 담을려고 했고, 라이브코딩 형식으로 해서 시간도 많이 걸렸다. 나는 발표를 왜 할까?","slug":"20230703-k8s-community-days"},"next":{"title":"if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기","date":"2023-07-16T00:00:00.000Z","tags":["kubernetes"],"summary":"어제는 Programming Kubernetes에 나오는 예제를 kubebuilder로 작성해보았다. if(kakao)2022에서 controller를 테스트하는 방법에 대해서 설명한 발표가 있었다. 어제 이해한 내용을 바탕으로 이 발표에서 사용한 BlueGreen controller 예제를 따라서 작성해보았다.","slug":"20230716-if-kakao-2022-k8s-controller"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20230715-k8s-controller"]},"buildId":"S2XwMqrz3A7mhdDV7kmrA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>