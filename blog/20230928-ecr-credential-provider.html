<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>ECR Credential-Provider 사용해보기</title><meta name="robots" content="follow, index"/><meta name="description" content="Kubeadm으로 만든 Kubernetes Cluster에서 AWS ECR를 private container image repository를 사용하고자 하였다. private repository를 접근하기 위해서 Kubernetes 1.26부터 stable feature로 제공하는 kubelet crendential provider를 사용하였다."/><meta property="og:url" content="https://jayground8.github.io/blog/20230928-ecr-credential-provider"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Kubeadm으로 만든 Kubernetes Cluster에서 AWS ECR를 private container image repository를 사용하고자 하였다. private repository를 접근하기 위해서 Kubernetes 1.26부터 stable feature로 제공하는 kubelet crendential provider를 사용하였다."/><meta property="og:title" content="ECR Credential-Provider 사용해보기"/><meta property="og:image" content="https://jayground8.github.iosocial-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="ECR Credential-Provider 사용해보기"/><meta name="twitter:description" content="Kubeadm으로 만든 Kubernetes Cluster에서 AWS ECR를 private container image repository를 사용하고자 하였다. private repository를 접근하기 위해서 Kubernetes 1.26부터 stable feature로 제공하는 kubelet crendential provider를 사용하였다."/><meta name="twitter:image" content="https://jayground8.github.iosocial-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20230928-ecr-credential-provider"/><meta property="article:published_time" content="2023-09-28T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20230928-ecr-credential-provider"
  },
  "headline": "ECR Credential-Provider 사용해보기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.iosocial-banner.png"
    }
  ],
  "datePublished": "2023-09-28T00:00:00.000Z",
  "dateModified": "2023-09-28T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Kubeadm으로 만든 Kubernetes Cluster에서 AWS ECR를 private container image repository를 사용하고자 하였다. private repository를 접근하기 위해서 Kubernetes 1.26부터 stable feature로 제공하는 kubelet crendential provider를 사용하였다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9cc92f2f74234421.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/eZWSqnOqf7fXW5G7Z80iH/_buildManifest.js" defer=""></script><script src="/_next/static/eZWSqnOqf7fXW5G7Z80iH/_ssgManifest.js" defer=""></script><script src="/_next/static/eZWSqnOqf7fXW5G7Z80iH/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-09-28T00:00:00.000Z">2023년 9월 28일 목요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">ECR Credential-Provider 사용해보기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="cronjob을-이용"><a href="#cronjob을-이용" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>CronJob을 이용?</h2><p>자체적으로 EC2(Ubuntu 20.04)에 Kubernetes Cluster를 Kubeadm로 만들어서 사용하는데, ECR를 연결하여 사용하려고 했다. AWS cli 명령어 <code>aws ecr get-login-password</code>를 사용하여 Docker secret에 추가하여 인증할 수도 있다. <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-secret-by-providing-credentials-on-the-command-line">Kubernetes 공식문서</a>에 친절하게 나와 있다. 하지만 이렇게 <code>aws ecr get-login-password</code>로 받은 token은 12시간동안 유효하게 된다. 따라서 Cronjob을 만들어서 주기적으로 업데이트해주는 작업으로 해결한 블로그들을 여럿 보았다.</p><h2 id="kubelet-crendential-provider를-사용"><a href="#kubelet-crendential-provider를-사용" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Kubelet Crendential Provider를 사용</h2><p>하지만 좀 더 깔끔한 방법이 있을 것 같아서 찾아보는 과정에서 1.26부터 stable된 <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-credential-provider/">kubelet image credential provider 설정</a>을 발견하게 되었다.</p><p>이 기능을 사용하기 위해서는 아래처럼 두가지의 kubelet flag를 설정해줘야 한다. <code>--image-credential-provider-config</code> <code>--image-credential-provider-bin-dir</code></p><h3 id="kubelet-flag-설정"><a href="#kubelet-flag-설정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Kubelet flag 설정</h3><p>kubeadm을 사용했기 때문에 kubelet systemd service 설정값을 보면 아래처럼 환경변수 값을 가져오는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">systemctl status kubelet
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">● kubelet.service - kubelet: The Kubernetes Node Agent
</span><span class="code-line">     Loaded: loaded <span class="token punctuation">(</span>/lib/systemd/system/kubelet.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
</span><span class="code-line">    Drop-In: /usr/lib/systemd/system/kubelet.service.d
</span><span class="code-line">             └─10-kubeadm.conf
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">cat</span> /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">Service<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token variable assign-left">Environment</span><span class="token operator">=</span><span class="token string">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span>
</span><span class="code-line"><span class="token variable assign-left">Environment</span><span class="token operator">=</span><span class="token string">&quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&quot;</span>
</span><span class="code-line"><span class="token comment"># This is a file that &quot;kubeadm init&quot; and &quot;kubeadm join&quot; generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically</span>
</span><span class="code-line"><span class="token variable assign-left">EnvironmentFile</span><span class="token operator">=</span>-/var/lib/kubelet/kubeadm-flags.env
</span><span class="code-line"><span class="token comment"># This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use</span>
</span><span class="code-line"><span class="token comment"># the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.</span>
</span><span class="code-line"><span class="token variable assign-left">EnvironmentFile</span><span class="token operator">=</span>-/etc/sysconfig/kubelet
</span><span class="code-line"><span class="token variable assign-left">ExecStart</span><span class="token operator">=</span>
</span><span class="code-line"><span class="token variable assign-left">ExecStart</span><span class="token operator">=</span>/usr/bin/kubelet <span class="token variable">$KUBELET_KUBECONFIG_ARGS</span> <span class="token variable">$KUBELET_CONFIG_ARGS</span> <span class="token variable">$KUBELET_KUBEADM_ARGS</span> <span class="token variable">$KUBELET_EXTRA_ARGS</span>
</span></code></pre></div><p>나는 여기에 추가해야 되는 flag 두 개를 넣어줘서 테스트를 하게 되었다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">cat</span> /var/lib/kubelet<span class="token comment"># cat kubeadm-flags.env</span>
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token variable assign-left">KUBELET_KUBEADM_ARGS</span><span class="token operator">=</span>&quot;--container-runtime-endpoint<span class="token operator">=</span>unix:///var/run/containerd/containerd.sock --pod-infra-container-image<span class="token operator">=</span>registry.k8s.io/pause:3.9
</span></code></pre></div><h3 id="plugin-binary-설정"><a href="#plugin-binary-설정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>plugin binary 설정</h3><p><code>--image-credential-provider-bin-dir</code>에서 plugin binary file 경로를 가르켜야 하는데, go로 source code를 compile하였다. 그리고 binary file을 <code>/usr/local/bin</code>으로 이동하였다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -OL https://go.dev/dl/go1.20.8.linux-amd64.tar.gz
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">tar</span> -C /usr/local -xvf go1.20.8.linux-amd64.tar.gz
</span><span class="code-line"><span class="token builtin class-name">export</span> <span class="token variable assign-left"><span class="token constant environment">PATH</span></span><span class="token operator">=</span><span class="token constant environment">$PATH</span>:/usr/local/go/bin
</span><span class="code-line"><span class="token function">git</span> clone https://github.com/kubernetes/cloud-provider-aws.git
</span><span class="code-line"><span class="token builtin class-name">cd</span> cloud-provider-aws/cmd/ecr-credential-provider
</span><span class="code-line">go build
</span><span class="code-line"><span class="token function">mv</span> ecr-credential-provider /usr/local/bin
</span></code></pre></div><h3 id="config-file-설정"><a href="#config-file-설정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>config file 설정</h3><p>그리고 <code>--image-credential-provider-config</code>에 연결한 config 파일도 작성하였다.</p><p><code>ecr.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> kubelet.config.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> CredentialProviderConfig
</span><span class="code-line"><span class="token atrule key">providers</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> ecr<span class="token punctuation">-</span>credential<span class="token punctuation">-</span>provider
</span><span class="code-line">    <span class="token atrule key">matchImages</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token string">&#x27;*.dkr.ecr.*.amazonaws.com&#x27;</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token string">&#x27;*.dkr.ecr.*.amazonaws.com.cn&#x27;</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token string">&#x27;*.dkr.ecr-fips.*.amazonaws.com&#x27;</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token string">&#x27;*.dkr.ecr.us-iso-east-1.c2s.ic.gov&#x27;</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token string">&#x27;*.dkr.ecr.us-isob-east-1.sc2s.sgov.gov&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> credentialprovider.kubelet.k8s.io/v1
</span><span class="code-line">    <span class="token atrule key">defaultCacheDuration</span><span class="token punctuation">:</span> <span class="token string">&#x27;12h&#x27;</span>
</span></code></pre></div><p>준비가 되어서 <code>/var/lib/kubelet# cat kubeadm-flags.env</code>를 아래와 같이 수정하였다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token variable assign-left">KUBELET_KUBEADM_ARGS</span><span class="token operator">=</span><span class="token string">&quot;--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9 --image-credential-provider-config=/home/ubuntu/ecr.yml --image-credential-provider-bin-dir=/usr/local/bin/&quot;</span>
</span></code></pre></div><h3 id="ecr-pull-권한"><a href="#ecr-pull-권한" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ECR pull 권한</h3><p>최소한의 권한만 주는게 Best practice지만 일단 Read쪽 권한 전부와 <code>GetAuthorizationToken</code>를 추가하여 테스트를 진행했다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;Version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2012-10-17&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;Statement&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;Sid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VisualEditor0&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;Effect&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Allow&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;Action&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetRegistryPolicy&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:DescribeImageScanFindings&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetLifecyclePolicyPreview&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:DescribeRegistry&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:DescribePullThroughCacheRules&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:DescribeImageReplicationStatus&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetAuthorizationToken&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:ListTagsForResource&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:ListImages&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:BatchGetRepositoryScanningConfiguration&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetRegistryScanningConfiguration&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:BatchGetImage&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:DescribeImages&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:DescribeRepositories&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetRepositoryPolicy&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token string">&quot;ecr:GetLifecyclePolicy&quot;</span>
</span><span class="code-line">      <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;Resource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="kubelet-restart"><a href="#kubelet-restart" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>kubelet restart</h3><p>이제 새로운 flag가 적용되도록 restart를 하면 정상적으로 ECR에서 image를 pull해온다. 😎</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> systemctl daemon-reload <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl restart kubelet
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230928-s3-data-transfer-out">S3에서 Internet으로 데이터 송신한 금액을 bucket별로 확인하기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231014-ncloud-certificate-manater">네이버 클라우드 certificate manager에 Lets encrypt 인증서 등록하기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003el(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=\u003ek(i(l(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var t=u((R,r)=\u003e{r.exports=_jsx_runtime});var y={};N(y,{default:()=\u003ev,frontmatter:()=\u003eb});var e=g(t()),b={title:\"ECR Credential-Provider \\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\",date:\"2023-09-28\",tags:[\"kubernetes\"],summary:\"Kubeadm\\uC73C\\uB85C \\uB9CC\\uB4E0 Kubernetes Cluster\\uC5D0\\uC11C AWS ECR\\uB97C private container image repository\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0\\uC790 \\uD558\\uC600\\uB2E4. private repository\\uB97C \\uC811\\uADFC\\uD558\\uAE30 \\uC704\\uD574\\uC11C Kubernetes 1.26\\uBD80\\uD130 stable feature\\uB85C \\uC81C\\uACF5\\uD558\\uB294 kubelet crendential provider\\uB97C \\uC0AC\\uC6A9\\uD558\\uC600\\uB2E4.\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"cronjob\\uC744-\\uC774\\uC6A9\",children:[(0,e.jsx)(n.a,{href:\"#cronjob\\uC744-\\uC774\\uC6A9\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"CronJob\\uC744 \\uC774\\uC6A9?\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC790\\uCCB4\\uC801\\uC73C\\uB85C EC2(Ubuntu 20.04)\\uC5D0 Kubernetes Cluster\\uB97C Kubeadm\\uB85C \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294\\uB370, ECR\\uB97C \\uC5F0\\uACB0\\uD558\\uC5EC \\uC0AC\\uC6A9\\uD558\\uB824\\uACE0 \\uD588\\uB2E4. AWS cli \\uBA85\\uB839\\uC5B4 \",(0,e.jsx)(n.code,{children:\"aws ecr get-login-password\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC Docker secret\\uC5D0 \\uCD94\\uAC00\\uD558\\uC5EC \\uC778\\uC99D\\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-secret-by-providing-credentials-on-the-command-line\",children:\"Kubernetes \\uACF5\\uC2DD\\uBB38\\uC11C\"}),\"\\uC5D0 \\uCE5C\\uC808\\uD558\\uAC8C \\uB098\\uC640 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uC774\\uB807\\uAC8C \",(0,e.jsx)(n.code,{children:\"aws ecr get-login-password\"}),\"\\uB85C \\uBC1B\\uC740 token\\uC740 12\\uC2DC\\uAC04\\uB3D9\\uC548 \\uC720\\uD6A8\\uD558\\uAC8C \\uB41C\\uB2E4. \\uB530\\uB77C\\uC11C Cronjob\\uC744 \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uC8FC\\uAE30\\uC801\\uC73C\\uB85C \\uC5C5\\uB370\\uC774\\uD2B8\\uD574\\uC8FC\\uB294 \\uC791\\uC5C5\\uC73C\\uB85C \\uD574\\uACB0\\uD55C \\uBE14\\uB85C\\uADF8\\uB4E4\\uC744 \\uC5EC\\uB7FF \\uBCF4\\uC558\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"kubelet-crendential-provider\\uB97C-\\uC0AC\\uC6A9\",children:[(0,e.jsx)(n.a,{href:\"#kubelet-crendential-provider\\uB97C-\\uC0AC\\uC6A9\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kubelet Crendential Provider\\uB97C \\uC0AC\\uC6A9\"]}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \\uC880 \\uB354 \\uAE54\\uB054\\uD55C \\uBC29\\uBC95\\uC774 \\uC788\\uC744 \\uAC83 \\uAC19\\uC544\\uC11C \\uCC3E\\uC544\\uBCF4\\uB294 \\uACFC\\uC815\\uC5D0\\uC11C 1.26\\uBD80\\uD130 stable\\uB41C \",(0,e.jsx)(n.a,{href:\"https://kubernetes.io/docs/tasks/administer-cluster/kubelet-credential-provider/\",children:\"kubelet image credential provider \\uC124\\uC815\"}),\"\\uC744 \\uBC1C\\uACAC\\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC774 \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC \\uB450\\uAC00\\uC9C0\\uC758 kubelet flag\\uB97C \\uC124\\uC815\\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"--image-credential-provider-config\"}),\" \",(0,e.jsx)(n.code,{children:\"--image-credential-provider-bin-dir\"})]}),(0,e.jsxs)(n.h3,{id:\"kubelet-flag-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#kubelet-flag-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kubelet flag \\uC124\\uC815\"]}),(0,e.jsx)(n.p,{children:\"kubeadm\\uC744 \\uC0AC\\uC6A9\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 kubelet systemd service \\uC124\\uC815\\uAC12\\uC744 \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC \\uD658\\uACBD\\uBCC0\\uC218 \\uAC12\\uC744 \\uAC00\\uC838\\uC624\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`systemctl status kubelet\n`})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u25CF kubelet.service - kubelet: The Kubernetes Node Agent\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     Loaded: loaded \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"/lib/systemd/system/kubelet.service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" enabled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" vendor preset: enabled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    Drop-In: /usr/lib/systemd/system/kubelet.service.d\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`             \\u2514\\u250010-kubeadm.conf\n`})]})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Environment\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Environment\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:'# This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"EnvironmentFile\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`-/var/lib/kubelet/kubeadm-flags.env\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"EnvironmentFile\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`-/etc/sysconfig/kubelet\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"ExecStart\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"ExecStart\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"/usr/bin/kubelet \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_KUBECONFIG_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_CONFIG_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_KUBEADM_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_EXTRA_ARGS\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uB098\\uB294 \\uC5EC\\uAE30\\uC5D0 \\uCD94\\uAC00\\uD574\\uC57C \\uB418\\uB294 flag \\uB450 \\uAC1C\\uB97C \\uB123\\uC5B4\\uC918\\uC11C \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),\" /var/lib/kubelet\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# cat kubeadm-flags.env\"}),`\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_KUBEADM_ARGS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),'\"--container-runtime-endpoint',(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"unix:///var/run/containerd/containerd.sock --pod-infra-container-image\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`registry.k8s.io/pause:3.9\n`]})})}),(0,e.jsxs)(n.h3,{id:\"plugin-binary-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#plugin-binary-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"plugin binary \\uC124\\uC815\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"--image-credential-provider-bin-dir\"}),\"\\uC5D0\\uC11C plugin binary file \\uACBD\\uB85C\\uB97C \\uAC00\\uB974\\uCF1C\\uC57C \\uD558\\uB294\\uB370, go\\uB85C source code\\uB97C compile\\uD558\\uC600\\uB2E4. \\uADF8\\uB9AC\\uACE0 binary file\\uC744 \",(0,e.jsx)(n.code,{children:\"/usr/local/bin\"}),\"\\uC73C\\uB85C \\uC774\\uB3D9\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),` -OL https://go.dev/dl/go1.20.8.linux-amd64.tar.gz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"tar\"}),` -C /usr/local -xvf go1.20.8.linux-amd64.tar.gz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"PATH\"})}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"$PATH\"}),`:/usr/local/go/bin\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"git\"}),` clone https://github.com/kubernetes/cloud-provider-aws.git\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"cd\"}),` cloud-provider-aws/cmd/ecr-credential-provider\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`go build\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"mv\"}),` ecr-credential-provider /usr/local/bin\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"config-file-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#config-file-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"config file \\uC124\\uC815\"]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"--image-credential-provider-config\"}),\"\\uC5D0 \\uC5F0\\uACB0\\uD55C config \\uD30C\\uC77C\\uB3C4 \\uC791\\uC131\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"ecr.yml\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` kubelet.config.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` CredentialProviderConfig\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"providers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ecr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"credential\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`provider\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchImages\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.*.amazonaws.com'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.*.amazonaws.com.cn'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr-fips.*.amazonaws.com'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.us-iso-east-1.c2s.ic.gov'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.us-isob-east-1.sc2s.sgov.gov'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` credentialprovider.kubelet.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"defaultCacheDuration\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'12h'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC900\\uBE44\\uAC00 \\uB418\\uC5B4\\uC11C \",(0,e.jsx)(n.code,{children:\"/var/lib/kubelet# cat kubeadm-flags.env\"}),\"\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC218\\uC815\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_KUBEADM_ARGS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9 --image-credential-provider-config=/home/ubuntu/ecr.yml --image-credential-provider-bin-dir=/usr/local/bin/\"'}),`\n`]})})}),(0,e.jsxs)(n.h3,{id:\"ecr-pull-\\uAD8C\\uD55C\",children:[(0,e.jsx)(n.a,{href:\"#ecr-pull-\\uAD8C\\uD55C\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"ECR pull \\uAD8C\\uD55C\"]}),(0,e.jsxs)(n.p,{children:[\"\\uCD5C\\uC18C\\uD55C\\uC758 \\uAD8C\\uD55C\\uB9CC \\uC8FC\\uB294\\uAC8C Best practice\\uC9C0\\uB9CC \\uC77C\\uB2E8 Read\\uCABD \\uAD8C\\uD55C \\uC804\\uBD80\\uC640 \",(0,e.jsx)(n.code,{children:\"GetAuthorizationToken\"}),\"\\uB97C \\uCD94\\uAC00\\uD558\\uC5EC \\uD14C\\uC2A4\\uD2B8\\uB97C \\uC9C4\\uD589\\uD588\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Version\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Statement\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Sid\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"VisualEditor0\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Effect\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Action\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetRegistryPolicy\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeImageScanFindings\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetLifecyclePolicyPreview\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetDownloadUrlForLayer\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeRegistry\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribePullThroughCacheRules\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeImageReplicationStatus\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetAuthorizationToken\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:ListTagsForResource\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:ListImages\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:BatchGetRepositoryScanningConfiguration\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetRegistryScanningConfiguration\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:BatchGetImage\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeImages\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeRepositories\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:BatchCheckLayerAvailability\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetRepositoryPolicy\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetLifecyclePolicy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Resource\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"kubelet-restart\",children:[(0,e.jsx)(n.a,{href:\"#kubelet-restart\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"kubelet restart\"]}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uC0C8\\uB85C\\uC6B4 flag\\uAC00 \\uC801\\uC6A9\\uB418\\uB3C4\\uB85D restart\\uB97C \\uD558\\uBA74 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C ECR\\uC5D0\\uC11C image\\uB97C pull\\uD574\\uC628\\uB2E4. \\u{1F60E}\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" systemctl daemon-reload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart kubelet\n`]})})})]})}}var v=f;return y;})();\n;return Component;","toc":[{"value":"CronJob을 이용?","url":"#cronjob을-이용","depth":2},{"value":"Kubelet Crendential Provider를 사용","url":"#kubelet-crendential-provider를-사용","depth":2},{"value":"Kubelet flag 설정","url":"#kubelet-flag-설정","depth":3},{"value":"plugin binary 설정","url":"#plugin-binary-설정","depth":3},{"value":"config file 설정","url":"#config-file-설정","depth":3},{"value":"ECR pull 권한","url":"#ecr-pull-권한","depth":3},{"value":"kubelet restart","url":"#kubelet-restart","depth":3}],"frontMatter":{"readingTime":{"text":"4 min read","minutes":3.165,"time":189900,"words":633},"slug":"20230928-ecr-credential-provider","fileName":"20230928-ecr-credential-provider.md","title":"ECR Credential-Provider 사용해보기","date":"2023-09-28T00:00:00.000Z","tags":["kubernetes"],"summary":"Kubeadm으로 만든 Kubernetes Cluster에서 AWS ECR를 private container image repository를 사용하고자 하였다. private repository를 접근하기 위해서 Kubernetes 1.26부터 stable feature로 제공하는 kubelet crendential provider를 사용하였다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"S3에서 Internet으로 데이터 송신한 금액을 bucket별로 확인하기","date":"2023-09-28T00:00:00.000Z","tags":["aws"],"images":["/static/images/social-banner.png"],"summary":"인터넷에서 S3의 file을 다운로드하면 데이터 전송 비용이 발생한다. 서울 리전 기준으로는 처음 월 10TB까지는 GB당 0.126USD 요금이 발생한다. 이렇게 발생한 금액을 S3 bucket별로 나눠서 볼려면 어떻게 해야 할까? AWS Cost and Usage Report 서비스를 사용하면 세부적인 사용내역을 얻을 수 있고, 그 데이터를 분석하면 bucket별로 인터넷 데이터 전송에 의해 발생한 금액을 산출할 수 있다.","slug":"20230928-s3-data-transfer-out"},"next":{"title":"네이버 클라우드 certificate manager에 Lets encrypt 인증서 등록하기","date":"2023-10-14T00:00:00.000Z","tags":["ncloud"],"images":["/static/images/social-banner.png"],"summary":"Lets encrypt로 인증서를 발급하여 이것을 Naver Cloud Certificate Manager에 등록하려고 하였다. certbot을 통해서 인증서를 발급받고 해당 파일들을 Certificate manager에 등록하려고 하니 에러가 발생하였다. 이번 블로그 포스팅은 두 가지의 에러를 해결한 삽질기이다.","slug":"20231014-ncloud-certificate-manater"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20230928-ecr-credential-provider"]},"buildId":"eZWSqnOqf7fXW5G7Z80iH","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>