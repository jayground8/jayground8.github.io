<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기</title><meta name="robots" content="follow, index"/><meta name="description" content="ModSecurity는 오픈소스로 제공하는 WAF이다. Nginx connector를 통해서 ModSecurity를 Nginx에 쉽게 연동할 수 있다. Nginx Ingress Controller에서는 해당 설정을 할 수 있도록 Configmap에 설정 옵션들을 제공한다. 해당 옵션들을 설정함으로서 쉽게 Nginx에 WAF를 구현할 수 있다. ModSecurity는 Trustware라는 회사가 관리하다가 2024년 1월에 OWASP foundation으로 넘어가게 되었다. ModSecurity는 오래된 프로젝트이고, Production Ready라고 소개되고 있다. 하지만 ModSecurity가 앞으로도 계속 커뮤니티를 통해서 활발히 관리될지는 지켜봐야겠다."/><meta property="og:url" content="https://jayground8.github.io/blog/20240615-modsecurity"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="ModSecurity는 오픈소스로 제공하는 WAF이다. Nginx connector를 통해서 ModSecurity를 Nginx에 쉽게 연동할 수 있다. Nginx Ingress Controller에서는 해당 설정을 할 수 있도록 Configmap에 설정 옵션들을 제공한다. 해당 옵션들을 설정함으로서 쉽게 Nginx에 WAF를 구현할 수 있다. ModSecurity는 Trustware라는 회사가 관리하다가 2024년 1월에 OWASP foundation으로 넘어가게 되었다. ModSecurity는 오래된 프로젝트이고, Production Ready라고 소개되고 있다. 하지만 ModSecurity가 앞으로도 계속 커뮤니티를 통해서 활발히 관리될지는 지켜봐야겠다."/><meta property="og:title" content="ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기"/><meta name="twitter:description" content="ModSecurity는 오픈소스로 제공하는 WAF이다. Nginx connector를 통해서 ModSecurity를 Nginx에 쉽게 연동할 수 있다. Nginx Ingress Controller에서는 해당 설정을 할 수 있도록 Configmap에 설정 옵션들을 제공한다. 해당 옵션들을 설정함으로서 쉽게 Nginx에 WAF를 구현할 수 있다. ModSecurity는 Trustware라는 회사가 관리하다가 2024년 1월에 OWASP foundation으로 넘어가게 되었다. ModSecurity는 오래된 프로젝트이고, Production Ready라고 소개되고 있다. 하지만 ModSecurity가 앞으로도 계속 커뮤니티를 통해서 활발히 관리될지는 지켜봐야겠다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20240615-modsecurity"/><meta property="article:published_time" content="2024-06-15T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20240615-modsecurity"
  },
  "headline": "ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2024-06-15T00:00:00.000Z",
  "dateModified": "2024-06-15T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "ModSecurity는 오픈소스로 제공하는 WAF이다. Nginx connector를 통해서 ModSecurity를 Nginx에 쉽게 연동할 수 있다. Nginx Ingress Controller에서는 해당 설정을 할 수 있도록 Configmap에 설정 옵션들을 제공한다. 해당 옵션들을 설정함으로서 쉽게 Nginx에 WAF를 구현할 수 있다. ModSecurity는 Trustware라는 회사가 관리하다가 2024년 1월에 OWASP foundation으로 넘어가게 되었다. ModSecurity는 오래된 프로젝트이고, Production Ready라고 소개되고 있다. 하지만 ModSecurity가 앞으로도 계속 커뮤니티를 통해서 활발히 관리될지는 지켜봐야겠다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-629764b60735ac2a.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/SOn0VUl_eewdktCp3nF0I/_buildManifest.js" defer=""></script><script src="/_next/static/SOn0VUl_eewdktCp3nF0I/_ssgManifest.js" defer=""></script><script src="/_next/static/SOn0VUl_eewdktCp3nF0I/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-06-15T00:00:00.000Z">2024년 6월 15일 토요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="waf"><a href="#waf" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>WAF</h2><p>Kubernetes에서 Nginx Ingress Controller를 사용하고 있을 때, WAF가 필요하다고 하면 어떻게 해야 할까? <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.github.io/ingress-nginx/user-guide/third-party-addons/modsecurity/">Nginx Ingress Controller 문서</a>에서 친절하게 <a target="_blank" rel="noopener noreferrer" href="https://github.com/owasp-modsecurity/ModSecurity">ModSecurity</a>를 통해서 WAF를 적용할 수 있다고 설명이 되어 있다.</p><p><a target="_blank" rel="noopener noreferrer" href="https://www.modsecurity.org/">https://www.modsecurity.org/</a>로 접속을 해보면 아래와 같이 설명이 되어 있다.</p><img src="/static/images/modsecurity-webpage.png" alt="annoucement on a modsecurity webpage"/><p>Trustwave가 관리하던 해당 software를 2024년 1월부터 OWASP에서 담당하게 되었다고 한다. Trustwave가 Community version도 관리하면서 Enterprise Support를 제공하고 있었던 것 같다. 오픈소스 소프트웨어를 도입할 때는 해당 소프트웨어가 지속적으로 관리가 될 수 있을지 판단하게 된다. Nginx, Vault, Cilium, Grafana등은 Community 버전과 함께 특정 회사에서 Enterprise Support를 같이 제공한다. 특정 기능들이 Enterprise 라이센스에서만 제공되는 한계가 있지만, 그래도 해당 Community version도 담당하기 때문에 어느 정도 신뢰를 가지고 사용할 수 있었다. 또한 CNCF에 속한 프로젝트도 어느정도 신뢰를 가지고 사용할 수 있었다.</p><p>ModSecurity는 계속해서 커뮤니티에서 관리가 될 수 있는 프로젝트일까? <a target="_blank" rel="noopener noreferrer" href="https://owasp.org/projects/">여기에는 OWASP foundation에서 관리하는 프로젝트들이</a> 나와있다. 나에게 익숙한 프로젝트는 많지 않았다. 예전에 Supply Chain Security와 BOM에 대해서 조사할 때 봤던 CycloneDX 정도만 알고 있다. 그런데 <a target="_blank" rel="noopener noreferrer" href="https://coraza.io/">OWSAP에서 다른 WAF 프로젝트인 Coraza</a>도 존재한다. Nginx Ingress Controller에서는 해당 WAF 설정을 지원하지 않는 것으로 보이는데, 아직 <a target="_blank" rel="noopener noreferrer" href="https://github.com/corazawaf/coraza-nginx">OWSAP Coraza을 위한 Nginx Connector가 Production Ready로 준비된게 없는 것</a>으로 보인다. <a target="_blank" rel="noopener noreferrer" href="https://github.com/owasp-modsecurity/ModSecurity/releases">ModSecurity의 마지막 배포된 버전은 2024년 1월 31일에 배포된 v3.0.12 이다.</a> 앞으로 계속해서 새로운 버전이 배포가 되는지 확인을 해봐야겠다.</p><h2 id="설치"><a href="#설치" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>설치</h2><p>Nginx 설정을 Configmap으로 설정할 수 있는데, <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/">공식 문서</a>에서 어떤 옵션들이 있는지 확인할 수 있다. 설정 옵션들 중에 <code>ModSecurity</code>에 관련된 옵션은 아래와 같다.</p><ul><li>enable-modsecurity</li><li>enable-owasp-modsecurity-crs</li><li>modsecurity-snippet</li></ul><p><code>modsecurity-snippet</code>으로는 ModSecurity 설정들을 할수 있는데, <a target="_blank" rel="noopener noreferrer" href="https://github.com/owasp-modsecurity/ModSecurity/wiki/Reference-Manual-%28v2.x%29#user-content-SecAuditEngine">설정값들은 Github Wiki 문서</a>에서 확인할 수 있다.</p><p><code>SecRuleEngine</code> 설정으로 Rule이 적용될것인지 결정할 수 있다. <code>DetectionOnly</code>는 rule에 의해서 traffic에 영향이 가지 않고, 그냥 감지만 할 수 있다. <code>On</code>으로 설정하게 되면 Rule에 따라서 Traffic이 막힐 수도 있다. 따라서 처음에는 영향이 가지 않도록 <code>DetectionOnly</code>로 설정하여 확인해볼 수 있다.</p><ul><li>On: process rules</li><li>Off: do not process rules</li><li>DetectionOnly: process rules but never executes any disruptive actions (block, deny, drop, allow, proxy and redirect)</li></ul><p>그리고 <code>AuditLog</code> 설정을 통해서 로그들을 남길 수 있다.</p><ul><li>SecAuditLog</li><li>SecAuditLogFormat</li><li>SecAuditEngine</li></ul><p>최종적으로 Nginx Ingress Controller Helm value를 아래와 같이 정의할 수 있다. audit log를 JSON 형식으로 stdout으로 남기게 된다. 그리고 <code>SecAuditEngine</code>을 <code>RelevantOnly</code>라고 설정을 했는데, <code>SecAuditLogRelevantStatus &quot;^(?:5|4(?!04))&quot;</code>로 기본 설정되어 있기 때문에 404빼고 4xx, 5xx status code에 대해서 log를 남기게 된다. 그리고 rule은 <a target="_blank" rel="noopener noreferrer" href="https://owasp.org/www-project-modsecurity-core-rule-set/">OWASP ModSecurity Core Rule Set</a>이 적용되도록 <code>enable-owasp-modsecurity-crs</code>을 true로 설정하였다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">controller</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">config</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">enable-modsecurity</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">    <span class="token atrule key">enable-owasp-modsecurity-crs</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">    <span class="token atrule key">modsecurity-snippet</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">      SecRuleEngine DetectionOnly
</span></span><span class="code-line"><span class="token string scalar">      SecStatusEngine Off
</span></span><span class="code-line"><span class="token string scalar">      SecAuditLog /dev/stdout
</span></span><span class="code-line"><span class="token string scalar">      SecAuditLogFormat JSON
</span></span><span class="code-line"><span class="token string scalar">      SecAuditEngine RelevantOnly</span>
</span></code></pre></div><p>최종 설정된 설정값은 Nginx controller container에서 아래 경로로 저장되어 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">cat</span> /etc/nginx/modsecurity/modsecurity.conf
</span></code></pre></div><p>그리고 Rule들이 아래의 경로로 저장되어 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">ls</span> /etc/nginx/owasp-modsecurity-crs/rules
</span></code></pre></div><h2 id="동작-확인"><a href="#동작-확인" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>동작 확인</h2><p>위의 values 적용하여 Helm으로 ModSecurity에 대한 설정값을 반영한다. 그러면 아래와 같이 stdout으로 log가 남는 것을 확인할 수 있다. HTTP PUT method로 요청이 왔을 때, OWASP ModSecurity Core Rule에 의해서 감지가 된 것이다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;transaction&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;client_ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.2.3.43&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;time_stamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Fri Jun 14 11:20:00 2024&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;server_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4c0ebcf3510333a0fbab30ac91370a728678087c&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;client_port&quot;</span><span class="token operator">:</span> <span class="token number">61320</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;host_ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.2.3.150&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;host_port&quot;</span><span class="token operator">:</span> <span class="token number">443</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;unique_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;171835464041.816920&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;http_version&quot;</span><span class="token operator">:</span> <span class="token number">1.1</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/test&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;headers&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">&quot;Host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;User-Agent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;python-requests/2.19.1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Accept-Encoding&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gzip, deflate&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Accept&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*/*&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Connection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keep-alive&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Content-Length&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;http_code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;headers&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">&quot;Referrer-Policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no-referrer&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Origin-Agent-Cluster&quot;</span><span class="token operator">:</span> <span class="token string">&quot;?1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Cross-Origin-Opener-Policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;same-origin&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Content-Security-Policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;default-src &#x27;self&#x27;;base-uri &#x27;self&#x27;;font-src &#x27;self&#x27; https: data:;form-action &#x27;self&#x27;;frame-ancestors &#x27;self&#x27;;img-src &#x27;self&#x27; data:;object-src &#x27;none&#x27;;script-src &#x27;self&#x27;;script-src-attr &#x27;none&#x27;;style-src &#x27;self&#x27; https: &#x27;unsafe-inline&#x27;;upgrade-insecure-requests&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Cross-Origin-Resource-Policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;same-origin&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-DNS-Prefetch-Control&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Connection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keep-alive&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/html; charset=utf-8&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Content-Length&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Fri, 14 Jun 2024 11:20:00 GMT&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;Strict-Transport-Security&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max-age=31536000; includeSubDomains&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;ETag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;W/\&quot;2-eoX0dku9ba8cNUXvu/DyeabcC+s\&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-Content-Type-Options&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nosniff&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-Download-Options&quot;</span><span class="token operator">:</span> <span class="token string">&quot;noopen&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-Frame-Options&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SAMEORIGIN&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-Permitted-Cross-Domain-Policies&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-XSS-Protection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;X-Request-IP&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.2.3.43&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;producer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;modsecurity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ModSecurity v3.0.8 (Linux)&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;connector&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ModSecurity-nginx v1.0.3&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;secrules_engine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DetectionOnly&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;components&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;OWASP_CRS/3.3.5\&quot;&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;messages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Method is not allowed by policy&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Matched \&quot;Operator `Within&#x27; with parameter `GET HEAD POST OPTIONS&#x27; against variable `REQUEST_METHOD&#x27; (Value: `PUT&#x27; )&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;reference&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v0,3&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;ruleId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;911100&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-911-METHOD-ENFORCEMENT.conf&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;lineNumber&quot;</span><span class="token operator">:</span> <span class="token string">&quot;28&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;ver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OWASP_CRS/3.3.5&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;rev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">            <span class="token string">&quot;application-multi&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;language-multi&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;platform-multi&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;attack-generic&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;paranoia-level/1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;OWASP_CRS&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;capec/1000/210/272/220/274&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&quot;PCI/12.1&quot;</span>
</span><span class="code-line">          <span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;maturity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;accuracy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Inbound Anomaly Score Exceeded (Total Score: 5)&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Matched \&quot;Operator `Ge&#x27; with parameter `5&#x27; against variable `TX:ANOMALY_SCORE&#x27; (Value: `5&#x27; )&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;reference&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;ruleId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;949110&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;lineNumber&quot;</span><span class="token operator">:</span> <span class="token string">&quot;81&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;ver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OWASP_CRS/3.3.5&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;rev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;application-multi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;language-multi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;platform-multi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attack-generic&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;maturity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;accuracy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>아래처럼 <code>tx.allowed_methods</code> 에 정의된 method만 허용가능하도록 Rule이 설정되어 있다.</p><p><code>REQUEST-949-BLOCKING-EVALUATION.conf</code></p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">SecRule REQUEST_METHOD <span class="token string">&quot;!@within %{tx.allowed_methods}&quot;</span> <span class="token punctuation">\</span>
</span><span class="code-line">    <span class="token string">&quot;id:911100,\
</span></span><span class="code-line"><span class="token string">    phase:2,\
</span></span><span class="code-line"><span class="token string">    block,\
</span></span><span class="code-line"><span class="token string">    msg:&#x27;Method is not allowed by policy&#x27;,\
</span></span><span class="code-line"><span class="token string">    logdata:&#x27;%{MATCHED_VAR}&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;application-multi&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;language-multi&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;platform-multi&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;attack-generic&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;paranoia-level/1&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;OWASP_CRS&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;capec/1000/210/272/220/274&#x27;,\
</span></span><span class="code-line"><span class="token string">    tag:&#x27;PCI/12.1&#x27;,\
</span></span><span class="code-line"><span class="token string">    ver:&#x27;OWASP_CRS/3.3.5&#x27;,\
</span></span><span class="code-line"><span class="token string">    severity:&#x27;CRITICAL&#x27;,\
</span></span><span class="code-line"><span class="token string">    setvar:&#x27;tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}&#x27;&quot;</span>
</span></code></pre></div><p>그리고 <code>allowed_methods</code>는 아래와 같은 Method만 정의가 되어 있다. 따라서 PUT은 허용되지 않았다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">tx.allowed_methods<span class="token operator">=</span>GET HEAD POST OPTION
</span></code></pre></div><p>이제 <code>SecAction</code>을 통해서 <code>allowed_methods</code>를 아래와 같이 원하는 값으로 override하도록 설정한다. 그리고 다시 Helm으로 해당 value로 업그레이드를 한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">config</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">enable-modsecurity</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">  <span class="token atrule key">enable-owasp-modsecurity-crs</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">  <span class="token atrule key">modsecurity-snippet</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">    SecRuleEngine DetectionOnly
</span></span><span class="code-line"><span class="token string scalar">    SecStatusEngine Off
</span></span><span class="code-line"><span class="token string scalar">    SecAuditLog /dev/stdout
</span></span><span class="code-line"><span class="token string scalar">    SecAuditLogFormat JSON
</span></span><span class="code-line"><span class="token string scalar">    SecAuditEngine RelevantOnly
</span></span><span class="code-line"><span class="token string scalar">    SecAction &quot;id:900200,phase:1,nolog,pass,t:none,setvar:&#x27;tx.allowed_methods=GET HEAD POST OPTIONS PUT&#x27;&quot;</span>
</span></code></pre></div><p>그러면 이제 stdout으로 남던 log가 사라진것을 확인할 수 있다.</p><p><code>SecRule</code>을 통해서 원하는 custom rule들을 추가할 수 있는데, 아래는 local network로 오는 경우에는 RuleEngine을 Off하도록 정의한 예이다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">SecRule REMOTE_ADDR <span class="token string">&quot;@ipMatch 127.0.0.1&quot;</span> <span class="token string">&quot;id:87,phase:1,pass,nolog,ctl:ruleEngine=Off&quot;</span>
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>오픈소스 WAF인 ModSecurity 덕분에 빠르게 Nginx에 WAF를 구현할 수 있었다. 해당 프로젝트가 OWSAP Foundation으로 이관되고 어떻게 관리되는지 계속해서 관심을 가져야겠다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/nginx">nginx</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/modsecurity">modsecurity</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/devsecops">devsecops</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240602-book-review-winning-organization">성공하는 조직은 어떠한 특성을 가지고 있을까?</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240713-vault-audit">Vault Audit Log를 남기기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var r=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{r(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of d(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=p(s,n))||c.enumerable});return a},g=a=\u003ek(r(l(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var i=N((A,t)=\u003e{t.exports=_jsx_runtime});var O={};u(O,{default:()=\u003ef,frontmatter:()=\u003ey});var e=g(i()),y={title:\"ModSecurity\\uB97C Nginx Ingress Controller\\uC5D0 \\uC5F0\\uB3D9\\uD558\\uC5EC WAF \\uC124\\uC815\\uD558\\uAE30\",date:\"2024-06-15\",tags:[\"kubernetes\",\"nginx\",\"modsecurity\",\"devsecops\"],images:[\"/static/images/social-banner.png\"],summary:\"ModSecurity\\uB294 \\uC624\\uD508\\uC18C\\uC2A4\\uB85C \\uC81C\\uACF5\\uD558\\uB294 WAF\\uC774\\uB2E4. Nginx connector\\uB97C \\uD1B5\\uD574\\uC11C ModSecurity\\uB97C Nginx\\uC5D0 \\uC27D\\uAC8C \\uC5F0\\uB3D9\\uD560 \\uC218 \\uC788\\uB2E4. Nginx Ingress Controller\\uC5D0\\uC11C\\uB294 \\uD574\\uB2F9 \\uC124\\uC815\\uC744 \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D Configmap\\uC5D0 \\uC124\\uC815 \\uC635\\uC158\\uB4E4\\uC744 \\uC81C\\uACF5\\uD55C\\uB2E4. \\uD574\\uB2F9 \\uC635\\uC158\\uB4E4\\uC744 \\uC124\\uC815\\uD568\\uC73C\\uB85C\\uC11C \\uC27D\\uAC8C Nginx\\uC5D0 WAF\\uB97C \\uAD6C\\uD604\\uD560 \\uC218 \\uC788\\uB2E4. ModSecurity\\uB294 Trustware\\uB77C\\uB294 \\uD68C\\uC0AC\\uAC00 \\uAD00\\uB9AC\\uD558\\uB2E4\\uAC00 2024\\uB144 1\\uC6D4\\uC5D0 OWASP foundation\\uC73C\\uB85C \\uB118\\uC5B4\\uAC00\\uAC8C \\uB418\\uC5C8\\uB2E4. ModSecurity\\uB294 \\uC624\\uB798\\uB41C \\uD504\\uB85C\\uC81D\\uD2B8\\uC774\\uACE0, Production Ready\\uB77C\\uACE0 \\uC18C\\uAC1C\\uB418\\uACE0 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC ModSecurity\\uAC00 \\uC55E\\uC73C\\uB85C\\uB3C4 \\uACC4\\uC18D \\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uB97C \\uD1B5\\uD574\\uC11C \\uD65C\\uBC1C\\uD788 \\uAD00\\uB9AC\\uB420\\uC9C0\\uB294 \\uC9C0\\uCF1C\\uBD10\\uC57C\\uACA0\\uB2E4.\"};function S(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",ul:\"ul\",li:\"li\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"waf\",children:[(0,e.jsx)(n.a,{href:\"#waf\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"WAF\"]}),(0,e.jsxs)(n.p,{children:[\"Kubernetes\\uC5D0\\uC11C Nginx Ingress Controller\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uC744 \\uB54C, WAF\\uAC00 \\uD544\\uC694\\uD558\\uB2E4\\uACE0 \\uD558\\uBA74 \\uC5B4\\uB5BB\\uAC8C \\uD574\\uC57C \\uD560\\uAE4C? \",(0,e.jsx)(n.a,{href:\"https://kubernetes.github.io/ingress-nginx/user-guide/third-party-addons/modsecurity/\",children:\"Nginx Ingress Controller \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uCE5C\\uC808\\uD558\\uAC8C \",(0,e.jsx)(n.a,{href:\"https://github.com/owasp-modsecurity/ModSecurity\",children:\"ModSecurity\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C WAF\\uB97C \\uC801\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4\\uACE0 \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://www.modsecurity.org/\",children:\"https://www.modsecurity.org/\"}),\"\\uB85C \\uC811\\uC18D\\uC744 \\uD574\\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/modsecurity-webpage.png\",alt:\"annoucement on a modsecurity webpage\"}),(0,e.jsx)(n.p,{children:\"Trustwave\\uAC00 \\uAD00\\uB9AC\\uD558\\uB358 \\uD574\\uB2F9 software\\uB97C 2024\\uB144 1\\uC6D4\\uBD80\\uD130 OWASP\\uC5D0\\uC11C \\uB2F4\\uB2F9\\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4\\uACE0 \\uD55C\\uB2E4. Trustwave\\uAC00 Community version\\uB3C4 \\uAD00\\uB9AC\\uD558\\uBA74\\uC11C Enterprise Support\\uB97C \\uC81C\\uACF5\\uD558\\uACE0 \\uC788\\uC5C8\\uB358 \\uAC83 \\uAC19\\uB2E4. \\uC624\\uD508\\uC18C\\uC2A4 \\uC18C\\uD504\\uD2B8\\uC6E8\\uC5B4\\uB97C \\uB3C4\\uC785\\uD560 \\uB54C\\uB294 \\uD574\\uB2F9 \\uC18C\\uD504\\uD2B8\\uC6E8\\uC5B4\\uAC00 \\uC9C0\\uC18D\\uC801\\uC73C\\uB85C \\uAD00\\uB9AC\\uAC00 \\uB420 \\uC218 \\uC788\\uC744\\uC9C0 \\uD310\\uB2E8\\uD558\\uAC8C \\uB41C\\uB2E4. Nginx, Vault, Cilium, Grafana\\uB4F1\\uC740 Community \\uBC84\\uC804\\uACFC \\uD568\\uAED8 \\uD2B9\\uC815 \\uD68C\\uC0AC\\uC5D0\\uC11C Enterprise Support\\uB97C \\uAC19\\uC774 \\uC81C\\uACF5\\uD55C\\uB2E4. \\uD2B9\\uC815 \\uAE30\\uB2A5\\uB4E4\\uC774 Enterprise \\uB77C\\uC774\\uC13C\\uC2A4\\uC5D0\\uC11C\\uB9CC \\uC81C\\uACF5\\uB418\\uB294 \\uD55C\\uACC4\\uAC00 \\uC788\\uC9C0\\uB9CC, \\uADF8\\uB798\\uB3C4 \\uD574\\uB2F9 Community version\\uB3C4 \\uB2F4\\uB2F9\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC5B4\\uB290 \\uC815\\uB3C4 \\uC2E0\\uB8B0\\uB97C \\uAC00\\uC9C0\\uACE0 \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4. \\uB610\\uD55C CNCF\\uC5D0 \\uC18D\\uD55C \\uD504\\uB85C\\uC81D\\uD2B8\\uB3C4 \\uC5B4\\uB290\\uC815\\uB3C4 \\uC2E0\\uB8B0\\uB97C \\uAC00\\uC9C0\\uACE0 \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[\"ModSecurity\\uB294 \\uACC4\\uC18D\\uD574\\uC11C \\uCEE4\\uBBA4\\uB2C8\\uD2F0\\uC5D0\\uC11C \\uAD00\\uB9AC\\uAC00 \\uB420 \\uC218 \\uC788\\uB294 \\uD504\\uB85C\\uC81D\\uD2B8\\uC77C\\uAE4C? \",(0,e.jsx)(n.a,{href:\"https://owasp.org/projects/\",children:\"\\uC5EC\\uAE30\\uC5D0\\uB294 OWASP foundation\\uC5D0\\uC11C \\uAD00\\uB9AC\\uD558\\uB294 \\uD504\\uB85C\\uC81D\\uD2B8\\uB4E4\\uC774\"}),\" \\uB098\\uC640\\uC788\\uB2E4. \\uB098\\uC5D0\\uAC8C \\uC775\\uC219\\uD55C \\uD504\\uB85C\\uC81D\\uD2B8\\uB294 \\uB9CE\\uC9C0 \\uC54A\\uC558\\uB2E4. \\uC608\\uC804\\uC5D0 Supply Chain Security\\uC640 BOM\\uC5D0 \\uB300\\uD574\\uC11C \\uC870\\uC0AC\\uD560 \\uB54C \\uBD24\\uB358 CycloneDX \\uC815\\uB3C4\\uB9CC \\uC54C\\uACE0 \\uC788\\uB2E4. \\uADF8\\uB7F0\\uB370 \",(0,e.jsx)(n.a,{href:\"https://coraza.io/\",children:\"OWSAP\\uC5D0\\uC11C \\uB2E4\\uB978 WAF \\uD504\\uB85C\\uC81D\\uD2B8\\uC778 Coraza\"}),\"\\uB3C4 \\uC874\\uC7AC\\uD55C\\uB2E4. Nginx Ingress Controller\\uC5D0\\uC11C\\uB294 \\uD574\\uB2F9 WAF \\uC124\\uC815\\uC744 \\uC9C0\\uC6D0\\uD558\\uC9C0 \\uC54A\\uB294 \\uAC83\\uC73C\\uB85C \\uBCF4\\uC774\\uB294\\uB370, \\uC544\\uC9C1 \",(0,e.jsx)(n.a,{href:\"https://github.com/corazawaf/coraza-nginx\",children:\"OWSAP Coraza\\uC744 \\uC704\\uD55C Nginx Connector\\uAC00 Production Ready\\uB85C \\uC900\\uBE44\\uB41C\\uAC8C \\uC5C6\\uB294 \\uAC83\"}),\"\\uC73C\\uB85C \\uBCF4\\uC778\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://github.com/owasp-modsecurity/ModSecurity/releases\",children:\"ModSecurity\\uC758 \\uB9C8\\uC9C0\\uB9C9 \\uBC30\\uD3EC\\uB41C \\uBC84\\uC804\\uC740 2024\\uB144 1\\uC6D4 31\\uC77C\\uC5D0 \\uBC30\\uD3EC\\uB41C v3.0.12 \\uC774\\uB2E4.\"}),\" \\uC55E\\uC73C\\uB85C \\uACC4\\uC18D\\uD574\\uC11C \\uC0C8\\uB85C\\uC6B4 \\uBC84\\uC804\\uC774 \\uBC30\\uD3EC\\uAC00 \\uB418\\uB294\\uC9C0 \\uD655\\uC778\\uC744 \\uD574\\uBD10\\uC57C\\uACA0\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"\\uC124\\uCE58\",children:[(0,e.jsx)(n.a,{href:\"#\\uC124\\uCE58\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uC124\\uCE58\"]}),(0,e.jsxs)(n.p,{children:[\"Nginx \\uC124\\uC815\\uC744 Configmap\\uC73C\\uB85C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB294\\uB370, \",(0,e.jsx)(n.a,{href:\"https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/\",children:\"\\uACF5\\uC2DD \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uC5B4\\uB5A4 \\uC635\\uC158\\uB4E4\\uC774 \\uC788\\uB294\\uC9C0 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \\uC124\\uC815 \\uC635\\uC158\\uB4E4 \\uC911\\uC5D0 \",(0,e.jsx)(n.code,{children:\"ModSecurity\"}),\"\\uC5D0 \\uAD00\\uB828\\uB41C \\uC635\\uC158\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"enable-modsecurity\"}),(0,e.jsx)(n.li,{children:\"enable-owasp-modsecurity-crs\"}),(0,e.jsx)(n.li,{children:\"modsecurity-snippet\"})]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"modsecurity-snippet\"}),\"\\uC73C\\uB85C\\uB294 ModSecurity \\uC124\\uC815\\uB4E4\\uC744 \\uD560\\uC218 \\uC788\\uB294\\uB370, \",(0,e.jsx)(n.a,{href:\"https://github.com/owasp-modsecurity/ModSecurity/wiki/Reference-Manual-%28v2.x%29#user-content-SecAuditEngine\",children:\"\\uC124\\uC815\\uAC12\\uB4E4\\uC740 Github Wiki \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"SecRuleEngine\"}),\" \\uC124\\uC815\\uC73C\\uB85C Rule\\uC774 \\uC801\\uC6A9\\uB420\\uAC83\\uC778\\uC9C0 \\uACB0\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"DetectionOnly\"}),\"\\uB294 rule\\uC5D0 \\uC758\\uD574\\uC11C traffic\\uC5D0 \\uC601\\uD5A5\\uC774 \\uAC00\\uC9C0 \\uC54A\\uACE0, \\uADF8\\uB0E5 \\uAC10\\uC9C0\\uB9CC \\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"On\"}),\"\\uC73C\\uB85C \\uC124\\uC815\\uD558\\uAC8C \\uB418\\uBA74 Rule\\uC5D0 \\uB530\\uB77C\\uC11C Traffic\\uC774 \\uB9C9\\uD790 \\uC218\\uB3C4 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uCC98\\uC74C\\uC5D0\\uB294 \\uC601\\uD5A5\\uC774 \\uAC00\\uC9C0 \\uC54A\\uB3C4\\uB85D \",(0,e.jsx)(n.code,{children:\"DetectionOnly\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uC5EC \\uD655\\uC778\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"On: process rules\"}),(0,e.jsx)(n.li,{children:\"Off: do not process rules\"}),(0,e.jsx)(n.li,{children:\"DetectionOnly: process rules but never executes any disruptive actions (block, deny, drop, allow, proxy and redirect)\"})]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"AuditLog\"}),\" \\uC124\\uC815\\uC744 \\uD1B5\\uD574\\uC11C \\uB85C\\uADF8\\uB4E4\\uC744 \\uB0A8\\uAE38 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"SecAuditLog\"}),(0,e.jsx)(n.li,{children:\"SecAuditLogFormat\"}),(0,e.jsx)(n.li,{children:\"SecAuditEngine\"})]}),(0,e.jsxs)(n.p,{children:[\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C Nginx Ingress Controller Helm value\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. audit log\\uB97C JSON \\uD615\\uC2DD\\uC73C\\uB85C stdout\\uC73C\\uB85C \\uB0A8\\uAE30\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"SecAuditEngine\"}),\"\\uC744 \",(0,e.jsx)(n.code,{children:\"RelevantOnly\"}),\"\\uB77C\\uACE0 \\uC124\\uC815\\uC744 \\uD588\\uB294\\uB370, \",(0,e.jsx)(n.code,{children:'SecAuditLogRelevantStatus \"^(?:5|4(?!04))\"'}),\"\\uB85C \\uAE30\\uBCF8 \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0 404\\uBE7C\\uACE0 4xx, 5xx status code\\uC5D0 \\uB300\\uD574\\uC11C log\\uB97C \\uB0A8\\uAE30\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB9AC\\uACE0 rule\\uC740 \",(0,e.jsx)(n.a,{href:\"https://owasp.org/www-project-modsecurity-core-rule-set/\",children:\"OWASP ModSecurity Core Rule Set\"}),\"\\uC774 \\uC801\\uC6A9\\uB418\\uB3C4\\uB85D \",(0,e.jsx)(n.code,{children:\"enable-owasp-modsecurity-crs\"}),\"\\uC744 true\\uB85C \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"controller\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enable-modsecurity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enable-owasp-modsecurity-crs\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"modsecurity-snippet\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      SecRuleEngine DetectionOnly\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      SecStatusEngine Off\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      SecAuditLog /dev/stdout\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      SecAuditLogFormat JSON\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"      SecAuditEngine RelevantOnly\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uCD5C\\uC885 \\uC124\\uC815\\uB41C \\uC124\\uC815\\uAC12\\uC740 Nginx controller container\\uC5D0\\uC11C \\uC544\\uB798 \\uACBD\\uB85C\\uB85C \\uC800\\uC7A5\\uB418\\uC5B4 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /etc/nginx/modsecurity/modsecurity.conf\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB9AC\\uACE0 Rule\\uB4E4\\uC774 \\uC544\\uB798\\uC758 \\uACBD\\uB85C\\uB85C \\uC800\\uC7A5\\uB418\\uC5B4 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),` /etc/nginx/owasp-modsecurity-crs/rules\n`]})})}),(0,e.jsxs)(n.h2,{id:\"\\uB3D9\\uC791-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{href:\"#\\uB3D9\\uC791-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uB3D9\\uC791 \\uD655\\uC778\"]}),(0,e.jsx)(n.p,{children:\"\\uC704\\uC758 values \\uC801\\uC6A9\\uD558\\uC5EC Helm\\uC73C\\uB85C ModSecurity\\uC5D0 \\uB300\\uD55C \\uC124\\uC815\\uAC12\\uC744 \\uBC18\\uC601\\uD55C\\uB2E4. \\uADF8\\uB7EC\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 stdout\\uC73C\\uB85C log\\uAC00 \\uB0A8\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. HTTP PUT method\\uB85C \\uC694\\uCCAD\\uC774 \\uC654\\uC744 \\uB54C, OWASP ModSecurity Core Rule\\uC5D0 \\uC758\\uD574\\uC11C \\uAC10\\uC9C0\\uAC00 \\uB41C \\uAC83\\uC774\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"transaction\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"client_ip\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.2.3.43\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"time_stamp\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Fri Jun 14 11:20:00 2024\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"server_id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"4c0ebcf3510333a0fbab30ac91370a728678087c\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"client_port\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"61320\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"host_ip\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.2.3.150\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"host_port\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"unique_id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"171835464041.816920\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"request\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"method\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"PUT\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"http_version\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1.1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"uri\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/test\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"body\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"headers\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Host\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"example.com\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"User-Agent\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"python-requests/2.19.1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Accept-Encoding\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"gzip, deflate\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Accept\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*/*\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Connection\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"keep-alive\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Content-Length\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"response\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"http_code\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"headers\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Referrer-Policy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"no-referrer\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Origin-Agent-Cluster\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"?1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Cross-Origin-Opener-Policy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"same-origin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Content-Security-Policy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`\"default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests\"`}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Cross-Origin-Resource-Policy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"same-origin\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-DNS-Prefetch-Control\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"off\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Connection\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"keep-alive\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Access-Control-Allow-Origin\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Content-Type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"text/html; charset=utf-8\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Content-Length\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Date\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Fri, 14 Jun 2024 11:20:00 GMT\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Server\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Server\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Strict-Transport-Security\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"max-age=31536000; includeSubDomains\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ETag\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"W/\\\\\"2-eoX0dku9ba8cNUXvu/DyeabcC+s\\\\\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-Content-Type-Options\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nosniff\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-Download-Options\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"noopen\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-Frame-Options\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"SAMEORIGIN\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-Permitted-Cross-Domain-Policies\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"none\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-XSS-Protection\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"X-Request-IP\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.2.3.43\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"producer\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"modsecurity\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ModSecurity v3.0.8 (Linux)\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"connector\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ModSecurity-nginx v1.0.3\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"secrules_engine\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"DetectionOnly\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"components\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"OWASP_CRS/3.3.5\\\\\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"messages\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Method is not allowed by policy\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"details\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"match\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"\\\"Matched \\\\\\\"Operator `Within' with parameter `GET HEAD POST OPTIONS' against variable `REQUEST_METHOD' (Value: `PUT' )\\\"\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"reference\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"v0,3\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ruleId\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"911100\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"file\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-911-METHOD-ENFORCEMENT.conf\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"lineNumber\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"28\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"data\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"PUT\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"severity\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ver\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"OWASP_CRS/3.3.5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rev\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"application-multi\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"language-multi\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"platform-multi\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"attack-generic\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"paranoia-level/1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"OWASP_CRS\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"capec/1000/210/272/220/274\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"PCI/12.1\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"maturity\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"accuracy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Inbound Anomaly Score Exceeded (Total Score: 5)\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"details\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"match\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"\\\"Matched \\\\\\\"Operator `Ge' with parameter `5' against variable `TX:ANOMALY_SCORE' (Value: `5' )\\\"\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"reference\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ruleId\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"949110\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"file\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"lineNumber\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"81\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"data\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"severity\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ver\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"OWASP_CRS/3.3.5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"rev\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"application-multi\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"language-multi\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"platform-multi\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"attack-generic\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"maturity\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"accuracy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC544\\uB798\\uCC98\\uB7FC \",(0,e.jsx)(n.code,{children:\"tx.allowed_methods\"}),\" \\uC5D0 \\uC815\\uC758\\uB41C method\\uB9CC \\uD5C8\\uC6A9\\uAC00\\uB2A5\\uD558\\uB3C4\\uB85D Rule\\uC774 \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"REQUEST-949-BLOCKING-EVALUATION.conf\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SecRule REQUEST_METHOD \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"!@within %{tx.allowed_methods}\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:`\"id:911100,\\\\\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    phase:2,\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    block,\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    msg:'Method is not allowed by policy',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    logdata:'%{MATCHED_VAR}',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'application-multi',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'language-multi',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'platform-multi',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'attack-generic',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'paranoia-level/1',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'OWASP_CRS',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'capec/1000/210/272/220/274',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    tag:'PCI/12.1',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    ver:'OWASP_CRS/3.3.5',\\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    severity:'CRITICAL',\\\\\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:`    setvar:'tx.anomaly_score_pl1=+%{tx.critical_anomaly_score}'\"`}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"allowed_methods\"}),\"\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uC740 Method\\uB9CC \\uC815\\uC758\\uAC00 \\uB418\\uC5B4 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C PUT\\uC740 \\uD5C8\\uC6A9\\uB418\\uC9C0 \\uC54A\\uC558\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"tx.allowed_methods\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`GET HEAD POST OPTION\n`]})})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C \",(0,e.jsx)(n.code,{children:\"SecAction\"}),\"\\uC744 \\uD1B5\\uD574\\uC11C \",(0,e.jsx)(n.code,{children:\"allowed_methods\"}),\"\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC6D0\\uD558\\uB294 \\uAC12\\uC73C\\uB85C override\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uB2E4\\uC2DC Helm\\uC73C\\uB85C \\uD574\\uB2F9 value\\uB85C \\uC5C5\\uADF8\\uB808\\uC774\\uB4DC\\uB97C \\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enable-modsecurity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enable-owasp-modsecurity-crs\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"modsecurity-snippet\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    SecRuleEngine DetectionOnly\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    SecStatusEngine Off\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    SecAuditLog /dev/stdout\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    SecAuditLogFormat JSON\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    SecAuditEngine RelevantOnly\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    SecAction \"id:900200,phase:1,nolog,pass,t:none,setvar:'tx.allowed_methods=GET HEAD POST OPTIONS PUT'\"`}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB7EC\\uBA74 \\uC774\\uC81C stdout\\uC73C\\uB85C \\uB0A8\\uB358 log\\uAC00 \\uC0AC\\uB77C\\uC9C4\\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"SecRule\"}),\"\\uC744 \\uD1B5\\uD574\\uC11C \\uC6D0\\uD558\\uB294 custom rule\\uB4E4\\uC744 \\uCD94\\uAC00\\uD560 \\uC218 \\uC788\\uB294\\uB370, \\uC544\\uB798\\uB294 local network\\uB85C \\uC624\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB294 RuleEngine\\uC744 Off\\uD558\\uB3C4\\uB85D \\uC815\\uC758\\uD55C \\uC608\\uC774\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SecRule REMOTE_ADDR \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"@ipMatch 127.0.0.1\"'}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"id:87,phase:1,pass,nolog,ctl:ruleEngine=Off\"'}),`\n`]})})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(n.p,{children:\"\\uC624\\uD508\\uC18C\\uC2A4 WAF\\uC778 ModSecurity \\uB355\\uBD84\\uC5D0 \\uBE60\\uB974\\uAC8C Nginx\\uC5D0 WAF\\uB97C \\uAD6C\\uD604\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4. \\uD574\\uB2F9 \\uD504\\uB85C\\uC81D\\uD2B8\\uAC00 OWSAP Foundation\\uC73C\\uB85C \\uC774\\uAD00\\uB418\\uACE0 \\uC5B4\\uB5BB\\uAC8C \\uAD00\\uB9AC\\uB418\\uB294\\uC9C0 \\uACC4\\uC18D\\uD574\\uC11C \\uAD00\\uC2EC\\uC744 \\uAC00\\uC838\\uC57C\\uACA0\\uB2E4.\"})]})}}var f=S;return O;})();\n;return Component;","toc":[{"value":"WAF","url":"#waf","depth":2},{"value":"설치","url":"#설치","depth":2},{"value":"동작 확인","url":"#동작-확인","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.29,"time":437400,"words":1458},"slug":"20240615-modsecurity","fileName":"20240615-modsecurity.md","title":"ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기","date":"2024-06-15T00:00:00.000Z","tags":["kubernetes","nginx","modsecurity","devsecops"],"images":["/static/images/social-banner.png"],"summary":"ModSecurity는 오픈소스로 제공하는 WAF이다. Nginx connector를 통해서 ModSecurity를 Nginx에 쉽게 연동할 수 있다. Nginx Ingress Controller에서는 해당 설정을 할 수 있도록 Configmap에 설정 옵션들을 제공한다. 해당 옵션들을 설정함으로서 쉽게 Nginx에 WAF를 구현할 수 있다. ModSecurity는 Trustware라는 회사가 관리하다가 2024년 1월에 OWASP foundation으로 넘어가게 되었다. ModSecurity는 오래된 프로젝트이고, Production Ready라고 소개되고 있다. 하지만 ModSecurity가 앞으로도 계속 커뮤니티를 통해서 활발히 관리될지는 지켜봐야겠다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"성공하는 조직은 어떠한 특성을 가지고 있을까?","date":"2024-06-02T00:00:00.000Z","tags":["book"],"images":["/static/images/social-banner.png"],"summary":"두 권의 책 Wiring the winning organization과 최고의 팀은 무엇이 다른가(The secrets of highly successful groups)을 읽었다. 성공하는 조직은 어떠한 특성을 가지고 있는지 두 권의 책으로 살펴보았다.","slug":"20240602-book-review-winning-organization"},"next":{"title":"Vault Audit Log를 남기기","date":"2024-07-13T00:00:00.000Z","tags":["vault","devsecops"],"images":["/static/images/social-banner.png"],"summary":"Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다.","slug":"20240713-vault-audit"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20240615-modsecurity"]},"buildId":"SOn0VUl_eewdktCp3nF0I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>