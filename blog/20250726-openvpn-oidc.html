<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Adding OIDC Authentication to OpenVPN Community Server</title><meta name="robots" content="follow, index"/><meta name="description" content=""/><meta property="og:url" content="https://jayground8.github.io/blog/20250726-openvpn-oidc"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content=""/><meta property="og:title" content="Adding OIDC Authentication to OpenVPN Community Server"/><meta property="og:image" content="https://jayground8.github.io/static/images/thumbnail/openvpn.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Adding OIDC Authentication to OpenVPN Community Server"/><meta name="twitter:description" content=""/><meta name="twitter:image" content="https://jayground8.github.io/static/images/thumbnail/openvpn.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20250726-openvpn-oidc"/><meta property="article:published_time" content="2025-07-26T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20250726-openvpn-oidc"
  },
  "headline": "Adding OIDC Authentication to OpenVPN Community Server",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/thumbnail/openvpn.png"
    }
  ],
  "datePublished": "2025-07-26T00:00:00.000Z",
  "dateModified": "2025-07-26T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": ""
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e9fc7f3433b9eec.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/W4OJIiHqN_WQQ9TfZMwI5/_buildManifest.js" defer=""></script><script src="/_next/static/W4OJIiHqN_WQQ9TfZMwI5/_ssgManifest.js" defer=""></script><script src="/_next/static/W4OJIiHqN_WQQ9TfZMwI5/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-07-26T00:00:00.000Z">Saturday, July 26, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Adding OIDC Authentication to OpenVPN Community Server</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>When you have many internal tools that require login, managing users and roles individually across separate systems can become a real headache. Fortunately, there’s an excellent open-source project called Keycloak. I prefer to integrate all internal tools with Keycloak to centralize authentication and authorization management. That’s why I also wanted to integrate OpenVPN with Keycloak.</p><p>There are two main editions of OpenVPN: the open-source Community Edition, and the enterprise-grade OpenVPN Access Server. Naturally, the enterprise edition offers robust features and can significantly reduce the effort needed to run a secure VPN server. It likely includes built-in support for integrating with Keycloak, making it a convenient choice.</p><p>If you’re deploying a self-hosted VPN server in a corporate environment, the enterprise edition can be a smarter decision—it saves time, allowing you to focus on tasks that contribute directly to your business’s core value. However, if you don’t need any advanced features, running the Community Edition on your server is a perfectly reasonable option.</p><p>Setting up a self-hosted VPN and integrating it with Keycloak wasn’t an urgent or critical task for me. Out of curiosity, I began exploring whether the OpenVPN Community Edition could meet my requirements during my spare time. Honestly, if this had been a necessity at a company, I would have chosen the enterprise edition to save time and effort—well worth the cost.</p><h2 id="authentication"><a href="#authentication" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Authentication</h2><p>One of my requirements was to integrate Keycloak for authentication. Thanks to two great open-source projects, I was able to understand how OpenVPN can support authentication via the OAuth2 protocol:</p><ul><li>An example using Go(<a target="_blank" rel="noopener noreferrer" href="https://github.com/jkroepke/openvpn-auth-oauth2">https://github.com/jkroepke/openvpn-auth-oauth2</a>)</li><li>An example using Python(<a target="_blank" rel="noopener noreferrer" href="https://github.com/thesparklabs/openvpn-okta-sso-example">https://github.com/thesparklabs/openvpn-okta-sso-example</a>)</li></ul><p>Let me explain how this works. You should think of it in two parts: the client side and the server side.</p><p>On the client side, there’s OpenVPN Connect, which is the client application used to access the VPN server. When you try to connect to the OpenVPN server using OpenVPN Connect, the server requests that you authenticate via OAuth2 (in our case, through Keycloak). OpenVPN Connect then opens the Keycloak login page in your browser. You enter your Keycloak username and password, and upon successful login, you’re authenticated and the VPN connection is established.</p><h3 id="a-more-detailed-step-by-step-explanation"><a href="#a-more-detailed-step-by-step-explanation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A More Detailed Step-by-Step Explanation</h3><p>Here’s a more detailed breakdown of what happens:</p><ol><li>OpenVPN Connect receives a message from the server that includes a URL for the login page. For example, the server might send:</li></ol><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">client-pending-auth 1 1 WEB_AUTH::http://localhost:3000/login?state=16dd5a57b23e2d51 120
</span></code></pre></div><ol start="2"><li>This tells OpenVPN Connect to open <a target="_blank" rel="noopener noreferrer" href="http://localhost:3000/login">http://localhost:3000/login</a> in your browser.</li><li>You can see this process in action by checking the OpenVPN Connect logs. It first logs an AUTH_PENDING event, followed by the WEB_AUTH event, which includes the URL that the browser should open.</li></ol><img src="/static/images/openvpn-connect-log.png" alt="openvpn connect logs"/><ol start="4"><li>Once you see the Keycloak login page in your browser, you enter your credentials. After a successful login, Keycloak redirects to a callback URL you configured in your Keycloak client using OIDC.</li></ol><p>Now you might ask: “Callback to where?”</p><p>Good question. This callback doesn’t go to the OpenVPN server directly. Instead, you need to run a separate server—let’s call it the Node.js server—to handle the callback from Keycloak. Later, I’ll share some Node.js code to make this clearer.</p><p>The Node.js server receives the callback from Keycloak, verifies the authentication result, and determines whether the user should be allowed to connect to the OpenVPN server.</p><p>At this point, you should understand that your system has two servers running:</p><ul><li>The OpenVPN server</li><li>The Node.js server (handling the OAuth2 flow)</li></ul><p>The client is trying to connect to the OpenVPN server, but the authentication result is handled by the Node.js server. So how do you let the OpenVPN server know that the user has been successfully authenticated?</p><p>This is where the OpenVPN Management Interface comes into play.</p><p>Once the Node.js server confirms that the user has successfully authenticated via OIDC, it uses the management interface to notify the OpenVPN server, which then allows the VPN connection to proceed. The Node.js server and the OpenVPN server exchange messages through this management interface using a simple protocol.</p><blockquote><p>The OpenVPN Management interface allows OpenVPN to be administratively controlled from an external program via a TCP or unix domain socket.</p></blockquote><ol start="5"><li><p>The extra server(In our case, Nodejs application) handles the callback request from Keycloak and checks whether it is valid. It then sends a message to the OpenVPN server—either to allow or deny the client—via the management interface.</p></li><li><p>The OpenVPN server receives the message from the extra server and processes it accordingly.</p></li><li><p>The client sees whether the connection has been successfully established or denied in the OpenVPN Connect client application.</p></li></ol><h3 id="an-example-of-the-messages-exchanged-through-the-management-interface"><a href="#an-example-of-the-messages-exchanged-through-the-management-interface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>An example of the messages exchanged through the management interface.</h3><p>Let’s take a look at the messages exchanged between the Node.js server and the OpenVPN server during a newly established connection:</p><ol><li><p>OpenVPN Server → Node.js Server:<br/>“Hey Node.js! A client is trying to establish a new connection.”<br/><code>&gt;CLIENT:CONNECT,0,1</code>\</p></li><li><p>Node.js Server → OpenVPN Server:<br/>“Oh really? Could you ask the client to authenticate using this URL?”<br/><code>client-pending-auth 0 1 WEB_AUTH::http://localhost:3000/login?state=16dd5a57b23e2d51 120</code>\</p></li><li><p>Node.js Server → OpenVPN Server:<br/>“I received a valid callback request from Keycloak. The user is authenticated. You can proceed with the connection.”<br/><code>client-auth 0 1</code></p></li><li><p>OpenVPN Server → Node.js Server:<br/>“The connection has been successfully established. Thank you for your cooperation!”<br/><code>&gt;CLIENT:ESTABLISHED,0</code></p></li></ol><h2 id="reauthentication"><a href="#reauthentication" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Reauthentication</h2><p>Previously, we looked at how authentication works when establishing the initial connection. For <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Forward_secrecy">Forward Secrecy</a>, the OpenVPN server renegotiates the TLS session and encryption keys at regular intervals. By default, this renegotiation happens every 60 minutes.</p><p>The two references I mentioned earlier take different approaches to handling reauthentication when OpenVPN is configured to authenticate via the management interface using OIDC:</p><ul><li>An example using Go(<a target="_blank" rel="noopener noreferrer" href="https://github.com/jkroepke/openvpn-auth-oauth2">https://github.com/jkroepke/openvpn-auth-oauth2</a>)</li><li>An example using Python(<a target="_blank" rel="noopener noreferrer" href="https://github.com/thesparklabs/openvpn-okta-sso-example">https://github.com/thesparklabs/openvpn-okta-sso-example</a>)</li></ul><h3 id="approach-1-go-example"><a href="#approach-1-go-example" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Approach 1: Go Example</h3><p>The Go example takes a simple approach. OpenVPN controls how often renegotiation occurs using the <code>reneg-sec</code> option, which can be configured on both the client and server sides. The server pushes a configuration to the client to disable renegotiation entirely by setting <code>reneg-sec</code> to 0:</p><p><code>server.conf</code></p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">push <span class="token string">&quot;reneg-sec 0&quot;</span>
</span></code></pre></div><p>This prevents reauthentication from happening during an active session.</p><h3 id="approach-2-python-example"><a href="#approach-2-python-example" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Approach 2: Python Example</h3><p>The Python example allows renegotiation but uses additional configuration.</p><p>To understand this better, consider the following scenario:</p><p>Suppose you’ve configured two-factor authentication (2FA) for accessing your OpenVPN server. During the initial connection, users provide both their username/password and a TOTP code. After one hour, OpenVPN initiates a session renegotiation. However, you don’t want users to re-enter all their credentials just to maintain the connection.</p><p>In this case, you can use authentication tokens. By enabling the auth-gen-token option on the OpenVPN server, it generates an authentication token after the initial connection is established and pushes it to the client (OpenVPN Connect). The client stores this token and reuses it during renegotiation. If the server accepts the token, the session continues without prompting the user to re-enter credentials.</p><p>However, in this specific case, the authentication token isn’t validated in the usual way—because authentication is done via OIDC, not username/password. When auth-user-pass-verify is used and a user logs in with a valid username and password, OpenVPN generates a token bound to that username. In the OIDC-based flow, auth-user-pass-optional is set, and the username is left empty. Therefore, authentication token validation fails.</p><p>That’s why the second example configures auth-gen-token with external-auth. The external-auth option allows an external server (in our case, the Node.js server) to decide whether to allow or deny reauthentication during session renegotiation.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">auth-gen-token <span class="token number">0</span> external-auth
</span></code></pre></div><p>In our case, even though the authentication token fails validation due to an empty username, the external server still receives a REAUTH event through the OpenVPN management interface:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">&gt;CLIENT:REAUTH,1,3
</span><span class="code-line">&gt;CLIENT:ENV,session_id=QRGqJyAu801FWKZx
</span><span class="code-line">&gt;CLIENT:ENV,session_status=AuthenticatedEmptyUser
</span></code></pre></div><p>Pay close attention to the session_status value. When it is set to AuthenticatedEmptyUser, it indicates that the server attempted to validate the token but failed because the username was empty. <a target="_blank" rel="noopener noreferrer" href="https://github.com/OpenVPN/openvpn/blob/7d5ec053f0f30c6cd27b60ed76859a09f6dbf5e4/doc/man-sections/server-options.rst#L51">According to the OpenVPN documentation</a>:</p><blockquote><p>AuthenticatedEmptyUser / ExpiredEmptyUser: The token is not valid with the username sent from the client but would be valid (or expired) if we assume an empty username was used instead. These two cases are a workaround for behaviour in OpenVPN 3. If this workaround is not needed these two cases should be handled in the same way as Invalid.</p></blockquote><p>In the second example, the session_id is stored during the initial connection and later validated by simply comparing it to the session_id provided during renegotiation. It also checks whether the session_state is AuthenticatedEmptyUser.</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token keyword">def</span> <span class="token function">clientReauth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cid<span class="token punctuation">,</span> kid<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token keyword">not</span> cid <span class="token keyword">in</span> self<span class="token punctuation">.</span>sessions <span class="token keyword">or</span> <span class="token keyword">not</span> <span class="token string">&quot;SessionID&quot;</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>sessions<span class="token punctuation">[</span>cid<span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token keyword">not</span> <span class="token string">&quot;session_id&quot;</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>clientData<span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">return</span>
</span><span class="code-line">    <span class="token keyword">if</span> self<span class="token punctuation">.</span>sessions<span class="token punctuation">[</span>cid<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;SessionID&quot;</span><span class="token punctuation">]</span> <span class="token operator">!=</span> self<span class="token punctuation">.</span>clientData<span class="token punctuation">[</span><span class="token string">&quot;session_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">return</span>
</span><span class="code-line">    <span class="token comment"># OpenVPN does not allow auth-gen-token without a username by default, so we allow it here</span>
</span><span class="code-line">    <span class="token keyword">if</span> self<span class="token punctuation">.</span>clientData<span class="token punctuation">[</span><span class="token string">&quot;session_state&quot;</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&quot;Authenticated&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AuthenticatedEmptyUser&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
</span><span class="code-line">        reply <span class="token operator">=</span> <span class="token string">&quot;client-auth-nt %s %s\n&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>cid<span class="token punctuation">,</span> kid<span class="token punctuation">)</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>write<span class="token punctuation">(</span>reply<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span>
</span></code></pre></div><h2 id="authorization"><a href="#authorization" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Authorization</h2></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/openvpn">openvpn</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/oauth2">oauth2</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250724-nodejs-trace-database-data">Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250809-paseto">What is PASETO?</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var l=Object.create;var i=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var o=t=\u003ei(t,\"__esModule\",{value:!0});var m=(t,a)=\u003e()=\u003e(a||t((a={exports:{}}).exports,a),a.exports),g=(t,a)=\u003e{o(t);for(var s in a)i(t,s,{get:a[s],enumerable:!0})},k=(t,a,s)=\u003e{if(a\u0026\u0026typeof a==\"object\"||typeof a==\"function\")for(let n of d(a))!u.call(t,n)\u0026\u0026n!==\"default\"\u0026\u0026i(t,n,{get:()=\u003ea[n],enumerable:!(s=h(a,n))||s.enumerable});return t},N=t=\u003ek(o(i(t!=null?l(p(t)):{},\"default\",t\u0026\u0026t.__esModule\u0026\u0026\"default\"in t?{get:()=\u003et.default,enumerable:!0}:{value:t,enumerable:!0})),t);var c=m((O,r)=\u003e{r.exports=_jsx_runtime});var w={};g(w,{default:()=\u003ev,frontmatter:()=\u003ey});var e=N(c()),y={title:\"Adding OIDC Authentication to OpenVPN Community Server\",date:\"2025-07-26\",tags:[\"openvpn\",\"oauth2\"],images:[\"/static/images/thumbnail/openvpn.png\"],summary:\"\"};function f(t={}){let{wrapper:a}=t.components||{};return a?(0,e.jsx)(a,Object.assign({},t,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",h3:\"h3\",ol:\"ol\",pre:\"pre\",code:\"code\",blockquote:\"blockquote\",br:\"br\"},t.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"When you have many internal tools that require login, managing users and roles individually across separate systems can become a real headache. Fortunately, there\\u2019s an excellent open-source project called Keycloak. I prefer to integrate all internal tools with Keycloak to centralize authentication and authorization management. That\\u2019s why I also wanted to integrate OpenVPN with Keycloak.\"}),(0,e.jsx)(n.p,{children:\"There are two main editions of OpenVPN: the open-source Community Edition, and the enterprise-grade OpenVPN Access Server. Naturally, the enterprise edition offers robust features and can significantly reduce the effort needed to run a secure VPN server. It likely includes built-in support for integrating with Keycloak, making it a convenient choice.\"}),(0,e.jsx)(n.p,{children:\"If you\\u2019re deploying a self-hosted VPN server in a corporate environment, the enterprise edition can be a smarter decision\\u2014it saves time, allowing you to focus on tasks that contribute directly to your business\\u2019s core value. However, if you don\\u2019t need any advanced features, running the Community Edition on your server is a perfectly reasonable option.\"}),(0,e.jsx)(n.p,{children:\"Setting up a self-hosted VPN and integrating it with Keycloak wasn\\u2019t an urgent or critical task for me. Out of curiosity, I began exploring whether the OpenVPN Community Edition could meet my requirements during my spare time. Honestly, if this had been a necessity at a company, I would have chosen the enterprise edition to save time and effort\\u2014well worth the cost.\"}),(0,e.jsxs)(n.h2,{id:\"authentication\",children:[(0,e.jsx)(n.a,{href:\"#authentication\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Authentication\"]}),(0,e.jsx)(n.p,{children:\"One of my requirements was to integrate Keycloak for authentication. Thanks to two great open-source projects, I was able to understand how OpenVPN can support authentication via the OAuth2 protocol:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"An example using Go(\",(0,e.jsx)(n.a,{href:\"https://github.com/jkroepke/openvpn-auth-oauth2\",children:\"https://github.com/jkroepke/openvpn-auth-oauth2\"}),\")\"]}),(0,e.jsxs)(n.li,{children:[\"An example using Python(\",(0,e.jsx)(n.a,{href:\"https://github.com/thesparklabs/openvpn-okta-sso-example\",children:\"https://github.com/thesparklabs/openvpn-okta-sso-example\"}),\")\"]})]}),(0,e.jsx)(n.p,{children:\"Let me explain how this works. You should think of it in two parts: the client side and the server side.\"}),(0,e.jsx)(n.p,{children:\"On the client side, there\\u2019s OpenVPN Connect, which is the client application used to access the VPN server. When you try to connect to the OpenVPN server using OpenVPN Connect, the server requests that you authenticate via OAuth2 (in our case, through Keycloak). OpenVPN Connect then opens the Keycloak login page in your browser. You enter your Keycloak username and password, and upon successful login, you\\u2019re authenticated and the VPN connection is established.\"}),(0,e.jsxs)(n.h3,{id:\"a-more-detailed-step-by-step-explanation\",children:[(0,e.jsx)(n.a,{href:\"#a-more-detailed-step-by-step-explanation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"A More Detailed Step-by-Step Explanation\"]}),(0,e.jsx)(n.p,{children:\"Here\\u2019s a more detailed breakdown of what happens:\"}),(0,e.jsx)(n.ol,{children:(0,e.jsx)(n.li,{children:\"OpenVPN Connect receives a message from the server that includes a URL for the login page. For example, the server might send:\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-sh\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`client-pending-auth 1 1 WEB_AUTH::http://localhost:3000/login?state=16dd5a57b23e2d51 120\n`})})}),(0,e.jsxs)(n.ol,{start:\"2\",children:[(0,e.jsxs)(n.li,{children:[\"This tells OpenVPN Connect to open \",(0,e.jsx)(n.a,{href:\"http://localhost:3000/login\",children:\"http://localhost:3000/login\"}),\" in your browser.\"]}),(0,e.jsx)(n.li,{children:\"You can see this process in action by checking the OpenVPN Connect logs. It first logs an AUTH_PENDING event, followed by the WEB_AUTH event, which includes the URL that the browser should open.\"})]}),(0,e.jsx)(\"img\",{src:\"/static/images/openvpn-connect-log.png\",alt:\"openvpn connect logs\"}),(0,e.jsx)(n.ol,{start:\"4\",children:(0,e.jsx)(n.li,{children:\"Once you see the Keycloak login page in your browser, you enter your credentials. After a successful login, Keycloak redirects to a callback URL you configured in your Keycloak client using OIDC.\"})}),(0,e.jsx)(n.p,{children:\"Now you might ask: \\u201CCallback to where?\\u201D\"}),(0,e.jsx)(n.p,{children:\"Good question. This callback doesn\\u2019t go to the OpenVPN server directly. Instead, you need to run a separate server\\u2014let\\u2019s call it the Node.js server\\u2014to handle the callback from Keycloak. Later, I\\u2019ll share some Node.js code to make this clearer.\"}),(0,e.jsx)(n.p,{children:\"The Node.js server receives the callback from Keycloak, verifies the authentication result, and determines whether the user should be allowed to connect to the OpenVPN server.\"}),(0,e.jsx)(n.p,{children:\"At this point, you should understand that your system has two servers running:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"The OpenVPN server\"}),(0,e.jsx)(n.li,{children:\"The Node.js server (handling the OAuth2 flow)\"})]}),(0,e.jsx)(n.p,{children:\"The client is trying to connect to the OpenVPN server, but the authentication result is handled by the Node.js server. So how do you let the OpenVPN server know that the user has been successfully authenticated?\"}),(0,e.jsx)(n.p,{children:\"This is where the OpenVPN Management Interface comes into play.\"}),(0,e.jsx)(n.p,{children:\"Once the Node.js server confirms that the user has successfully authenticated via OIDC, it uses the management interface to notify the OpenVPN server, which then allows the VPN connection to proceed. The Node.js server and the OpenVPN server exchange messages through this management interface using a simple protocol.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"The OpenVPN Management interface allows OpenVPN to be administratively controlled from an external program via a TCP or unix domain socket.\"})}),(0,e.jsxs)(n.ol,{start:\"5\",children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"The extra server(In our case, Nodejs application) handles the callback request from Keycloak and checks whether it is valid. It then sends a message to the OpenVPN server\\u2014either to allow or deny the client\\u2014via the management interface.\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"The OpenVPN server receives the message from the extra server and processes it accordingly.\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"The client sees whether the connection has been successfully established or denied in the OpenVPN Connect client application.\"})})]}),(0,e.jsxs)(n.h3,{id:\"an-example-of-the-messages-exchanged-through-the-management-interface\",children:[(0,e.jsx)(n.a,{href:\"#an-example-of-the-messages-exchanged-through-the-management-interface\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"An example of the messages exchanged through the management interface.\"]}),(0,e.jsx)(n.p,{children:\"Let\\u2019s take a look at the messages exchanged between the Node.js server and the OpenVPN server during a newly established connection:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"OpenVPN Server \\u2192 Node.js Server:\",(0,e.jsx)(n.br,{}),\"\\u201CHey Node.js! A client is trying to establish a new connection.\\u201D\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"\u003eCLIENT:CONNECT,0,1\"}),\"\\\\\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"Node.js Server \\u2192 OpenVPN Server:\",(0,e.jsx)(n.br,{}),\"\\u201COh really? Could you ask the client to authenticate using this URL?\\u201D\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"client-pending-auth 0 1 WEB_AUTH::http://localhost:3000/login?state=16dd5a57b23e2d51 120\"}),\"\\\\\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"Node.js Server \\u2192 OpenVPN Server:\",(0,e.jsx)(n.br,{}),\"\\u201CI received a valid callback request from Keycloak. The user is authenticated. You can proceed with the connection.\\u201D\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"client-auth 0 1\"})]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"OpenVPN Server \\u2192 Node.js Server:\",(0,e.jsx)(n.br,{}),\"\\u201CThe connection has been successfully established. Thank you for your cooperation!\\u201D\",(0,e.jsx)(n.br,{}),(0,e.jsx)(n.code,{children:\"\u003eCLIENT:ESTABLISHED,0\"})]})})]}),(0,e.jsxs)(n.h2,{id:\"reauthentication\",children:[(0,e.jsx)(n.a,{href:\"#reauthentication\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Reauthentication\"]}),(0,e.jsxs)(n.p,{children:[\"Previously, we looked at how authentication works when establishing the initial connection. For \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Forward_secrecy\",children:\"Forward Secrecy\"}),\", the OpenVPN server renegotiates the TLS session and encryption keys at regular intervals. By default, this renegotiation happens every 60 minutes.\"]}),(0,e.jsx)(n.p,{children:\"The two references I mentioned earlier take different approaches to handling reauthentication when OpenVPN is configured to authenticate via the management interface using OIDC:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"An example using Go(\",(0,e.jsx)(n.a,{href:\"https://github.com/jkroepke/openvpn-auth-oauth2\",children:\"https://github.com/jkroepke/openvpn-auth-oauth2\"}),\")\"]}),(0,e.jsxs)(n.li,{children:[\"An example using Python(\",(0,e.jsx)(n.a,{href:\"https://github.com/thesparklabs/openvpn-okta-sso-example\",children:\"https://github.com/thesparklabs/openvpn-okta-sso-example\"}),\")\"]})]}),(0,e.jsxs)(n.h3,{id:\"approach-1-go-example\",children:[(0,e.jsx)(n.a,{href:\"#approach-1-go-example\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approach 1: Go Example\"]}),(0,e.jsxs)(n.p,{children:[\"The Go example takes a simple approach. OpenVPN controls how often renegotiation occurs using the \",(0,e.jsx)(n.code,{children:\"reneg-sec\"}),\" option, which can be configured on both the client and server sides. The server pushes a configuration to the client to disable renegotiation entirely by setting \",(0,e.jsx)(n.code,{children:\"reneg-sec\"}),\" to 0:\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"server.conf\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"push \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"reneg-sec 0\"'}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"This prevents reauthentication from happening during an active session.\"}),(0,e.jsxs)(n.h3,{id:\"approach-2-python-example\",children:[(0,e.jsx)(n.a,{href:\"#approach-2-python-example\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approach 2: Python Example\"]}),(0,e.jsx)(n.p,{children:\"The Python example allows renegotiation but uses additional configuration.\"}),(0,e.jsx)(n.p,{children:\"To understand this better, consider the following scenario:\"}),(0,e.jsx)(n.p,{children:\"Suppose you\\u2019ve configured two-factor authentication (2FA) for accessing your OpenVPN server. During the initial connection, users provide both their username/password and a TOTP code. After one hour, OpenVPN initiates a session renegotiation. However, you don\\u2019t want users to re-enter all their credentials just to maintain the connection.\"}),(0,e.jsx)(n.p,{children:\"In this case, you can use authentication tokens. By enabling the auth-gen-token option on the OpenVPN server, it generates an authentication token after the initial connection is established and pushes it to the client (OpenVPN Connect). The client stores this token and reuses it during renegotiation. If the server accepts the token, the session continues without prompting the user to re-enter credentials.\"}),(0,e.jsx)(n.p,{children:\"However, in this specific case, the authentication token isn\\u2019t validated in the usual way\\u2014because authentication is done via OIDC, not username/password. When auth-user-pass-verify is used and a user logs in with a valid username and password, OpenVPN generates a token bound to that username. In the OIDC-based flow, auth-user-pass-optional is set, and the username is left empty. Therefore, authentication token validation fails.\"}),(0,e.jsx)(n.p,{children:\"That\\u2019s why the second example configures auth-gen-token with external-auth. The external-auth option allows an external server (in our case, the Node.js server) to decide whether to allow or deny reauthentication during session renegotiation.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"auth-gen-token \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),` external-auth\n`]})})}),(0,e.jsx)(n.p,{children:\"In our case, even though the authentication token fails validation due to an empty username, the external server still receives a REAUTH event through the OpenVPN management interface:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`\u003eCLIENT:REAUTH,1,3\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\u003eCLIENT:ENV,session_id=QRGqJyAu801FWKZx\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\u003eCLIENT:ENV,session_status=AuthenticatedEmptyUser\n`})]})}),(0,e.jsxs)(n.p,{children:[\"Pay close attention to the session_status value. When it is set to AuthenticatedEmptyUser, it indicates that the server attempted to validate the token but failed because the username was empty. \",(0,e.jsx)(n.a,{href:\"https://github.com/OpenVPN/openvpn/blob/7d5ec053f0f30c6cd27b60ed76859a09f6dbf5e4/doc/man-sections/server-options.rst#L51\",children:\"According to the OpenVPN documentation\"}),\":\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"AuthenticatedEmptyUser / ExpiredEmptyUser: The token is not valid with the username sent from the client but would be valid (or expired) if we assume an empty username was used instead. These two cases are a workaround for behaviour in OpenVPN 3. If this workaround is not needed these two cases should be handled in the same way as Invalid.\"})}),(0,e.jsx)(n.p,{children:\"In the second example, the session_id is stored during the initial connection and later validated by simply comparing it to the session_id provided during renegotiation. It also checks whether the session_state is AuthenticatedEmptyUser.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"clientReauth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" cid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" kid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" cid \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sessions \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"SessionID\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sessions\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"cid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"session_id\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"clientData\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sessions\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"cid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"SessionID\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"clientData\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"session_id\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# OpenVPN does not allow auth-gen-token without a username by default, so we allow it here\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"clientData\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"session_state\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Authenticated\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AuthenticatedEmptyUser\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        reply \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"client-auth-nt %s %s\\\\n\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"%\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" kid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"write\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"reply\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"authorization\",children:[(0,e.jsx)(n.a,{href:\"#authorization\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Authorization\"]})]})}}var v=f;return w;})();\n;return Component;","toc":[{"value":"Authentication","url":"#authentication","depth":2},{"value":"A More Detailed Step-by-Step Explanation","url":"#a-more-detailed-step-by-step-explanation","depth":3},{"value":"An example of the messages exchanged through the management interface.","url":"#an-example-of-the-messages-exchanged-through-the-management-interface","depth":3},{"value":"Reauthentication","url":"#reauthentication","depth":2},{"value":"Approach 1: Go Example","url":"#approach-1-go-example","depth":3},{"value":"Approach 2: Python Example","url":"#approach-2-python-example","depth":3},{"value":"Authorization","url":"#authorization","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.495,"time":449700,"words":1499},"slug":"20250726-openvpn-oidc","fileName":"20250726-openvpn-oidc.md","title":"Adding OIDC Authentication to OpenVPN Community Server","date":"2025-07-26T00:00:00.000Z","tags":["openvpn","oauth2"],"images":["/static/images/thumbnail/openvpn.png"],"summary":""}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry","date":"2025-07-24T00:00:00.000Z","tags":["opentelemetry","nodejs"],"images":["/static/images/thumbnail/trace-data.png"],"summary":"My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data.","slug":"20250724-nodejs-trace-database-data"},"next":{"title":"What is PASETO?","date":"2025-08-09T00:00:00.000Z","tags":["paseto","security"],"images":["/static/images/thumbnail/paseto.png"],"summary":"I stumbled upon the PASETO specification. At first glance, it offers better security for a system. I researched it to figure out if it could bring any advantages to my system, which is built with Node.js and authenticates using bearer tokens.","slug":"20250809-paseto"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20250726-openvpn-oidc"]},"buildId":"W4OJIiHqN_WQQ9TfZMwI5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>