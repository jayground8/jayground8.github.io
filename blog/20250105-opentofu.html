<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기</title><meta name="robots" content="follow, index"/><meta name="description" content="GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다."/><meta property="og:url" content="https://jayground8.github.io/blog/20250105-opentofu"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다."/><meta property="og:title" content="GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기"/><meta name="twitter:description" content="GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20250105-opentofu"/><meta property="article:published_time" content="2025-01-05T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20250105-opentofu"
  },
  "headline": "GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2025-01-05T00:00:00.000Z",
  "dateModified": "2025-01-05T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-209ecea39c080748.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/XqYl5nn2sxnBArTY5fDr7/_buildManifest.js" defer=""></script><script src="/_next/static/XqYl5nn2sxnBArTY5fDr7/_ssgManifest.js" defer=""></script><script src="/_next/static/XqYl5nn2sxnBArTY5fDr7/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-01-05T00:00:00.000Z">2025년 1월 5일 일요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>IaS(Infrastructure As Code)로 GCP Secret Manager의 Secret 값을 관리할 때, 어떻게 하면 좋을까? Terraform을 이용하여 tf파일을 Git으로 관리하는 것을 생각해볼 수 있는데, Private Git Repository를 사용한다고 하더라도 tf파일에 Secret 값들을 평서문으로 올리는 것은 바람직하지 않다.</p><h2 id="kms_secret_asymmetric"><a href="#kms_secret_asymmetric" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>kms_secret_asymmetric</h2><p>이럴 때, Terraform <a target="_blank" rel="noopener noreferrer" href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_secret_asymmetric">google_kms_secret_asymmetric</a> data source를 사용하는 것을 고려해볼 수 있다.</p><p>GCP의 KMS(Key Management Service)를 이용하여 비대칭키를 생성하여 관리하고, Terraform Resource Definition에는 공개키로 암호화된 값을 작성한다. 최종적으로 Secret Manager의 Secret 값은 Runtime중에 google_kms_secret_asymmetric data source를 통해서 복호화된 값이 설정되게 된다.</p><p><a target="_blank" rel="noopener noreferrer" href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_secret_asymmetric">Hashcorp google provider 문서</a>를 보면 어떻게 사용할 수 있는지 자세히 설명되어 있다. google_kms_secret_asymmetric data source는 terraform-provider-google-beta provider에서 제공되기 때문에 google-beta를 설정해준다.</p><blockquote><p>This resource is in beta, and should be used with the terraform-provider-google-beta provider. See Provider Versions for more details on beta resources.</p></blockquote><p><code>main.tf</code></p><div class="relative"><pre><code class="code-highlight language-tf"><span class="code-line">terraform {
</span><span class="code-line">  required_providers {
</span><span class="code-line">    google-beta = {
</span><span class="code-line">      source = &quot;hashicorp/google-beta&quot;
</span><span class="code-line">      version = &quot;6.14.1&quot;
</span><span class="code-line">    }
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">provider &quot;google&quot; {
</span><span class="code-line">  project = &quot;tutorial&quot;
</span><span class="code-line">  region  = &quot;us-central1&quot;
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">provider &quot;google-beta&quot; {
</span><span class="code-line">  project = &quot;tutorial&quot;
</span><span class="code-line">  region  = &quot;us-central1&quot;
</span><span class="code-line">}
</span></code></pre></div><p>이제 아래처럼 GCP KMS에서 비대칭키를 사용하기 위하여 resource를 정의하고, 최종적으로 local환경에서 사용할 public key를 저장한다.</p><p><code>main.tf</code></p><div class="relative"><pre><code class="code-highlight language-tf"><span class="code-line">data &quot;google_kms_key_ring&quot; &quot;tutorial_keyring&quot; {
</span><span class="code-line">  name     = &quot;tutorial-keyring&quot;
</span><span class="code-line">  location = &quot;us-central1&quot;
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">resource &quot;google_kms_crypto_key&quot; &quot;tutorial_secret&quot; {
</span><span class="code-line">  name     = &quot;tutorial_secret&quot;
</span><span class="code-line">  key_ring = data.google_kms_key_ring.tutorial_keyring.id
</span><span class="code-line">  purpose  = &quot;ASYMMETRIC_DECRYPT&quot;
</span><span class="code-line">  version_template {
</span><span class="code-line">    algorithm = &quot;RSA_DECRYPT_OAEP_4096_SHA256&quot;
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">data &quot;google_kms_crypto_key_version&quot; &quot;tutorial_secret&quot; {
</span><span class="code-line">  crypto_key = google_kms_crypto_key.tutorial_secret.id
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">resource &quot;local_file&quot; &quot;public_key&quot; {
</span><span class="code-line">    filename = &quot;${path.module}/public-key.pem&quot;
</span><span class="code-line">    content     = data.google_kms_crypto_key_version.tutorial_secret.public_key[0].pem
</span><span class="code-line">}
</span></code></pre></div><p>이제 생성된 public key로 원하는 값을 암호화한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token builtin class-name">echo</span> -n hello  <span class="token operator">|</span>
</span><span class="code-line">  openssl pkeyutl -in - <span class="token punctuation">\</span>
</span><span class="code-line">        -encrypt <span class="token punctuation">\</span>
</span><span class="code-line">        -pubin <span class="token punctuation">\</span>
</span><span class="code-line">        -inkey public-key.pem <span class="token punctuation">\</span>
</span><span class="code-line">        -pkeyopt rsa_padding_mode:oaep <span class="token punctuation">\</span>
</span><span class="code-line">        -pkeyopt rsa_oaep_md:sha256 <span class="token punctuation">\</span>
</span><span class="code-line">        -pkeyopt rsa_mgf1_md:sha256 <span class="token punctuation">\</span>
</span><span class="code-line">        -out tutorial.enc
</span></code></pre></div><p>그리고 crc32 checksum을 저장한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token constant environment">$HOME</span>/go/bin/crc32 -polynomial castagnoli <span class="token operator">&lt;</span> tutorial.enc
</span></code></pre></div><p>마지막으로 암호화했던 것을 base64로 인코딩 한다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">openssl base64 <span class="token punctuation">\</span>
</span><span class="code-line">  -in tutorial.enc <span class="token punctuation">\</span>
</span><span class="code-line">  -out tutorial.enc.b64
</span></code></pre></div><p>이렇게 계산한 base64 인코딩 값을 ciphertext에 저장하고, checksum을 위해서 crc32 값도 추가해준다.</p><div class="relative"><pre><code class="code-highlight language-tf"><span class="code-line">data &quot;google_kms_secret_asymmetric&quot; &quot;secret_data&quot; {
</span><span class="code-line">  crypto_key_version = data.google_kms_crypto_key_version.opentofu-secret.id
</span><span class="code-line">  crc32              = &quot;920961a5&quot;
</span><span class="code-line">  ciphertext         = &lt;&lt;EOT
</span><span class="code-line">    UCIDSu19B3c3twcdppvPUGfu+QWtXEJdCgEru80jwW7r0Zzq1nNIEW9ZaFYGlUUT
</span><span class="code-line">    xreYLOF+VsIY5ejnzr0QKuU7Y/0vnZrc7RU6WBNW8R/IyrOXT8LB6e1KwfomduaI
</span><span class="code-line">    4VMrx2WQxo+kaU1Tw2p6JoAKZICzoaZZg2eatMESxlxLlMIQTK6QDbtD0mOu1rzI
</span><span class="code-line">    rz257/jI1FNzxLq9K3BmfxjFWCuL45QnyM0Y8Aqh0YXyVCiPQNr/GodR8JNKl/xt
</span><span class="code-line">    rHAEq8YL/r1lOGCJNBsFYjcKIAUD5Ade1hVfUQGZDMNM/wcCLCOU3aHhgkaAT6xG
</span><span class="code-line">    3FjZtyIYW2dnpIelHrtSxepQN4yy49qxeuKaf9Cjj6uXJsTi0bCiTw4PcD4RHOTJ
</span><span class="code-line">    Gbm2QLJMr5BaiUyK0ZXHokynQg++McAiRsygeuWilInXPLpEkDcC+G0+i6Z2f3Ki
</span><span class="code-line">    6kOE9edC5YHFSH4mrUeFZwdbdPgPzfP1szJ+h6jMJJt76jSDovAkwScuh2eibvRG
</span><span class="code-line">    wO+O0VZaZW9WdiwX7yD4GQSkCRTZg4XQJ6TSuG+U18T33mOoQbA0DvvYcYYRMVBS
</span><span class="code-line">    q3YVhbGhBwxfxFXRoWYBqyGomP33NL6cEKWnovwPf3OSPDZ8n66nqzQY18tJvr+7
</span><span class="code-line">    XALVYFRpEdOCBjBa1EbB+e0LKeL8LyREq/3aGX7+X5Q=
</span><span class="code-line">  EOT
</span><span class="code-line">  provider = google-beta
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">resource &quot;google_secret_manager_secret&quot; &quot;secret_data&quot; {
</span><span class="code-line">  secret_id = &quot;secret_key_name&quot;
</span><span class="code-line">
</span><span class="code-line">  replication {
</span><span class="code-line">    auto {}
</span><span class="code-line">  }
</span><span class="code-line">}
</span><span class="code-line">
</span><span class="code-line">resource &quot;google_secret_manager_secret_version&quot; &quot;secret_data&quot; {
</span><span class="code-line">  secret = google_secret_manager_secret.secret_data.id
</span><span class="code-line">
</span><span class="code-line">  secret_data = data.google_kms_secret_asymmetric.secret_data.plaintext
</span><span class="code-line">}
</span></code></pre></div><p>이렇게 Secret Manager의 Secret 값을 저장하면, Terraform Resource 정의에서 평서문으로 작성하지 않고 runtime과정에서 kms을 통해서 복호화해서 저장하게 된다. Git에는 평서문 대신에 공개키로 암호화된 값을 저장하면 된다. 하지만 공식문서에 나온 것처럼 Secret값이 log, plan, state 출력값에 노출되는 것에 대해서는 주의를 해야 한다.</p><blockquote><p>Using this data provider will allow you to conceal secret data within your resource definitions, but it does not take care of protecting that data in the logging output, plan output, or state output. Please take care to secure your secret data outside of resource definitions.</p></blockquote><p>Terraform으로 apply하고 생성된 state 파일을 보면, 아래와 같이 plaintext값이 &quot;hello&quot;로 노출되어 있는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token property">&quot;attributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;ciphertext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;생략&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;crc32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;생략&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;crypto_key_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;생략&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;생략&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;plaintext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Terraform에서는 remote state로 S3와 같은 Object Storage에 저장하도록 설정이 가능하고, S3의 경우에는 물리적인 공간에 저장될 때 암호화가 되어서 저장된다. 하지만 S3에 저장되는 state 파일 object는 동일하게 비밀값이 평서문으로 노출되어 있다. 따라서 해당 비밀값이 노출되지 않도록 S3 bucket에 접근을 잘 관리해야 한다.</p><h2 id="opentofu-state-암호화"><a href="#opentofu-state-암호화" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>OpenTofu State 암호화</h2><p>OpenTofu를 사용할 때는 state 파일 자체를 암호화하는 옵션을 이용할 수 있다. 아래와 같이 GCP Key Management Service를 통해서 State 파일을 암호화하여 저장할 수 있다. Cloud Key Managerment Service를 이용할 때는 키를 잃어버릴 가능성이 거의 없고, 실수로 삭제하더라도 일정기간 보존하기 때문에 복구할 수 있는 옵션이 존재한다. 따라서 State 파일을 KMS로 암호화하여 보관할 때, 키를 잃어버려서 다시 복호화를 못하는 문제에 대해서 덜 걱정해도 된다고 생각된다.</p><div class="relative"><pre><code class="code-highlight language-tf"><span class="code-line">terraform {
</span><span class="code-line">  encryption {
</span><span class="code-line">    key_provider &quot;gcp_kms&quot; &quot;basic&quot; {
</span><span class="code-line">      kms_encryption_key = &quot;KMS key 경로 값&quot;
</span><span class="code-line">      key_length = 32
</span><span class="code-line">    }
</span><span class="code-line">    method &quot;aes_gcm&quot; &quot;secure_method&quot; {
</span><span class="code-line">      keys = key_provider.gcp_kms.basic
</span><span class="code-line">    }
</span><span class="code-line">    method &quot;unencrypted&quot; &quot;migrate&quot; {}
</span><span class="code-line">    state {
</span><span class="code-line">      method = method.aes_gcm.secure_method
</span><span class="code-line">      fallback {
</span><span class="code-line">        method = method.unencrypted.migrate
</span><span class="code-line">      }
</span><span class="code-line">    }
</span><span class="code-line">  }
</span><span class="code-line">  required_providers {
</span><span class="code-line">    google-beta = {
</span><span class="code-line">      source = &quot;hashicorp/google-beta&quot;
</span><span class="code-line">      version = &quot;6.14.1&quot;
</span><span class="code-line">    }
</span><span class="code-line">  }
</span><span class="code-line">}
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>GCP Secret Manager의 비밀값을 Terraform으로 관리할 때, google_kms_secret_asymmetric data source를 사용하여 공개키로 암호화된 값으로 코드 관리를 할 수 있다. 하지만 State, Output 같은 경로로 복호화된 평서문이 노출될 수 있기 때문에 이점에 대해서 주의를 해야 한다. Terraform의 remote state를 사용할 경우에는 state 파일에는 평서문으로 저장되기 때문에 해당 파일이 노출되지 않도록 주의해야 한다. OpenTofu를 이용할 경우에는 State 파일 자체를 암호화해서 저장할 수 있는 옵션이 있다. Cloud Key Management Service를 이용하는 경우에는 키를 잃어버려서 다시 복호화하지 못하는 문제가 발생할 가능성이 상당히 적기 때문에, OpenTofu를 통해서 State 파일 자체를 암호화하여 저장하는 것도 고려해볼 수 있겠다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/gcp">gcp</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform">terraform</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/opentofu">opentofu</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250105-secrets-store-csi-driver-provider-gcp">secrets-store-csi-driver-provider-gcp 사용해보기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250117-google-oidc-bitbucket">Bitbucket OIDC with GCP</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var t=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var r=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,c)=\u003e()=\u003e(c||a((c={exports:{}}).exports,c),c.exports),u=(a,c)=\u003e{r(a);for(var s in c)l(a,s,{get:c[s],enumerable:!0})},g=(a,c,s)=\u003e{if(c\u0026\u0026typeof c==\"object\"||typeof c==\"function\")for(let n of p(c))!h.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003ec[n],enumerable:!(s=d(c,n))||s.enumerable});return a},_=a=\u003eg(r(l(a!=null?t(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=N((v,i)=\u003e{i.exports=_jsx_runtime});var b={};u(b,{default:()=\u003ef,frontmatter:()=\u003ek});var e=_(o()),k={title:\"GCP Secret Manager\\uC5D0\\uC11C \\uBE44\\uBC00\\uAC12\\uC744 OpenTofu\\uB85C \\uAD00\\uB9AC\\uD558\\uAE30\",date:\"2025-01-05\",tags:[\"gcp\",\"terraform\",\"opentofu\"],images:[\"/static/images/social-banner.png\"],summary:\"GCP Secret Manager\\uB97C IaS\\uB85C \\uAD00\\uB9AC\\uD560 \\uB54C, \\uC800\\uC7A5\\uD558\\uB294 Secret \\uAC12\\uC744 Key Management Service\\uC758 \\uBE44\\uB300\\uCE6D\\uD0A4\\uC640 Terraform\\uC758 google_kms_secret_asymmetric data source\\uB85C \\uAD00\\uB9AC\\uD560 \\uC218 \\uC788\\uB2E4. \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uD55C \\uBE44\\uBC00 \\uAC12\\uC744 Terraform resource definition\\uC5D0 \\uC815\\uC758\\uD558\\uACE0, \\uB7F0\\uD0C0\\uC784 \\uACFC\\uC815\\uC5D0\\uC11C \\uBCF5\\uD638\\uD654\\uD558\\uC5EC Secret Manager\\uC758 \\uBE44\\uBC00\\uAC12\\uC73C\\uB85C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C Git\\uC5D0 \\uD3C9\\uC11C\\uBB38 \\uB300\\uC2E0\\uC5D0 \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uD55C \\uBE44\\uBC00 \\uAC12\\uC73C\\uB85C \\uC815\\uC758\\uD55C Terraform \\uD30C\\uC77C\\uC744 \\uC800\\uC7A5\\uD558\\uC5EC \\uAD00\\uB9AC\\uD560 \\uC218 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uD574\\uB2F9 \\uBE44\\uBC00 \\uAC12\\uC740 State output \\uAC19\\uC740 \\uACF3\\uC5D0 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uADF8\\uB300\\uB85C \\uB178\\uCD9C \\uB420 \\uC218 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, remote state\\uB85C \\uAD00\\uB9AC\\uD560 \\uB54C\\uB294 \\uD574\\uB2F9 state \\uD30C\\uC77C\\uC774 \\uB178\\uCD9C\\uB418\\uC9C0 \\uC54A\\uB3C4\\uB85D \\uAD00\\uB9AC\\uB97C \\uC798\\uD574\\uC57C \\uD55C\\uB2E4. OpenTofu\\uB97C \\uC774\\uC6A9\\uD560 \\uB54C\\uB294 State \\uD30C\\uC77C\\uC744 \\uC554\\uD638\\uD654 \\uD558\\uB294 \\uC635\\uC158\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC State \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD574\\uC11C \\uAD00\\uB9AC\\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4.\"};function y(a={}){let{wrapper:c}=a.components||{};return c?(0,e.jsx)(c,Object.assign({},a,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",code:\"code\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"IaS(Infrastructure As Code)\\uB85C GCP Secret Manager\\uC758 Secret \\uAC12\\uC744 \\uAD00\\uB9AC\\uD560 \\uB54C, \\uC5B4\\uB5BB\\uAC8C \\uD558\\uBA74 \\uC88B\\uC744\\uAE4C? Terraform\\uC744 \\uC774\\uC6A9\\uD558\\uC5EC tf\\uD30C\\uC77C\\uC744 Git\\uC73C\\uB85C \\uAD00\\uB9AC\\uD558\\uB294 \\uAC83\\uC744 \\uC0DD\\uAC01\\uD574\\uBCFC \\uC218 \\uC788\\uB294\\uB370, Private Git Repository\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4\\uACE0 \\uD558\\uB354\\uB77C\\uB3C4 tf\\uD30C\\uC77C\\uC5D0 Secret \\uAC12\\uB4E4\\uC744 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uC62C\\uB9AC\\uB294 \\uAC83\\uC740 \\uBC14\\uB78C\\uC9C1\\uD558\\uC9C0 \\uC54A\\uB2E4.\"}),(0,e.jsxs)(n.h2,{id:\"kms_secret_asymmetric\",children:[(0,e.jsx)(n.a,{href:\"#kms_secret_asymmetric\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"kms_secret_asymmetric\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uB7F4 \\uB54C, Terraform \",(0,e.jsx)(n.a,{href:\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_secret_asymmetric\",children:\"google_kms_secret_asymmetric\"}),\" data source\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC744 \\uACE0\\uB824\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:\"GCP\\uC758 KMS(Key Management Service)\\uB97C \\uC774\\uC6A9\\uD558\\uC5EC \\uBE44\\uB300\\uCE6D\\uD0A4\\uB97C \\uC0DD\\uC131\\uD558\\uC5EC \\uAD00\\uB9AC\\uD558\\uACE0, Terraform Resource Definition\\uC5D0\\uB294 \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uB41C \\uAC12\\uC744 \\uC791\\uC131\\uD55C\\uB2E4. \\uCD5C\\uC885\\uC801\\uC73C\\uB85C Secret Manager\\uC758 Secret \\uAC12\\uC740 Runtime\\uC911\\uC5D0 google_kms_secret_asymmetric data source\\uB97C \\uD1B5\\uD574\\uC11C \\uBCF5\\uD638\\uD654\\uB41C \\uAC12\\uC774 \\uC124\\uC815\\uB418\\uAC8C \\uB41C\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_secret_asymmetric\",children:\"Hashcorp google provider \\uBB38\\uC11C\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC5B4\\uB5BB\\uAC8C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB294\\uC9C0 \\uC790\\uC138\\uD788 \\uC124\\uBA85\\uB418\\uC5B4 \\uC788\\uB2E4. google_kms_secret_asymmetric data source\\uB294 terraform-provider-google-beta provider\\uC5D0\\uC11C \\uC81C\\uACF5\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0 google-beta\\uB97C \\uC124\\uC815\\uD574\\uC900\\uB2E4.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"This resource is in beta, and should be used with the terraform-provider-google-beta provider. See Provider Versions for more details on beta resources.\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.tf\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  required_providers {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    google-beta = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      source = \"hashicorp/google-beta\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      version = \"6.14.1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`provider \"google\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  project = \"tutorial\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  region  = \"us-central1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`provider \"google-beta\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  project = \"tutorial\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  region  = \"us-central1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uC544\\uB798\\uCC98\\uB7FC GCP KMS\\uC5D0\\uC11C \\uBE44\\uB300\\uCE6D\\uD0A4\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD558\\uC5EC resource\\uB97C \\uC815\\uC758\\uD558\\uACE0, \\uCD5C\\uC885\\uC801\\uC73C\\uB85C local\\uD658\\uACBD\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uD560 public key\\uB97C \\uC800\\uC7A5\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.tf\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`data \"google_kms_key_ring\" \"tutorial_keyring\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  name     = \"tutorial-keyring\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  location = \"us-central1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"google_kms_crypto_key\" \"tutorial_secret\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  name     = \"tutorial_secret\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  key_ring = data.google_kms_key_ring.tutorial_keyring.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  purpose  = \"ASYMMETRIC_DECRYPT\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  version_template {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    algorithm = \"RSA_DECRYPT_OAEP_4096_SHA256\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`data \"google_kms_crypto_key_version\" \"tutorial_secret\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  crypto_key = google_kms_crypto_key.tutorial_secret.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"local_file\" \"public_key\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:'    filename = \"${path.module}/public-key.pem\"\\n'}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    content     = data.google_kms_crypto_key_version.tutorial_secret.public_key[0].pem\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uC0DD\\uC131\\uB41C public key\\uB85C \\uC6D0\\uD558\\uB294 \\uAC12\\uC744 \\uC554\\uD638\\uD654\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" -n hello  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  openssl pkeyutl -in - \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -encrypt \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pubin \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -inkey public-key.pem \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pkeyopt rsa_padding_mode:oaep \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pkeyopt rsa_oaep_md:sha256 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pkeyopt rsa_mgf1_md:sha256 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        -out tutorial.enc\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB9AC\\uACE0 crc32 checksum\\uC744 \\uC800\\uC7A5\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"$HOME\"}),\"/go/bin/crc32 -polynomial castagnoli \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),` tutorial.enc\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \\uC554\\uD638\\uD654\\uD588\\uB358 \\uAC83\\uC744 base64\\uB85C \\uC778\\uCF54\\uB529 \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"openssl base64 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -in tutorial.enc \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -out tutorial.enc.b64\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uB807\\uAC8C \\uACC4\\uC0B0\\uD55C base64 \\uC778\\uCF54\\uB529 \\uAC12\\uC744 ciphertext\\uC5D0 \\uC800\\uC7A5\\uD558\\uACE0, checksum\\uC744 \\uC704\\uD574\\uC11C crc32 \\uAC12\\uB3C4 \\uCD94\\uAC00\\uD574\\uC900\\uB2E4.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`data \"google_kms_secret_asymmetric\" \"secret_data\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  crypto_key_version = data.google_kms_crypto_key_version.opentofu-secret.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  crc32              = \"920961a5\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  ciphertext         = \u003c\u003cEOT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    UCIDSu19B3c3twcdppvPUGfu+QWtXEJdCgEru80jwW7r0Zzq1nNIEW9ZaFYGlUUT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    xreYLOF+VsIY5ejnzr0QKuU7Y/0vnZrc7RU6WBNW8R/IyrOXT8LB6e1KwfomduaI\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    4VMrx2WQxo+kaU1Tw2p6JoAKZICzoaZZg2eatMESxlxLlMIQTK6QDbtD0mOu1rzI\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    rz257/jI1FNzxLq9K3BmfxjFWCuL45QnyM0Y8Aqh0YXyVCiPQNr/GodR8JNKl/xt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    rHAEq8YL/r1lOGCJNBsFYjcKIAUD5Ade1hVfUQGZDMNM/wcCLCOU3aHhgkaAT6xG\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    3FjZtyIYW2dnpIelHrtSxepQN4yy49qxeuKaf9Cjj6uXJsTi0bCiTw4PcD4RHOTJ\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    Gbm2QLJMr5BaiUyK0ZXHokynQg++McAiRsygeuWilInXPLpEkDcC+G0+i6Z2f3Ki\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    6kOE9edC5YHFSH4mrUeFZwdbdPgPzfP1szJ+h6jMJJt76jSDovAkwScuh2eibvRG\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    wO+O0VZaZW9WdiwX7yD4GQSkCRTZg4XQJ6TSuG+U18T33mOoQbA0DvvYcYYRMVBS\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    q3YVhbGhBwxfxFXRoWYBqyGomP33NL6cEKWnovwPf3OSPDZ8n66nqzQY18tJvr+7\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    XALVYFRpEdOCBjBa1EbB+e0LKeL8LyREq/3aGX7+X5Q=\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  EOT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  provider = google-beta\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"google_secret_manager_secret\" \"secret_data\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  secret_id = \"secret_key_name\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  replication {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    auto {}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"google_secret_manager_secret_version\" \"secret_data\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  secret = google_secret_manager_secret.secret_data.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  secret_data = data.google_kms_secret_asymmetric.secret_data.plaintext\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uB807\\uAC8C Secret Manager\\uC758 Secret \\uAC12\\uC744 \\uC800\\uC7A5\\uD558\\uBA74, Terraform Resource \\uC815\\uC758\\uC5D0\\uC11C \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uC791\\uC131\\uD558\\uC9C0 \\uC54A\\uACE0 runtime\\uACFC\\uC815\\uC5D0\\uC11C kms\\uC744 \\uD1B5\\uD574\\uC11C \\uBCF5\\uD638\\uD654\\uD574\\uC11C \\uC800\\uC7A5\\uD558\\uAC8C \\uB41C\\uB2E4. Git\\uC5D0\\uB294 \\uD3C9\\uC11C\\uBB38 \\uB300\\uC2E0\\uC5D0 \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uB41C \\uAC12\\uC744 \\uC800\\uC7A5\\uD558\\uBA74 \\uB41C\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uACF5\\uC2DD\\uBB38\\uC11C\\uC5D0 \\uB098\\uC628 \\uAC83\\uCC98\\uB7FC Secret\\uAC12\\uC774 log, plan, state \\uCD9C\\uB825\\uAC12\\uC5D0 \\uB178\\uCD9C\\uB418\\uB294 \\uAC83\\uC5D0 \\uB300\\uD574\\uC11C\\uB294 \\uC8FC\\uC758\\uB97C \\uD574\\uC57C \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Using this data provider will allow you to conceal secret data within your resource definitions, but it does not take care of protecting that data in the logging output, plan output, or state output. Please take care to secure your secret data outside of resource definitions.\"})}),(0,e.jsx)(n.p,{children:'Terraform\\uC73C\\uB85C apply\\uD558\\uACE0 \\uC0DD\\uC131\\uB41C state \\uD30C\\uC77C\\uC744 \\uBCF4\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 plaintext\\uAC12\\uC774 \"hello\"\\uB85C \\uB178\\uCD9C\\uB418\\uC5B4 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.'}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property\",children:'\"attributes\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ciphertext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"crc32\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"crypto_key_version\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"plaintext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"hello\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Terraform\\uC5D0\\uC11C\\uB294 remote state\\uB85C S3\\uC640 \\uAC19\\uC740 Object Storage\\uC5D0 \\uC800\\uC7A5\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC774 \\uAC00\\uB2A5\\uD558\\uACE0, S3\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uBB3C\\uB9AC\\uC801\\uC778 \\uACF5\\uAC04\\uC5D0 \\uC800\\uC7A5\\uB420 \\uB54C \\uC554\\uD638\\uD654\\uAC00 \\uB418\\uC5B4\\uC11C \\uC800\\uC7A5\\uB41C\\uB2E4. \\uD558\\uC9C0\\uB9CC S3\\uC5D0 \\uC800\\uC7A5\\uB418\\uB294 state \\uD30C\\uC77C object\\uB294 \\uB3D9\\uC77C\\uD558\\uAC8C \\uBE44\\uBC00\\uAC12\\uC774 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uB178\\uCD9C\\uB418\\uC5B4 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uD574\\uB2F9 \\uBE44\\uBC00\\uAC12\\uC774 \\uB178\\uCD9C\\uB418\\uC9C0 \\uC54A\\uB3C4\\uB85D S3 bucket\\uC5D0 \\uC811\\uADFC\\uC744 \\uC798 \\uAD00\\uB9AC\\uD574\\uC57C \\uD55C\\uB2E4.\"}),(0,e.jsxs)(n.h2,{id:\"opentofu-state-\\uC554\\uD638\\uD654\",children:[(0,e.jsx)(n.a,{href:\"#opentofu-state-\\uC554\\uD638\\uD654\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"OpenTofu State \\uC554\\uD638\\uD654\"]}),(0,e.jsx)(n.p,{children:\"OpenTofu\\uB97C \\uC0AC\\uC6A9\\uD560 \\uB54C\\uB294 state \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD558\\uB294 \\uC635\\uC158\\uC744 \\uC774\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uC544\\uB798\\uC640 \\uAC19\\uC774 GCP Key Management Service\\uB97C \\uD1B5\\uD574\\uC11C State \\uD30C\\uC77C\\uC744 \\uC554\\uD638\\uD654\\uD558\\uC5EC \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB2E4. Cloud Key Managerment Service\\uB97C \\uC774\\uC6A9\\uD560 \\uB54C\\uB294 \\uD0A4\\uB97C \\uC783\\uC5B4\\uBC84\\uB9B4 \\uAC00\\uB2A5\\uC131\\uC774 \\uAC70\\uC758 \\uC5C6\\uACE0, \\uC2E4\\uC218\\uB85C \\uC0AD\\uC81C\\uD558\\uB354\\uB77C\\uB3C4 \\uC77C\\uC815\\uAE30\\uAC04 \\uBCF4\\uC874\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uBCF5\\uAD6C\\uD560 \\uC218 \\uC788\\uB294 \\uC635\\uC158\\uC774 \\uC874\\uC7AC\\uD55C\\uB2E4. \\uB530\\uB77C\\uC11C State \\uD30C\\uC77C\\uC744 KMS\\uB85C \\uC554\\uD638\\uD654\\uD558\\uC5EC \\uBCF4\\uAD00\\uD560 \\uB54C, \\uD0A4\\uB97C \\uC783\\uC5B4\\uBC84\\uB824\\uC11C \\uB2E4\\uC2DC \\uBCF5\\uD638\\uD654\\uB97C \\uBABB\\uD558\\uB294 \\uBB38\\uC81C\\uC5D0 \\uB300\\uD574\\uC11C \\uB35C \\uAC71\\uC815\\uD574\\uB3C4 \\uB41C\\uB2E4\\uACE0 \\uC0DD\\uAC01\\uB41C\\uB2E4.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  encryption {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    key_provider \"gcp_kms\" \"basic\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      kms_encryption_key = \"KMS key \\uACBD\\uB85C \\uAC12\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      key_length = 32\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    method \"aes_gcm\" \"secure_method\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      keys = key_provider.gcp_kms.basic\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    method \"unencrypted\" \"migrate\" {}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    state {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      method = method.aes_gcm.secure_method\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      fallback {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        method = method.unencrypted.migrate\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  required_providers {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    google-beta = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      source = \"hashicorp/google-beta\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      version = \"6.14.1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(n.p,{children:\"GCP Secret Manager\\uC758 \\uBE44\\uBC00\\uAC12\\uC744 Terraform\\uC73C\\uB85C \\uAD00\\uB9AC\\uD560 \\uB54C, google_kms_secret_asymmetric data source\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uB41C \\uAC12\\uC73C\\uB85C \\uCF54\\uB4DC \\uAD00\\uB9AC\\uB97C \\uD560 \\uC218 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC State, Output \\uAC19\\uC740 \\uACBD\\uB85C\\uB85C \\uBCF5\\uD638\\uD654\\uB41C \\uD3C9\\uC11C\\uBB38\\uC774 \\uB178\\uCD9C\\uB420 \\uC218 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC774\\uC810\\uC5D0 \\uB300\\uD574\\uC11C \\uC8FC\\uC758\\uB97C \\uD574\\uC57C \\uD55C\\uB2E4. Terraform\\uC758 remote state\\uB97C \\uC0AC\\uC6A9\\uD560 \\uACBD\\uC6B0\\uC5D0\\uB294 state \\uD30C\\uC77C\\uC5D0\\uB294 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uC800\\uC7A5\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uD574\\uB2F9 \\uD30C\\uC77C\\uC774 \\uB178\\uCD9C\\uB418\\uC9C0 \\uC54A\\uB3C4\\uB85D \\uC8FC\\uC758\\uD574\\uC57C \\uD55C\\uB2E4. OpenTofu\\uB97C \\uC774\\uC6A9\\uD560 \\uACBD\\uC6B0\\uC5D0\\uB294 State \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD574\\uC11C \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB294 \\uC635\\uC158\\uC774 \\uC788\\uB2E4. Cloud Key Management Service\\uB97C \\uC774\\uC6A9\\uD558\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uD0A4\\uB97C \\uC783\\uC5B4\\uBC84\\uB824\\uC11C \\uB2E4\\uC2DC \\uBCF5\\uD638\\uD654\\uD558\\uC9C0 \\uBABB\\uD558\\uB294 \\uBB38\\uC81C\\uAC00 \\uBC1C\\uC0DD\\uD560 \\uAC00\\uB2A5\\uC131\\uC774 \\uC0C1\\uB2F9\\uD788 \\uC801\\uAE30 \\uB54C\\uBB38\\uC5D0, OpenTofu\\uB97C \\uD1B5\\uD574\\uC11C State \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD558\\uC5EC \\uC800\\uC7A5\\uD558\\uB294 \\uAC83\\uB3C4 \\uACE0\\uB824\\uD574\\uBCFC \\uC218 \\uC788\\uACA0\\uB2E4.\"})]})}}var f=y;return b;})();\n;return Component;","toc":[{"value":"kms_secret_asymmetric","url":"#kms_secret_asymmetric","depth":2},{"value":"OpenTofu State 암호화","url":"#opentofu-state-암호화","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.805,"time":288300,"words":961},"slug":"20250105-opentofu","fileName":"20250105-opentofu.md","title":"GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기","date":"2025-01-05T00:00:00.000Z","tags":["gcp","terraform","opentofu"],"images":["/static/images/social-banner.png"],"summary":"GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"secrets-store-csi-driver-provider-gcp 사용해보기","date":"2025-01-05T00:00:00.000Z","tags":["gcp","kubernetes"],"images":["/static/images/social-banner.png"],"summary":"GKE에서 add-on 기능으로 관리형 서비스인 Google Secret Manager을 Kubernetes Secrets Store CSI Driver로 쉽게 사용할 수 있다. 하지만 add-on 버전에서는 Sync as Kubernetes Secret 기능을 제공하지 않기 때문에, Kubernetes Secret을 환경변수로 설정하는데 제약사항이 있다. 직접 Kubernetes Secrets Store CSI driver와 GCP provider driver를 설치하여 Sync as Kubernetes Secret 기능을 사용할 수 있다. 이렇게 Sync된 Kubernetes Secret을 환경변수로 주입하도록 설정할 수 있다. Google Secret Manager는 아쉽게도 하나의 Secret에 복수의 key value를 제공하지 않는다. 이번 글에서는 Google Secret Manager를 Kubernetes Secret Object와 Sync해서 사용하는 것이 바람직할지 고민해본다.","slug":"20250105-secrets-store-csi-driver-provider-gcp"},"next":{"title":"Bitbucket OIDC with GCP","date":"2025-01-17T00:00:00.000Z","tags":["gcp","oidc","bitbucket"],"images":["/static/images/social-banner.png"],"summary":"Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다.","slug":"20250117-google-oidc-bitbucket"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20250105-opentofu"]},"buildId":"XqYl5nn2sxnBArTY5fDr7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>