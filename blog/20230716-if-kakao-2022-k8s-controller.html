<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기</title><meta name="robots" content="follow, index"/><meta name="description" content="어제는 Programming Kubernetes에 나오는 예제를 kubebuilder로 작성해보았다. if(kakao)2022에서 controller를 테스트하는 방법에 대해서 설명한 발표가 있었다. 어제 이해한 내용을 바탕으로 이 발표에서 사용한 BlueGreen controller 예제를 따라서 작성해보았다."/><meta property="og:url" content="https://jayground8.github.io/blog/20230716-if-kakao-2022-k8s-controller"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="어제는 Programming Kubernetes에 나오는 예제를 kubebuilder로 작성해보았다. if(kakao)2022에서 controller를 테스트하는 방법에 대해서 설명한 발표가 있었다. 어제 이해한 내용을 바탕으로 이 발표에서 사용한 BlueGreen controller 예제를 따라서 작성해보았다."/><meta property="og:title" content="if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기"/><meta property="og:image" content="https://jayground8.github.iosocial-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기"/><meta name="twitter:description" content="어제는 Programming Kubernetes에 나오는 예제를 kubebuilder로 작성해보았다. if(kakao)2022에서 controller를 테스트하는 방법에 대해서 설명한 발표가 있었다. 어제 이해한 내용을 바탕으로 이 발표에서 사용한 BlueGreen controller 예제를 따라서 작성해보았다."/><meta name="twitter:image" content="https://jayground8.github.iosocial-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20230716-if-kakao-2022-k8s-controller"/><meta property="article:published_time" content="2023-07-16T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20230716-if-kakao-2022-k8s-controller"
  },
  "headline": "if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.iosocial-banner.png"
    }
  ],
  "datePublished": "2023-07-16T00:00:00.000Z",
  "dateModified": "2023-07-16T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "어제는 Programming Kubernetes에 나오는 예제를 kubebuilder로 작성해보았다. if(kakao)2022에서 controller를 테스트하는 방법에 대해서 설명한 발표가 있었다. 어제 이해한 내용을 바탕으로 이 발표에서 사용한 BlueGreen controller 예제를 따라서 작성해보았다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b83c5b680e61b031.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/HB4CJMbKXjIAKvbIp-yyR/_buildManifest.js" defer=""></script><script src="/_next/static/HB4CJMbKXjIAKvbIp-yyR/_ssgManifest.js" defer=""></script><script src="/_next/static/HB4CJMbKXjIAKvbIp-yyR/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-07-16T00:00:00.000Z">2023년 7월 16일 일요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p><a target="_blank" rel="noopener noreferrer" href="https://youtu.be/B80-GByJFEA">if(kakao)2022 영상들 중에 Controller 관련 영상</a>이 있어서 따라서 Controller를 작성해보았다. 아래와 같이 Custom Resource BlueGreen을 만들면, <code>spec.routeTo</code>에 따라서 ClusterIP service가 blue pod에 갈지 green pod에 갈지 결정하게 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> app.demo.kakao.com/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> BlueGreen
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> demo
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">routeTo</span><span class="token punctuation">:</span> Blue
</span><span class="code-line">  <span class="token atrule key">blueSpec</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> blue
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> demo<span class="token punctuation">:</span>version<span class="token punctuation">-</span>blue
</span><span class="code-line">  <span class="token atrule key">greenSpec</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> green
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> demo<span class="token punctuation">:</span>version<span class="token punctuation">-</span>green
</span></code></pre></div><h2 id="kubebuilder로-api-생성"><a href="#kubebuilder로-api-생성" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>kubebuilder로 API 생성</h2><p>발표에서 공유된 CRD를 바탕으로 kubebuilder를 통해서 api를 만들었다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">go mod init blue_green_controller
</span><span class="code-line">kubebuilder init --domain demo.kakao.com
</span><span class="code-line">kubebuilder create api --group app --version v1 --kind BlueGreen
</span></code></pre></div><h2 id="type-작성"><a href="#type-작성" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>type 작성</h2><p>이제 <code>bluegreen_types.go</code>를 CRD에 맞춰서 작성을 한다. 이제 RouteTo는 Blue와 Green 값만 가질수 있다라는 가정하에 아래와 같이 Constant를 정의하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">type</span> BlueOrGreen <span class="token builtin">string</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token punctuation">(</span>
</span><span class="code-line">	Blue  BlueOrGreen <span class="token operator">=</span> <span class="token string">&quot;Blue&quot;</span>
</span><span class="code-line">	Green BlueOrGreen <span class="token operator">=</span> <span class="token string">&quot;Green&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">그리고 BlueGreen Kind의 spec과 status를 아래와 같이 정의하였다<span class="token punctuation">.</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> BlueGreenSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	RouteTo   <span class="token builtin">string</span>      <span class="token string">`json:&quot;routeTo&quot;`</span>
</span><span class="code-line">	BlueSpec  <span class="token operator">*</span>v1<span class="token punctuation">.</span>PodSpec <span class="token string">`json:&quot;blueSpec,omitempty&quot;`</span>
</span><span class="code-line">	GreenSpec <span class="token operator">*</span>v1<span class="token punctuation">.</span>PodSpec <span class="token string">`json:&quot;greenSpec,omitempty&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> BlueGreenStatus <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	RouteTo <span class="token builtin">string</span> <span class="token string">`json:&quot;routeTo&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="crd-생성"><a href="#crd-생성" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>CRD 생성</h2><p><code>make install</code>로 해당 type으로 생성된 CRD를 Minikube cluser에 적용한다. 하지만 <code>v1.PodSpec</code>때문에 생성된 CRD file의 size가 커졌고, 아래와 같은 에러가 발생하였다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">The CustomResourceDefinition <span class="token string">&quot;bluegreens.app.demo.kakao.com&quot;</span> is invalid: metadata.annotations: Too long: must have at <span class="token function">most</span> <span class="token number">262144</span> bytes
</span><span class="code-line">make: *** <span class="token punctuation">[</span>install<span class="token punctuation">]</span> Error <span class="token number">1</span>
</span></code></pre></div><p><code>make install</code>은 <code>kustomize build config/crd | kubectl apply -f -</code>를 실행하게 되는데, kubectl apply는 client-side apply로 <code>last-applied-configuration</code> annotation을 추가하고 이 정보를 바탕으로 현재 resource의 state에서 어떤 것을 update할지 판단하게 된다. 그런데 client-side는 이제 kubectl apply로 하는 동안 controller나 다른 agent에 의해서 resource state가 변경되면 detect를 하지 못하고, 그냥 overwrite를 할 수 있게 된다. <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/reference/using-api/server-side-apply/">Kubernetes v1.22에서 stable 상태가 된 server-side apply</a>를 적용하면, 이제 conflict를 detect해서 이제 update를 되는 것을 막을 수 있게 된다.</p><p><code>v1.PodSpec</code>때문에 CRD의 크기가 커졌고, <code>kubectl apply</code>를 통해서 <code>annotation</code>이 추가되니 사이즈 제한을 넘어서게 된 것이다. 따라서 <code>client-side apply</code> 대신에 <code>server-side apply</code>를 사용하여 이러한 <code>annotation</code> 생성없이 CRD를 생성하도록 해서 해결 할 수 있다. <code>make manifests</code>로 CRD file을 생성하고, 아래와 같이 별도로 CRD를 cluster에 생성하도록 하였다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kustomize build config/crd <span class="token operator">|</span> kubectl apply --server-side<span class="token operator">=</span>true -f -
</span></code></pre></div><h2 id="controller-business-logic-추가"><a href="#controller-business-logic-추가" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Controller Business logic 추가</h2><p>그리고 이제 BlueGreen resource를 contoller하기 위해서 <code>bluegreen_controller.go</code>에 business logic을 추가한다. 발표자료에서 이 business logic을 공유해주었기 때문에 동일하게 작성을 하였다.</p><h3 id="메모리-할당-new-vs-something"><a href="#메모리-할당-new-vs-something" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>메모리 할당 new vs &amp;something</h3><p>Custom resource <code>At</code>을 control하는 business logic을 작성할 때는, 아래와 같이 instance 변수에 메모리를 할당하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">instance <span class="token operator">:=</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>BlueGreen<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// return a pointer</span>
</span></code></pre></div><p>하지만 발표자료에서는 아래처럼 new function을 사용했다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">instance <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>BlueGreen<span class="token punctuation">)</span>
</span></code></pre></div><h3 id="struct-promoted-field"><a href="#struct-promoted-field" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>struct promoted field</h3><p><code>At Controller</code>에서는 아래처럼 struct type가 정의가 되었을 때, <code>client.Client</code>가 promoted field가 되어서 Client를 통해서 resource를 GET할 때 <code>r.Get()</code>으로 작성했다. 하지만 발표자료에서는 <code>r.Client.Get()</code>로 name을 명시적으로 작성하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">type</span> BlueGreenReconciler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	client<span class="token punctuation">.</span>Client
</span><span class="code-line">	Scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="initialization-statement"><a href="#initialization-statement" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>initialization statement</h3><p>발표자료에서는 <code>initialization statement</code>을 사용했다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>Client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>NamespacedName<span class="token punctuation">,</span> blueGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">IgnoreNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="clientignorenotfound"><a href="#clientignorenotfound" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Client.IgnoreNotFound</h3><p><code>At Controller</code>에서는 resource를 찾을 수 없는 에러인지 이렇게 errors package를 통해서 확인을 했다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">IsNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> reconcile<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>하지만 발표자료에서는 Client의 <code>IgnoreNotFound</code>을 사용하여, NotFound Error일 때는 nil를 반환하도록 하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">IgnoreNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
</span></code></pre></div><h3 id="declarative-error"><a href="#declarative-error" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>declarative error</h3><p>발표자료에서 <code>fmt.Errorf</code> 함수를 사용하여 custom message를 에러에 추가하여 어떤 에러인지 알기 쉽게 하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;fail to set owner reference for a service: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span></code></pre></div><h3 id="pointer-type"><a href="#pointer-type" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>pointer type</h3><p>발표자료에서 range를 통해서 for loop iteration을 하도록 작성하였다. 그런데 struct에 Spec의 Type이 <code>*corev1.PodSpec</code>으로 정의되어서 pointer를 사용하도록 하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tgt <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">  Phase v1<span class="token punctuation">.</span>BlueOrGreen
</span><span class="code-line">  Spec  <span class="token operator">*</span>corev1<span class="token punctuation">.</span>PodSpec
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">{</span>Phase<span class="token punctuation">:</span> v1<span class="token punctuation">.</span>Blue<span class="token punctuation">,</span> Spec<span class="token punctuation">:</span> blueGreen<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>BlueSpec<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">{</span>Phase<span class="token punctuation">:</span> v1<span class="token punctuation">.</span>Green<span class="token punctuation">,</span> Spec<span class="token punctuation">:</span> blueGreen<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>GreenSpec<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>따라서 <code>BlueGreenSpec</code>에서도 동일하게 type을 정의하였다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">type</span> BlueGreenSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	RouteTo   <span class="token builtin">string</span>      <span class="token string">`json:&quot;routeTo&quot;`</span>
</span><span class="code-line">	BlueSpec  <span class="token operator">*</span>v1<span class="token punctuation">.</span>PodSpec <span class="token string">`json:&quot;blueSpec,omitempty&quot;`</span>
</span><span class="code-line">	GreenSpec <span class="token operator">*</span>v1<span class="token punctuation">.</span>PodSpec <span class="token string">`json:&quot;greenSpec,omitempty&quot;`</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>그래서 value를 가져오기 위해서 아래처럼 <code>*tgt.Spec</code>으로 작성되었다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">deploy<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Template <span class="token operator">=</span> corev1<span class="token punctuation">.</span>PodTemplateSpec<span class="token punctuation">{</span>
</span><span class="code-line">  ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">{</span>Labels<span class="token punctuation">:</span> label<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  Spec<span class="token punctuation">:</span>       <span class="token operator">*</span>tgt<span class="token punctuation">.</span>Spec<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="전체-business-logic-code"><a href="#전체-business-logic-code" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>전체 business logic code</h2><p>Service를 CreateOrUpdate 함수로 생성하거나 업데이트를 하고, CRD에서 BlueSpec, GreenSpec에 정의된 container image로 Deployment resource를 두 개 생성하거나 업데이트하게 된다. 이제 service의 selector를 통해서 blue pod 요청할지 green pod에 요청할지 결정하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">package</span> controller
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line">	<span class="token string">&quot;context&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;fmt&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;strings&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	appsv1 <span class="token string">&quot;k8s.io/api/apps/v1&quot;</span>
</span><span class="code-line">	corev1 <span class="token string">&quot;k8s.io/api/core/v1&quot;</span>
</span><span class="code-line">	metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
</span><span class="code-line">	ctrl <span class="token string">&quot;sigs.k8s.io/controller-runtime&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/client&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/log&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	v1 <span class="token string">&quot;blue_green_controller/api/v1&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// BlueGreenReconciler reconciles a BlueGreen object</span>
</span><span class="code-line"><span class="token keyword">type</span> BlueGreenReconciler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	client<span class="token punctuation">.</span>Client
</span><span class="code-line">	Scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens,verbs=get;list;watch;create;update;patch;delete</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens/status,verbs=get;update;patch</span>
</span><span class="code-line"><span class="token comment">//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens/finalizers,verbs=update</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Reconcile is part of the main kubernetes reconciliation loop which aims to</span>
</span><span class="code-line"><span class="token comment">// move the current state of the cluster closer to the desired state.</span>
</span><span class="code-line"><span class="token comment">// TODO(user): Modify the Reconcile function to compare the state specified by</span>
</span><span class="code-line"><span class="token comment">// the BlueGreen object against the actual cluster state, and then</span>
</span><span class="code-line"><span class="token comment">// perform operations to make the cluster state reflect the state specified by</span>
</span><span class="code-line"><span class="token comment">// the user.</span>
</span><span class="code-line"><span class="token comment">//</span>
</span><span class="code-line"><span class="token comment">// For more details, check Reconcile and its Result here:</span>
</span><span class="code-line"><span class="token comment">// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.15.0/pkg/reconcile</span>
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BlueGreenReconciler<span class="token punctuation">)</span> <span class="token function">Reconcile</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req ctrl<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	log <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">FromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;=== Reconciling BlueGreen&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	blueGreen <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>BlueGreen<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>Client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>NamespacedName<span class="token punctuation">,</span> blueGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">IgnoreNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	svc <span class="token operator">:=</span> <span class="token operator">&amp;</span>corev1<span class="token punctuation">.</span>Service<span class="token punctuation">{</span>ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">{</span>Namespace<span class="token punctuation">:</span> req<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> req<span class="token punctuation">.</span>Name<span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">CreateOrUpdate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Client<span class="token punctuation">,</span> svc<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">SetControllerReference</span><span class="token punctuation">(</span>blueGreen<span class="token punctuation">,</span> svc<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Scheme<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;fail to set owner reference for a service: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		svc<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Ports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>corev1<span class="token punctuation">.</span>ServicePort<span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> Protocol<span class="token punctuation">:</span> corev1<span class="token punctuation">.</span>ProtocolTCP<span class="token punctuation">,</span> Port<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		svc<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Selector <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token string">&quot;app.kubernetes.io/managed-by&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;app.demo.kakao.com&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token string">&quot;app.kubernetes.io/name&quot;</span><span class="token punctuation">:</span>       req<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token string">&quot;app.kubernetes.io/phase&quot;</span><span class="token punctuation">:</span>      <span class="token function">string</span><span class="token punctuation">(</span>blueGreen<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>RouteTo<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;fail to create (or update) service: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tgt <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">		Phase v1<span class="token punctuation">.</span>BlueOrGreen
</span><span class="code-line">		Spec  <span class="token operator">*</span>corev1<span class="token punctuation">.</span>PodSpec
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token punctuation">{</span>Phase<span class="token punctuation">:</span> v1<span class="token punctuation">.</span>Blue<span class="token punctuation">,</span> Spec<span class="token punctuation">:</span> blueGreen<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>BlueSpec<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">{</span>Phase<span class="token punctuation">:</span> v1<span class="token punctuation">.</span>Green<span class="token punctuation">,</span> Spec<span class="token punctuation">:</span> blueGreen<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>GreenSpec<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">if</span> tgt<span class="token punctuation">.</span>Spec <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">continue</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		deploy <span class="token operator">:=</span> <span class="token operator">&amp;</span>appsv1<span class="token punctuation">.</span>Deployment<span class="token punctuation">{</span>ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">{</span>Namespace<span class="token punctuation">:</span> req<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> req<span class="token punctuation">.</span>Name <span class="token operator">+</span> strings<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>tgt<span class="token punctuation">.</span>Phase<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-deployment&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">CreateOrUpdate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Client<span class="token punctuation">,</span> deploy<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">if</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">SetControllerReference</span><span class="token punctuation">(</span>blueGreen<span class="token punctuation">,</span> deploy<span class="token punctuation">,</span> r<span class="token punctuation">.</span>Scheme<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">				<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;fail to set owner reference for a deployment: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">			<span class="token punctuation">}</span>
</span><span class="code-line">			label <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
</span><span class="code-line">				<span class="token string">&quot;app.kubernetes.io/managed-by&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;app.demo.kakao.com&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">				<span class="token string">&quot;app.kubernetes.io/name&quot;</span><span class="token punctuation">:</span>       req<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
</span><span class="code-line">				<span class="token string">&quot;app.kubernetes.io/phase&quot;</span><span class="token punctuation">:</span>      <span class="token function">string</span><span class="token punctuation">(</span>tgt<span class="token punctuation">.</span>Phase<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span>
</span><span class="code-line">			deploy<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Selector <span class="token operator">=</span> <span class="token operator">&amp;</span>metav1<span class="token punctuation">.</span>LabelSelector<span class="token punctuation">{</span>MatchLabels<span class="token punctuation">:</span> label<span class="token punctuation">}</span>
</span><span class="code-line">			deploy<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Template <span class="token operator">=</span> corev1<span class="token punctuation">.</span>PodTemplateSpec<span class="token punctuation">{</span>
</span><span class="code-line">				ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">{</span>Labels<span class="token punctuation">:</span> label<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				Spec<span class="token punctuation">:</span>       <span class="token operator">*</span>tgt<span class="token punctuation">.</span>Spec<span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span>
</span><span class="code-line">			<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;fail to create (or update) deployment: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	blueGreen<span class="token punctuation">.</span>Status <span class="token operator">=</span> v1<span class="token punctuation">.</span>BlueGreenStatus<span class="token punctuation">{</span>
</span><span class="code-line">		RouteTo<span class="token punctuation">:</span> blueGreen<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>RouteTo<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>Client<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> blueGreen<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;fail to update bluegreen status: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// SetupWithManager sets up the controller with the Manager.</span>
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>BlueGreenReconciler<span class="token punctuation">)</span> <span class="token function">SetupWithManager</span><span class="token punctuation">(</span>mgr ctrl<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span><span class="token function">NewControllerManagedBy</span><span class="token punctuation">(</span>mgr<span class="token punctuation">)</span><span class="token punctuation">.</span>
</span><span class="code-line">		<span class="token function">For</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>BlueGreen<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
</span><span class="code-line">		<span class="token function">Complete</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="로컬에서-동작-확인"><a href="#로컬에서-동작-확인" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>로컬에서 동작 확인</h2><p><code>make run</code>으로 이제 해당 controller을 local에서 실행하고, custom resource BlueGreen을 Minikube cluster에 생성한다. <code>routeTo</code>를 Blue로 선택했기 때문에 echo server가 실행되고 있는 container로 요청하게 된다. 이제 Green으로 변경하면 Terminated된 busybox container로 요청하여 정상적인 응답을 못 받게 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> app.demo.kakao.com/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> BlueGreen
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> demo
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">routeTo</span><span class="token punctuation">:</span> Blue
</span><span class="code-line">  <span class="token atrule key">blueSpec</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> blue
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> ealen/echo<span class="token punctuation">-</span>server
</span><span class="code-line">  <span class="token atrule key">greenSpec</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> green
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> busybox
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230715-k8s-controller">Kubernetes custom controller 작성해보기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230717-book-review-indistractable-hooked">책 두 권 &lt;초집중&gt;, &lt;훅&gt;</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var m=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of d(s))!h.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003es[e],enumerable:!(c=p(s,e))||c.enumerable});return a},g=a=\u003ek(t(l(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((w,i)=\u003e{i.exports=_jsx_runtime});var v={};N(v,{default:()=\u003ef,frontmatter:()=\u003eb});var n=g(o()),b={title:\"if(kakao)2022 Testing Kubernetes Controller \\uBC1C\\uD45C \\uB530\\uB77C \\uB9CC\\uB4E4\\uAE30\",date:\"2023-07-16\",tags:[\"kubernetes\"],summary:\"\\uC5B4\\uC81C\\uB294 Programming Kubernetes\\uC5D0 \\uB098\\uC624\\uB294 \\uC608\\uC81C\\uB97C kubebuilder\\uB85C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4. if(kakao)2022\\uC5D0\\uC11C controller\\uB97C \\uD14C\\uC2A4\\uD2B8\\uD558\\uB294 \\uBC29\\uBC95\\uC5D0 \\uB300\\uD574\\uC11C \\uC124\\uBA85\\uD55C \\uBC1C\\uD45C\\uAC00 \\uC788\\uC5C8\\uB2E4. \\uC5B4\\uC81C \\uC774\\uD574\\uD55C \\uB0B4\\uC6A9\\uC744 \\uBC14\\uD0D5\\uC73C\\uB85C \\uC774 \\uBC1C\\uD45C\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uD55C BlueGreen controller \\uC608\\uC81C\\uB97C \\uB530\\uB77C\\uC11C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4.\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",a:\"a\",code:\"code\",pre:\"pre\",span:\"span\",h2:\"h2\",h3:\"h3\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://youtu.be/B80-GByJFEA\",children:\"if(kakao)2022 \\uC601\\uC0C1\\uB4E4 \\uC911\\uC5D0 Controller \\uAD00\\uB828 \\uC601\\uC0C1\"}),\"\\uC774 \\uC788\\uC5B4\\uC11C \\uB530\\uB77C\\uC11C Controller\\uB97C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4. \\uC544\\uB798\\uC640 \\uAC19\\uC774 Custom Resource BlueGreen\\uC744 \\uB9CC\\uB4E4\\uBA74, \",(0,n.jsx)(e.code,{children:\"spec.routeTo\"}),\"\\uC5D0 \\uB530\\uB77C\\uC11C ClusterIP service\\uAC00 blue pod\\uC5D0 \\uAC08\\uC9C0 green pod\\uC5D0 \\uAC08\\uC9C0 \\uACB0\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` app.demo.kakao.com/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` BlueGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` demo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"routeTo\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"blueSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" demo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"greenSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` green\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" demo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`green\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"kubebuilder\\uB85C-api-\\uC0DD\\uC131\",children:[(0,n.jsx)(e.a,{href:\"#kubebuilder\\uB85C-api-\\uC0DD\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"kubebuilder\\uB85C API \\uC0DD\\uC131\"]}),(0,n.jsx)(e.p,{children:\"\\uBC1C\\uD45C\\uC5D0\\uC11C \\uACF5\\uC720\\uB41C CRD\\uB97C \\uBC14\\uD0D5\\uC73C\\uB85C kubebuilder\\uB97C \\uD1B5\\uD574\\uC11C api\\uB97C \\uB9CC\\uB4E4\\uC5C8\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`go mod init blue_green_controller\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubebuilder init --domain demo.kakao.com\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubebuilder create api --group app --version v1 --kind BlueGreen\n`})]})}),(0,n.jsxs)(e.h2,{id:\"type-\\uC791\\uC131\",children:[(0,n.jsx)(e.a,{href:\"#type-\\uC791\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"type \\uC791\\uC131\"]}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"bluegreen_types.go\"}),\"\\uB97C CRD\\uC5D0 \\uB9DE\\uCDB0\\uC11C \\uC791\\uC131\\uC744 \\uD55C\\uB2E4. \\uC774\\uC81C RouteTo\\uB294 Blue\\uC640 Green \\uAC12\\uB9CC \\uAC00\\uC9C8\\uC218 \\uC788\\uB2E4\\uB77C\\uB294 \\uAC00\\uC815\\uD558\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 Constant\\uB97C \\uC815\\uC758\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueOrGreen \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tBlue  BlueOrGreen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Blue\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tGreen BlueOrGreen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Green\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\\uADF8\\uB9AC\\uACE0 BlueGreen Kind\\uC758 spec\\uACFC status\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC815\\uC758\\uD558\\uC600\\uB2E4\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tRouteTo   \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"routeTo\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tBlueSpec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"blueSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tGreenSpec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"greenSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenStatus \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tRouteTo \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"routeTo\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"crd-\\uC0DD\\uC131\",children:[(0,n.jsx)(e.a,{href:\"#crd-\\uC0DD\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"CRD \\uC0DD\\uC131\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make install\"}),\"\\uB85C \\uD574\\uB2F9 type\\uC73C\\uB85C \\uC0DD\\uC131\\uB41C CRD\\uB97C Minikube cluser\\uC5D0 \\uC801\\uC6A9\\uD55C\\uB2E4. \\uD558\\uC9C0\\uB9CC \",(0,n.jsx)(e.code,{children:\"v1.PodSpec\"}),\"\\uB54C\\uBB38\\uC5D0 \\uC0DD\\uC131\\uB41C CRD file\\uC758 size\\uAC00 \\uCEE4\\uC84C\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uC5D0\\uB7EC\\uAC00 \\uBC1C\\uC0DD\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"The CustomResourceDefinition \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"bluegreens.app.demo.kakao.com\"'}),\" is invalid: metadata.annotations: Too long: must have at \",(0,n.jsx)(e.span,{className:\"token function\",children:\"most\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"262144\"}),` bytes\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"make: *** \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"install\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Error \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make install\"}),\"\\uC740 \",(0,n.jsx)(e.code,{children:\"kustomize build config/crd | kubectl apply -f -\"}),\"\\uB97C \\uC2E4\\uD589\\uD558\\uAC8C \\uB418\\uB294\\uB370, kubectl apply\\uB294 client-side apply\\uB85C \",(0,n.jsx)(e.code,{children:\"last-applied-configuration\"}),\" annotation\\uC744 \\uCD94\\uAC00\\uD558\\uACE0 \\uC774 \\uC815\\uBCF4\\uB97C \\uBC14\\uD0D5\\uC73C\\uB85C \\uD604\\uC7AC resource\\uC758 state\\uC5D0\\uC11C \\uC5B4\\uB5A4 \\uAC83\\uC744 update\\uD560\\uC9C0 \\uD310\\uB2E8\\uD558\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB7F0\\uB370 client-side\\uB294 \\uC774\\uC81C kubectl apply\\uB85C \\uD558\\uB294 \\uB3D9\\uC548 controller\\uB098 \\uB2E4\\uB978 agent\\uC5D0 \\uC758\\uD574\\uC11C resource state\\uAC00 \\uBCC0\\uACBD\\uB418\\uBA74 detect\\uB97C \\uD558\\uC9C0 \\uBABB\\uD558\\uACE0, \\uADF8\\uB0E5 overwrite\\uB97C \\uD560 \\uC218 \\uC788\\uAC8C \\uB41C\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://kubernetes.io/docs/reference/using-api/server-side-apply/\",children:\"Kubernetes v1.22\\uC5D0\\uC11C stable \\uC0C1\\uD0DC\\uAC00 \\uB41C server-side apply\"}),\"\\uB97C \\uC801\\uC6A9\\uD558\\uBA74, \\uC774\\uC81C conflict\\uB97C detect\\uD574\\uC11C \\uC774\\uC81C update\\uB97C \\uB418\\uB294 \\uAC83\\uC744 \\uB9C9\\uC744 \\uC218 \\uC788\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"v1.PodSpec\"}),\"\\uB54C\\uBB38\\uC5D0 CRD\\uC758 \\uD06C\\uAE30\\uAC00 \\uCEE4\\uC84C\\uACE0, \",(0,n.jsx)(e.code,{children:\"kubectl apply\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"annotation\"}),\"\\uC774 \\uCD94\\uAC00\\uB418\\uB2C8 \\uC0AC\\uC774\\uC988 \\uC81C\\uD55C\\uC744 \\uB118\\uC5B4\\uC11C\\uAC8C \\uB41C \\uAC83\\uC774\\uB2E4. \\uB530\\uB77C\\uC11C \",(0,n.jsx)(e.code,{children:\"client-side apply\"}),\" \\uB300\\uC2E0\\uC5D0 \",(0,n.jsx)(e.code,{children:\"server-side apply\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC774\\uB7EC\\uD55C \",(0,n.jsx)(e.code,{children:\"annotation\"}),\" \\uC0DD\\uC131\\uC5C6\\uC774 CRD\\uB97C \\uC0DD\\uC131\\uD558\\uB3C4\\uB85D \\uD574\\uC11C \\uD574\\uACB0 \\uD560 \\uC218 \\uC788\\uB2E4. \",(0,n.jsx)(e.code,{children:\"make manifests\"}),\"\\uB85C CRD file\\uC744 \\uC0DD\\uC131\\uD558\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uBCC4\\uB3C4\\uB85C CRD\\uB97C cluster\\uC5D0 \\uC0DD\\uC131\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"kustomize build config/crd \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" kubectl apply --server-side\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`true -f -\n`]})})}),(0,n.jsxs)(e.h2,{id:\"controller-business-logic-\\uCD94\\uAC00\",children:[(0,n.jsx)(e.a,{href:\"#controller-business-logic-\\uCD94\\uAC00\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Controller Business logic \\uCD94\\uAC00\"]}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uC774\\uC81C BlueGreen resource\\uB97C contoller\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"bluegreen_controller.go\"}),\"\\uC5D0 business logic\\uC744 \\uCD94\\uAC00\\uD55C\\uB2E4. \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C \\uC774 business logic\\uC744 \\uACF5\\uC720\\uD574\\uC8FC\\uC5C8\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uB3D9\\uC77C\\uD558\\uAC8C \\uC791\\uC131\\uC744 \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsxs)(e.h3,{id:\"\\uBA54\\uBAA8\\uB9AC-\\uD560\\uB2F9-new-vs-something\",children:[(0,n.jsx)(e.a,{href:\"#\\uBA54\\uBAA8\\uB9AC-\\uD560\\uB2F9-new-vs-something\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uBA54\\uBAA8\\uB9AC \\uD560\\uB2F9 new vs \u0026something\"]}),(0,n.jsxs)(e.p,{children:[\"Custom resource \",(0,n.jsx)(e.code,{children:\"At\"}),\"\\uC744 control\\uD558\\uB294 business logic\\uC744 \\uC791\\uC131\\uD560 \\uB54C\\uB294, \\uC544\\uB798\\uC640 \\uAC19\\uC774 instance \\uBCC0\\uC218\\uC5D0 \\uBA54\\uBAA8\\uB9AC\\uB97C \\uD560\\uB2F9\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"instance \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// return a pointer\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"\\uD558\\uC9C0\\uB9CC \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC new function\\uC744 \\uC0AC\\uC6A9\\uD588\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"instance \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"new\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"struct-promoted-field\",children:[(0,n.jsx)(e.a,{href:\"#struct-promoted-field\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"struct promoted field\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"At Controller\"}),\"\\uC5D0\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC struct type\\uAC00 \\uC815\\uC758\\uAC00 \\uB418\\uC5C8\\uC744 \\uB54C, \",(0,n.jsx)(e.code,{children:\"client.Client\"}),\"\\uAC00 promoted field\\uAC00 \\uB418\\uC5B4\\uC11C Client\\uB97C \\uD1B5\\uD574\\uC11C resource\\uB97C GET\\uD560 \\uB54C \",(0,n.jsx)(e.code,{children:\"r.Get()\"}),\"\\uC73C\\uB85C \\uC791\\uC131\\uD588\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 \",(0,n.jsx)(e.code,{children:\"r.Client.Get()\"}),\"\\uB85C name\\uC744 \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uC791\\uC131\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenReconciler \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tclient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Client\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tScheme \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"runtime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Scheme\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"initialization-statement\",children:[(0,n.jsx)(e.a,{href:\"#initialization-statement\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"initialization statement\"]}),(0,n.jsxs)(e.p,{children:[\"\\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 \",(0,n.jsx)(e.code,{children:\"initialization statement\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD588\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NamespacedName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IgnoreNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"clientignorenotfound\",children:[(0,n.jsx)(e.a,{href:\"#clientignorenotfound\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Client.IgnoreNotFound\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"At Controller\"}),\"\\uC5D0\\uC11C\\uB294 resource\\uB97C \\uCC3E\\uC744 \\uC218 \\uC5C6\\uB294 \\uC5D0\\uB7EC\\uC778\\uC9C0 \\uC774\\uB807\\uAC8C errors package\\uB97C \\uD1B5\\uD574\\uC11C \\uD655\\uC778\\uC744 \\uD588\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" errors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IsNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uD558\\uC9C0\\uB9CC \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 Client\\uC758 \",(0,n.jsx)(e.code,{children:\"IgnoreNotFound\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC, NotFound Error\\uC77C \\uB54C\\uB294 nil\\uB97C \\uBC18\\uD658\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IgnoreNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"declarative-error\",children:[(0,n.jsx)(e.a,{href:\"#declarative-error\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"declarative error\"]}),(0,n.jsxs)(e.p,{children:[\"\\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"fmt.Errorf\"}),\" \\uD568\\uC218\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC custom message\\uB97C \\uC5D0\\uB7EC\\uC5D0 \\uCD94\\uAC00\\uD558\\uC5EC \\uC5B4\\uB5A4 \\uC5D0\\uB7EC\\uC778\\uC9C0 \\uC54C\\uAE30 \\uC27D\\uAC8C \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to set owner reference for a service: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"pointer-type\",children:[(0,n.jsx)(e.a,{href:\"#pointer-type\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"pointer type\"]}),(0,n.jsxs)(e.p,{children:[\"\\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C range\\uB97C \\uD1B5\\uD574\\uC11C for loop iteration\\uC744 \\uD558\\uB3C4\\uB85D \\uC791\\uC131\\uD558\\uC600\\uB2E4. \\uADF8\\uB7F0\\uB370 struct\\uC5D0 Spec\\uC758 Type\\uC774 \",(0,n.jsx)(e.code,{children:\"*corev1.PodSpec\"}),\"\\uC73C\\uB85C \\uC815\\uC758\\uB418\\uC5B4\\uC11C pointer\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tgt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Phase v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`BlueOrGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Spec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PodSpec\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Blue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Green\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GreenSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uB530\\uB77C\\uC11C \",(0,n.jsx)(e.code,{children:\"BlueGreenSpec\"}),\"\\uC5D0\\uC11C\\uB3C4 \\uB3D9\\uC77C\\uD558\\uAC8C type\\uC744 \\uC815\\uC758\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tRouteTo   \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"routeTo\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tBlueSpec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"blueSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tGreenSpec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"greenSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB798\\uC11C value\\uB97C \\uAC00\\uC838\\uC624\\uAE30 \\uC704\\uD574\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"*tgt.Spec\"}),\"\\uC73C\\uB85C \\uC791\\uC131\\uB418\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"deploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Template \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodTemplateSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Labels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"\\uC804\\uCCB4-business-logic-code\",children:[(0,n.jsx)(e.a,{href:\"#\\uC804\\uCCB4-business-logic-code\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uC804\\uCCB4 business logic code\"]}),(0,n.jsx)(e.p,{children:\"Service\\uB97C CreateOrUpdate \\uD568\\uC218\\uB85C \\uC0DD\\uC131\\uD558\\uAC70\\uB098 \\uC5C5\\uB370\\uC774\\uD2B8\\uB97C \\uD558\\uACE0, CRD\\uC5D0\\uC11C BlueSpec, GreenSpec\\uC5D0 \\uC815\\uC758\\uB41C container image\\uB85C Deployment resource\\uB97C \\uB450 \\uAC1C \\uC0DD\\uC131\\uD558\\uAC70\\uB098 \\uC5C5\\uB370\\uC774\\uD2B8\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC774\\uC81C service\\uC758 selector\\uB97C \\uD1B5\\uD574\\uC11C blue pod \\uC694\\uCCAD\\uD560\\uC9C0 green pod\\uC5D0 \\uC694\\uCCAD\\uD560\\uC9C0 \\uACB0\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` controller\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"fmt\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"strings\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tappsv1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/api/apps/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tcorev1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/api/core/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tmetav1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/apis/meta/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/runtime\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tctrl \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/client\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/log\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tv1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"blue_green_controller/api/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// BlueGreenReconciler reconciles a BlueGreen object\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenReconciler \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tclient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Client\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tScheme \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"runtime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Scheme\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens,verbs=get;list;watch;create;update;patch;delete\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens/status,verbs=get;update;patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens/finalizers,verbs=update\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Reconcile is part of the main kubernetes reconciliation loop which aims to\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// move the current state of the cluster closer to the desired state.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// TODO(user): Modify the Reconcile function to compare the state specified by\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// the BlueGreen object against the actual cluster state, and then\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// perform operations to make the cluster state reflect the state specified by\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// the user.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// For more details, check Reconcile and its Result here:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.15.0/pkg/reconcile\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"BlueGreenReconciler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Reconcile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" log\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"FromContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=== Reconciling BlueGreen\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tblueGreen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"new\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NamespacedName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IgnoreNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tsvc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Service\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"CreateOrUpdate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" svc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetControllerReference\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" svc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scheme\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to set owner reference for a service: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tsvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Ports \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ServicePort\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"http\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Protocol\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ProtocolTCP\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Port\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"80\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tsvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Selector \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/managed-by\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.demo.kakao.com\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/phase\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RouteTo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to create (or update) service: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tgt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tPhase v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`BlueOrGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tSpec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PodSpec\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Blue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Green\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GreenSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"continue\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tdeploy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"appsv1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Deployment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" strings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ToLower\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"-deployment\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"CreateOrUpdate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" deploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetControllerReference\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" deploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scheme\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to set owner reference for a deployment: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tlabel \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/managed-by\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.demo.kakao.com\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/phase\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tdeploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Selector \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"LabelSelector\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"MatchLabels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tdeploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Template \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodTemplateSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Labels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to create (or update) deployment: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tblueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreenStatus\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tRouteTo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RouteTo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to update bluegreen status: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// SetupWithManager sets up the controller with the Manager.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"BlueGreenReconciler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SetupWithManager\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mgr ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Manager\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewControllerManagedBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mgr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"For\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"Complete\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"\\uB85C\\uCEEC\\uC5D0\\uC11C-\\uB3D9\\uC791-\\uD655\\uC778\",children:[(0,n.jsx)(e.a,{href:\"#\\uB85C\\uCEEC\\uC5D0\\uC11C-\\uB3D9\\uC791-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uB85C\\uCEEC\\uC5D0\\uC11C \\uB3D9\\uC791 \\uD655\\uC778\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make run\"}),\"\\uC73C\\uB85C \\uC774\\uC81C \\uD574\\uB2F9 controller\\uC744 local\\uC5D0\\uC11C \\uC2E4\\uD589\\uD558\\uACE0, custom resource BlueGreen\\uC744 Minikube cluster\\uC5D0 \\uC0DD\\uC131\\uD55C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"routeTo\"}),\"\\uB97C Blue\\uB85C \\uC120\\uD0DD\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 echo server\\uAC00 \\uC2E4\\uD589\\uB418\\uACE0 \\uC788\\uB294 container\\uB85C \\uC694\\uCCAD\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC774\\uC81C Green\\uC73C\\uB85C \\uBCC0\\uACBD\\uD558\\uBA74 Terminated\\uB41C busybox container\\uB85C \\uC694\\uCCAD\\uD558\\uC5EC \\uC815\\uC0C1\\uC801\\uC778 \\uC751\\uB2F5\\uC744 \\uBABB \\uBC1B\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` app.demo.kakao.com/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` BlueGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` demo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"routeTo\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"blueSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ealen/echo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"greenSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` green\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` busybox\n`]})]})})]})}}var f=y;return v;})();\n;return Component;","toc":[{"value":"kubebuilder로 API 생성","url":"#kubebuilder로-api-생성","depth":2},{"value":"type 작성","url":"#type-작성","depth":2},{"value":"CRD 생성","url":"#crd-생성","depth":2},{"value":"Controller Business logic 추가","url":"#controller-business-logic-추가","depth":2},{"value":"메모리 할당 new vs \u0026something","url":"#메모리-할당-new-vs-something","depth":3},{"value":"struct promoted field","url":"#struct-promoted-field","depth":3},{"value":"initialization statement","url":"#initialization-statement","depth":3},{"value":"Client.IgnoreNotFound","url":"#clientignorenotfound","depth":3},{"value":"declarative error","url":"#declarative-error","depth":3},{"value":"pointer type","url":"#pointer-type","depth":3},{"value":"전체 business logic code","url":"#전체-business-logic-code","depth":2},{"value":"로컬에서 동작 확인","url":"#로컬에서-동작-확인","depth":2}],"frontMatter":{"readingTime":{"text":"10 min read","minutes":9.735,"time":584100,"words":1947},"slug":"20230716-if-kakao-2022-k8s-controller","fileName":"20230716-if-kakao-2022-k8s-controller.mdx","title":"if(kakao)2022 Testing Kubernetes Controller 발표 따라 만들기","date":"2023-07-16T00:00:00.000Z","tags":["kubernetes"],"summary":"어제는 Programming Kubernetes에 나오는 예제를 kubebuilder로 작성해보았다. if(kakao)2022에서 controller를 테스트하는 방법에 대해서 설명한 발표가 있었다. 어제 이해한 내용을 바탕으로 이 발표에서 사용한 BlueGreen controller 예제를 따라서 작성해보았다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Kubernetes custom controller 작성해보기","date":"2023-07-15T00:00:00.000Z","tags":["kubernetes"],"summary":"Programming Kubernetes 책에서 나온 예제를 따라서 custom controller를 작성해보았다. CustomResourceDefinition를 어떻게 정의하고, kubebuilder로 어떻게 나만의 business logic을 작성할 수 있는지 예제를 통해서 이해했다.","slug":"20230715-k8s-controller"},"next":{"title":"책 두 권 \u003c초집중\u003e, \u003c훅\u003e","date":"2023-07-17T00:00:00.000Z","tags":["book"],"summary":"나의 집중력을 되찾고 싶은 마음에 책 \u003c초집중\u003e을 읽었다. 그리고 애 책의 저자중 한명이 과거에 쓴 \u003c훅\u003e도 읽게 되었다. \u003c흑\u003e은 2014년에 출간된 책으로 조금 오래된 책이지만, 사업모델이 습관에 의존한다면 이 책이 도움이 될거라는 설명에 읽어보게 되었다. 계기, 행동, 가변적 보상, 투자라는 키워드를 현재 내가 일하고 있는 프로덕트와 내가 한번 쯤 만들어보고 싶은 서비스와 연관지어서 생각해보는 시간을 가졌다. 그 과정에서 떠오른 아이디어도 PM분들과 공유해보았다.","slug":"20230717-book-review-indistractable-hooked"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20230716-if-kakao-2022-k8s-controller"]},"buildId":"HB4CJMbKXjIAKvbIp-yyR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>