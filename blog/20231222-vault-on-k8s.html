<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>vault secrets operator 사용해보기</title><meta name="robots" content="follow, index"/><meta name="description" content="GitOps에서 Secret을 어떻게 관리할지 고민을 하였고, 개발자들의 인지부하를 줄이기 위해서 Vault UI로 자신의 앱의 비밀값을 관리하는 것이 제일 효율적이라는 판단을 했다. Vault secrets operator가 GA로 공유가 되었고, Secrets Store CSI나 External secrets 프로젝트보다 깔끔한 방식이라는 생각이 들었다. Vault secrets operator의 CRD로 vault secret과 kubernetes secret의 sync를 맞추고, reloader로 secret이 변경되었을 때 다시 pod를 배포하는 것을 테스트해보았다."/><meta property="og:url" content="https://jayground8.github.io/blog/20231222-vault-on-k8s"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="GitOps에서 Secret을 어떻게 관리할지 고민을 하였고, 개발자들의 인지부하를 줄이기 위해서 Vault UI로 자신의 앱의 비밀값을 관리하는 것이 제일 효율적이라는 판단을 했다. Vault secrets operator가 GA로 공유가 되었고, Secrets Store CSI나 External secrets 프로젝트보다 깔끔한 방식이라는 생각이 들었다. Vault secrets operator의 CRD로 vault secret과 kubernetes secret의 sync를 맞추고, reloader로 secret이 변경되었을 때 다시 pod를 배포하는 것을 테스트해보았다."/><meta property="og:title" content="vault secrets operator 사용해보기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="vault secrets operator 사용해보기"/><meta name="twitter:description" content="GitOps에서 Secret을 어떻게 관리할지 고민을 하였고, 개발자들의 인지부하를 줄이기 위해서 Vault UI로 자신의 앱의 비밀값을 관리하는 것이 제일 효율적이라는 판단을 했다. Vault secrets operator가 GA로 공유가 되었고, Secrets Store CSI나 External secrets 프로젝트보다 깔끔한 방식이라는 생각이 들었다. Vault secrets operator의 CRD로 vault secret과 kubernetes secret의 sync를 맞추고, reloader로 secret이 변경되었을 때 다시 pod를 배포하는 것을 테스트해보았다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20231222-vault-on-k8s"/><meta property="article:published_time" content="2023-12-22T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20231222-vault-on-k8s"
  },
  "headline": "vault secrets operator 사용해보기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2023-12-22T00:00:00.000Z",
  "dateModified": "2023-12-22T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "GitOps에서 Secret을 어떻게 관리할지 고민을 하였고, 개발자들의 인지부하를 줄이기 위해서 Vault UI로 자신의 앱의 비밀값을 관리하는 것이 제일 효율적이라는 판단을 했다. Vault secrets operator가 GA로 공유가 되었고, Secrets Store CSI나 External secrets 프로젝트보다 깔끔한 방식이라는 생각이 들었다. Vault secrets operator의 CRD로 vault secret과 kubernetes secret의 sync를 맞추고, reloader로 secret이 변경되었을 때 다시 pod를 배포하는 것을 테스트해보았다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3c8a0fd6355e4772.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/U7DE318orb_de6hUgWFnv/_buildManifest.js" defer=""></script><script src="/_next/static/U7DE318orb_de6hUgWFnv/_ssgManifest.js" defer=""></script><script src="/_next/static/U7DE318orb_de6hUgWFnv/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-12-22T00:00:00.000Z">2023년 12월 22일 금요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">vault secrets operator 사용해보기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>GitOps로 Secret을 관리할 때, Secret을 암호화해서 Git에 올리는 방법과 Secret management tool를 사용하여 동기화하는 방법을 생각해볼 수 있다. <a target="_blank" rel="noopener noreferrer" href="https://www.redhat.com/en/blog/a-guide-to-secrets-management-with-gitops-and-kubernetes">Red Hat 블로그에서 GitOps에서 Secret을 관리하는 다양한 방법들을 잘 설명하고 있다.</a></p><p>개발자들의 인지부하를 최소한화 하고 개발에 집중할 수 있는 환경을 만드는 것을 중요하게 생각한다. 그래서 개발자들이 쿠버네티스에 대해서 최소한으로 알고 개발을 할 수 있게 환경을 만들고자 했다. Vault는 Web UI를 제공하고, 세부적으로 권한 설정을 할 수 있다. 따라서 개발자들은 Web UI에만 접근하여 자신의 어플리케이션과 관련된 secret 정보를 바꿀 수 있다. 그리고 vault의 다양한 engine을 통해서 임시 credential 발급 하거나 rotation을 하는 것을 쉽게 구현할 수 있다.</p><p>올해 Hashicorp가 제공하는 Product들의 License가 BSL(Business Source License)로 변경되었다. 라이센스 변경 때문에 Terraform을 fork한 오픈 소스 프로젝트인 OpenTofu가 탄생하기도 했다. 기존의 Vault version들은 여전히 MPL(Mozilla Public License) 2.0로 사용가능하고, Hashicorp와 경쟁적인 프로덕트를 만드는 곳이 아니라면 여전히 Vault를 라이센스 구매 없이 사용 가능하다.</p><p>Vault를 활용하여 Kubernetes에서 secret management를 할 수 있는 방법은 아래와 같이 나열해볼 수 있다.</p><ul><li>Secrets Store CSI + Vault Provider</li><li>External Secrets</li><li>Vault secrets operator</li></ul><p>Secrets Store CSI는 vault의 secret과 kubernetes secret의 sync를 맞추는 <a target="_blank" rel="noopener noreferrer" href="https://secrets-store-csi-driver.sigs.k8s.io/topics/secret-auto-rotation">secret-auto-rotation</a> 기능이 아직도 alpha feature로 남아 있다. 그리고 node-driver-registrar로 kubelet에 binary를 추가하는 설정도 해야 한다. <a target="_blank" rel="noopener noreferrer" href="https://jayground8.github.io/blog/20230730-k8s-controller-external-secrets">External Secrets은 이전에 소스코드를 살펴본적이 있는데</a>, 이 프로젝트도 좋은 옵션이라고 생각이 들었다. 하지만 Vault만 사용할 계획이고, Hashicorp에서 제공하는 vault secrets operator의 CRD가 더 직관적이고 깔끔했다. 그리고 <a target="_blank" rel="noopener noreferrer" href="https://www.hashicorp.com/blog/vault-secrets-operator-for-kubernetes-now-ga">GA로 제공한다는 공지도</a> 있었고, 앞으로 관리 측면에서도 유리하다고 판단하였다.</p><h2 id="vault"><a href="#vault" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>vault</h2><p><a target="_blank" rel="noopener noreferrer" href="https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-raft-deployment-guide">HashCorp 문서</a>에서 친절하게 어떻게 Vault을 Production 환경에서 설치할 수 있는지 설명해주고 있다.</p><h3 id="certificate-준비"><a href="#certificate-준비" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Certificate 준비</h3><p>openssl로 key와 csr를 생성한다. <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/">Kubernetes 문서</a>에서 CN과 Organizationd을 아래와 같이 설정해야 된다고 나온다. 따라서 <code>vault-csr.conf</code>에 해당 내용이 반영되어 있다.</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">Permitted subjects - organizations are exactly [&quot;system:nodes&quot;], common name starts with &quot;system:node:&quot;.
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">openssl genrsa -out vault.key <span class="token number">2048</span>
</span></code></pre></div><p>Helm으로 resource를 생성할 때 headless service로 <code>vault-internal</code>이 생성된다. Raft로 Vault node들이 cluster를 형성할 때 이 headless service의 DNS 이름을 사용하기 때문에 <code>vault-csr.conf</code>에 추가되었다.</p><p><code>vault-csr.conf</code></p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">[</span>req<span class="token punctuation">]</span>
</span><span class="code-line">default_bits <span class="token operator">=</span> <span class="token number">2048</span>
</span><span class="code-line">prompt <span class="token operator">=</span> no
</span><span class="code-line">encrypt_key <span class="token operator">=</span> <span class="token function">yes</span>
</span><span class="code-line">default_md <span class="token operator">=</span> sha256
</span><span class="code-line">distinguished_name <span class="token operator">=</span> kubelet_serving
</span><span class="code-line">req_extensions <span class="token operator">=</span> v3_req
</span><span class="code-line"><span class="token punctuation">[</span> kubelet_serving <span class="token punctuation">]</span>
</span><span class="code-line">O <span class="token operator">=</span> system:nodes
</span><span class="code-line">CN <span class="token operator">=</span> system:node:*.vault.svc.cluster.local
</span><span class="code-line"><span class="token punctuation">[</span> v3_req <span class="token punctuation">]</span>
</span><span class="code-line">basicConstraints <span class="token operator">=</span> CA:FALSE
</span><span class="code-line">keyUsage <span class="token operator">=</span> nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment
</span><span class="code-line">extendedKeyUsage <span class="token operator">=</span> serverAuth, clientAuth
</span><span class="code-line">subjectAltName <span class="token operator">=</span> @alt_names
</span><span class="code-line"><span class="token punctuation">[</span>alt_names<span class="token punctuation">]</span>
</span><span class="code-line">DNS.1 <span class="token operator">=</span> *.vault-internal
</span><span class="code-line">DNS.2 <span class="token operator">=</span> *.vault-internal.vault.svc.cluster.local
</span><span class="code-line">DNS.3 <span class="token operator">=</span> *.vault
</span><span class="code-line">DNS.4 <span class="token operator">=</span> *.vault.svc.cluster.local
</span><span class="code-line">DNS.5 <span class="token operator">=</span> *.vault.svc
</span><span class="code-line">IP.1 <span class="token operator">=</span> <span class="token number">127.0</span>.0.1
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">openssl req -new -key vault.key -out vault.csr -config vault-csr.conf
</span><span class="code-line"><span class="token function">cat</span> vault.csr<span class="token operator">|</span>base64<span class="token operator">|</span><span class="token function">tr</span> -d <span class="token string">&#x27;\n&#x27;</span>
</span></code></pre></div><p>이제 Kubernetes Root CA로 Sign하기 위해서 <code>CertificateSigningRequest</code> resource를 만든다.</p><p><code>csr.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> certificates.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> CertificateSigningRequest
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> vault.svc
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">signerName</span><span class="token punctuation">:</span> kubernetes.io/kubelet<span class="token punctuation">-</span>serving
</span><span class="code-line">  <span class="token atrule key">expirationSeconds</span><span class="token punctuation">:</span> <span class="token number">8640000</span>
</span><span class="code-line">  <span class="token atrule key">request</span><span class="token punctuation">:</span> <span class="token string">&#x27;{vault.csr base64 인코딩 값}&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">usages</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> digital signature
</span><span class="code-line">    <span class="token punctuation">-</span> key encipherment
</span><span class="code-line">    <span class="token punctuation">-</span> server auth
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl apply -f csr.yml
</span></code></pre></div><p>이렇게 생성하고 나면 <code>CONDITION</code>이 <code>Pending</code>으로 보이게 된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ kubectl get certificatesigningrequest
</span><span class="code-line">NAME        AGE   SIGNERNAME                      REQUESTOR    REQUESTEDDURATION   CONDITION
</span><span class="code-line">vault.svc   62s   kubernetes.io/kubelet-serving   example      100d                Pending
</span></code></pre></div><p>최종적으로 approve 명령어를 사용해서 <code>Approved,Issued</code> 상태가 되도록 한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl certificate approve vault.svc
</span></code></pre></div><p>이제 Certificate와 Kubernetes CA Certificate를 받는다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl get csr vault.svc -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&#x27;{.status.certificate}&#x27;</span> <span class="token operator">|</span> openssl base64 -d -A -out vault.crt
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl config view <span class="token punctuation">\</span>
</span><span class="code-line">--raw <span class="token punctuation">\</span>
</span><span class="code-line">--minify <span class="token punctuation">\</span>
</span><span class="code-line">--flatten <span class="token punctuation">\</span>
</span><span class="code-line">-o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&#x27;{.clusters[].cluster.certificate-authority-data}&#x27;</span> <span class="token punctuation">\</span>
</span><span class="code-line"><span class="token operator">|</span> base64 -d <span class="token operator">&gt;</span> vault.ca
</span></code></pre></div><h3 id="secret으로-준비"><a href="#secret으로-준비" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Secret으로 준비</h3><p>Kutomize와 sealed-secret를 사용하여 secret를 GitOps 방식으로 저장한다.</p><p><code>kustomization.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">secretGenerator</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls
</span><span class="code-line">    <span class="token atrule key">files</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> vault.ca
</span><span class="code-line">      <span class="token punctuation">-</span> vault.crt
</span><span class="code-line">      <span class="token punctuation">-</span> vault.key
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kustomize build <span class="token operator">&gt;</span> secret.yml
</span><span class="code-line"><span class="token function">cat</span> secret.yml<span class="token operator">|</span> kubeseal --controller-namespace kube-system --controller-name sealed-secrets-controller --format yaml <span class="token operator">&gt;</span> sealed-secret.yml
</span></code></pre></div><p>namespace를 추가하고, sealed-secret으로 encryption된 yaml 파일로 secret resource를 추가한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl create namespace vault
</span><span class="code-line">kubectl ns vault
</span><span class="code-line">kubectl apply -f sealed-secret.yml
</span></code></pre></div><p>sealed-secret에서 decrypt하여 secret resource가 정상적으로 생성되었는지 확인한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl get secret
</span><span class="code-line">NAME                      TYPE     DATA   AGE
</span><span class="code-line">vault-ha-tls-ad6d57g7t2   Opaque   <span class="token number">3</span>      13s
</span></code></pre></div><h3 id="argocd로-배포"><a href="#argocd로-배포" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>ArgoCD로 배포</h3><p><a target="_blank" rel="noopener noreferrer" href="https://argo-cd.readthedocs.io/en/stable/user-guide/helm/">ArgoCD 문서</a>처럼 Helm charts를 통해서 ArgoCD CRD를 정의할 수 있다. Helm으로 배포할 때 <code>values</code>에 override할 설정값들을 정의할 수 있다. Vault의 secret을 template으로 원하는 형식으로 volume에 저장할 수 있는 <code>Vault agent injector</code>는 사용하지 않을 거라 <code>enabled</code>을 <code>false</code>로 지정했다. High Avability Mode로 설정을 하였고, 3개 중에 하나의 Node가 Active 상태로 있고, 나머지들은 Stand By 상태로 있게 된다. Raft Protocol로 모든 노드들에 data를 잘 replication한다. Vault의 UI도 사용할 수 있게 NodePort type으로 service resource를 생성하도록 하였다.</p><p><code>argocd-vault.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Application
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> vault
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> argocd
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">project</span><span class="token punctuation">:</span> default
</span><span class="code-line">  <span class="token atrule key">destination</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">server</span><span class="token punctuation">:</span> <span class="token string">&#x27;https://kubernetes.default.svc&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">namespace</span><span class="token punctuation">:</span> vault
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">chart</span><span class="token punctuation">:</span> vault
</span><span class="code-line">    <span class="token atrule key">repoURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//helm.releases.hashicorp.com
</span><span class="code-line">    <span class="token atrule key">targetRevision</span><span class="token punctuation">:</span> 0.27.0
</span><span class="code-line">    <span class="token atrule key">helm</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">releaseName</span><span class="token punctuation">:</span> vault
</span><span class="code-line">      <span class="token atrule key">values</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">        global:
</span></span><span class="code-line"><span class="token string scalar">          enabled: true
</span></span><span class="code-line"><span class="token string scalar">          tlsDisable: false
</span></span><span class="code-line"><span class="token string scalar">        injector:
</span></span><span class="code-line"><span class="token string scalar">          enabled: false
</span></span><span class="code-line"><span class="token string scalar">          image:
</span></span><span class="code-line"><span class="token string scalar">            repository: &quot;hashicorp/vault-k8s&quot;
</span></span><span class="code-line"><span class="token string scalar">            tag: &quot;1.3&quot;
</span></span><span class="code-line"><span class="token string scalar">        server:
</span></span><span class="code-line"><span class="token string scalar">          standalone:
</span></span><span class="code-line"><span class="token string scalar">            enabled: false
</span></span><span class="code-line"><span class="token string scalar">          image:
</span></span><span class="code-line"><span class="token string scalar">            repository: &quot;hashicorp/vault&quot;
</span></span><span class="code-line"><span class="token string scalar">            tag: &quot;1.15.2&quot;
</span></span><span class="code-line"><span class="token string scalar">          resources:
</span></span><span class="code-line"><span class="token string scalar">            requests:
</span></span><span class="code-line"><span class="token string scalar">              memory: 1Gi
</span></span><span class="code-line"><span class="token string scalar">              cpu: 500m
</span></span><span class="code-line"><span class="token string scalar">            limit:
</span></span><span class="code-line"><span class="token string scalar">              memory: 2Gi
</span></span><span class="code-line"><span class="token string scalar">          affinity: null
</span></span><span class="code-line"><span class="token string scalar">          readinessProbe:
</span></span><span class="code-line"><span class="token string scalar">            enabled: true
</span></span><span class="code-line"><span class="token string scalar">            path: &quot;/v1/sys/health?standbyok=true&amp;sealedcode=204&amp;uninitcode=204&quot;
</span></span><span class="code-line"><span class="token string scalar">          livenessProbe:
</span></span><span class="code-line"><span class="token string scalar">            enabled: true
</span></span><span class="code-line"><span class="token string scalar">            path: &quot;/v1/sys/health?standbyok=true&quot;
</span></span><span class="code-line"><span class="token string scalar">            initialDelaySeconds: 60
</span></span><span class="code-line"><span class="token string scalar">          extraEnvironmentVars:
</span></span><span class="code-line"><span class="token string scalar">            VAULT_CACERT: /vault/userconfig/vault-ha-tls/vault.ca
</span></span><span class="code-line"><span class="token string scalar">            VAULT_TLSCERT: /vault/userconfig/vault-ha-tls/vault.crt
</span></span><span class="code-line"><span class="token string scalar">            VAULT_TLSKEY: /vault/userconfig/vault-ha-tls/vault.key
</span></span><span class="code-line"><span class="token string scalar">          volumes:
</span></span><span class="code-line"><span class="token string scalar">            - name: userconfig-vault-ha-tls
</span></span><span class="code-line"><span class="token string scalar">              secret:
</span></span><span class="code-line"><span class="token string scalar">                defaultMode: 420
</span></span><span class="code-line"><span class="token string scalar">                secretName: vault-ha-tls-ad6d57g7t2
</span></span><span class="code-line"><span class="token string scalar">          volumeMounts:
</span></span><span class="code-line"><span class="token string scalar">            - mountPath: /vault/userconfig/vault-ha-tls
</span></span><span class="code-line"><span class="token string scalar">              name: userconfig-vault-ha-tls
</span></span><span class="code-line"><span class="token string scalar">              readOnly: true
</span></span><span class="code-line"><span class="token string scalar">          auditStorage:
</span></span><span class="code-line"><span class="token string scalar">            enabled: true
</span></span><span class="code-line"><span class="token string scalar">          ha:
</span></span><span class="code-line"><span class="token string scalar">            enabled: true
</span></span><span class="code-line"><span class="token string scalar">            replicas: 3
</span></span><span class="code-line"><span class="token string scalar">            raft:
</span></span><span class="code-line"><span class="token string scalar">              enabled: true
</span></span><span class="code-line"><span class="token string scalar">              setNodeId: true</span>
</span><span class="code-line">
</span><span class="code-line">              <span class="token atrule key">config</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">                ui = true
</span></span><span class="code-line"><span class="token string scalar">                listener &quot;tcp&quot; {
</span></span><span class="code-line"><span class="token string scalar">                  tls_disable = 0
</span></span><span class="code-line"><span class="token string scalar">                  address = &quot;[::]:8200&quot;
</span></span><span class="code-line"><span class="token string scalar">                  cluster_address = &quot;[::]:8201&quot;
</span></span><span class="code-line"><span class="token string scalar">                  tls_cert_file = &quot;/vault/userconfig/vault-ha-tls/vault.crt&quot;
</span></span><span class="code-line"><span class="token string scalar">                  tls_key_file  = &quot;/vault/userconfig/vault-ha-tls/vault.key&quot;
</span></span><span class="code-line"><span class="token string scalar">                  tls_client_ca_file = &quot;/vault/userconfig/vault-ha-tls/vault.ca&quot;
</span></span><span class="code-line"><span class="token string scalar">                }</span>
</span><span class="code-line">
</span><span class="code-line">                storage &quot;raft&quot; <span class="token punctuation">{</span>
</span><span class="code-line">                  path = &quot;/vault/data&quot;
</span><span class="code-line">                    retry_join <span class="token punctuation">{</span>
</span><span class="code-line">                    leader_api_addr = &quot;https<span class="token punctuation">:</span>//vault<span class="token punctuation">-</span>0.vault<span class="token punctuation">-</span>internal<span class="token punctuation">:</span>8200&quot;
</span><span class="code-line">                    leader_ca_cert_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.ca&quot;
</span><span class="code-line">                    leader_client_cert_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.crt&quot;
</span><span class="code-line">                    leader_client_key_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.key&quot;
</span><span class="code-line">                  <span class="token punctuation">}</span>
</span><span class="code-line">                  retry_join <span class="token punctuation">{</span>
</span><span class="code-line">                    leader_api_addr = &quot;https<span class="token punctuation">:</span>//vault<span class="token punctuation">-</span>1.vault<span class="token punctuation">-</span>internal<span class="token punctuation">:</span>8200&quot;
</span><span class="code-line">                    leader_ca_cert_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.ca&quot;
</span><span class="code-line">                    leader_client_cert_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.crt&quot;
</span><span class="code-line">                    leader_client_key_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.key&quot;
</span><span class="code-line">                  <span class="token punctuation">}</span>
</span><span class="code-line">                  retry_join <span class="token punctuation">{</span>
</span><span class="code-line">                    leader_api_addr = &quot;https<span class="token punctuation">:</span>//vault<span class="token punctuation">-</span>2.vault<span class="token punctuation">-</span>internal<span class="token punctuation">:</span>8200&quot;
</span><span class="code-line">                    leader_ca_cert_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.ca&quot;
</span><span class="code-line">                    leader_client_cert_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.crt&quot;
</span><span class="code-line">                    leader_client_key_file = &quot;/vault/userconfig/vault<span class="token punctuation">-</span>ha<span class="token punctuation">-</span>tls/vault.key&quot;
</span><span class="code-line">                  <span class="token punctuation">}</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">                service_registration &quot;kubernetes&quot; <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token atrule key">ui</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">          <span class="token atrule key">serviceType</span><span class="token punctuation">:</span> <span class="token string">&quot;NodePort&quot;</span>
</span><span class="code-line">          <span class="token atrule key">externalPort</span><span class="token punctuation">:</span> <span class="token number">8200</span>
</span></code></pre></div><p>ArgoCD의 <code>Application</code> CRD 설정에서 source 부분은 아래와 같이 하면 된다. helm command로 repo를 추가할 때 URL이 <code>repoURL</code>에 설정이 되어야 한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">helm repo <span class="token function">add</span> hashicorp https://helm.releases.hashicorp.com
</span></code></pre></div><p>그리고 <code>targetRevision</code>은 <code>CHART VERSION</code>을 설정하면 되고, chart는 chart이름을 추가하면 된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ helm search repo
</span><span class="code-line">NAME             CHART VERSION   APP VERSION   DESCRIPTION
</span><span class="code-line">hashicorp/vault  <span class="token number">0.27</span>.0          <span class="token number">1.15</span>.2        Official HashiCorp Vault Chart
</span></code></pre></div><p>마지막으로 <code>releaseName</code>은 helm install 명령어를 쓸 때 사용하는 이름을 설정하면 된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">helm <span class="token function">install</span> vault hashcorp/vault
</span></code></pre></div><p>그렇게 반영을 하면 vault의 경우 아래와 같이 작성할 수가 있다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">chart</span><span class="token punctuation">:</span> vault
</span><span class="code-line">  <span class="token atrule key">repoURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//helm.releases.hashicorp.com
</span><span class="code-line">  <span class="token atrule key">targetRevision</span><span class="token punctuation">:</span> 0.27.0
</span><span class="code-line">  <span class="token atrule key">helm</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">releaseName</span><span class="token punctuation">:</span> vault
</span></code></pre></div><p>이제 ArgoCD CRD를 배포하고, argocd application를 Sync한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl apply -f argocd-vault.yml
</span><span class="code-line">argocd app <span class="token function">sync</span> vault
</span></code></pre></div><h3 id="vault-init--unseal"><a href="#vault-init--unseal" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Vault init &amp; unseal</h3><p>이제 StatefulSet으로 아래처럼 pod가 정상적으로 잘 뜬 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ kubectl get pod
</span><span class="code-line">NAME      READY   STATUS    RESTARTS   AGE
</span><span class="code-line">vault-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          57s
</span><span class="code-line">vault-1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          57s
</span><span class="code-line">vault-2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          57s
</span></code></pre></div><p>이제 정상적으로 동작하기 위해서 init을 해줘야 한다. 그리고 이렇게 init을 하면 root key를 생성하게 되는데, 예제에서는 편의를 위해서 <code>-key-shares=1</code>로 하여 하나만 발급하게 한다. 실제로 운영할 때는 복수의 key를 분리하고 <code>-key-threshold</code> 갯수만큼 key로 unseal을 하도록 설정할 수 있다. 해당 값으로 unseal까지 완료한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> vault-0 -- vault operator init -key-shares<span class="token operator">=</span><span class="token number">1</span> -key-threshold<span class="token operator">=</span><span class="token number">1</span> -format<span class="token operator">=</span>json <span class="token operator">&gt;</span> cluster-keys-0.json
</span><span class="code-line">kubectl <span class="token builtin class-name">exec</span> vault-0 -- vault operator unseal <span class="token punctuation">{</span>unseal_keys_b64 값<span class="token punctuation">}</span>
</span></code></pre></div><p><code>etc/resolve.conf</code>에는 이렇게 작성이 되어 있고, <code>vault-0.vault-internal</code>로만 DNS lookup을 하더라도 해당 pod의 IP를 resolve할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">cat</span> /etc/resolv.conf
</span><span class="code-line">search vault.svc.cluster.local svc.cluster.local cluster.local
</span><span class="code-line">nameserver <span class="token number">169.254</span>.25.10
</span><span class="code-line">options ndots:5
</span></code></pre></div><p>Raft로 이제 Standby node가 cluster join할 때, <code>https://vault-0.vault-internal:8200</code>로 URL를 정의했다. 그런데 이상하게 아래와 같이 전체 Domain을 lookup할 때는 정상적으로 되었지만,</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ kubectl <span class="token builtin class-name">exec</span> -it vault-0 -- <span class="token function">nslookup</span> vault-0.vault-internal.vault.svc.cluster.local
</span><span class="code-line">Server:         <span class="token number">169.254</span>.25.10
</span><span class="code-line">Address:        <span class="token number">169.254</span>.25.10:53
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Name:   vault-0.vault-internal.vault.svc.cluster.local
</span><span class="code-line">Address: <span class="token number">198.18</span>.9.169
</span></code></pre></div><p>아래와 같이 줄여서 할 때는 되지 않았다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ kubectl <span class="token builtin class-name">exec</span> -it vault-0 -- <span class="token function">nslookup</span> vault-0.vault-internal.vault
</span><span class="code-line">Server:         <span class="token number">169.254</span>.25.10
</span><span class="code-line">Address:        <span class="token number">169.254</span>.25.10:53
</span><span class="code-line">
</span><span class="code-line">** server can<span class="token string">&#x27;t find vault-0.vault-internal.vault: NXDOMAIN
</span></span><span class="code-line"><span class="token string">
</span></span><span class="code-line"><span class="token string">** server can&#x27;</span>t <span class="token function">find</span> vault-0.vault-internal.vault: NXDOMAIN
</span></code></pre></div><p>CoreDns의 ConfigMap에서 log를 추가했고, 여기에 로그가 남지가 않았다. 아래처럼 dnsutils가 있는 pod를 실행해서 lookup을 해보니 정상적으로 되었다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Pod
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> dnsutils
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> vault
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> dnsutils
</span><span class="code-line">      <span class="token atrule key">image</span><span class="token punctuation">:</span> registry.k8s.io/e2e<span class="token punctuation">-</span>test<span class="token punctuation">-</span>images/jessie<span class="token punctuation">-</span>dnsutils<span class="token punctuation">:</span><span class="token number">1.3</span>
</span><span class="code-line">      <span class="token atrule key">command</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> sleep
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token string">&#x27;infinity&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
</span><span class="code-line">  <span class="token atrule key">restartPolicy</span><span class="token punctuation">:</span> Always
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it dnsutils -- <span class="token function">nslookup</span> vault-0.vault-internal.vault
</span><span class="code-line">Server:         <span class="token number">169.254</span>.25.10
</span><span class="code-line">Address:        <span class="token number">169.254</span>.25.10<span class="token comment">#53</span>
</span><span class="code-line">
</span><span class="code-line">Name:   vault-0.vault-internal.vault.svc.cluster.local
</span><span class="code-line">Address: <span class="token number">198.18</span>.9.169
</span></code></pre></div><p>왜 Vault pod에서는 정상적으로 되는지 파악할 수 없었고, 아래와 같이 수정을 하였다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">storage <span class="token string">&quot;raft&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  path <span class="token operator">=</span> <span class="token string">&quot;/vault/data&quot;</span>
</span><span class="code-line">    retry_join <span class="token punctuation">{</span>
</span><span class="code-line">    leader_api_addr <span class="token operator">=</span> <span class="token string">&quot;https://vault-0.vault-internal.vault.svc.cluster.local:8200&quot;</span>
</span><span class="code-line">    leader_ca_cert_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.ca&quot;</span>
</span><span class="code-line">    leader_client_cert_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.crt&quot;</span>
</span><span class="code-line">    leader_client_key_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.key&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  retry_join <span class="token punctuation">{</span>
</span><span class="code-line">    leader_api_addr <span class="token operator">=</span> <span class="token string">&quot;https://vault-1.vault-internal.vault.svc.cluster.local:8200&quot;</span>
</span><span class="code-line">    leader_ca_cert_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.ca&quot;</span>
</span><span class="code-line">    leader_client_cert_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.crt&quot;</span>
</span><span class="code-line">    leader_client_key_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.key&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  retry_join <span class="token punctuation">{</span>
</span><span class="code-line">    leader_api_addr <span class="token operator">=</span> <span class="token string">&quot;https://vault-2.vault-internal.vault.svc.cluster.local:8200&quot;</span>
</span><span class="code-line">    leader_ca_cert_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.ca&quot;</span>
</span><span class="code-line">    leader_client_cert_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.crt&quot;</span>
</span><span class="code-line">    leader_client_key_file <span class="token operator">=</span> <span class="token string">&quot;/vault/userconfig/vault-ha-tls/vault.key&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>이제 vault-1과 vault-2에서도 unseal을 해주고, raft에 join 한 것도 확인을 한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> vault-1 -- vault operator unseal <span class="token punctuation">{</span>unseal_keys_b64 값<span class="token punctuation">}</span>
</span><span class="code-line">kubectl <span class="token builtin class-name">exec</span> vault-2 -- vault operator unseal <span class="token punctuation">{</span>unseal_keys_b64 값<span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ vault operator raft list-peers
</span><span class="code-line">Node       Address                        State       Voter
</span><span class="code-line">----       -------                        -----       -----
</span><span class="code-line">vault-0    vault-0.vault-internal:8201    leader      <span class="token boolean">true</span>
</span><span class="code-line">vault-1    vault-1.vault-internal:8201    follower    <span class="token boolean">true</span>
</span><span class="code-line">vault-2    vault-2.vault-internal:8201    follower    <span class="token boolean">true</span>
</span></code></pre></div><h3 id="vault-auth-engine-policy-role-설정"><a href="#vault-auth-engine-policy-role-설정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>vault auth, engine, policy, role 설정</h3><p>이제 vault가 정상적으로 실행이 되었으니, 예제처럼 vault에 필요한 것들을 설정한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">vault auth <span class="token builtin class-name">enable</span> -path dev-auth-mount kubernetes
</span><span class="code-line">vault <span class="token function">write</span> auth/dev-auth-mount/config <span class="token assign-left variable">kubernetes_host</span><span class="token operator">=</span><span class="token string">&quot;https://kubernetes.default.svc&quot;</span>
</span><span class="code-line">vault secrets <span class="token builtin class-name">enable</span> -path<span class="token operator">=</span>dev kv-v2
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">vault policy <span class="token function">write</span> dev - <span class="token operator">&lt;&lt;</span><span class="token string">EOF
</span></span><span class="code-line"><span class="token string">path &quot;dev/*&quot; {
</span></span><span class="code-line"><span class="token string">   capabilities = [&quot;read&quot;]
</span></span><span class="code-line"><span class="token string">}
</span></span><span class="code-line"><span class="token string">EOF</span>
</span></code></pre></div><div class="relative"><pre><code class="code-highlight"><span class="code-line">vault write auth/dev-auth-mount/role/dev \
</span><span class="code-line">   bound_service_account_names=default \
</span><span class="code-line">   bound_service_account_namespaces=dev \
</span><span class="code-line">   policies=dev \
</span><span class="code-line">   audience=vault \
</span><span class="code-line">   ttl=24h
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">vault kv put dev/webapp/config <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">&quot;static-user&quot;</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;static-password&quot;</span>
</span></code></pre></div><h2 id="vault-secrets-operator"><a href="#vault-secrets-operator" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>vault secrets operator</h2><p>이제 CRD로 관리하고, vault의 secret을 Kubernetes secret으로 sync해주는 vault-secrets-operator를 설치한다. 먼저 ca.crt가 Secret에 있어야 되서 동일하게 Kustomize로 Secret Manifest를 생성하고, sealed-secret으로 배포한다.</p><p><code>kustomization.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">secretGenerator</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>ca
</span><span class="code-line">    <span class="token atrule key">files</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> ca.crt=vault.ca
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl create namespace vault-secrets-operator
</span><span class="code-line">kubectl ns vault-secrets-operator
</span><span class="code-line"><span class="token function">cat</span> secret-ca.yml<span class="token operator">|</span> kubeseal --controller-namespace kube-system --controller-name sealed-secrets-controller --format yaml <span class="token operator">&gt;</span> sealed-secret-ca.yml
</span><span class="code-line">kubectl apply -f sealed-secret-ca.yml
</span></code></pre></div><p>그리고 ArgoCD Application resource를 생성한다.</p><p><code>argocd-vault-secrets-operator.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Application
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>secrets<span class="token punctuation">-</span>operator
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> argocd
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">project</span><span class="token punctuation">:</span> default
</span><span class="code-line">  <span class="token atrule key">destination</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">server</span><span class="token punctuation">:</span> <span class="token string">&#x27;https://kubernetes.default.svc&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">namespace</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>secrets<span class="token punctuation">-</span>operator
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">chart</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>secrets<span class="token punctuation">-</span>operator
</span><span class="code-line">    <span class="token atrule key">repoURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//helm.releases.hashicorp.com
</span><span class="code-line">    <span class="token atrule key">targetRevision</span><span class="token punctuation">:</span> 0.4.2
</span><span class="code-line">    <span class="token atrule key">helm</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">releaseName</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>secrets<span class="token punctuation">-</span>operator
</span><span class="code-line">      <span class="token atrule key">values</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">        defaultVaultConnection:
</span></span><span class="code-line"><span class="token string scalar">          enabled: true
</span></span><span class="code-line"><span class="token string scalar">          address: &quot;https://vault.vault.svc.cluster.local:8200&quot;
</span></span><span class="code-line"><span class="token string scalar">          skipTLSVerify: false
</span></span><span class="code-line"><span class="token string scalar">          caCertSecret: vault-ca-a2dh3972mm</span>
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl apply -f argocd-vault-secrets-operator.yml
</span></code></pre></div><p>ArgoCD로 sync를 맞춰서 정상적으로 resource들이 배포된 것을 확인한다.</p><h3 id="vault-secrets-operator-test"><a href="#vault-secrets-operator-test" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>vault secrets operator test</h3><p>이제 vault secrets operator가 정상적으로 설치되었으니, CRD를 생성하여 namespace dev에서 vault secret에 따라서 Kubernetes secret이 생성되는 것을 확인해본다.</p><p>위에서 vault에 다음과 같이 추가하였다.</p><ul><li>kubernetes auth: dev-auth-mount</li><li>role: dev</li><li>kv-v2: dev/webapp/config</li></ul><p><code>example-auth.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> secrets.hashicorp.com/v1beta1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> VaultAuth
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> static<span class="token punctuation">-</span>auth
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> dev
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">method</span><span class="token punctuation">:</span> kubernetes
</span><span class="code-line">  <span class="token atrule key">mount</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>auth<span class="token punctuation">-</span>mount
</span><span class="code-line">  <span class="token atrule key">kubernetes</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">role</span><span class="token punctuation">:</span> dev
</span><span class="code-line">    <span class="token atrule key">serviceAccount</span><span class="token punctuation">:</span> default
</span><span class="code-line">    <span class="token atrule key">audiences</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> vault
</span></code></pre></div><p><code>example-secret.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> secrets.hashicorp.com/v1beta1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> VaultStaticSecret
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> vault<span class="token punctuation">-</span>kv<span class="token punctuation">-</span>app
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> dev
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> kv<span class="token punctuation">-</span>v2
</span><span class="code-line">
</span><span class="code-line">  <span class="token atrule key">mount</span><span class="token punctuation">:</span> dev
</span><span class="code-line">
</span><span class="code-line">  <span class="token atrule key">path</span><span class="token punctuation">:</span> webapp/config
</span><span class="code-line">
</span><span class="code-line">  <span class="token atrule key">destination</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>secret
</span><span class="code-line">    <span class="token atrule key">create</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token atrule key">refreshAfter</span><span class="token punctuation">:</span> 30s
</span><span class="code-line">
</span><span class="code-line">  <span class="token atrule key">vaultAuthRef</span><span class="token punctuation">:</span> static<span class="token punctuation">-</span>auth
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl apply -f example-auth.yml
</span><span class="code-line">kubectl apply -f example-secret.yml
</span></code></pre></div><p>이제 Kubernetes namespace dev에 <code>devSecret</code> Secret resource가 생성된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ kubectl get secret -n dev
</span><span class="code-line">NAME              TYPE                             DATA   AGE
</span><span class="code-line">dev-secret        Opaque                           <span class="token number">3</span>      3s
</span></code></pre></div><p>이제 secret이 변경되면 자동으로 Deployment의 pod를 Rolling Update할 수 있도록, <a target="_blank" rel="noopener noreferrer" href="https://github.com/stakater/Reloader">Reloader</a>을 helm으로 설치한다.</p><p><code>argocd-reloader.yml</code></p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Application
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> reloader
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> argocd
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">project</span><span class="token punctuation">:</span> default
</span><span class="code-line">  <span class="token atrule key">syncPolicy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">syncOptions</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> CreateNamespace=true
</span><span class="code-line">  <span class="token atrule key">destination</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">server</span><span class="token punctuation">:</span> <span class="token string">&#x27;https://kubernetes.default.svc&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">namespace</span><span class="token punctuation">:</span> reloader
</span><span class="code-line">  <span class="token atrule key">source</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">chart</span><span class="token punctuation">:</span> reloader
</span><span class="code-line">    <span class="token atrule key">repoURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//stakater.github.io/stakater<span class="token punctuation">-</span>charts
</span><span class="code-line">    <span class="token atrule key">targetRevision</span><span class="token punctuation">:</span> 1.0.56
</span><span class="code-line">    <span class="token atrule key">helm</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">releaseName</span><span class="token punctuation">:</span> reloader
</span></code></pre></div><p>동일하게 ArgoCD로 배포를 하고, 그냥 secret으로부터 값을 stdout으로 남기는 Pod를 생성하는 Deployment Resource를 배포한다. 이때 annotation을 통해서 설치한 reloader가 변경된 secret를 watch하고 rolling update를 할 수 있도록 한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> ubuntu
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">reloader.stakater.com/auto</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> dev
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">app</span><span class="token punctuation">:</span> ubuntu
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">app</span><span class="token punctuation">:</span> ubuntu
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> ubuntu
</span><span class="code-line">          <span class="token atrule key">image</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">:</span>latest
</span><span class="code-line">          <span class="token comment"># Just spin &amp; wait forever</span>
</span><span class="code-line">          <span class="token atrule key">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;/bin/bash&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;-c&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;--&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;while true; echo ${username}; do sleep 30; done;&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">envFrom</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">secretRef</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token atrule key">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>secret
</span></code></pre></div><p>배포하고 나서 log를 확인하면 <code>dev-secret</code>에 있는 username 값이 찍히는 걸 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">$ kubectl logs -f --selector app=ubuntu
</span><span class="code-line">static-user
</span></code></pre></div><p>이제 vault에서 secret값을 변경하면, rolling update가 되고 static-user3가 log로 남는 걸 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">vault kv put dev/webapp/config <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">&quot;static-user3&quot;</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">&quot;static-password&quot;</span>
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>GitOps로 Kubernetes manifest file를 관리하는 상황에서 Secret은 어떻게 관리하는 것이 좋을까 고민을 했었다. 예전부터 Vault를 편리하게 사용해왔고, Kubernetes에서 vault를 사용할 수 있는 옵션들을 확인해보았다. 그중에서 Vault secrets operator가 가장 적합하다고 판단하여, ArgoCD, Kustomize, sealed-secret 등을 사용하여 셋팅을 해보았다. Hashicorp 만세! 👍👍</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">Kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/vault">vault</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231217-aws-sam-resolve-issue">AWS SAM으로 배포한 Lambda의 환경변수가 변경된 Secret Manager 값으로 반영이 안되는 문제</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231228-vault-custom-secret-engine">Vault custom secret engine 작성해보기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=n=\u003ec(n,\"__esModule\",{value:!0});var m=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),N=(n,s)=\u003e{t(n);for(var l in s)c(n,l,{get:s[l],enumerable:!0})},k=(n,s,l)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of p(s))!u.call(n,a)\u0026\u0026a!==\"default\"\u0026\u0026c(n,a,{get:()=\u003es[a],enumerable:!(l=d(s,a))||l.enumerable});return n},g=n=\u003ek(t(c(n!=null?o(h(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var r=m((A,i)=\u003e{i.exports=_jsx_runtime});var f={};N(f,{default:()=\u003eb,frontmatter:()=\u003ev});var e=g(r()),v={title:\"vault secrets operator \\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\",date:\"2023-12-22\",tags:[\"Kubernetes\",\"vault\"],images:[\"/static/images/social-banner.png\"],summary:\"GitOps\\uC5D0\\uC11C Secret\\uC744 \\uC5B4\\uB5BB\\uAC8C \\uAD00\\uB9AC\\uD560\\uC9C0 \\uACE0\\uBBFC\\uC744 \\uD558\\uC600\\uACE0, \\uAC1C\\uBC1C\\uC790\\uB4E4\\uC758 \\uC778\\uC9C0\\uBD80\\uD558\\uB97C \\uC904\\uC774\\uAE30 \\uC704\\uD574\\uC11C Vault UI\\uB85C \\uC790\\uC2E0\\uC758 \\uC571\\uC758 \\uBE44\\uBC00\\uAC12\\uC744 \\uAD00\\uB9AC\\uD558\\uB294 \\uAC83\\uC774 \\uC81C\\uC77C \\uD6A8\\uC728\\uC801\\uC774\\uB77C\\uB294 \\uD310\\uB2E8\\uC744 \\uD588\\uB2E4. Vault secrets operator\\uAC00 GA\\uB85C \\uACF5\\uC720\\uAC00 \\uB418\\uC5C8\\uACE0, Secrets Store CSI\\uB098 External secrets \\uD504\\uB85C\\uC81D\\uD2B8\\uBCF4\\uB2E4 \\uAE54\\uB054\\uD55C \\uBC29\\uC2DD\\uC774\\uB77C\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. Vault secrets operator\\uC758 CRD\\uB85C vault secret\\uACFC kubernetes secret\\uC758 sync\\uB97C \\uB9DE\\uCD94\\uACE0, reloader\\uB85C secret\\uC774 \\uBCC0\\uACBD\\uB418\\uC5C8\\uC744 \\uB54C \\uB2E4\\uC2DC pod\\uB97C \\uBC30\\uD3EC\\uD558\\uB294 \\uAC83\\uC744 \\uD14C\\uC2A4\\uD2B8\\uD574\\uBCF4\\uC558\\uB2E4.\"};function y(n={}){let{wrapper:s}=n.components||{};return s?(0,e.jsx)(s,Object.assign({},n,{children:(0,e.jsx)(l,{})})):l();function l(){let a=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",h2:\"h2\",span:\"span\",h3:\"h3\",code:\"code\",pre:\"pre\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a.p,{children:[\"GitOps\\uB85C Secret\\uC744 \\uAD00\\uB9AC\\uD560 \\uB54C, Secret\\uC744 \\uC554\\uD638\\uD654\\uD574\\uC11C Git\\uC5D0 \\uC62C\\uB9AC\\uB294 \\uBC29\\uBC95\\uACFC Secret management tool\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uB3D9\\uAE30\\uD654\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC0DD\\uAC01\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://www.redhat.com/en/blog/a-guide-to-secrets-management-with-gitops-and-kubernetes\",children:\"Red Hat \\uBE14\\uB85C\\uADF8\\uC5D0\\uC11C GitOps\\uC5D0\\uC11C Secret\\uC744 \\uAD00\\uB9AC\\uD558\\uB294 \\uB2E4\\uC591\\uD55C \\uBC29\\uBC95\\uB4E4\\uC744 \\uC798 \\uC124\\uBA85\\uD558\\uACE0 \\uC788\\uB2E4.\"})]}),(0,e.jsx)(a.p,{children:\"\\uAC1C\\uBC1C\\uC790\\uB4E4\\uC758 \\uC778\\uC9C0\\uBD80\\uD558\\uB97C \\uCD5C\\uC18C\\uD55C\\uD654 \\uD558\\uACE0 \\uAC1C\\uBC1C\\uC5D0 \\uC9D1\\uC911\\uD560 \\uC218 \\uC788\\uB294 \\uD658\\uACBD\\uC744 \\uB9CC\\uB4DC\\uB294 \\uAC83\\uC744 \\uC911\\uC694\\uD558\\uAC8C \\uC0DD\\uAC01\\uD55C\\uB2E4. \\uADF8\\uB798\\uC11C \\uAC1C\\uBC1C\\uC790\\uB4E4\\uC774 \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4\\uC5D0 \\uB300\\uD574\\uC11C \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uC54C\\uACE0 \\uAC1C\\uBC1C\\uC744 \\uD560 \\uC218 \\uC788\\uAC8C \\uD658\\uACBD\\uC744 \\uB9CC\\uB4E4\\uACE0\\uC790 \\uD588\\uB2E4. Vault\\uB294 Web UI\\uB97C \\uC81C\\uACF5\\uD558\\uACE0, \\uC138\\uBD80\\uC801\\uC73C\\uB85C \\uAD8C\\uD55C \\uC124\\uC815\\uC744 \\uD560 \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uAC1C\\uBC1C\\uC790\\uB4E4\\uC740 Web UI\\uC5D0\\uB9CC \\uC811\\uADFC\\uD558\\uC5EC \\uC790\\uC2E0\\uC758 \\uC5B4\\uD50C\\uB9AC\\uCF00\\uC774\\uC158\\uACFC \\uAD00\\uB828\\uB41C secret \\uC815\\uBCF4\\uB97C \\uBC14\\uAFC0 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 vault\\uC758 \\uB2E4\\uC591\\uD55C engine\\uC744 \\uD1B5\\uD574\\uC11C \\uC784\\uC2DC credential \\uBC1C\\uAE09 \\uD558\\uAC70\\uB098 rotation\\uC744 \\uD558\\uB294 \\uAC83\\uC744 \\uC27D\\uAC8C \\uAD6C\\uD604\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.p,{children:\"\\uC62C\\uD574 Hashicorp\\uAC00 \\uC81C\\uACF5\\uD558\\uB294 Product\\uB4E4\\uC758 License\\uAC00 BSL(Business Source License)\\uB85C \\uBCC0\\uACBD\\uB418\\uC5C8\\uB2E4. \\uB77C\\uC774\\uC13C\\uC2A4 \\uBCC0\\uACBD \\uB54C\\uBB38\\uC5D0 Terraform\\uC744 fork\\uD55C \\uC624\\uD508 \\uC18C\\uC2A4 \\uD504\\uB85C\\uC81D\\uD2B8\\uC778 OpenTofu\\uAC00 \\uD0C4\\uC0DD\\uD558\\uAE30\\uB3C4 \\uD588\\uB2E4. \\uAE30\\uC874\\uC758 Vault version\\uB4E4\\uC740 \\uC5EC\\uC804\\uD788 MPL(Mozilla Public License) 2.0\\uB85C \\uC0AC\\uC6A9\\uAC00\\uB2A5\\uD558\\uACE0, Hashicorp\\uC640 \\uACBD\\uC7C1\\uC801\\uC778 \\uD504\\uB85C\\uB355\\uD2B8\\uB97C \\uB9CC\\uB4DC\\uB294 \\uACF3\\uC774 \\uC544\\uB2C8\\uB77C\\uBA74 \\uC5EC\\uC804\\uD788 Vault\\uB97C \\uB77C\\uC774\\uC13C\\uC2A4 \\uAD6C\\uB9E4 \\uC5C6\\uC774 \\uC0AC\\uC6A9 \\uAC00\\uB2A5\\uD558\\uB2E4.\"}),(0,e.jsx)(a.p,{children:\"Vault\\uB97C \\uD65C\\uC6A9\\uD558\\uC5EC Kubernetes\\uC5D0\\uC11C secret management\\uB97C \\uD560 \\uC218 \\uC788\\uB294 \\uBC29\\uBC95\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uB098\\uC5F4\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsxs)(a.ul,{children:[(0,e.jsx)(a.li,{children:\"Secrets Store CSI + Vault Provider\"}),(0,e.jsx)(a.li,{children:\"External Secrets\"}),(0,e.jsx)(a.li,{children:\"Vault secrets operator\"})]}),(0,e.jsxs)(a.p,{children:[\"Secrets Store CSI\\uB294 vault\\uC758 secret\\uACFC kubernetes secret\\uC758 sync\\uB97C \\uB9DE\\uCD94\\uB294 \",(0,e.jsx)(a.a,{href:\"https://secrets-store-csi-driver.sigs.k8s.io/topics/secret-auto-rotation\",children:\"secret-auto-rotation\"}),\" \\uAE30\\uB2A5\\uC774 \\uC544\\uC9C1\\uB3C4 alpha feature\\uB85C \\uB0A8\\uC544 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 node-driver-registrar\\uB85C kubelet\\uC5D0 binary\\uB97C \\uCD94\\uAC00\\uD558\\uB294 \\uC124\\uC815\\uB3C4 \\uD574\\uC57C \\uD55C\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://jayground8.github.io/blog/20230730-k8s-controller-external-secrets\",children:\"External Secrets\\uC740 \\uC774\\uC804\\uC5D0 \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB97C \\uC0B4\\uD3B4\\uBCF8\\uC801\\uC774 \\uC788\\uB294\\uB370\"}),\", \\uC774 \\uD504\\uB85C\\uC81D\\uD2B8\\uB3C4 \\uC88B\\uC740 \\uC635\\uC158\\uC774\\uB77C\\uACE0 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. \\uD558\\uC9C0\\uB9CC Vault\\uB9CC \\uC0AC\\uC6A9\\uD560 \\uACC4\\uD68D\\uC774\\uACE0, Hashicorp\\uC5D0\\uC11C \\uC81C\\uACF5\\uD558\\uB294 vault secrets operator\\uC758 CRD\\uAC00 \\uB354 \\uC9C1\\uAD00\\uC801\\uC774\\uACE0 \\uAE54\\uB054\\uD588\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(a.a,{href:\"https://www.hashicorp.com/blog/vault-secrets-operator-for-kubernetes-now-ga\",children:\"GA\\uB85C \\uC81C\\uACF5\\uD55C\\uB2E4\\uB294 \\uACF5\\uC9C0\\uB3C4\"}),\" \\uC788\\uC5C8\\uACE0, \\uC55E\\uC73C\\uB85C \\uAD00\\uB9AC \\uCE21\\uBA74\\uC5D0\\uC11C\\uB3C4 \\uC720\\uB9AC\\uD558\\uB2E4\\uACE0 \\uD310\\uB2E8\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsxs)(a.h2,{id:\"vault\",children:[(0,e.jsx)(a.a,{href:\"#vault\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault\"]}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-raft-deployment-guide\",children:\"HashCorp \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uCE5C\\uC808\\uD558\\uAC8C \\uC5B4\\uB5BB\\uAC8C Vault\\uC744 Production \\uD658\\uACBD\\uC5D0\\uC11C \\uC124\\uCE58\\uD560 \\uC218 \\uC788\\uB294\\uC9C0 \\uC124\\uBA85\\uD574\\uC8FC\\uACE0 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(a.h3,{id:\"certificate-\\uC900\\uBE44\",children:[(0,e.jsx)(a.a,{href:\"#certificate-\\uC900\\uBE44\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Certificate \\uC900\\uBE44\"]}),(0,e.jsxs)(a.p,{children:[\"openssl\\uB85C key\\uC640 csr\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/\",children:\"Kubernetes \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C CN\\uACFC Organizationd\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uD574\\uC57C \\uB41C\\uB2E4\\uACE0 \\uB098\\uC628\\uB2E4. \\uB530\\uB77C\\uC11C \",(0,e.jsx)(a.code,{children:\"vault-csr.conf\"}),\"\\uC5D0 \\uD574\\uB2F9 \\uB0B4\\uC6A9\\uC774 \\uBC18\\uC601\\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{children:(0,e.jsx)(a.code,{className:\"code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`Permitted subjects - organizations are exactly [\"system:nodes\"], common name starts with \"system:node:\".\n`})})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"openssl genrsa -out vault.key \",(0,e.jsx)(a.span,{className:\"token number\",children:\"2048\"}),`\n`]})})}),(0,e.jsxs)(a.p,{children:[\"Helm\\uC73C\\uB85C resource\\uB97C \\uC0DD\\uC131\\uD560 \\uB54C headless service\\uB85C \",(0,e.jsx)(a.code,{children:\"vault-internal\"}),\"\\uC774 \\uC0DD\\uC131\\uB41C\\uB2E4. Raft\\uB85C Vault node\\uB4E4\\uC774 cluster\\uB97C \\uD615\\uC131\\uD560 \\uB54C \\uC774 headless service\\uC758 DNS \\uC774\\uB984\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \",(0,e.jsx)(a.code,{children:\"vault-csr.conf\"}),\"\\uC5D0 \\uCD94\\uAC00\\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"vault-csr.conf\"})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"req\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"default_bits \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"2048\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"prompt \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` no\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"encrypt_key \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"yes\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"default_md \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` sha256\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"distinguished_name \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` kubelet_serving\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"req_extensions \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` v3_req\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" kubelet_serving \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"O \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` system:nodes\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"CN \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` system:node:*.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" v3_req \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"basicConstraints \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` CA:FALSE\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"keyUsage \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"extendedKeyUsage \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` serverAuth, clientAuth\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"subjectAltName \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` @alt_names\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"alt_names\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.1 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault-internal\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.2 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault-internal.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.3 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.4 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.5 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault.svc\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"IP.1 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"127.0\"}),`.0.1\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`openssl req -new -key vault.key -out vault.csr -config vault-csr.conf\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),\" vault.csr\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\"base64\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token function\",children:\"tr\"}),\" -d \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'\\\\n'\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C Kubernetes Root CA\\uB85C Sign\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"CertificateSigningRequest\"}),\" resource\\uB97C \\uB9CC\\uB4E0\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"csr.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` certificates.k8s.io/v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` CertificateSigningRequest\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault.svc\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"signerName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" kubernetes.io/kubelet\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`serving\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"expirationSeconds\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8640000\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"request\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'{vault.csr base64 \\uC778\\uCF54\\uB529 \\uAC12}'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"usages\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` digital signature\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` key encipherment\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` server auth\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f csr.yml\n`})})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uB807\\uAC8C \\uC0DD\\uC131\\uD558\\uACE0 \\uB098\\uBA74 \",(0,e.jsx)(a.code,{children:\"CONDITION\"}),\"\\uC774 \",(0,e.jsx)(a.code,{children:\"Pending\"}),\"\\uC73C\\uB85C \\uBCF4\\uC774\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get certificatesigningrequest\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME        AGE   SIGNERNAME                      REQUESTOR    REQUESTEDDURATION   CONDITION\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`vault.svc   62s   kubernetes.io/kubelet-serving   example      100d                Pending\n`})]})}),(0,e.jsxs)(a.p,{children:[\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C approve \\uBA85\\uB839\\uC5B4\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"Approved,Issued\"}),\" \\uC0C1\\uD0DC\\uAC00 \\uB418\\uB3C4\\uB85D \\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl certificate approve vault.svc\n`})})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C Certificate\\uC640 Kubernetes CA Certificate\\uB97C \\uBC1B\\uB294\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl get csr vault.svc -o \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"jsonpath\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'{.status.certificate}'\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),` openssl base64 -d -A -out vault.crt\n`]})})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl config view \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"--raw \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"--minify \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"--flatten \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"-o \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"jsonpath\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'{.clusters[].cluster.certificate-authority-data}'\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" base64 -d \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"\u003e\"}),` vault.ca\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"secret\\uC73C\\uB85C-\\uC900\\uBE44\",children:[(0,e.jsx)(a.a,{href:\"#secret\\uC73C\\uB85C-\\uC900\\uBE44\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Secret\\uC73C\\uB85C \\uC900\\uBE44\"]}),(0,e.jsx)(a.p,{children:\"Kutomize\\uC640 sealed-secret\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC secret\\uB97C GitOps \\uBC29\\uC2DD\\uC73C\\uB85C \\uC800\\uC7A5\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"kustomization.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"secretGenerator\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"files\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault.ca\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault.crt\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault.key\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kustomize build \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"\u003e\"}),` secret.yml\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),\" secret.yml\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" kubeseal --controller-namespace kube-system --controller-name sealed-secrets-controller --format yaml \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"\u003e\"}),` sealed-secret.yml\n`]})]})}),(0,e.jsx)(a.p,{children:\"namespace\\uB97C \\uCD94\\uAC00\\uD558\\uACE0, sealed-secret\\uC73C\\uB85C encryption\\uB41C yaml \\uD30C\\uC77C\\uB85C secret resource\\uB97C \\uCD94\\uAC00\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl create namespace vault\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl ns vault\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f sealed-secret.yml\n`})]})}),(0,e.jsx)(a.p,{children:\"sealed-secret\\uC5D0\\uC11C decrypt\\uD558\\uC5EC secret resource\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC0DD\\uC131\\uB418\\uC5C8\\uB294\\uC9C0 \\uD655\\uC778\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl get secret\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME                      TYPE     DATA   AGE\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-ha-tls-ad6d57g7t2   Opaque   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"3\"}),`      13s\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"argocd\\uB85C-\\uBC30\\uD3EC\",children:[(0,e.jsx)(a.a,{href:\"#argocd\\uB85C-\\uBC30\\uD3EC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"ArgoCD\\uB85C \\uBC30\\uD3EC\"]}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://argo-cd.readthedocs.io/en/stable/user-guide/helm/\",children:\"ArgoCD \\uBB38\\uC11C\"}),\"\\uCC98\\uB7FC Helm charts\\uB97C \\uD1B5\\uD574\\uC11C ArgoCD CRD\\uB97C \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. Helm\\uC73C\\uB85C \\uBC30\\uD3EC\\uD560 \\uB54C \",(0,e.jsx)(a.code,{children:\"values\"}),\"\\uC5D0 override\\uD560 \\uC124\\uC815\\uAC12\\uB4E4\\uC744 \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. Vault\\uC758 secret\\uC744 template\\uC73C\\uB85C \\uC6D0\\uD558\\uB294 \\uD615\\uC2DD\\uC73C\\uB85C volume\\uC5D0 \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB294 \",(0,e.jsx)(a.code,{children:\"Vault agent injector\"}),\"\\uB294 \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uC744 \\uAC70\\uB77C \",(0,e.jsx)(a.code,{children:\"enabled\"}),\"\\uC744 \",(0,e.jsx)(a.code,{children:\"false\"}),\"\\uB85C \\uC9C0\\uC815\\uD588\\uB2E4. High Avability Mode\\uB85C \\uC124\\uC815\\uC744 \\uD558\\uC600\\uACE0, 3\\uAC1C \\uC911\\uC5D0 \\uD558\\uB098\\uC758 Node\\uAC00 Active \\uC0C1\\uD0DC\\uB85C \\uC788\\uACE0, \\uB098\\uBA38\\uC9C0\\uB4E4\\uC740 Stand By \\uC0C1\\uD0DC\\uB85C \\uC788\\uAC8C \\uB41C\\uB2E4. Raft Protocol\\uB85C \\uBAA8\\uB4E0 \\uB178\\uB4DC\\uB4E4\\uC5D0 data\\uB97C \\uC798 replication\\uD55C\\uB2E4. Vault\\uC758 UI\\uB3C4 \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uAC8C NodePort type\\uC73C\\uB85C service resource\\uB97C \\uC0DD\\uC131\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"argocd-vault.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"project\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'https://kubernetes.default.svc'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`//helm.releases.hashicorp.com\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 0.27.0\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"values\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        global:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          tlsDisable: false\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        injector:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          enabled: false\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          image:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            repository: \"hashicorp/vault-k8s\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            tag: \"1.3\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        server:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          standalone:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: false\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          image:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            repository: \"hashicorp/vault\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            tag: \"1.15.2\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          resources:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            requests:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              memory: 1Gi\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              cpu: 500m\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            limit:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              memory: 2Gi\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          affinity: null\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          readinessProbe:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            path: \"/v1/sys/health?standbyok=true\u0026sealedcode=204\u0026uninitcode=204\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          livenessProbe:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            path: \"/v1/sys/health?standbyok=true\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            initialDelaySeconds: 60\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          extraEnvironmentVars:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            VAULT_CACERT: /vault/userconfig/vault-ha-tls/vault.ca\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            VAULT_TLSCERT: /vault/userconfig/vault-ha-tls/vault.crt\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            VAULT_TLSKEY: /vault/userconfig/vault-ha-tls/vault.key\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          volumes:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            - name: userconfig-vault-ha-tls\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              secret:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                defaultMode: 420\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                secretName: vault-ha-tls-ad6d57g7t2\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          volumeMounts:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            - mountPath: /vault/userconfig/vault-ha-tls\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              name: userconfig-vault-ha-tls\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              readOnly: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          auditStorage:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          ha:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            replicas: 3\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            raft:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              enabled: true\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"              setNodeId: true\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"config\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                ui = true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                listener \"tcp\" {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_disable = 0\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  address = \"[::]:8200\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  cluster_address = \"[::]:8201\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_cert_file = \"/vault/userconfig/vault-ha-tls/vault.crt\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_key_file  = \"/vault/userconfig/vault-ha-tls/vault.key\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_client_ca_file = \"/vault/userconfig/vault-ha-tls/vault.ca\"\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"                }\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                storage \"raft\" ',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`                  path = \"/vault/data\"\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                    retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_api_addr = \"https',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"0.vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"internal\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8200\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_ca_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.ca\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.crt\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_key_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.key\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_api_addr = \"https',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"1.vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"internal\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8200\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_ca_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.ca\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.crt\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_key_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.key\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_api_addr = \"https',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"2.vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"internal\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8200\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_ca_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.ca\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.crt\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_key_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.key\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                service_registration \"kubernetes\" ',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"ui\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"serviceType\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"NodePort\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"externalPort\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8200\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"ArgoCD\\uC758 \",(0,e.jsx)(a.code,{children:\"Application\"}),\" CRD \\uC124\\uC815\\uC5D0\\uC11C source \\uBD80\\uBD84\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD558\\uBA74 \\uB41C\\uB2E4. helm command\\uB85C repo\\uB97C \\uCD94\\uAC00\\uD560 \\uB54C URL\\uC774 \",(0,e.jsx)(a.code,{children:\"repoURL\"}),\"\\uC5D0 \\uC124\\uC815\\uC774 \\uB418\\uC5B4\\uC57C \\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"helm repo \",(0,e.jsx)(a.span,{className:\"token function\",children:\"add\"}),` hashicorp https://helm.releases.hashicorp.com\n`]})})}),(0,e.jsxs)(a.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(a.code,{children:\"targetRevision\"}),\"\\uC740 \",(0,e.jsx)(a.code,{children:\"CHART VERSION\"}),\"\\uC744 \\uC124\\uC815\\uD558\\uBA74 \\uB418\\uACE0, chart\\uB294 chart\\uC774\\uB984\\uC744 \\uCD94\\uAC00\\uD558\\uBA74 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ helm search repo\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME             CHART VERSION   APP VERSION   DESCRIPTION\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"hashicorp/vault  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0.27\"}),\".0          \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1.15\"}),`.2        Official HashiCorp Vault Chart\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \",(0,e.jsx)(a.code,{children:\"releaseName\"}),\"\\uC740 helm install \\uBA85\\uB839\\uC5B4\\uB97C \\uC4F8 \\uB54C \\uC0AC\\uC6A9\\uD558\\uB294 \\uC774\\uB984\\uC744 \\uC124\\uC815\\uD558\\uBA74 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"helm \",(0,e.jsx)(a.span,{className:\"token function\",children:\"install\"}),` vault hashcorp/vault\n`]})})}),(0,e.jsx)(a.p,{children:\"\\uADF8\\uB807\\uAC8C \\uBC18\\uC601\\uC744 \\uD558\\uBA74 vault\\uC758 \\uACBD\\uC6B0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC791\\uC131\\uD560 \\uC218\\uAC00 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`//helm.releases.hashicorp.com\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 0.27.0\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C ArgoCD CRD\\uB97C \\uBC30\\uD3EC\\uD558\\uACE0, argocd application\\uB97C Sync\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f argocd-vault.yml\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"argocd app \",(0,e.jsx)(a.span,{className:\"token function\",children:\"sync\"}),` vault\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"vault-init--unseal\",children:[(0,e.jsx)(a.a,{href:\"#vault-init--unseal\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Vault init \u0026 unseal\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C StatefulSet\\uC73C\\uB85C \\uC544\\uB798\\uCC98\\uB7FC pod\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC798 \\uB72C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get pod\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME      READY   STATUS    RESTARTS   AGE\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-0   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),`          57s\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-1   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),`          57s\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-2   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),`          57s\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB3D9\\uC791\\uD558\\uAE30 \\uC704\\uD574\\uC11C init\\uC744 \\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uC774\\uB807\\uAC8C init\\uC744 \\uD558\\uBA74 root key\\uB97C \\uC0DD\\uC131\\uD558\\uAC8C \\uB418\\uB294\\uB370, \\uC608\\uC81C\\uC5D0\\uC11C\\uB294 \\uD3B8\\uC758\\uB97C \\uC704\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"-key-shares=1\"}),\"\\uB85C \\uD558\\uC5EC \\uD558\\uB098\\uB9CC \\uBC1C\\uAE09\\uD558\\uAC8C \\uD55C\\uB2E4. \\uC2E4\\uC81C\\uB85C \\uC6B4\\uC601\\uD560 \\uB54C\\uB294 \\uBCF5\\uC218\\uC758 key\\uB97C \\uBD84\\uB9AC\\uD558\\uACE0 \",(0,e.jsx)(a.code,{children:\"-key-threshold\"}),\" \\uAC2F\\uC218\\uB9CC\\uD07C key\\uB85C unseal\\uC744 \\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uD574\\uB2F9 \\uAC12\\uC73C\\uB85C unseal\\uAE4C\\uC9C0 \\uC644\\uB8CC\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-0 -- vault operator init -key-shares\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" -key-threshold\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" -format\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"json \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"\u003e\"}),` cluster-keys-0.json\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-0 -- vault operator unseal \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"unseal_keys_b64 \\uAC12\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.code,{children:\"etc/resolve.conf\"}),\"\\uC5D0\\uB294 \\uC774\\uB807\\uAC8C \\uC791\\uC131\\uC774 \\uB418\\uC5B4 \\uC788\\uACE0, \",(0,e.jsx)(a.code,{children:\"vault-0.vault-internal\"}),\"\\uB85C\\uB9CC DNS lookup\\uC744 \\uD558\\uB354\\uB77C\\uB3C4 \\uD574\\uB2F9 pod\\uC758 IP\\uB97C resolve\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),` /etc/resolv.conf\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`search vault.svc.cluster.local svc.cluster.local cluster.local\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"nameserver \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`options ndots:5\n`})]})}),(0,e.jsxs)(a.p,{children:[\"Raft\\uB85C \\uC774\\uC81C Standby node\\uAC00 cluster join\\uD560 \\uB54C, \",(0,e.jsx)(a.code,{children:\"https://vault-0.vault-internal:8200\"}),\"\\uB85C URL\\uB97C \\uC815\\uC758\\uD588\\uB2E4. \\uADF8\\uB7F0\\uB370 \\uC774\\uC0C1\\uD558\\uAC8C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC804\\uCCB4 Domain\\uC744 lookup\\uD560 \\uB54C\\uB294 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB418\\uC5C8\\uC9C0\\uB9CC,\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it vault-0 -- \",(0,e.jsx)(a.span,{className:\"token function\",children:\"nslookup\"}),` vault-0.vault-internal.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Server:         \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address:        \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10:53\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Name:   vault-0.vault-internal.vault.svc.cluster.local\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address: \",(0,e.jsx)(a.span,{className:\"token number\",children:\"198.18\"}),`.9.169\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC904\\uC5EC\\uC11C \\uD560 \\uB54C\\uB294 \\uB418\\uC9C0 \\uC54A\\uC558\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it vault-0 -- \",(0,e.jsx)(a.span,{className:\"token function\",children:\"nslookup\"}),` vault-0.vault-internal.vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Server:         \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address:        \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10:53\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"** server can\",(0,e.jsx)(a.span,{className:\"token string\",children:`'t find vault-0.vault-internal.vault: NXDOMAIN\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string\",children:\"** server can'\"}),\"t \",(0,e.jsx)(a.span,{className:\"token function\",children:\"find\"}),` vault-0.vault-internal.vault: NXDOMAIN\n`]})]})}),(0,e.jsx)(a.p,{children:\"CoreDns\\uC758 ConfigMap\\uC5D0\\uC11C log\\uB97C \\uCD94\\uAC00\\uD588\\uACE0, \\uC5EC\\uAE30\\uC5D0 \\uB85C\\uADF8\\uAC00 \\uB0A8\\uC9C0\\uAC00 \\uC54A\\uC558\\uB2E4. \\uC544\\uB798\\uCC98\\uB7FC dnsutils\\uAC00 \\uC788\\uB294 pod\\uB97C \\uC2E4\\uD589\\uD574\\uC11C lookup\\uC744 \\uD574\\uBCF4\\uB2C8 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB418\\uC5C8\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dnsutils\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dnsutils\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" registry.k8s.io/e2e\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"test\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"images/jessie\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"dnsutils\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1.3\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` sleep\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'infinity'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` IfNotPresent\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"restartPolicy\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Always\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it dnsutils -- \",(0,e.jsx)(a.span,{className:\"token function\",children:\"nslookup\"}),` vault-0.vault-internal.vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Server:         \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address:        \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),\".25.10\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"#53\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Name:   vault-0.vault-internal.vault.svc.cluster.local\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address: \",(0,e.jsx)(a.span,{className:\"token number\",children:\"198.18\"}),`.9.169\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC65C Vault pod\\uC5D0\\uC11C\\uB294 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB418\\uB294\\uC9C0 \\uD30C\\uC545\\uD560 \\uC218 \\uC5C6\\uC5C8\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC218\\uC815\\uC744 \\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"storage \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"raft\"'}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  path \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/data\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_api_addr \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://vault-0.vault-internal.vault.svc.cluster.local:8200\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_ca_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.ca\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.crt\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_key_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.key\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_api_addr \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://vault-1.vault-internal.vault.svc.cluster.local:8200\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_ca_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.ca\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.crt\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_key_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.key\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_api_addr \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://vault-2.vault-internal.vault.svc.cluster.local:8200\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_ca_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.ca\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.crt\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_key_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.key\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault-1\\uACFC vault-2\\uC5D0\\uC11C\\uB3C4 unseal\\uC744 \\uD574\\uC8FC\\uACE0, raft\\uC5D0 join \\uD55C \\uAC83\\uB3C4 \\uD655\\uC778\\uC744 \\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-1 -- vault operator unseal \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"unseal_keys_b64 \\uAC12\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-2 -- vault operator unseal \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"unseal_keys_b64 \\uAC12\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ vault operator raft list-peers\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Node       Address                        State       Voter\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`----       -------                        -----       -----\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-0    vault-0.vault-internal:8201    leader      \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-1    vault-1.vault-internal:8201    follower    \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-2    vault-2.vault-internal:8201    follower    \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"vault-auth-engine-policy-role-\\uC124\\uC815\",children:[(0,e.jsx)(a.a,{href:\"#vault-auth-engine-policy-role-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault auth, engine, policy, role \\uC124\\uC815\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC2E4\\uD589\\uC774 \\uB418\\uC5C8\\uC73C\\uB2C8, \\uC608\\uC81C\\uCC98\\uB7FC vault\\uC5D0 \\uD544\\uC694\\uD55C \\uAC83\\uB4E4\\uC744 \\uC124\\uC815\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault auth \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"enable\"}),` -path dev-auth-mount kubernetes\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault \",(0,e.jsx)(a.span,{className:\"token function\",children:\"write\"}),\" auth/dev-auth-mount/config \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"kubernetes_host\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://kubernetes.default.svc\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault secrets \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"enable\"}),\" -path\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),`dev kv-v2\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault policy \",(0,e.jsx)(a.span,{className:\"token function\",children:\"write\"}),\" dev - \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"\u003c\u003c\"}),(0,e.jsx)(a.span,{className:\"token string\",children:`EOF\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`path \"dev/*\" {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`   capabilities = [\"read\"]\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`}\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string\",children:\"EOF\"}),`\n`]})]})}),(0,e.jsx)(a.pre,{children:(0,e.jsxs)(a.code,{className:\"code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`vault write auth/dev-auth-mount/role/dev \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   bound_service_account_names=default \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   bound_service_account_namespaces=dev \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   policies=dev \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   audience=vault \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   ttl=24h\n`})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault kv put dev/webapp/config \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"username\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-user\"'}),\" \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"password\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-password\"'}),`\n`]})})}),(0,e.jsxs)(a.h2,{id:\"vault-secrets-operator\",children:[(0,e.jsx)(a.a,{href:\"#vault-secrets-operator\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault secrets operator\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C CRD\\uB85C \\uAD00\\uB9AC\\uD558\\uACE0, vault\\uC758 secret\\uC744 Kubernetes secret\\uC73C\\uB85C sync\\uD574\\uC8FC\\uB294 vault-secrets-operator\\uB97C \\uC124\\uCE58\\uD55C\\uB2E4. \\uBA3C\\uC800 ca.crt\\uAC00 Secret\\uC5D0 \\uC788\\uC5B4\\uC57C \\uB418\\uC11C \\uB3D9\\uC77C\\uD558\\uAC8C Kustomize\\uB85C Secret Manifest\\uB97C \\uC0DD\\uC131\\uD558\\uACE0, sealed-secret\\uC73C\\uB85C \\uBC30\\uD3EC\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"kustomization.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"secretGenerator\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`ca\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"files\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` ca.crt=vault.ca\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl create namespace vault-secrets-operator\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl ns vault-secrets-operator\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),\" secret-ca.yml\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" kubeseal --controller-namespace kube-system --controller-name sealed-secrets-controller --format yaml \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"\u003e\"}),` sealed-secret-ca.yml\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f sealed-secret-ca.yml\n`})]})}),(0,e.jsx)(a.p,{children:\"\\uADF8\\uB9AC\\uACE0 ArgoCD Application resource\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"argocd-vault-secrets-operator.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"project\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'https://kubernetes.default.svc'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`//helm.releases.hashicorp.com\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 0.4.2\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"values\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        defaultVaultConnection:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          address: \"https://vault.vault.svc.cluster.local:8200\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          skipTLSVerify: false\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"          caCertSecret: vault-ca-a2dh3972mm\"}),`\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f argocd-vault-secrets-operator.yml\n`})})}),(0,e.jsx)(a.p,{children:\"ArgoCD\\uB85C sync\\uB97C \\uB9DE\\uCDB0\\uC11C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C resource\\uB4E4\\uC774 \\uBC30\\uD3EC\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD55C\\uB2E4.\"}),(0,e.jsxs)(a.h3,{id:\"vault-secrets-operator-test\",children:[(0,e.jsx)(a.a,{href:\"#vault-secrets-operator-test\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault secrets operator test\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault secrets operator\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC124\\uCE58\\uB418\\uC5C8\\uC73C\\uB2C8, CRD\\uB97C \\uC0DD\\uC131\\uD558\\uC5EC namespace dev\\uC5D0\\uC11C vault secret\\uC5D0 \\uB530\\uB77C\\uC11C Kubernetes secret\\uC774 \\uC0DD\\uC131\\uB418\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD574\\uBCF8\\uB2E4.\"}),(0,e.jsx)(a.p,{children:\"\\uC704\\uC5D0\\uC11C vault\\uC5D0 \\uB2E4\\uC74C\\uACFC \\uAC19\\uC774 \\uCD94\\uAC00\\uD558\\uC600\\uB2E4.\"}),(0,e.jsxs)(a.ul,{children:[(0,e.jsx)(a.li,{children:\"kubernetes auth: dev-auth-mount\"}),(0,e.jsx)(a.li,{children:\"role: dev\"}),(0,e.jsx)(a.li,{children:\"kv-v2: dev/webapp/config\"})]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"example-auth.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` secrets.hashicorp.com/v1beta1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` VaultAuth\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" static\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`auth\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"method\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` kubernetes\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"mount\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" dev\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"auth\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`mount\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kubernetes\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"role\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"serviceAccount\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"audiences\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault\n`]})]})}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"example-secret.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` secrets.hashicorp.com/v1beta1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` VaultStaticSecret\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"kv\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`app\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" kv\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`v2\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"mount\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"path\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` webapp/config\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" dev\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`secret\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"create\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"refreshAfter\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 30s\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"vaultAuthRef\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" static\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`auth\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f example-auth.yml\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f example-secret.yml\n`})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C Kubernetes namespace dev\\uC5D0 \",(0,e.jsx)(a.code,{children:\"devSecret\"}),\" Secret resource\\uAC00 \\uC0DD\\uC131\\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get secret -n dev\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME              TYPE                             DATA   AGE\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"dev-secret        Opaque                           \",(0,e.jsx)(a.span,{className:\"token number\",children:\"3\"}),`      3s\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C secret\\uC774 \\uBCC0\\uACBD\\uB418\\uBA74 \\uC790\\uB3D9\\uC73C\\uB85C Deployment\\uC758 pod\\uB97C Rolling Update\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D, \",(0,e.jsx)(a.a,{href:\"https://github.com/stakater/Reloader\",children:\"Reloader\"}),\"\\uC744 helm\\uC73C\\uB85C \\uC124\\uCE58\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"argocd-reloader.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"project\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"syncPolicy\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"syncOptions\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` CreateNamespace=true\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'https://kubernetes.default.svc'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//stakater.github.io/stakater\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`charts\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 1.0.56\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uB3D9\\uC77C\\uD558\\uAC8C ArgoCD\\uB85C \\uBC30\\uD3EC\\uB97C \\uD558\\uACE0, \\uADF8\\uB0E5 secret\\uC73C\\uB85C\\uBD80\\uD130 \\uAC12\\uC744 stdout\\uC73C\\uB85C \\uB0A8\\uAE30\\uB294 Pod\\uB97C \\uC0DD\\uC131\\uD558\\uB294 Deployment Resource\\uB97C \\uBC30\\uD3EC\\uD55C\\uB2E4. \\uC774\\uB54C annotation\\uC744 \\uD1B5\\uD574\\uC11C \\uC124\\uCE58\\uD55C reloader\\uAC00 \\uBCC0\\uACBD\\uB41C secret\\uB97C watch\\uD558\\uACE0 rolling update\\uB97C \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"reloader.stakater.com/auto\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" ubuntu\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Just spin \u0026 wait forever\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'/bin/bash'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'-c'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'--'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"args\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'while true; echo ${username}; do sleep 30; done;'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"envFrom\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"secretRef\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" dev\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`secret\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uBC30\\uD3EC\\uD558\\uACE0 \\uB098\\uC11C log\\uB97C \\uD655\\uC778\\uD558\\uBA74 \",(0,e.jsx)(a.code,{children:\"dev-secret\"}),\"\\uC5D0 \\uC788\\uB294 username \\uAC12\\uC774 \\uCC0D\\uD788\\uB294 \\uAC78 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{children:(0,e.jsxs)(a.code,{className:\"code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl logs -f --selector app=ubuntu\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`static-user\n`})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault\\uC5D0\\uC11C secret\\uAC12\\uC744 \\uBCC0\\uACBD\\uD558\\uBA74, rolling update\\uAC00 \\uB418\\uACE0 static-user3\\uAC00 log\\uB85C \\uB0A8\\uB294 \\uAC78 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault kv put dev/webapp/config \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"username\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-user3\"'}),\" \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"password\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-password\"'}),`\n`]})})}),(0,e.jsxs)(a.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(a.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(a.p,{children:\"GitOps\\uB85C Kubernetes manifest file\\uB97C \\uAD00\\uB9AC\\uD558\\uB294 \\uC0C1\\uD669\\uC5D0\\uC11C Secret\\uC740 \\uC5B4\\uB5BB\\uAC8C \\uAD00\\uB9AC\\uD558\\uB294 \\uAC83\\uC774 \\uC88B\\uC744\\uAE4C \\uACE0\\uBBFC\\uC744 \\uD588\\uC5C8\\uB2E4. \\uC608\\uC804\\uBD80\\uD130 Vault\\uB97C \\uD3B8\\uB9AC\\uD558\\uAC8C \\uC0AC\\uC6A9\\uD574\\uC654\\uACE0, Kubernetes\\uC5D0\\uC11C vault\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB294 \\uC635\\uC158\\uB4E4\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uC558\\uB2E4. \\uADF8\\uC911\\uC5D0\\uC11C Vault secrets operator\\uAC00 \\uAC00\\uC7A5 \\uC801\\uD569\\uD558\\uB2E4\\uACE0 \\uD310\\uB2E8\\uD558\\uC5EC, ArgoCD, Kustomize, sealed-secret \\uB4F1\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC14B\\uD305\\uC744 \\uD574\\uBCF4\\uC558\\uB2E4. Hashicorp \\uB9CC\\uC138! \\u{1F44D}\\u{1F44D}\"})]})}}var b=y;return f;})();\n;return Component;","toc":[{"value":"vault","url":"#vault","depth":2},{"value":"Certificate 준비","url":"#certificate-준비","depth":3},{"value":"Secret으로 준비","url":"#secret으로-준비","depth":3},{"value":"ArgoCD로 배포","url":"#argocd로-배포","depth":3},{"value":"Vault init \u0026 unseal","url":"#vault-init--unseal","depth":3},{"value":"vault auth, engine, policy, role 설정","url":"#vault-auth-engine-policy-role-설정","depth":3},{"value":"vault secrets operator","url":"#vault-secrets-operator","depth":2},{"value":"vault secrets operator test","url":"#vault-secrets-operator-test","depth":3},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"15 min read","minutes":14.89,"time":893400,"words":2978},"slug":"20231222-vault-on-k8s","fileName":"20231222-vault-on-k8s.md","title":"vault secrets operator 사용해보기","date":"2023-12-22T00:00:00.000Z","tags":["Kubernetes","vault"],"images":["/static/images/social-banner.png"],"summary":"GitOps에서 Secret을 어떻게 관리할지 고민을 하였고, 개발자들의 인지부하를 줄이기 위해서 Vault UI로 자신의 앱의 비밀값을 관리하는 것이 제일 효율적이라는 판단을 했다. Vault secrets operator가 GA로 공유가 되었고, Secrets Store CSI나 External secrets 프로젝트보다 깔끔한 방식이라는 생각이 들었다. Vault secrets operator의 CRD로 vault secret과 kubernetes secret의 sync를 맞추고, reloader로 secret이 변경되었을 때 다시 pod를 배포하는 것을 테스트해보았다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"AWS SAM으로 배포한 Lambda의 환경변수가 변경된 Secret Manager 값으로 반영이 안되는 문제","date":"2023-12-17T00:00:00.000Z","tags":["AWS"],"images":["/static/images/social-banner.png"],"summary":"AWS Cloudformation에서 Secret Manager의 값을 참조하도록 할 수 있다. AWS SAM을 사용하여 배포된 Lambda의 환경변수가 Secret Manager의 값을 참조하는 경우가 있었다. 그런데 Secret manager의 값을 변경하여 다시 배포하여도 변경된 값이 Lambda 환경변수에 반영이 되지 않았다.🧐 AWS SAM의 리포에 관련된 Issue가 있었고, 제안한 해결방법을 적용하였다. 살짝 삽질을 했기 때문에 기록을 남겨 본다.🤪","slug":"20231217-aws-sam-resolve-issue"},"next":{"title":"Vault custom secret engine 작성해보기","date":"2023-12-28T00:00:00.000Z","tags":["vault","ncloud"],"images":["/static/images/social-banner.png"],"summary":"Vault의 secret engine을 사용하여 네이버 클라우드의 임시 인증키를 발행하고 싶었다. 네이버클라우드는 AWS, Azure처럼 builtin plugin으로 제공하지 않는다. 하지만 custom secret engine을 vault framework SDK를 통해서 쉽게 만들 수 있다. 네이버 클라우드에서 STS API를 제공하기 때문에, custom secret engine을 통해서 임시 인증키를 발행하는 것을 테스트 해보게 되었다. 처음에 구조를 이해하는데 좀 시간이 걸렸지만, Vault Tutorial에서 친절하게 설명하고 있어서 비교적 쉽게 만들 수 있었다.","slug":"20231228-vault-custom-secret-engine"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20231222-vault-on-k8s"]},"buildId":"U7DE318orb_de6hUgWFnv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>