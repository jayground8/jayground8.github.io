<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>How To Authenticate With Docker API</title><meta name="robots" content="follow, index"/><meta name="description" content="I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files. Although an LLM can generate code for this task quickly, it&#x27;s worth knowing how to issue an authentication token for the Docker API. This could be important for guiding the LLM to produce a correct final version."/><meta property="og:url" content="https://jayground8.github.io/blog/20250716-docker-v2-api"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files. Although an LLM can generate code for this task quickly, it&#x27;s worth knowing how to issue an authentication token for the Docker API. This could be important for guiding the LLM to produce a correct final version."/><meta property="og:title" content="How To Authenticate With Docker API"/><meta property="og:image" content="https://jayground8.github.io/static/images/thumbnail/write-bash-script.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="How To Authenticate With Docker API"/><meta name="twitter:description" content="I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files. Although an LLM can generate code for this task quickly, it&#x27;s worth knowing how to issue an authentication token for the Docker API. This could be important for guiding the LLM to produce a correct final version."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/thumbnail/write-bash-script.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20250716-docker-v2-api"/><meta property="article:published_time" content="2025-07-16T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20250716-docker-v2-api"
  },
  "headline": "How To Authenticate With Docker API",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/thumbnail/write-bash-script.png"
    }
  ],
  "datePublished": "2025-07-16T00:00:00.000Z",
  "dateModified": "2025-07-16T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files. Although an LLM can generate code for this task quickly, it's worth knowing how to issue an authentication token for the Docker API. This could be important for guiding the LLM to produce a correct final version."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0e373dd4633ec194.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/byMjVt7p1j1f5Lba1yluX/_buildManifest.js" defer=""></script><script src="/_next/static/byMjVt7p1j1f5Lba1yluX/_ssgManifest.js" defer=""></script><script src="/_next/static/byMjVt7p1j1f5Lba1yluX/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-07-16T00:00:00.000Z">Wednesday, July 16, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">How To Authenticate With Docker API</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>I needed to write a simple bash script to iterate through all the image repositories in my private container registry, find the latest build for each, and save them as individual .tar files. I didn&#x27;t want to do this manually because there are too many images, and I knew I would have to do it again later.</p><p>Since we&#x27;re in the age of AI, I asked an LLM to generate the script. Instead of trying to remember all the bash syntax, an LLM can generate code in just a few seconds. However, it&#x27;s common to encounter errors when you run the generated script. You then have to report the errors back to the AI to fix the problem, sometimes repeating the process over and over. This shows how important it is to give LLMs clear and correct instructions.</p><p>For instance, when I asked Gemini to generate a script for this task, the code it produced was almost perfect. But depending on how you write the prompt, it can miss crucial steps. In my case, it initially forgot to include the function to generate an authentication token.</p><h2 id="how-to-authenticate"><a href="#how-to-authenticate" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>How To Authenticate</h2><p>You can get information on how to authenticate to your registry from the Www-Authenticate response header. For example, if your registry supports the Docker V2 API, an unauthenticated request to list an image&#x27;s tags will fail.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -i <span class="token string">&quot;https://my-private-repository.com/v2/<span class="token variable">$name</span>/tags/list&quot;</span>
</span></code></pre></div><p>You&#x27;ll get a 401 Unauthorized status code back, and the response will include a Www-Authenticate header. This header contains information about where you need to request a token (realm), and which service and scope to use. This information can vary depending on the container registry.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">www-authenticate: Bearer <span class="token variable assign-left">realm</span><span class="token operator">=</span><span class="token string">&quot;https://my-private-repository.com/auth/token&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;ncr&quot;</span>,scope<span class="token operator">=</span><span class="token string">&quot;repository:tutorial:pull&quot;</span>
</span></code></pre></div><p>With this information, you can get an authentication token using basic authentication, like so:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -u <span class="token string">&quot;<span class="token variable">$USERNAME</span>:<span class="token variable">$PASSWORD</span>&quot;</span> <span class="token string">&quot;https://my-private-repository.com/auth/token?service=ncr&amp;scope=repository:tutorial:pull&quot;</span>
</span></code></pre></div><p>Now that you have the token, you can make an authorized request to get all the tags.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -H <span class="token string">&quot;Authorization: Bearer <span class="token variable">${TOKEN}</span>&quot;</span> <span class="token string">&quot;https://my-private-repository.com/v2/<span class="token variable">$name</span>$/tags/list&quot;</span>
</span></code></pre></div><p>You can get a list of all image repositories in your container registry using the <code>v2/_catalog</code> API. However, the Www-Authenticate header for this endpoint doesn&#x27;t explicitly state the required scope.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -i https://my-private-repository.com/v2/_catalog
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">www-authenticate: Bearer <span class="token variable assign-left">realm</span><span class="token operator">=</span><span class="token string">&quot;https://my-private-repository.com/auth/token&quot;</span>,service<span class="token operator">=</span><span class="token string">&quot;ncr&quot;</span>
</span></code></pre></div><p>To get a token with the correct permissions, you must set the scope to registry:catalog:*.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -u <span class="token string">&quot;<span class="token variable">$USERNAME</span>:<span class="token variable">$PASSWORD</span>&quot;</span> <span class="token string">&quot;https://my-private-repository.com/auth/token?service=ncr&amp;scope=registry:catalog:*&quot;</span>
</span></code></pre></div><h2 id="generating-with-llm"><a href="#generating-with-llm" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Generating with LLM</h2><p>From the explanation above, you probably have a good idea of the process. You can get a list of all image repositories from your container registry using the <code>v2/_catalog</code> API and then iterate through them to find the latest build for each. You also know that you need to authenticate with the private registry and how to do it.</p><p>Now, let&#x27;s have an LLM do the work.</p><h3 id="claude-sonnet-4"><a href="#claude-sonnet-4" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Claude Sonnet 4</h3><p>My first prompt was:</p><blockquote><p>please write a bash script. I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files.</p></blockquote><p>Claude generated a nice bash script. However, instead of first requesting a token from the realm URL, the script attempted to use basic authentication for every API call.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function function-name">get_repositories</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> auth_header
</span><span class="code-line">    <span class="token variable assign-left">auth_header</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> -n <span class="token string">&quot;<span class="token variable">$REGISTRY_USERNAME</span>:<span class="token variable">$REGISTRY_PASSWORD</span>&quot;</span> <span class="token operator">|</span> base64<span class="token variable">)</span></span>
</span><span class="code-line">
</span><span class="code-line">    log <span class="token string">&quot;Fetching repository list from registry...&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># For Docker Registry API v2</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> <span class="token variable assign-left">repos_url</span><span class="token operator">=</span><span class="token string">&quot;https://<span class="token variable">$REGISTRY_URL</span>/v2/_catalog&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">curl</span> -s -H <span class="token string">&quot;Authorization: Basic <span class="token variable">$auth_header</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$repos_url</span>&quot;</span> <span class="token operator">|</span> jq -r <span class="token string">&#x27;.repositories[]&#x27;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        error <span class="token string">&quot;Failed to fetch repositories. Make sure your registry supports Docker Registry API v2&quot;</span>
</span><span class="code-line">        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line">    <span class="token keyword">fi</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>After I gave it additional guidance, it generated the code I was expecting.</p><blockquote><p>basic authentication is not working. You should issue a authentication token to authenticate to API.</p></blockquote><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function function-name">get_auth_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> <span class="token variable assign-left">service</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> <span class="token variable assign-left">scope</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># First, try to get the authentication realm from the registry</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> auth_challenge
</span><span class="code-line">    <span class="token variable assign-left">auth_challenge</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -I <span class="token string">&quot;https://<span class="token variable">$REGISTRY_URL</span>/v2/&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> -i <span class="token string">&quot;www-authenticate&quot;</span> <span class="token operator">|</span> <span class="token function">head</span> -1<span class="token variable">)</span></span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$auth_challenge</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        error <span class="token string">&quot;Could not get authentication challenge from registry&quot;</span>
</span><span class="code-line">        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line">    <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># Extract realm, service, and scope from the challenge</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> realm
</span><span class="code-line">    <span class="token variable assign-left">realm</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$auth_challenge</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> -n <span class="token string">&#x27;s/.*realm=&quot;\([^&quot;]*\)&quot;.*/\1/p&#x27;</span><span class="token variable">)</span></span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$realm</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        error <span class="token string">&quot;Could not extract authentication realm&quot;</span>
</span><span class="code-line">        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line">    <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">    log <span class="token string">&quot;Getting authentication token from: <span class="token variable">$realm</span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># Request token with proper parameters</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> <span class="token variable assign-left">token_url</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$realm</span>&quot;</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> <span class="token variable assign-left">token_params</span><span class="token operator">=</span><span class="token string">&quot;service=<span class="token variable">$service</span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$scope</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        <span class="token variable assign-left">token_params</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$token_params</span>&amp;scope=<span class="token variable">$scope</span>&quot;</span>
</span><span class="code-line">    <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token builtin class-name">local</span> token_response
</span><span class="code-line">    <span class="token variable assign-left">token_response</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -s -u <span class="token string">&quot;<span class="token variable">$REGISTRY_USERNAME</span>:<span class="token variable">$REGISTRY_PASSWORD</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$token_url</span>?<span class="token variable">$token_params</span>&quot;</span><span class="token variable">)</span></span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        error <span class="token string">&quot;Failed to get authentication token&quot;</span>
</span><span class="code-line">        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line">    <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># Extract token from response</span>
</span><span class="code-line">    <span class="token builtin class-name">local</span> token
</span><span class="code-line">    <span class="token variable assign-left">token</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$token_response</span>&quot;</span> <span class="token operator">|</span> jq -r <span class="token string">&#x27;.token // .access_token&#x27;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token variable">)</span></span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$token</span>&quot;</span> <span class="token operator">||</span> <span class="token string">&quot;<span class="token variable">$token</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;null&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">        error <span class="token string">&quot;Could not extract token from response&quot;</span>
</span><span class="code-line">        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
</span><span class="code-line">    <span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$token</span>&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>I had to provide more instructions to fix other parts as well. For instance, Claude initially interpreted &quot;latest build&quot; as simply getting the image with the tag name &quot;latest&quot;. In the end, the script was able to retrieve all image repositories and find the true latest build by using two additional API calls: <code>v2/${repo}/manifests/${tag}</code> and <code>v2/${repo}/blobs/${config_digest}</code>.</p><h3 id="gemini-25-pro"><a href="#gemini-25-pro" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Gemini 2.5 Pro</h3><p>I prefer to use Gemini because its token allowance is more generous, and I don&#x27;t have to pay extra on my current plan. I sent the same prompt to Gemini.</p><blockquote><p>please write a bash script. I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files.</p></blockquote><p>It turned out that the authentication part was completely missing, so I provided an additional instruction.</p><blockquote><p>it need to issue a token to authenticate to my private container registry.</p></blockquote><p>However, this time it just defined an AUTH_URL variable instead of getting it dynamically from the Www-Authenticate header. I had to give it a more specific instruction.</p><blockquote><p>you need to get auth url from www-authenticate insead.</p></blockquote><p>Just like with Claude, I had to chat a little bit more with Gemini to fix minor issues. In the end, the result was quite similar.</p><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h2><p>Gemini and Claude did the boring job of writing a simple bash script for me. However, they didn&#x27;t generate perfect code on the first try. It was worthwhile to understand how authentication works with the www-authenticate response header and the Docker API. Based on this knowledge, you can give the LLM more specific guidance to generate a final, working version of the code.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/docker">docker</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/gemini">Gemini</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/claude">Claude</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250712-gitea-action">Configuring Private Runner Images for Gitea Runner</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250719-writing-helm-values-with-gemini">Writing Helm Values With Gemini</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=n=\u003el(n,\"__esModule\",{value:!0});var u=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),N=(n,s)=\u003e{t(n);for(var i in s)l(n,i,{get:s[i],enumerable:!0})},k=(n,s,i)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of d(s))!m.call(n,a)\u0026\u0026a!==\"default\"\u0026\u0026l(n,a,{get:()=\u003es[a],enumerable:!(i=h(s,a))||i.enumerable});return n},g=n=\u003ek(t(l(n!=null?o(p(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var r=u((I,c)=\u003e{c.exports=_jsx_runtime});var w={};N(w,{default:()=\u003ef,frontmatter:()=\u003eb});var e=g(r()),b={title:\"How To Authenticate With Docker API\",date:\"2025-07-16\",tags:[\"docker\",\"Gemini\",\"Claude\"],images:[\"/static/images/thumbnail/write-bash-script.png\"],summary:\"I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files. Although an LLM can generate code for this task quickly, it's worth knowing how to issue an authentication token for the Docker API. This could be important for guiding the LLM to produce a correct final version.\"};function v(n={}){let{wrapper:s}=n.components||{};return s?(0,e.jsx)(s,Object.assign({},n,{children:(0,e.jsx)(i,{})})):i();function i(){let a=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",pre:\"pre\",code:\"code\",h3:\"h3\",blockquote:\"blockquote\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(a.p,{children:\"I needed to write a simple bash script to iterate through all the image repositories in my private container registry, find the latest build for each, and save them as individual .tar files. I didn't want to do this manually because there are too many images, and I knew I would have to do it again later.\"}),(0,e.jsx)(a.p,{children:\"Since we're in the age of AI, I asked an LLM to generate the script. Instead of trying to remember all the bash syntax, an LLM can generate code in just a few seconds. However, it's common to encounter errors when you run the generated script. You then have to report the errors back to the AI to fix the problem, sometimes repeating the process over and over. This shows how important it is to give LLMs clear and correct instructions.\"}),(0,e.jsx)(a.p,{children:\"For instance, when I asked Gemini to generate a script for this task, the code it produced was almost perfect. But depending on how you write the prompt, it can miss crucial steps. In my case, it initially forgot to include the function to generate an authentication token.\"}),(0,e.jsxs)(a.h2,{id:\"how-to-authenticate\",children:[(0,e.jsx)(a.a,{\"aria-hidden\":\"true\",href:\"#how-to-authenticate\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"How To Authenticate\"]}),(0,e.jsx)(a.p,{children:\"You can get information on how to authenticate to your registry from the Www-Authenticate response header. For example, if your registry supports the Docker V2 API, an unauthenticated request to list an image's tags will fail.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -i \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"https://my-private-repository.com/v2/',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$name\"}),'/tags/list\"']}),`\n`]})})}),(0,e.jsx)(a.p,{children:\"You'll get a 401 Unauthorized status code back, and the response will include a Www-Authenticate header. This header contains information about where you need to request a token (realm), and which service and scope to use. This information can vary depending on the container registry.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"www-authenticate: Bearer \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"realm\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://my-private-repository.com/auth/token\"'}),\",service\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"ncr\"'}),\",scope\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"repository:tutorial:pull\"'}),`\n`]})})}),(0,e.jsx)(a.p,{children:\"With this information, you can get an authentication token using basic authentication, like so:\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -u \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$USERNAME\"}),\":\",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$PASSWORD\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://my-private-repository.com/auth/token?service=ncr\u0026scope=repository:tutorial:pull\"'}),`\n`]})})}),(0,e.jsx)(a.p,{children:\"Now that you have the token, you can make an authorized request to get all the tags.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -H \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"Authorization: Bearer ',(0,e.jsx)(a.span,{className:\"token variable\",children:\"${TOKEN}\"}),'\"']}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"https://my-private-repository.com/v2/',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$name\"}),'$/tags/list\"']}),`\n`]})})}),(0,e.jsxs)(a.p,{children:[\"You can get a list of all image repositories in your container registry using the \",(0,e.jsx)(a.code,{children:\"v2/_catalog\"}),\" API. However, the Www-Authenticate header for this endpoint doesn't explicitly state the required scope.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),` -i https://my-private-repository.com/v2/_catalog\n`]})})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"www-authenticate: Bearer \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"realm\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://my-private-repository.com/auth/token\"'}),\",service\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"ncr\"'}),`\n`]})})}),(0,e.jsx)(a.p,{children:\"To get a token with the correct permissions, you must set the scope to registry:catalog:*.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -u \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$USERNAME\"}),\":\",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$PASSWORD\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://my-private-repository.com/auth/token?service=ncr\u0026scope=registry:catalog:*\"'}),`\n`]})})}),(0,e.jsxs)(a.h2,{id:\"generating-with-llm\",children:[(0,e.jsx)(a.a,{\"aria-hidden\":\"true\",href:\"#generating-with-llm\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Generating with LLM\"]}),(0,e.jsxs)(a.p,{children:[\"From the explanation above, you probably have a good idea of the process. You can get a list of all image repositories from your container registry using the \",(0,e.jsx)(a.code,{children:\"v2/_catalog\"}),\" API and then iterate through them to find the latest build for each. You also know that you need to authenticate with the private registry and how to do it.\"]}),(0,e.jsx)(a.p,{children:\"Now, let's have an LLM do the work.\"}),(0,e.jsxs)(a.h3,{id:\"claude-sonnet-4\",children:[(0,e.jsx)(a.a,{\"aria-hidden\":\"true\",href:\"#claude-sonnet-4\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Claude Sonnet 4\"]}),(0,e.jsx)(a.p,{children:\"My first prompt was:\"}),(0,e.jsx)(a.blockquote,{children:(0,e.jsx)(a.p,{children:\"please write a bash script. I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files.\"})}),(0,e.jsx)(a.p,{children:\"Claude generated a nice bash script. However, instead of first requesting a token from the realm URL, the script attempted to use basic authentication for every API call.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function function-name\",children:\"get_repositories\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),` auth_header\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"auth_header\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token variable\",children:[(0,e.jsx)(a.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"echo\"}),\" -n \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$REGISTRY_USERNAME\"}),\":\",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$REGISTRY_PASSWORD\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" base64\",(0,e.jsx)(a.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    log \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"Fetching repository list from registry...\"'}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# For Docker Registry API v2\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),\" \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"repos_url\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token string\",children:['\"https://',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$REGISTRY_URL\"}),'/v2/_catalog\"']}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"!\"}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -s -H \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"Authorization: Basic ',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$auth_header\"}),'\"']}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$repos_url\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'.repositories[]'\"}),\" \",(0,e.jsxs)(a.span,{className:\"token operator\",children:[(0,e.jsx)(a.span,{className:\"token file-descriptor important\",children:\"2\"}),\"\u003e\"]}),\"/dev/null\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        error \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"Failed to fetch repositories. Make sure your registry supports Docker Registry API v2\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"After I gave it additional guidance, it generated the code I was expecting.\"}),(0,e.jsx)(a.blockquote,{children:(0,e.jsx)(a.p,{children:\"basic authentication is not working. You should issue a authentication token to authenticate to API.\"})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function function-name\",children:\"get_auth_token\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),\" \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"service\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$1\"}),'\"']}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),\" \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"scope\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$2\"}),'\"']}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# First, try to get the authentication realm from the registry\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),` auth_challenge\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"auth_challenge\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token variable\",children:[(0,e.jsx)(a.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -s -I \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"https://',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$REGISTRY_URL\"}),'/v2/\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"grep\"}),\" -i \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"www-authenticate\"'}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"head\"}),\" -1\",(0,e.jsx)(a.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$auth_challenge\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        error \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"Could not get authentication challenge from registry\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Extract realm, service, and scope from the challenge\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),` realm\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"realm\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token variable\",children:[(0,e.jsx)(a.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$auth_challenge\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"sed\"}),\" -n \",(0,e.jsx)(a.span,{className:\"token string\",children:`'s/.*realm=\"\\\\([^\"]*\\\\)\".*/\\\\1/p'`}),(0,e.jsx)(a.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$realm\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        error \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"Could not extract authentication realm\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    log \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"Getting authentication token from: ',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$realm\"}),'\"']}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Request token with proper parameters\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),\" \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"token_url\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$realm\"}),'\"']}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),\" \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"token_params\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token string\",children:['\"service=',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$service\"}),'\"']}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" -n \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$scope\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"token_params\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token_params\"}),\"\u0026scope=\",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$scope\"}),'\"']}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),` token_response\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"token_response\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token variable\",children:[(0,e.jsx)(a.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(a.span,{className:\"token function\",children:\"curl\"}),\" -s -u \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$REGISTRY_USERNAME\"}),\":\",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$REGISTRY_PASSWORD\"}),'\"']}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token_url\"}),\"?\",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token_params\"}),'\"']}),(0,e.jsx)(a.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsx)(a.span,{className:\"token variable\",children:\"$?\"}),\" -ne \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        error \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"Failed to get authentication token\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Extract token from response\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),` token\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token variable assign-left\",children:\"token\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(a.span,{className:\"token variable\",children:[(0,e.jsx)(a.span,{className:\"token variable\",children:\"$(\"}),(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token_response\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" jq -r \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'.token // .access_token'\"}),\" \",(0,e.jsxs)(a.span,{className:\"token operator\",children:[(0,e.jsx)(a.span,{className:\"token file-descriptor important\",children:\"2\"}),\"\u003e\"]}),\"/dev/null\",(0,e.jsx)(a.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" -z \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token\"}),'\"']}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"null\"'}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        error \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"Could not extract token from response\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exit\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(a.span,{className:\"token string\",children:['\"',(0,e.jsx)(a.span,{className:\"token variable\",children:\"$token\"}),'\"']}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:['I had to provide more instructions to fix other parts as well. For instance, Claude initially interpreted \"latest build\" as simply getting the image with the tag name \"latest\". In the end, the script was able to retrieve all image repositories and find the true latest build by using two additional API calls: ',(0,e.jsx)(a.code,{children:\"v2/${repo}/manifests/${tag}\"}),\" and \",(0,e.jsx)(a.code,{children:\"v2/${repo}/blobs/${config_digest}\"}),\".\"]}),(0,e.jsxs)(a.h3,{id:\"gemini-25-pro\",children:[(0,e.jsx)(a.a,{\"aria-hidden\":\"true\",href:\"#gemini-25-pro\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Gemini 2.5 Pro\"]}),(0,e.jsx)(a.p,{children:\"I prefer to use Gemini because its token allowance is more generous, and I don't have to pay extra on my current plan. I sent the same prompt to Gemini.\"}),(0,e.jsx)(a.blockquote,{children:(0,e.jsx)(a.p,{children:\"please write a bash script. I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files.\"})}),(0,e.jsx)(a.p,{children:\"It turned out that the authentication part was completely missing, so I provided an additional instruction.\"}),(0,e.jsx)(a.blockquote,{children:(0,e.jsx)(a.p,{children:\"it need to issue a token to authenticate to my private container registry.\"})}),(0,e.jsx)(a.p,{children:\"However, this time it just defined an AUTH_URL variable instead of getting it dynamically from the Www-Authenticate header. I had to give it a more specific instruction.\"}),(0,e.jsx)(a.blockquote,{children:(0,e.jsx)(a.p,{children:\"you need to get auth url from www-authenticate insead.\"})}),(0,e.jsx)(a.p,{children:\"Just like with Claude, I had to chat a little bit more with Gemini to fix minor issues. In the end, the result was quite similar.\"}),(0,e.jsxs)(a.h2,{id:\"conclusion\",children:[(0,e.jsx)(a.a,{\"aria-hidden\":\"true\",href:\"#conclusion\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),(0,e.jsx)(a.p,{children:\"Gemini and Claude did the boring job of writing a simple bash script for me. However, they didn't generate perfect code on the first try. It was worthwhile to understand how authentication works with the www-authenticate response header and the Docker API. Based on this knowledge, you can give the LLM more specific guidance to generate a final, working version of the code.\"})]})}}var f=v;return w;})();\n;return Component;","toc":[{"value":"How To Authenticate","url":"#how-to-authenticate","depth":2},{"value":"Generating with LLM","url":"#generating-with-llm","depth":2},{"value":"Claude Sonnet 4","url":"#claude-sonnet-4","depth":3},{"value":"Gemini 2.5 Pro","url":"#gemini-25-pro","depth":3},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.195,"time":431700,"words":1439},"slug":"20250716-docker-v2-api","fileName":"20250716-docker-v2-api.md","title":"How To Authenticate With Docker API","date":"2025-07-16T00:00:00.000Z","tags":["docker","Gemini","Claude"],"images":["/static/images/thumbnail/write-bash-script.png"],"summary":"I needed to iterate through all image repositories in my private container registry, find the latest build for each, and save them as individual tar files. Although an LLM can generate code for this task quickly, it's worth knowing how to issue an authentication token for the Docker API. This could be important for guiding the LLM to produce a correct final version."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Configuring Private Runner Images for Gitea Runner","date":"2025-07-12T00:00:00.000Z","tags":["gitea"],"images":["/static/images/thumbnail/gitea.png"],"summary":"I needed to set up a self-hosted Git system and was looking for an open-source tool that would fit my requirements. Gitea seemed like a great fit, and I was particularly interested in Gitea Actions, which is compatible with GitHub Actions. However, I struggled to correctly configure a Gitea Actions runner to use a container image from a private repository. Through that process, I gained a much better understanding of how Gitea offers a CI/CD system compatible with GitHub Actions. In this post, I'll share what I learned.","slug":"20250712-gitea-action"},"next":{"title":"Writing Helm Values With Gemini","date":"2025-07-19T00:00:00.000Z","tags":["kubernetes","heml","Gemini"],"images":["/static/images/thumbnail/writing-helm-values-with-gemini.png"],"summary":"I often write values.yaml files to install open-source projects on Kubernetes clusters. This time, I needed to add tolerations to ensure all components of Sentry would run on specific nodes. Since Sentry has quite a few components, I decided to leverage Gemini to generate the values.yaml file more quickly.","slug":"20250719-writing-helm-values-with-gemini"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20250716-docker-v2-api"]},"buildId":"byMjVt7p1j1f5Lba1yluX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>