<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Kubelet imageGC</title><meta name="robots" content="follow, index"/><meta name="description" content="사이즈가 큰 컨테이너 이미지를 내려받기 위해서 Containerd의 설정값 root을 새로운 스토리지를 추가한 경로로 수정하였다. Kubelet은 imageGCHighThresholdPercent로 설정된 임계치보다 disk 사용량이 많으면, 컨테이너 이미지를 정리하여 disk 공간을 확보하려고 한다. imageGCHighThresholdPercent이 기본값으로 85로 설정되어 있고, disk의 85 퍼센트 이상 사용했을 때 정리 프로세스가 실행된다. 문제는 Containerd root 경로의 volume이 거의 꽉 차더라도, 전체 volume의 사용량은 85 퍼센트가 되지 않을 수 있다는 것이다. Containerd root 경로의 volume에 여유가 없어서 새로 스케쥴된 Pod의 컨테이너 이미지를 내려 받지 못하는 문제가 발생할 수 있다. imageGCHighThresholdPercent 설정값을 조절하여 이 문제를 해결할 수 있다."/><meta property="og:url" content="https://jayground8.github.io/blog/20240420-kubelet-imagegc"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="사이즈가 큰 컨테이너 이미지를 내려받기 위해서 Containerd의 설정값 root을 새로운 스토리지를 추가한 경로로 수정하였다. Kubelet은 imageGCHighThresholdPercent로 설정된 임계치보다 disk 사용량이 많으면, 컨테이너 이미지를 정리하여 disk 공간을 확보하려고 한다. imageGCHighThresholdPercent이 기본값으로 85로 설정되어 있고, disk의 85 퍼센트 이상 사용했을 때 정리 프로세스가 실행된다. 문제는 Containerd root 경로의 volume이 거의 꽉 차더라도, 전체 volume의 사용량은 85 퍼센트가 되지 않을 수 있다는 것이다. Containerd root 경로의 volume에 여유가 없어서 새로 스케쥴된 Pod의 컨테이너 이미지를 내려 받지 못하는 문제가 발생할 수 있다. imageGCHighThresholdPercent 설정값을 조절하여 이 문제를 해결할 수 있다."/><meta property="og:title" content="Kubelet imageGC"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Kubelet imageGC"/><meta name="twitter:description" content="사이즈가 큰 컨테이너 이미지를 내려받기 위해서 Containerd의 설정값 root을 새로운 스토리지를 추가한 경로로 수정하였다. Kubelet은 imageGCHighThresholdPercent로 설정된 임계치보다 disk 사용량이 많으면, 컨테이너 이미지를 정리하여 disk 공간을 확보하려고 한다. imageGCHighThresholdPercent이 기본값으로 85로 설정되어 있고, disk의 85 퍼센트 이상 사용했을 때 정리 프로세스가 실행된다. 문제는 Containerd root 경로의 volume이 거의 꽉 차더라도, 전체 volume의 사용량은 85 퍼센트가 되지 않을 수 있다는 것이다. Containerd root 경로의 volume에 여유가 없어서 새로 스케쥴된 Pod의 컨테이너 이미지를 내려 받지 못하는 문제가 발생할 수 있다. imageGCHighThresholdPercent 설정값을 조절하여 이 문제를 해결할 수 있다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20240420-kubelet-imagegc"/><meta property="article:published_time" content="2024-04-20T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20240420-kubelet-imagegc"
  },
  "headline": "Kubelet imageGC",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2024-04-20T00:00:00.000Z",
  "dateModified": "2024-04-20T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "사이즈가 큰 컨테이너 이미지를 내려받기 위해서 Containerd의 설정값 root을 새로운 스토리지를 추가한 경로로 수정하였다. Kubelet은 imageGCHighThresholdPercent로 설정된 임계치보다 disk 사용량이 많으면, 컨테이너 이미지를 정리하여 disk 공간을 확보하려고 한다. imageGCHighThresholdPercent이 기본값으로 85로 설정되어 있고, disk의 85 퍼센트 이상 사용했을 때 정리 프로세스가 실행된다. 문제는 Containerd root 경로의 volume이 거의 꽉 차더라도, 전체 volume의 사용량은 85 퍼센트가 되지 않을 수 있다는 것이다. Containerd root 경로의 volume에 여유가 없어서 새로 스케쥴된 Pod의 컨테이너 이미지를 내려 받지 못하는 문제가 발생할 수 있다. imageGCHighThresholdPercent 설정값을 조절하여 이 문제를 해결할 수 있다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5e5368a448ef7870.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/EVGw9w9cVqQ1I13StpVYa/_buildManifest.js" defer=""></script><script src="/_next/static/EVGw9w9cVqQ1I13StpVYa/_ssgManifest.js" defer=""></script><script src="/_next/static/EVGw9w9cVqQ1I13StpVYa/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-04-20T00:00:00.000Z">2024년 4월 20일 토요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Kubelet imageGC</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="크기가-큰-컨테이너-이미지를-사용"><a href="#크기가-큰-컨테이너-이미지를-사용" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>크기가 큰 컨테이너 이미지를 사용</h2><p>네이버 클라우드의 쿠버네티스 워커 노드의 스토리지 크기가 50GB로 설정되어 있다. 그렇기 때문에 10~20GB 크기의 컨테이너 이미지를 실행하려면 디스크 용량이 부족하게 된다. 용량 부족을 해결하기 위해서 블록 스토리지를 워커노드에 추가 생성하고, 새로 생성한 스토리지를 마운팅한 경로에 컨테이너 이미지를 저장하도록 Containerd 설정파일을 수정하여 해결할 수 있다.</p><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/containerd/containerd/blob/main/docs/ops.md">containerd의 문서</a>를 확인하면 root 경로 옵션은 컨테이너 이미지를 저장하는 경로로 사용되는 것을 확인할 수 있다.</p><blockquote><p>root will be used to store any type of persistent data for containerd. Snapshots, content, metadata for containers and image, as well as any plugin data will be kept in this location.</p></blockquote><p>워커노드의 containerd의 설정파일 root을 추가한 Volume의 경로로 수정하고, <code>systemctl restart containerd</code>로 재시작하여 적용할 수 있다.</p><p><code>/etc/containerd/config.toml</code></p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">version <span class="token operator">=</span> <span class="token number">2</span>
</span><span class="code-line">root <span class="token operator">=</span> <span class="token string">&quot;{추가한 경로}&quot;</span>
</span><span class="code-line">state <span class="token operator">=</span> <span class="token string">&quot;/run/containerd&quot;</span>
</span><span class="code-line">oom_score <span class="token operator">=</span> <span class="token number">0</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">..</span>.생략
</span></code></pre></div><p>이제 아래와 같이 컨테이너 이미지를 pull 받으면, <code>root</code>에 설정된 경로로 사용된 용량이 증가하는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ctr -n k8s.io image pull --user <span class="token punctuation">{</span>ncloud access key<span class="token punctuation">}</span>:<span class="token punctuation">{</span>ncloud secret key<span class="token punctuation">}</span> <span class="token punctuation">{</span>conatiner registry 주소<span class="token punctuation">}</span>
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">df</span> -h
</span><span class="code-line">Filesystem      Size  Used Avail Use% Mounted on
</span><span class="code-line">/dev/xvdb        98G   37G   57G  <span class="token number">40</span>% <span class="token punctuation">{</span>추가한 경로<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="kubelet의-컨테이너-이미지-정리"><a href="#kubelet의-컨테이너-이미지-정리" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Kubelet의 컨테이너 이미지 정리</h2><p>쿠버네티스에서 Kubelet은 disk 사용량을 체크하여 불필요한 데이터를 제거한다. 그 중에 <code>image manager</code>는 disk를 특정 퍼센트 만큼 사용하면, 정리 가능한 컨테이너 이미지를 정리하여 disk 공간을 확보하게 된다.</p><p>Systemd로 실행중인 Kubelet process의 설정파일을 확인해보면, 아래와 같이 되어 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ systemctl <span class="token function">cat</span> kubelet
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># /etc/systemd/system/kubelet.service</span>
</span><span class="code-line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token variable assign-left">Description</span><span class="token operator">=</span>Kubernetes Kubelet Server
</span><span class="code-line"><span class="token variable assign-left">Documentation</span><span class="token operator">=</span>https://github.com/GoogleCloudPlatform/kubernetes
</span><span class="code-line"><span class="token variable assign-left">After</span><span class="token operator">=</span>containerd.service
</span><span class="code-line"><span class="token variable assign-left">Wants</span><span class="token operator">=</span>containerd.service
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token variable assign-left">EnvironmentFile</span><span class="token operator">=</span>-/etc/kubernetes/kubelet.env
</span><span class="code-line"><span class="token variable assign-left">ExecStart</span><span class="token operator">=</span>/usr/local/bin/kubelet <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBE_LOGTOSTDERR</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBE_LOG_LEVEL</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_API_SERVER</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_ADDRESS</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_PORT</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_HOSTNAME</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_ARGS</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$DOCKER_SOCKET</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_NETWORK_PLUGIN</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_VOLUME_PLUGIN</span> <span class="token punctuation">\</span>
</span><span class="code-line">                <span class="token variable">$KUBELET_CLOUDPROVIDER</span>
</span><span class="code-line"><span class="token variable assign-left">Restart</span><span class="token operator">=</span>always
</span><span class="code-line"><span class="token variable assign-left">RestartSec</span><span class="token operator">=</span>10s
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token variable assign-left">WantedBy</span><span class="token operator">=</span>multi-user.target
</span></code></pre></div><p>그리고 <code>/etc/kubernetes/kubelet.env</code>를 확인해보면, <code>/etc/kubernetes/kubelet-config.yaml</code>를 설정값으로 사용하는 것을 확인할 수 있다.</p><p><code>/etc/kubernetes/kubelet.env</code></p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token punctuation">..</span>.생략
</span><span class="code-line"><span class="token variable assign-left">KUBELET_ARGS</span><span class="token operator">=</span><span class="token string">&quot;--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf \
</span></span><span class="code-line"><span class="token string">--config=/etc/kubernetes/kubelet-config.yaml \
</span></span><span class="code-line"><span class="token string">--cloud-provider=external \
</span></span><span class="code-line"><span class="token string">--provider-id=&#x27;navercloudplatform://2767456&#x27; \
</span></span><span class="code-line"><span class="token string">--kubeconfig=/etc/kubernetes/kubelet.conf \
</span></span><span class="code-line"><span class="token string">--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \
</span></span><span class="code-line"><span class="token string">--runtime-cgroups=/system.slice/containerd.service \
</span></span><span class="code-line"><span class="token string">--node-labels=ncloud.com/nks-nodepool=example \
</span></span><span class="code-line"><span class="token string"> --register-with-taints=nvidia.com/gpu=:NoSchedule  &quot;</span>
</span><span class="code-line"><span class="token variable assign-left">KUBELET_VOLUME_PLUGIN</span><span class="token operator">=</span><span class="token string">&quot;--volume-plugin-dir=/usr/libexec/kubernetes/kubelet-plugins/volume/exec&quot;</span>
</span><span class="code-line"><span class="token variable assign-left">KUBELET_CLOUDPROVIDER</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token variable assign-left"><span class="token constant environment">PATH</span></span><span class="token operator">=</span>/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span></code></pre></div><p><code>/etc/kubernetes/kubelet-config.yaml</code>는 <code>KubeletConfiguration</code> kind로 Kubelet의 설정 parameter 값들을 정의하고 있다.</p><p><code>/etc/kubernetes/kubelet-config.yaml</code></p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">apiVersion: kubelet.config.k8s.io/v1beta1
</span><span class="code-line">kind: KubeletConfiguration
</span><span class="code-line">nodeStatusUpdateFrequency: <span class="token string">&quot;10s&quot;</span>
</span><span class="code-line">failSwapOn: True
</span><span class="code-line">authentication:
</span><span class="code-line">  anonymous:
</span><span class="code-line">    enabled: <span class="token boolean">false</span>
</span><span class="code-line">  x509:
</span><span class="code-line">    clientCAFile: /etc/kubernetes/ssl/ca.crt
</span><span class="code-line">  webhook:
</span><span class="code-line">    enabled: <span class="token boolean">true</span>
</span><span class="code-line">authorization:
</span><span class="code-line">  mode: Webhook
</span><span class="code-line">staticPodPath: /etc/kubernetes/manifests
</span><span class="code-line">cgroupDriver: systemd
</span><span class="code-line">containerLogMaxFiles: <span class="token number">5</span>
</span><span class="code-line">containerLogMaxSize: 10Mi
</span><span class="code-line">maxPods: <span class="token number">110</span>
</span><span class="code-line">address: 
</span><span class="code-line">readOnlyPort: <span class="token number">0</span>
</span><span class="code-line">healthzPort: <span class="token number">10248</span>
</span><span class="code-line">healthzBindAddress: <span class="token number">127.0</span>.0.1
</span><span class="code-line">kubeletCgroups: /system.slice/kubelet.service
</span><span class="code-line">clusterDomain: cluster.local
</span><span class="code-line">protectKernelDefaults: <span class="token boolean">true</span>
</span><span class="code-line">rotateCertificates: <span class="token boolean">true</span>
</span><span class="code-line">tlsCertFile: /etc/kubernetes/kubelet-server.crt
</span><span class="code-line">tlsPrivateKeyFile: /etc/kubernetes/kubelet-server.key
</span><span class="code-line">clusterDNS:
</span><span class="code-line">evictionHard:
</span><span class="code-line">  memory.available: 100Mi
</span><span class="code-line">  nodefs.available: <span class="token number">10</span>%
</span><span class="code-line">  nodefs.inodesFree: <span class="token number">5</span>%
</span><span class="code-line">  pid.available: <span class="token number">10</span>%
</span><span class="code-line">kubeReserved:
</span><span class="code-line">  cpu: 80m
</span><span class="code-line">  memory: 2877Mi
</span><span class="code-line">resolvConf: <span class="token string">&quot;/run/systemd/resolve/resolv.conf&quot;</span>
</span><span class="code-line">featureGates:
</span><span class="code-line">  CSIVolumeHealth: <span class="token boolean">true</span>
</span><span class="code-line">tlsCipherSuites:
</span><span class="code-line">eventRecordQPS: <span class="token number">5</span>
</span><span class="code-line">shutdownGracePeriod: 60s
</span><span class="code-line">shutdownGracePeriodCriticalPods: 20s
</span></code></pre></div><p>위에 명시적으로 정의되어 있지 않지만, 언제 <code>image manager</code>가 컨테이너 이미지를 정리할지 정하는 파라미터 값인 <code>imageGCHighThresholdPercent</code>와 <code>imageGCLowThresholdPercent</code>이 존재한다. 디스크 사용량이 <code>imageGCHighThresholdPercent</code> 퍼센트보다 높아지면, <code>imageGCLowThresholdPercent</code> 퍼센트까지 디스크 사용량을 줄이기 위해서 컨테이너 이미지를 정리하려고 한다. 해당 설정값은 default로 각각 85, 80으로 설정되어 있다. 따라서 disk 사용량이 85 퍼센트를 넘어가면 컨테이너 이미지를 정리하여 disk 사용량을 줄이는 작업을 하게 된다.</p><h2 id="컨테이너-이미지가-정리되지-않고-꽉-차는-문제"><a href="#컨테이너-이미지가-정리되지-않고-꽉-차는-문제" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>컨테이너 이미지가 정리되지 않고 꽉 차는 문제</h2><p>위에서 containerd의 설정값 <code>root</code>를 변경하여, 컨테이너 이미지가 해당 volume에 저장하도록 설정하였다. 예를 들어서 추가 스토리지를 100GB로 설정했다면, 최종 disk 용량은 150GB(기본 50GB + 추가 100GB)가 된다. <code>imageGCHighThresholdPercent</code>의 기본 설정값 85 퍼센트가 되려면, 128GB이상을 사용해야 한다.</p><p>문제는 컨테이너 이미지를 저장하는 root 경로의 100GB 용량이 거의 꽉 차더라도, 기본 50GB volume에 여유가 있으면 컨테이너 이미지를 정리하려는 프로세스가 trigger되지 않는다. 예를 들어서 컨테이너 이미지가 계속 쌓여서 100GB중에 95GB를 사용하게 되었지만, 기본 volume 50GB중에 15GB만 쓰고 있다면 전체 disk 사용량은 약 73 퍼센트가 된다. 그래서 disk 공간이 부족해서 Pod가 정상적으로 실행될 수 없는 문제를 발생하게 된다.</p><p>따라서 이런 경우에 <code>/etc/kubernetes/kubelet-config.yaml</code>에 설정값을 명시적으로 설정하여 컨테이너 이미지가 정리 될 수 있도록 조정이 필요하다. 아래와 같이 설정하고, systemd 명령어로 kubelet service를 재시작한다. <code>systemctl restart kubelet</code></p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">imageGCHighThresholdPercent: <span class="token number">60</span>
</span><span class="code-line">imageGCLowThresholdPercent: <span class="token number">40</span>
</span></code></pre></div><p>이제 Kubelet 로그를 확인하면, 임계치를 넘어서 image를 정리하는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> journalctl -u kubelet.service -n <span class="token number">100</span>
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">Disk usage on image filesystem is over the high threshold, trying to <span class="token function">free</span> bytes down to the low threshold&quot; <span class="token variable assign-left">usage</span><span class="token operator">=</span><span class="token number">93</span> <span class="token variable assign-left">highThreshold</span><span class="token operator">=</span><span class="token number">60</span> <span class="token variable assign-left">amountToFree</span><span class="token operator">=</span><span class="token number">55522593996</span> <span class="token variable assign-left">lowThreshold</span><span class="token operator">=</span><span class="token number">40</span>
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>Container Image를 최대한 작게 구성하는 것이 Best Practice이다. 하지만 어쩔 수 없이 10GB가 넘는 Container Image를 네이버 클라우드 쿠버네티스 서비스에서 띄울려고 할 때, Disk 크기가 문제가 될 수 있다. 기본 Block Storage 50GB만 제공하기 때문에 Kubelet에 지정된 Disk 최대치를 넘어가서 Pod가 스케쥴링이 안되는 문제가 발생할 수 있거나, Container Image를 정상적으로 pull 받을 수 없어서 장애가 발생할 수 있다. 따라서 Containerd의 설정값을 변경하여 Container Image가 저장되는 경로를 새로 Mount한 Volume으로 지정하여 사용할 수 있다. 그리고 Image manager가 disk 공간을 유지할 수 있도록 <code>imageGCHighThresholdPercent</code>, <code>imageGCLowThresholdPercent</code>를 조절할 수 있다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/ncloud">ncloud</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240420-loki-multi-tenants">Loki multi-tenants</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var c=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var i=a=\u003ec(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{i(a);for(var l in s)c(a,l,{get:s[l],enumerable:!0})},k=(a,s,l)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!p.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026c(a,n,{get:()=\u003es[n],enumerable:!(l=t(s,n))||l.enumerable});return a},b=a=\u003ek(i(c(a!=null?d(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=N((C,r)=\u003e{r.exports=_jsx_runtime});var G={};u(G,{default:()=\u003ef,frontmatter:()=\u003eg});var e=b(o()),g={title:\"Kubelet imageGC\",date:\"2024-04-20\",tags:[\"kubernetes\",\"ncloud\"],images:[\"/static/images/social-banner.png\"],summary:\"\\uC0AC\\uC774\\uC988\\uAC00 \\uD070 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uB0B4\\uB824\\uBC1B\\uAE30 \\uC704\\uD574\\uC11C Containerd\\uC758 \\uC124\\uC815\\uAC12 root\\uC744 \\uC0C8\\uB85C\\uC6B4 \\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uB97C \\uCD94\\uAC00\\uD55C \\uACBD\\uB85C\\uB85C \\uC218\\uC815\\uD558\\uC600\\uB2E4. Kubelet\\uC740 imageGCHighThresholdPercent\\uB85C \\uC124\\uC815\\uB41C \\uC784\\uACC4\\uCE58\\uBCF4\\uB2E4 disk \\uC0AC\\uC6A9\\uB7C9\\uC774 \\uB9CE\\uC73C\\uBA74, \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC815\\uB9AC\\uD558\\uC5EC disk \\uACF5\\uAC04\\uC744 \\uD655\\uBCF4\\uD558\\uB824\\uACE0 \\uD55C\\uB2E4. imageGCHighThresholdPercent\\uC774 \\uAE30\\uBCF8\\uAC12\\uC73C\\uB85C 85\\uB85C \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uACE0, disk\\uC758 85 \\uD37C\\uC13C\\uD2B8 \\uC774\\uC0C1 \\uC0AC\\uC6A9\\uD588\\uC744 \\uB54C \\uC815\\uB9AC \\uD504\\uB85C\\uC138\\uC2A4\\uAC00 \\uC2E4\\uD589\\uB41C\\uB2E4. \\uBB38\\uC81C\\uB294 Containerd root \\uACBD\\uB85C\\uC758 volume\\uC774 \\uAC70\\uC758 \\uAF49 \\uCC28\\uB354\\uB77C\\uB3C4, \\uC804\\uCCB4 volume\\uC758 \\uC0AC\\uC6A9\\uB7C9\\uC740 85 \\uD37C\\uC13C\\uD2B8\\uAC00 \\uB418\\uC9C0 \\uC54A\\uC744 \\uC218 \\uC788\\uB2E4\\uB294 \\uAC83\\uC774\\uB2E4. Containerd root \\uACBD\\uB85C\\uC758 volume\\uC5D0 \\uC5EC\\uC720\\uAC00 \\uC5C6\\uC5B4\\uC11C \\uC0C8\\uB85C \\uC2A4\\uCF00\\uC974\\uB41C Pod\\uC758 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uB0B4\\uB824 \\uBC1B\\uC9C0 \\uBABB\\uD558\\uB294 \\uBB38\\uC81C\\uAC00 \\uBC1C\\uC0DD\\uD560 \\uC218 \\uC788\\uB2E4. imageGCHighThresholdPercent \\uC124\\uC815\\uAC12\\uC744 \\uC870\\uC808\\uD558\\uC5EC \\uC774 \\uBB38\\uC81C\\uB97C \\uD574\\uACB0\\uD560 \\uC218 \\uC788\\uB2E4.\"};function v(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(l,{})})):l();function l(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",blockquote:\"blockquote\",code:\"code\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"\\uD06C\\uAE30\\uAC00-\\uD070-\\uCEE8\\uD14C\\uC774\\uB108-\\uC774\\uBBF8\\uC9C0\\uB97C-\\uC0AC\\uC6A9\",children:[(0,e.jsx)(n.a,{href:\"#\\uD06C\\uAE30\\uAC00-\\uD070-\\uCEE8\\uD14C\\uC774\\uB108-\\uC774\\uBBF8\\uC9C0\\uB97C-\\uC0AC\\uC6A9\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uD06C\\uAE30\\uAC00 \\uD070 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC0AC\\uC6A9\"]}),(0,e.jsx)(n.p,{children:\"\\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC758 \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4 \\uC6CC\\uCEE4 \\uB178\\uB4DC\\uC758 \\uC2A4\\uD1A0\\uB9AC\\uC9C0 \\uD06C\\uAE30\\uAC00 50GB\\uB85C \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB2E4. \\uADF8\\uB807\\uAE30 \\uB54C\\uBB38\\uC5D0 10~20GB \\uD06C\\uAE30\\uC758 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC2E4\\uD589\\uD558\\uB824\\uBA74 \\uB514\\uC2A4\\uD06C \\uC6A9\\uB7C9\\uC774 \\uBD80\\uC871\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC6A9\\uB7C9 \\uBD80\\uC871\\uC744 \\uD574\\uACB0\\uD558\\uAE30 \\uC704\\uD574\\uC11C \\uBE14\\uB85D \\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uB97C \\uC6CC\\uCEE4\\uB178\\uB4DC\\uC5D0 \\uCD94\\uAC00 \\uC0DD\\uC131\\uD558\\uACE0, \\uC0C8\\uB85C \\uC0DD\\uC131\\uD55C \\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uB97C \\uB9C8\\uC6B4\\uD305\\uD55C \\uACBD\\uB85C\\uC5D0 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC800\\uC7A5\\uD558\\uB3C4\\uB85D Containerd \\uC124\\uC815\\uD30C\\uC77C\\uC744 \\uC218\\uC815\\uD558\\uC5EC \\uD574\\uACB0\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/containerd/containerd/blob/main/docs/ops.md\",children:\"containerd\\uC758 \\uBB38\\uC11C\"}),\"\\uB97C \\uD655\\uC778\\uD558\\uBA74 root \\uACBD\\uB85C \\uC635\\uC158\\uC740 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC800\\uC7A5\\uD558\\uB294 \\uACBD\\uB85C\\uB85C \\uC0AC\\uC6A9\\uB418\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"root will be used to store any type of persistent data for containerd. Snapshots, content, metadata for containers and image, as well as any plugin data will be kept in this location.\"})}),(0,e.jsxs)(n.p,{children:[\"\\uC6CC\\uCEE4\\uB178\\uB4DC\\uC758 containerd\\uC758 \\uC124\\uC815\\uD30C\\uC77C root\\uC744 \\uCD94\\uAC00\\uD55C Volume\\uC758 \\uACBD\\uB85C\\uB85C \\uC218\\uC815\\uD558\\uACE0, \",(0,e.jsx)(n.code,{children:\"systemctl restart containerd\"}),\"\\uB85C \\uC7AC\\uC2DC\\uC791\\uD558\\uC5EC \\uC801\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"/etc/containerd/config.toml\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"version \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"root \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"{\\uCD94\\uAC00\\uD55C \\uACBD\\uB85C}\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/run/containerd\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"oom_score \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\\uC0DD\\uB7B5\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C pull \\uBC1B\\uC73C\\uBA74, \",(0,e.jsx)(n.code,{children:\"root\"}),\"\\uC5D0 \\uC124\\uC815\\uB41C \\uACBD\\uB85C\\uB85C \\uC0AC\\uC6A9\\uB41C \\uC6A9\\uB7C9\\uC774 \\uC99D\\uAC00\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ctr -n k8s.io image pull --user \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"ncloud access key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\":\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"ncloud secret key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"conatiner registry \\uC8FC\\uC18C\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"df\"}),` -h\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Filesystem      Size  Used Avail Use% Mounted on\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"/dev/xvdb        98G   37G   57G  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"40\"}),\"% \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"\\uCD94\\uAC00\\uD55C \\uACBD\\uB85C\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"kubelet\\uC758-\\uCEE8\\uD14C\\uC774\\uB108-\\uC774\\uBBF8\\uC9C0-\\uC815\\uB9AC\",children:[(0,e.jsx)(n.a,{href:\"#kubelet\\uC758-\\uCEE8\\uD14C\\uC774\\uB108-\\uC774\\uBBF8\\uC9C0-\\uC815\\uB9AC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kubelet\\uC758 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0 \\uC815\\uB9AC\"]}),(0,e.jsxs)(n.p,{children:[\"\\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4\\uC5D0\\uC11C Kubelet\\uC740 disk \\uC0AC\\uC6A9\\uB7C9\\uC744 \\uCCB4\\uD06C\\uD558\\uC5EC \\uBD88\\uD544\\uC694\\uD55C \\uB370\\uC774\\uD130\\uB97C \\uC81C\\uAC70\\uD55C\\uB2E4. \\uADF8 \\uC911\\uC5D0 \",(0,e.jsx)(n.code,{children:\"image manager\"}),\"\\uB294 disk\\uB97C \\uD2B9\\uC815 \\uD37C\\uC13C\\uD2B8 \\uB9CC\\uD07C \\uC0AC\\uC6A9\\uD558\\uBA74, \\uC815\\uB9AC \\uAC00\\uB2A5\\uD55C \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC815\\uB9AC\\uD558\\uC5EC disk \\uACF5\\uAC04\\uC744 \\uD655\\uBCF4\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:\"Systemd\\uB85C \\uC2E4\\uD589\\uC911\\uC778 Kubelet process\\uC758 \\uC124\\uC815\\uD30C\\uC77C\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ systemctl \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` kubelet\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# /etc/systemd/system/kubelet.service\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Unit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Description\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`Kubernetes Kubelet Server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Documentation\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`https://github.com/GoogleCloudPlatform/kubernetes\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"After\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`containerd.service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Wants\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`containerd.service\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"EnvironmentFile\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`-/etc/kubernetes/kubelet.env\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"ExecStart\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"/usr/local/bin/kubelet \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBE_LOGTOSTDERR\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBE_LOG_LEVEL\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_API_SERVER\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_ADDRESS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_PORT\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_HOSTNAME\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DOCKER_SOCKET\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_NETWORK_PLUGIN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_VOLUME_PLUGIN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_CLOUDPROVIDER\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Restart\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`always\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"RestartSec\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`10s\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Install\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"WantedBy\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`multi-user.target\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"/etc/kubernetes/kubelet.env\"}),\"\\uB97C \\uD655\\uC778\\uD574\\uBCF4\\uBA74, \",(0,e.jsx)(n.code,{children:\"/etc/kubernetes/kubelet-config.yaml\"}),\"\\uB97C \\uC124\\uC815\\uAC12\\uC73C\\uB85C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"/etc/kubernetes/kubelet.env\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\\uC0DD\\uB7B5\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_ARGS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:`\"--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf \\\\\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--config=/etc/kubernetes/kubelet-config.yaml \\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--cloud-provider=external \\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--provider-id='navercloudplatform://2767456' \\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--kubeconfig=/etc/kubernetes/kubelet.conf \\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--runtime-cgroups=/system.slice/containerd.service \\\\\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`--node-labels=ncloud.com/nks-nodepool=example \\\\\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:' --register-with-taints=nvidia.com/gpu=:NoSchedule  \"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_VOLUME_PLUGIN\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"--volume-plugin-dir=/usr/libexec/kubernetes/kubelet-plugins/volume/exec\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_CLOUDPROVIDER\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"PATH\"})}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n`]})]})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"/etc/kubernetes/kubelet-config.yaml\"}),\"\\uB294 \",(0,e.jsx)(n.code,{children:\"KubeletConfiguration\"}),\" kind\\uB85C Kubelet\\uC758 \\uC124\\uC815 parameter \\uAC12\\uB4E4\\uC744 \\uC815\\uC758\\uD558\\uACE0 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"/etc/kubernetes/kubelet-config.yaml\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`apiVersion: kubelet.config.k8s.io/v1beta1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kind: KubeletConfiguration\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"nodeStatusUpdateFrequency: \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10s\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`failSwapOn: True\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`authentication:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  anonymous:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    enabled: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  x509:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    clientCAFile: /etc/kubernetes/ssl/ca.crt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  webhook:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    enabled: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`authorization:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  mode: Webhook\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`staticPodPath: /etc/kubernetes/manifests\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`cgroupDriver: systemd\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"containerLogMaxFiles: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`containerLogMaxSize: 10Mi\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"maxPods: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"110\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`address: \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"readOnlyPort: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"healthzPort: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10248\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"healthzBindAddress: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),`.0.1\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kubeletCgroups: /system.slice/kubelet.service\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`clusterDomain: cluster.local\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"protectKernelDefaults: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"rotateCertificates: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`tlsCertFile: /etc/kubernetes/kubelet-server.crt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`tlsPrivateKeyFile: /etc/kubernetes/kubelet-server.key\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`clusterDNS:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`evictionHard:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  memory.available: 100Mi\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  nodefs.available: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`%\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  nodefs.inodesFree: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),`%\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  pid.available: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`%\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kubeReserved:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  cpu: 80m\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  memory: 2877Mi\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"resolvConf: \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/run/systemd/resolve/resolv.conf\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`featureGates:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  CSIVolumeHealth: \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`tlsCipherSuites:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"eventRecordQPS: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`shutdownGracePeriod: 60s\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`shutdownGracePeriodCriticalPods: 20s\n`})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC704\\uC5D0 \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uC815\\uC758\\uB418\\uC5B4 \\uC788\\uC9C0 \\uC54A\\uC9C0\\uB9CC, \\uC5B8\\uC81C \",(0,e.jsx)(n.code,{children:\"image manager\"}),\"\\uAC00 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC815\\uB9AC\\uD560\\uC9C0 \\uC815\\uD558\\uB294 \\uD30C\\uB77C\\uBBF8\\uD130 \\uAC12\\uC778 \",(0,e.jsx)(n.code,{children:\"imageGCHighThresholdPercent\"}),\"\\uC640 \",(0,e.jsx)(n.code,{children:\"imageGCLowThresholdPercent\"}),\"\\uC774 \\uC874\\uC7AC\\uD55C\\uB2E4. \\uB514\\uC2A4\\uD06C \\uC0AC\\uC6A9\\uB7C9\\uC774 \",(0,e.jsx)(n.code,{children:\"imageGCHighThresholdPercent\"}),\" \\uD37C\\uC13C\\uD2B8\\uBCF4\\uB2E4 \\uB192\\uC544\\uC9C0\\uBA74, \",(0,e.jsx)(n.code,{children:\"imageGCLowThresholdPercent\"}),\" \\uD37C\\uC13C\\uD2B8\\uAE4C\\uC9C0 \\uB514\\uC2A4\\uD06C \\uC0AC\\uC6A9\\uB7C9\\uC744 \\uC904\\uC774\\uAE30 \\uC704\\uD574\\uC11C \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC815\\uB9AC\\uD558\\uB824\\uACE0 \\uD55C\\uB2E4. \\uD574\\uB2F9 \\uC124\\uC815\\uAC12\\uC740 default\\uB85C \\uAC01\\uAC01 85, 80\\uC73C\\uB85C \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C disk \\uC0AC\\uC6A9\\uB7C9\\uC774 85 \\uD37C\\uC13C\\uD2B8\\uB97C \\uB118\\uC5B4\\uAC00\\uBA74 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC815\\uB9AC\\uD558\\uC5EC disk \\uC0AC\\uC6A9\\uB7C9\\uC744 \\uC904\\uC774\\uB294 \\uC791\\uC5C5\\uC744 \\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"\\uCEE8\\uD14C\\uC774\\uB108-\\uC774\\uBBF8\\uC9C0\\uAC00-\\uC815\\uB9AC\\uB418\\uC9C0-\\uC54A\\uACE0-\\uAF49-\\uCC28\\uB294-\\uBB38\\uC81C\",children:[(0,e.jsx)(n.a,{href:\"#\\uCEE8\\uD14C\\uC774\\uB108-\\uC774\\uBBF8\\uC9C0\\uAC00-\\uC815\\uB9AC\\uB418\\uC9C0-\\uC54A\\uACE0-\\uAF49-\\uCC28\\uB294-\\uBB38\\uC81C\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uAC00 \\uC815\\uB9AC\\uB418\\uC9C0 \\uC54A\\uACE0 \\uAF49 \\uCC28\\uB294 \\uBB38\\uC81C\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC704\\uC5D0\\uC11C containerd\\uC758 \\uC124\\uC815\\uAC12 \",(0,e.jsx)(n.code,{children:\"root\"}),\"\\uB97C \\uBCC0\\uACBD\\uD558\\uC5EC, \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uAC00 \\uD574\\uB2F9 volume\\uC5D0 \\uC800\\uC7A5\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD558\\uC600\\uB2E4. \\uC608\\uB97C \\uB4E4\\uC5B4\\uC11C \\uCD94\\uAC00 \\uC2A4\\uD1A0\\uB9AC\\uC9C0\\uB97C 100GB\\uB85C \\uC124\\uC815\\uD588\\uB2E4\\uBA74, \\uCD5C\\uC885 disk \\uC6A9\\uB7C9\\uC740 150GB(\\uAE30\\uBCF8 50GB + \\uCD94\\uAC00 100GB)\\uAC00 \\uB41C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"imageGCHighThresholdPercent\"}),\"\\uC758 \\uAE30\\uBCF8 \\uC124\\uC815\\uAC12 85 \\uD37C\\uC13C\\uD2B8\\uAC00 \\uB418\\uB824\\uBA74, 128GB\\uC774\\uC0C1\\uC744 \\uC0AC\\uC6A9\\uD574\\uC57C \\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:\"\\uBB38\\uC81C\\uB294 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC800\\uC7A5\\uD558\\uB294 root \\uACBD\\uB85C\\uC758 100GB \\uC6A9\\uB7C9\\uC774 \\uAC70\\uC758 \\uAF49 \\uCC28\\uB354\\uB77C\\uB3C4, \\uAE30\\uBCF8 50GB volume\\uC5D0 \\uC5EC\\uC720\\uAC00 \\uC788\\uC73C\\uBA74 \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC815\\uB9AC\\uD558\\uB824\\uB294 \\uD504\\uB85C\\uC138\\uC2A4\\uAC00 trigger\\uB418\\uC9C0 \\uC54A\\uB294\\uB2E4. \\uC608\\uB97C \\uB4E4\\uC5B4\\uC11C \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uAC00 \\uACC4\\uC18D \\uC313\\uC5EC\\uC11C 100GB\\uC911\\uC5D0 95GB\\uB97C \\uC0AC\\uC6A9\\uD558\\uAC8C \\uB418\\uC5C8\\uC9C0\\uB9CC, \\uAE30\\uBCF8 volume 50GB\\uC911\\uC5D0 15GB\\uB9CC \\uC4F0\\uACE0 \\uC788\\uB2E4\\uBA74 \\uC804\\uCCB4 disk \\uC0AC\\uC6A9\\uB7C9\\uC740 \\uC57D 73 \\uD37C\\uC13C\\uD2B8\\uAC00 \\uB41C\\uB2E4. \\uADF8\\uB798\\uC11C disk \\uACF5\\uAC04\\uC774 \\uBD80\\uC871\\uD574\\uC11C Pod\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC2E4\\uD589\\uB420 \\uC218 \\uC5C6\\uB294 \\uBB38\\uC81C\\uB97C \\uBC1C\\uC0DD\\uD558\\uAC8C \\uB41C\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[\"\\uB530\\uB77C\\uC11C \\uC774\\uB7F0 \\uACBD\\uC6B0\\uC5D0 \",(0,e.jsx)(n.code,{children:\"/etc/kubernetes/kubelet-config.yaml\"}),\"\\uC5D0 \\uC124\\uC815\\uAC12\\uC744 \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uC124\\uC815\\uD558\\uC5EC \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uAC00 \\uC815\\uB9AC \\uB420 \\uC218 \\uC788\\uB3C4\\uB85D \\uC870\\uC815\\uC774 \\uD544\\uC694\\uD558\\uB2E4. \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uD558\\uACE0, systemd \\uBA85\\uB839\\uC5B4\\uB85C kubelet service\\uB97C \\uC7AC\\uC2DC\\uC791\\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"systemctl restart kubelet\"})]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"imageGCHighThresholdPercent: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"imageGCLowThresholdPercent: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"40\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C Kubelet \\uB85C\\uADF8\\uB97C \\uD655\\uC778\\uD558\\uBA74, \\uC784\\uACC4\\uCE58\\uB97C \\uB118\\uC5B4\\uC11C image\\uB97C \\uC815\\uB9AC\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" journalctl -u kubelet.service -n \",(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),`\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Disk usage on image filesystem is over the high threshold, trying to \",(0,e.jsx)(n.span,{className:\"token function\",children:\"free\"}),' bytes down to the low threshold\" ',(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"usage\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"93\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"highThreshold\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"amountToFree\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"55522593996\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"lowThreshold\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"40\"}),`\n`]})})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsxs)(n.p,{children:[\"Container Image\\uB97C \\uCD5C\\uB300\\uD55C \\uC791\\uAC8C \\uAD6C\\uC131\\uD558\\uB294 \\uAC83\\uC774 Best Practice\\uC774\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uC5B4\\uCA54 \\uC218 \\uC5C6\\uC774 10GB\\uAC00 \\uB118\\uB294 Container Image\\uB97C \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4 \\uC11C\\uBE44\\uC2A4\\uC5D0\\uC11C \\uB744\\uC6B8\\uB824\\uACE0 \\uD560 \\uB54C, Disk \\uD06C\\uAE30\\uAC00 \\uBB38\\uC81C\\uAC00 \\uB420 \\uC218 \\uC788\\uB2E4. \\uAE30\\uBCF8 Block Storage 50GB\\uB9CC \\uC81C\\uACF5\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 Kubelet\\uC5D0 \\uC9C0\\uC815\\uB41C Disk \\uCD5C\\uB300\\uCE58\\uB97C \\uB118\\uC5B4\\uAC00\\uC11C Pod\\uAC00 \\uC2A4\\uCF00\\uC974\\uB9C1\\uC774 \\uC548\\uB418\\uB294 \\uBB38\\uC81C\\uAC00 \\uBC1C\\uC0DD\\uD560 \\uC218 \\uC788\\uAC70\\uB098, Container Image\\uB97C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C pull \\uBC1B\\uC744 \\uC218 \\uC5C6\\uC5B4\\uC11C \\uC7A5\\uC560\\uAC00 \\uBC1C\\uC0DD\\uD560 \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C Containerd\\uC758 \\uC124\\uC815\\uAC12\\uC744 \\uBCC0\\uACBD\\uD558\\uC5EC Container Image\\uAC00 \\uC800\\uC7A5\\uB418\\uB294 \\uACBD\\uB85C\\uB97C \\uC0C8\\uB85C Mount\\uD55C Volume\\uC73C\\uB85C \\uC9C0\\uC815\\uD558\\uC5EC \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 Image manager\\uAC00 disk \\uACF5\\uAC04\\uC744 \\uC720\\uC9C0\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \",(0,e.jsx)(n.code,{children:\"imageGCHighThresholdPercent\"}),\", \",(0,e.jsx)(n.code,{children:\"imageGCLowThresholdPercent\"}),\"\\uB97C \\uC870\\uC808\\uD560 \\uC218 \\uC788\\uB2E4.\"]})]})}}var f=v;return G;})();\n;return Component;","toc":[{"value":"크기가 큰 컨테이너 이미지를 사용","url":"#크기가-큰-컨테이너-이미지를-사용","depth":2},{"value":"Kubelet의 컨테이너 이미지 정리","url":"#kubelet의-컨테이너-이미지-정리","depth":2},{"value":"컨테이너 이미지가 정리되지 않고 꽉 차는 문제","url":"#컨테이너-이미지가-정리되지-않고-꽉-차는-문제","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.825,"time":289500,"words":965},"slug":"20240420-kubelet-imagegc","fileName":"20240420-kubelet-imagegc.md","title":"Kubelet imageGC","date":"2024-04-20T00:00:00.000Z","tags":["kubernetes","ncloud"],"images":["/static/images/social-banner.png"],"summary":"사이즈가 큰 컨테이너 이미지를 내려받기 위해서 Containerd의 설정값 root을 새로운 스토리지를 추가한 경로로 수정하였다. Kubelet은 imageGCHighThresholdPercent로 설정된 임계치보다 disk 사용량이 많으면, 컨테이너 이미지를 정리하여 disk 공간을 확보하려고 한다. imageGCHighThresholdPercent이 기본값으로 85로 설정되어 있고, disk의 85 퍼센트 이상 사용했을 때 정리 프로세스가 실행된다. 문제는 Containerd root 경로의 volume이 거의 꽉 차더라도, 전체 volume의 사용량은 85 퍼센트가 되지 않을 수 있다는 것이다. Containerd root 경로의 volume에 여유가 없어서 새로 스케쥴된 Pod의 컨테이너 이미지를 내려 받지 못하는 문제가 발생할 수 있다. imageGCHighThresholdPercent 설정값을 조절하여 이 문제를 해결할 수 있다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Loki multi-tenants","date":"2024-04-20T00:00:00.000Z","tags":["kubernetes"],"images":["/static/images/social-banner.png"],"summary":"","slug":"20240420-loki-multi-tenants"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20240420-kubelet-imagegc"]},"buildId":"EVGw9w9cVqQ1I13StpVYa","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>