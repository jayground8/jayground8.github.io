<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry</title><meta name="robots" content="follow, index"/><meta name="description" content="My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data."/><meta property="og:url" content="https://jayground8.github.io/blog/20250724-nodejs-trace-database-data"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data."/><meta property="og:title" content="Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry"/><meta property="og:image" content="https://jayground8.github.io/static/images/thumbnail/trace-data.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry"/><meta name="twitter:description" content="My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/thumbnail/trace-data.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20250724-nodejs-trace-database-data"/><meta property="article:published_time" content="2025-07-24T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20250724-nodejs-trace-database-data"
  },
  "headline": "Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/thumbnail/trace-data.png"
    }
  ],
  "datePublished": "2025-07-24T00:00:00.000Z",
  "dateModified": "2025-07-24T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7b281fb55ef8153b.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/pgk04D_iZGZPDfMeQaKFq/_buildManifest.js" defer=""></script><script src="/_next/static/pgk04D_iZGZPDfMeQaKFq/_ssgManifest.js" defer=""></script><script src="/_next/static/pgk04D_iZGZPDfMeQaKFq/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-07-24T00:00:00.000Z">Thursday, July 24, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>I have applications running on GKE (Google Kubernetes Engine), and I’ve configured OpenTelemetry to collect telemetry data—including logs, metrics, and traces. In other cloud environments, I used tools like Tempo, Loki, and Thanos to store this telemetry data.</p><p>However, Google Cloud offers a fully managed monitoring service that can significantly reduce the operational overhead of running these tools yourself. Thanks to the <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/v0.130.0/exporter/googlecloudexporter/README.md">Google Cloud Exporter</a>, integrating with the OpenTelemetry Collector is straightforward.</p><p>Everything was working well and the setup was simple. But then I noticed something odd in the trace data later. That’s where my story begins.</p><h2 id="unexpected-jdbc-format-in-nodejs-trace-data"><a href="#unexpected-jdbc-format-in-nodejs-trace-data" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Unexpected JDBC Format in Node.js Trace Data</h2><p>While analyzing trace data from a Node.js application, I noticed something odd in the <code>db.connection_string</code> attribute:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">jdbc:mysql://127.0.0.1:3306/my_db
</span></code></pre></div><p>Wait, JDBC? That caught me off guard. why is a Node.js application emitting a JDBC-style connection string?</p><p>The trace was generated by the <a target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/package/@opentelemetry/instrumentation-mysql2">mysql2 instrumentation package</a>. Naturally, I wanted to understand why a JDBC prefix was appearing in trace data from a JavaScript runtime. So I did some digging.</p><p>It turns out the MySQL2 instrumentation itself generates this format! <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-js-contrib/blob/winston-transport-v0.14.0/packages/instrumentation-mysql2/src/utils.ts">Here’s the relevant code from the library</a>:</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getConnectionAttributes</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token operator">:</span> <span class="token maybe-class-name">Config</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Attributes</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> database<span class="token punctuation">,</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> portNumber <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>portNumber<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_NET_PEER_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> host<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_NET_PEER_PORT</span><span class="token punctuation">]</span><span class="token operator">:</span> portNumber<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_CONNECTION_STRING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">getJDBCString</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> database<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_USER</span><span class="token punctuation">]</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_NET_PEER_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> host<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_CONNECTION_STRING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">getJDBCString</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> database<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_USER</span><span class="token punctuation">]</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>As you can see, the instrumentation calls <code>getJDBCString</code> to generate the connection string, even in a Node.js context.</p><p>But why did they choose to use a JDBC-style format?</p><p>To investigate further, I checked <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-js-contrib/blob/instrumentation-mysql2-v0.49.0/packages/instrumentation-mysql2/README.md">the README of the MySQL2 instrumentation package</a>. It states:</p><blockquote><p>This package uses @opentelemetry/semantic-conventions version 1.22+, which implements Semantic Convention Version 1.7.0</p></blockquote><p>So I followed the trail to <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-specification/blob/v1.7.0/semantic_conventions/trace/database.yaml">the OpenTelemetry Specification for Semantic Conventions v1.7.0</a>, specifically the section related to databases. Here’s the relevant snippet:</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> connection_string
</span><span class="code-line">	<span class="token atrule key">tag</span><span class="token punctuation">:</span> connection<span class="token punctuation">-</span>level
</span><span class="code-line">	<span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">	<span class="token atrule key">brief</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">			The connection string used to connect to the database.
</span></span><span class="code-line"><span class="token string scalar">			It is recommended to remove embedded credentials.</span>
</span><span class="code-line">	<span class="token atrule key">examples</span><span class="token punctuation">:</span> <span class="token string">&#x27;Server=(localdb)\v11.0;Integrated Security=true;&#x27;</span>
</span></code></pre></div><p>Unfortunately, it doesn’t directly mention the JDBC format. Still curious, I browsed through related GitHub issues and eventually found <a target="_blank" rel="noopener noreferrer" href="https://github.com/open-telemetry/opentelemetry-js-contrib/issues/473">this one</a>, which indirectly suggested that earlier specifications or conventions may have encouraged using JDBC-style strings—even outside of Java environments.</p><p>So in the end, it turns out that seeing a JDBC-style connection string in Node.js trace data is normal behavior, at least when using this instrumentation. It’s hardcoded by the library itself.</p><h2 id="dbstatement-information-was-truncated"><a href="#dbstatement-information-was-truncated" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>db.statement</code> information Was Truncated</h2><p>I discovered a limitation with the GCP-managed Cloud Trace service: the <code>db.statement</code> attribute was being truncated. This attribute is particularly useful for identifying which query a client is executing for each URL, but in GCP Cloud Trace, the query information was incomplete and cut off.</p><p>According to <a target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/trace/docs/quotas">the GCP official documentation</a>, there’s a strict limit:</p><blockquote><p>Maximum size of value for a label or attribute: 256 bytes</p></blockquote><p>This explains why the full SQL query wasn’t visible in the trace.</p><h2 id="dbname-is-not-following-the-spec"><a href="#dbname-is-not-following-the-spec" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>db.name</code> Is Not Following the Spec</h2><p>Since I couldn’t always determine which database a client was querying based solely on the (truncated) <code>db.statement</code>, I started paying more attention to the <code>db.name</code> attribute.</p><p>Even if you configure a single database for the initial connection using the mysql2 library, you can still issue queries to other logical databases. According to the OpenTelemetry semantic conventions (version 1.7.0), the <code>db.name</code> attribute is <code>call-level</code> and should reflect the actual database targeted by a given statement.</p><p>From the spec:</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token punctuation">-</span> <span class="token atrule key">id</span><span class="token punctuation">:</span> name
</span><span class="code-line">	<span class="token atrule key">tag</span><span class="token punctuation">:</span> call<span class="token punctuation">-</span>level
</span><span class="code-line">	<span class="token atrule key">type</span><span class="token punctuation">:</span> string
</span><span class="code-line">	<span class="token atrule key">required</span><span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token atrule key">conditional</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">			Required, if applicable and no more-specific attribute is defined.</span>
</span><span class="code-line">	<span class="token atrule key">brief</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		If no [tech-specific attribute](#call-level-attributes-for-specific-technologies)
</span></span><span class="code-line"><span class="token string scalar">		is defined, this attribute is used to report the name of the database being accessed.
</span></span><span class="code-line"><span class="token string scalar">		For commands that switch the database, this should be set to the target database
</span></span><span class="code-line"><span class="token string scalar">		(even if the command fails).</span>
</span><span class="code-line">	<span class="token atrule key">note</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">		In some SQL databases, the database name to be used is called &quot;schema name&quot;.</span>
</span><span class="code-line">	<span class="token atrule key">examples</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&#x27;customers&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;main&#x27;</span> <span class="token punctuation">]</span>
</span></code></pre></div><p>So what happens when you run a query like this?</p><div class="relative"><pre><code class="code-highlight language-sql"><span class="code-line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>other_db<span class="token punctuation">.</span>some_table<span class="token punctuation">`</span><span class="token punctuation">;</span>
</span></code></pre></div><p>According to the spec, the <code>db.name</code> should be <code>other_db</code>. However, in practice, <code>db.name</code> always reflects the database configured during the initial connection.</p><p>This behavior can be traced to the implementation of the mysql2 instrumentation package, which sets <code>db.name</code> based on the connection config rather than parsing the query dynamically:</p><div class="relative"><pre><code class="code-highlight language-js"><span class="code-line"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">getConnectionAttributes</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token operator">:</span> <span class="token maybe-class-name">Config</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Attributes</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> database<span class="token punctuation">,</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> portNumber <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>portNumber<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_NET_PEER_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> host<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_NET_PEER_PORT</span><span class="token punctuation">]</span><span class="token operator">:</span> portNumber<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_CONNECTION_STRING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">getJDBCString</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> database<span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_USER</span><span class="token punctuation">]</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_NET_PEER_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> host<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_CONNECTION_STRING</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">getJDBCString</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_NAME</span><span class="token punctuation">]</span><span class="token operator">:</span> database<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span><span class="token constant">SEMATTRS_DB_USER</span><span class="token punctuation">]</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This means that even if you query a different logical database, the instrumentation will always report the original connection database as <code>db.name</code>.</p><h2 id="attributes-were-not-consistent-from-the-same-source"><a href="#attributes-were-not-consistent-from-the-same-source" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Attributes Were Not Consistent from the Same Source</h2><p>I noticed another strange behavior in GCP Cloud Trace: the attribute keys in the trace data were not consistent. Initially, I assumed that this might be because two different sources were sending trace data. However, the real cause turned out to be a strict limitation in GCP Cloud Trace:</p><blockquote><p>Maximum number of labels or attributes per span: 32</p></blockquote><p>Since the spans had more than 32 attributes, Cloud Trace may simply drop the excess ones. Because the order of attributes isn’t guaranteed, it might drop different attributes even for spans from the same source. As a result, the attributes displayed in the UI can vary between otherwise identical spans, giving the impression that the attribute keys are inconsistent.</p><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h2><p>I noticed some odd behavior in the trace data from GCP Cloud Trace and initially suspected that my system wasn’t storing trace data correctly. In the end, there was no issue with my setup. The problem came from the mysql2 instrumentation package, which strictly adheres to OpenTelemetry Specification <code>v1.7.0</code> and sets the JDBC string format to the <code>db.connection_string</code> attribute.</p><p>Due to GCP Cloud Trace limits—specifically, the maximum size of an attribute value and the maximum number of attributes per span—some attribute values were truncated, and others were dropped entirely. This made the trace data appear inconsistent, even though it came from a single, identical source.</p><p>While digging deeper to understand the issue, I also noticed that the <code>db.name</code> attribute is defined at the call level in the OpenTelemetry spec. However, the mysql2 instrumentation doesn’t fully follow this when you’re querying other logical databases from the same application. This could be an interesting problem to explore further—perhaps as a future side project to improve the library.</p><p>Another idea that came to mind: it would be useful if users could choose which version of the semantic conventions an instrumentation library follows. At the time of writing, the latest OpenTelemetry specification version is <code>v1.36.0</code>, while the <code>db.connection_string</code> attribute was removed in <code>v1.25.0</code>.</p><p>I understand that upgrading to newer spec versions is difficult due to compatibility concerns. especially if your monitoring systems rely on certain attributes. But currently, for example, the mysql2 instrumentation is locked into <code>v1.7.0</code>. What if the library allowed users to select a semantic version, and the instrumentation adapted its behavior accordingly?</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/opentelemetry">opentelemetry</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/nodejs">nodejs</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250722-sentry-saml2">Configuring Sentry&#x27;s SAML2 Provider with Keycloak</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250726-openvpn-oidc">Adding OIDC Authentication to OpenVPN Community Server</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003ec(a,\"__esModule\",{value:!0});var u=(a,t)=\u003e()=\u003e(t||a((t={exports:{}}).exports,t),t.exports),N=(a,t)=\u003e{i(a);for(var s in t)c(a,s,{get:t[s],enumerable:!0})},k=(a,t,s)=\u003e{if(t\u0026\u0026typeof t==\"object\"||typeof t==\"function\")for(let n of p(t))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026c(a,n,{get:()=\u003et[n],enumerable:!(s=d(t,n))||s.enumerable});return a},g=a=\u003ek(i(c(a!=null?r(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var l=u((v,o)=\u003e{o.exports=_jsx_runtime});var w={};N(w,{default:()=\u003ef,frontmatter:()=\u003eb});var e=g(l()),b={title:\"Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry\",date:\"2025-07-24\",tags:[\"opentelemetry\",\"nodejs\"],images:[\"/static/images/thumbnail/trace-data.png\"],summary:\"My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data.\"};function y(a={}){let{wrapper:t}=a.components||{};return t?(0,e.jsx)(t,Object.assign({},a,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",code:\"code\",pre:\"pre\",blockquote:\"blockquote\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"I have applications running on GKE (Google Kubernetes Engine), and I\\u2019ve configured OpenTelemetry to collect telemetry data\\u2014including logs, metrics, and traces. In other cloud environments, I used tools like Tempo, Loki, and Thanos to store this telemetry data.\"}),(0,e.jsxs)(n.p,{children:[\"However, Google Cloud offers a fully managed monitoring service that can significantly reduce the operational overhead of running these tools yourself. Thanks to the \",(0,e.jsx)(n.a,{href:\"https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/v0.130.0/exporter/googlecloudexporter/README.md\",children:\"Google Cloud Exporter\"}),\", integrating with the OpenTelemetry Collector is straightforward.\"]}),(0,e.jsx)(n.p,{children:\"Everything was working well and the setup was simple. But then I noticed something odd in the trace data later. That\\u2019s where my story begins.\"}),(0,e.jsxs)(n.h2,{id:\"unexpected-jdbc-format-in-nodejs-trace-data\",children:[(0,e.jsx)(n.a,{href:\"#unexpected-jdbc-format-in-nodejs-trace-data\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Unexpected JDBC Format in Node.js Trace Data\"]}),(0,e.jsxs)(n.p,{children:[\"While analyzing trace data from a Node.js application, I noticed something odd in the \",(0,e.jsx)(n.code,{children:\"db.connection_string\"}),\" attribute:\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`jdbc:mysql://127.0.0.1:3306/my_db\n`})})}),(0,e.jsx)(n.p,{children:\"Wait, JDBC? That caught me off guard. why is a Node.js application emitting a JDBC-style connection string?\"}),(0,e.jsxs)(n.p,{children:[\"The trace was generated by the \",(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/@opentelemetry/instrumentation-mysql2\",children:\"mysql2 instrumentation package\"}),\". Naturally, I wanted to understand why a JDBC prefix was appearing in trace data from a JavaScript runtime. So I did some digging.\"]}),(0,e.jsxs)(n.p,{children:[\"It turns out the MySQL2 instrumentation itself generates this format! \",(0,e.jsx)(n.a,{href:\"https://github.com/open-telemetry/opentelemetry-js-contrib/blob/winston-transport-v0.14.0/packages/instrumentation-mysql2/src/utils.ts\",children:\"Here\\u2019s the relevant code from the library\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-js\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getConnectionAttributes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token parameter\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Config\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Attributes\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" user \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" portNumber \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"parseInt\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"isNaN\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"portNumber\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_NET_PEER_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_NET_PEER_PORT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" portNumber\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_CONNECTION_STRING\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getJDBCString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_USER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_NET_PEER_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_CONNECTION_STRING\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getJDBCString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_USER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"As you can see, the instrumentation calls \",(0,e.jsx)(n.code,{children:\"getJDBCString\"}),\" to generate the connection string, even in a Node.js context.\"]}),(0,e.jsx)(n.p,{children:\"But why did they choose to use a JDBC-style format?\"}),(0,e.jsxs)(n.p,{children:[\"To investigate further, I checked \",(0,e.jsx)(n.a,{href:\"https://github.com/open-telemetry/opentelemetry-js-contrib/blob/instrumentation-mysql2-v0.49.0/packages/instrumentation-mysql2/README.md\",children:\"the README of the MySQL2 instrumentation package\"}),\". It states:\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"This package uses @opentelemetry/semantic-conventions version 1.22+, which implements Semantic Convention Version 1.7.0\"})}),(0,e.jsxs)(n.p,{children:[\"So I followed the trail to \",(0,e.jsx)(n.a,{href:\"https://github.com/open-telemetry/opentelemetry-specification/blob/v1.7.0/semantic_conventions/trace/database.yaml\",children:\"the OpenTelemetry Specification for Semantic Conventions v1.7.0\"}),\", specifically the section related to databases. Here\\u2019s the relevant snippet:\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"id\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` connection_string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"tag\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" connection\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`level\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"brief\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\t\tThe connection string used to connect to the database.\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\t\tIt is recommended to remove embedded credentials.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"examples\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Server=(localdb)\\\\v11.0;Integrated Security=true;'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Unfortunately, it doesn\\u2019t directly mention the JDBC format. Still curious, I browsed through related GitHub issues and eventually found \",(0,e.jsx)(n.a,{href:\"https://github.com/open-telemetry/opentelemetry-js-contrib/issues/473\",children:\"this one\"}),\", which indirectly suggested that earlier specifications or conventions may have encouraged using JDBC-style strings\\u2014even outside of Java environments.\"]}),(0,e.jsx)(n.p,{children:\"So in the end, it turns out that seeing a JDBC-style connection string in Node.js trace data is normal behavior, at least when using this instrumentation. It\\u2019s hardcoded by the library itself.\"}),(0,e.jsxs)(n.h2,{id:\"dbstatement-information-was-truncated\",children:[(0,e.jsx)(n.a,{href:\"#dbstatement-information-was-truncated\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),(0,e.jsx)(n.code,{children:\"db.statement\"}),\" information Was Truncated\"]}),(0,e.jsxs)(n.p,{children:[\"I discovered a limitation with the GCP-managed Cloud Trace service: the \",(0,e.jsx)(n.code,{children:\"db.statement\"}),\" attribute was being truncated. This attribute is particularly useful for identifying which query a client is executing for each URL, but in GCP Cloud Trace, the query information was incomplete and cut off.\"]}),(0,e.jsxs)(n.p,{children:[\"According to \",(0,e.jsx)(n.a,{href:\"https://cloud.google.com/trace/docs/quotas\",children:\"the GCP official documentation\"}),\", there\\u2019s a strict limit:\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Maximum size of value for a label or attribute: 256 bytes\"})}),(0,e.jsx)(n.p,{children:\"This explains why the full SQL query wasn\\u2019t visible in the trace.\"}),(0,e.jsxs)(n.h2,{id:\"dbname-is-not-following-the-spec\",children:[(0,e.jsx)(n.a,{href:\"#dbname-is-not-following-the-spec\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),(0,e.jsx)(n.code,{children:\"db.name\"}),\" Is Not Following the Spec\"]}),(0,e.jsxs)(n.p,{children:[\"Since I couldn\\u2019t always determine which database a client was querying based solely on the (truncated) \",(0,e.jsx)(n.code,{children:\"db.statement\"}),\", I started paying more attention to the \",(0,e.jsx)(n.code,{children:\"db.name\"}),\" attribute.\"]}),(0,e.jsxs)(n.p,{children:[\"Even if you configure a single database for the initial connection using the mysql2 library, you can still issue queries to other logical databases. According to the OpenTelemetry semantic conventions (version 1.7.0), the \",(0,e.jsx)(n.code,{children:\"db.name\"}),\" attribute is \",(0,e.jsx)(n.code,{children:\"call-level\"}),\" and should reflect the actual database targeted by a given statement.\"]}),(0,e.jsx)(n.p,{children:\"From the spec:\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"id\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"tag\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" call\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`level\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"required\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"conditional\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\t\tRequired, if applicable and no more-specific attribute is defined.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"brief\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tIf no [tech-specific attribute](#call-level-attributes-for-specific-technologies)\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tis defined, this attribute is used to report the name of the database being accessed.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\t\tFor commands that switch the database, this should be set to the target database\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"\t\t(even if the command fails).\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"note\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:'\t\tIn some SQL databases, the database name to be used is called \"schema name\".'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"examples\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'customers'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'main'\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"So what happens when you run a query like this?\"}),(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-sql\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"`\"}),\"other_db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"some_table\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,e.jsxs)(n.p,{children:[\"According to the spec, the \",(0,e.jsx)(n.code,{children:\"db.name\"}),\" should be \",(0,e.jsx)(n.code,{children:\"other_db\"}),\". However, in practice, \",(0,e.jsx)(n.code,{children:\"db.name\"}),\" always reflects the database configured during the initial connection.\"]}),(0,e.jsxs)(n.p,{children:[\"This behavior can be traced to the implementation of the mysql2 instrumentation package, which sets \",(0,e.jsx)(n.code,{children:\"db.name\"}),\" based on the connection config rather than parsing the query dynamically:\"]}),(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-js\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getConnectionAttributes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token parameter\",children:[\"config\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Config\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Attributes\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" user \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" portNumber \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"parseInt\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"isNaN\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"portNumber\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_NET_PEER_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_NET_PEER_PORT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" portNumber\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_CONNECTION_STRING\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getJDBCString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_USER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_NET_PEER_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_CONNECTION_STRING\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getJDBCString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_NAME\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"SEMATTRS_DB_USER\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"This means that even if you query a different logical database, the instrumentation will always report the original connection database as \",(0,e.jsx)(n.code,{children:\"db.name\"}),\".\"]}),(0,e.jsxs)(n.h2,{id:\"attributes-were-not-consistent-from-the-same-source\",children:[(0,e.jsx)(n.a,{href:\"#attributes-were-not-consistent-from-the-same-source\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Attributes Were Not Consistent from the Same Source\"]}),(0,e.jsx)(n.p,{children:\"I noticed another strange behavior in GCP Cloud Trace: the attribute keys in the trace data were not consistent. Initially, I assumed that this might be because two different sources were sending trace data. However, the real cause turned out to be a strict limitation in GCP Cloud Trace:\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Maximum number of labels or attributes per span: 32\"})}),(0,e.jsx)(n.p,{children:\"Since the spans had more than 32 attributes, Cloud Trace may simply drop the excess ones. Because the order of attributes isn\\u2019t guaranteed, it might drop different attributes even for spans from the same source. As a result, the attributes displayed in the UI can vary between otherwise identical spans, giving the impression that the attribute keys are inconsistent.\"}),(0,e.jsxs)(n.h2,{id:\"conclusion\",children:[(0,e.jsx)(n.a,{href:\"#conclusion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),(0,e.jsxs)(n.p,{children:[\"I noticed some odd behavior in the trace data from GCP Cloud Trace and initially suspected that my system wasn\\u2019t storing trace data correctly. In the end, there was no issue with my setup. The problem came from the mysql2 instrumentation package, which strictly adheres to OpenTelemetry Specification \",(0,e.jsx)(n.code,{children:\"v1.7.0\"}),\" and sets the JDBC string format to the \",(0,e.jsx)(n.code,{children:\"db.connection_string\"}),\" attribute.\"]}),(0,e.jsx)(n.p,{children:\"Due to GCP Cloud Trace limits\\u2014specifically, the maximum size of an attribute value and the maximum number of attributes per span\\u2014some attribute values were truncated, and others were dropped entirely. This made the trace data appear inconsistent, even though it came from a single, identical source.\"}),(0,e.jsxs)(n.p,{children:[\"While digging deeper to understand the issue, I also noticed that the \",(0,e.jsx)(n.code,{children:\"db.name\"}),\" attribute is defined at the call level in the OpenTelemetry spec. However, the mysql2 instrumentation doesn\\u2019t fully follow this when you\\u2019re querying other logical databases from the same application. This could be an interesting problem to explore further\\u2014perhaps as a future side project to improve the library.\"]}),(0,e.jsxs)(n.p,{children:[\"Another idea that came to mind: it would be useful if users could choose which version of the semantic conventions an instrumentation library follows. At the time of writing, the latest OpenTelemetry specification version is \",(0,e.jsx)(n.code,{children:\"v1.36.0\"}),\", while the \",(0,e.jsx)(n.code,{children:\"db.connection_string\"}),\" attribute was removed in \",(0,e.jsx)(n.code,{children:\"v1.25.0\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"I understand that upgrading to newer spec versions is difficult due to compatibility concerns. especially if your monitoring systems rely on certain attributes. But currently, for example, the mysql2 instrumentation is locked into \",(0,e.jsx)(n.code,{children:\"v1.7.0\"}),\". What if the library allowed users to select a semantic version, and the instrumentation adapted its behavior accordingly?\"]})]})}}var f=y;return w;})();\n;return Component;","toc":[{"value":"Unexpected JDBC Format in Node.js Trace Data","url":"#unexpected-jdbc-format-in-nodejs-trace-data","depth":2},{"value":"db.statement information Was Truncated","url":"#dbstatement-information-was-truncated","depth":2},{"value":"db.name Is Not Following the Spec","url":"#dbname-is-not-following-the-spec","depth":2},{"value":"Attributes Were Not Consistent from the Same Source","url":"#attributes-were-not-consistent-from-the-same-source","depth":2},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.105,"time":486300,"words":1621},"slug":"20250724-nodejs-trace-database-data","fileName":"20250724-nodejs-trace-database-data.md","title":"Unexpected Trace Data Behavior in Google Cloud Trace with OpenTelemetry","date":"2025-07-24T00:00:00.000Z","tags":["opentelemetry","nodejs"],"images":["/static/images/thumbnail/trace-data.png"],"summary":"My system exports telemetry data from a Node.js application using OpenTelemetry. I configured the OpenTelemetry Collector to send that data to a GCP-managed service via the Google Cloud Exporter. Later, while reviewing database query information from the application, I noticed something odd in the trace data. As I dug deeper, I discovered some limitations of GCP Cloud Trace and how the mysql2 instrumentation package sets attribute values. That investigation helped explain the strange behavior I was seeing in the trace data."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Configuring Sentry's SAML2 Provider with Keycloak","date":"2025-07-22T00:00:00.000Z","tags":["sentry","keycloak","saml2"],"images":["/static/images/thumbnail/sentry-saml2-keycloak.png"],"summary":"This time, I integrated Sentry with Keycloak. There are several helpful blog posts available that make the process easy to follow. However, out of curiosity, I wanted to understand exactly what was happening behind the scenes—and clarify which steps are truly necessary.","slug":"20250722-sentry-saml2"},"next":{"title":"Adding OIDC Authentication to OpenVPN Community Server","date":"2025-07-26T00:00:00.000Z","tags":["openvpn","oauth2"],"images":["/static/images/thumbnail/openvpn.png"],"summary":"","slug":"20250726-openvpn-oidc"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20250724-nodejs-trace-database-data"]},"buildId":"pgk04D_iZGZPDfMeQaKFq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>