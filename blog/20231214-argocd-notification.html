<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Argo CD Notification으로 간단하게 Slack 알림 보내기</title><meta name="robots" content="follow, index"/><meta name="description" content="Argo CD Notification가 이미 있어서 쉽게 Slack 알림을 연동할 수 있다. 메뉴얼에서 친절하게 셋팅 방법을 설명하고 있지만, 처음 보고 셋팅할 때 놓칠 수 있는 부분을 기록으로 남긴다."/><meta property="og:url" content="https://jayground8.github.io/blog/20231214-argocd-notification"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Argo CD Notification가 이미 있어서 쉽게 Slack 알림을 연동할 수 있다. 메뉴얼에서 친절하게 셋팅 방법을 설명하고 있지만, 처음 보고 셋팅할 때 놓칠 수 있는 부분을 기록으로 남긴다."/><meta property="og:title" content="Argo CD Notification으로 간단하게 Slack 알림 보내기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Argo CD Notification으로 간단하게 Slack 알림 보내기"/><meta name="twitter:description" content="Argo CD Notification가 이미 있어서 쉽게 Slack 알림을 연동할 수 있다. 메뉴얼에서 친절하게 셋팅 방법을 설명하고 있지만, 처음 보고 셋팅할 때 놓칠 수 있는 부분을 기록으로 남긴다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20231214-argocd-notification"/><meta property="article:published_time" content="2023-12-14T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20231214-argocd-notification"
  },
  "headline": "Argo CD Notification으로 간단하게 Slack 알림 보내기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2023-12-14T00:00:00.000Z",
  "dateModified": "2023-12-14T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Argo CD Notification가 이미 있어서 쉽게 Slack 알림을 연동할 수 있다. 메뉴얼에서 친절하게 셋팅 방법을 설명하고 있지만, 처음 보고 셋팅할 때 놓칠 수 있는 부분을 기록으로 남긴다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f46966e17cb10413.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/I4gAGHbi2VRGJGh6bqD35/_buildManifest.js" defer=""></script><script src="/_next/static/I4gAGHbi2VRGJGh6bqD35/_ssgManifest.js" defer=""></script><script src="/_next/static/I4gAGHbi2VRGJGh6bqD35/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-12-14T00:00:00.000Z">2023년 12월 14일 목요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Argo CD Notification으로 간단하게 Slack 알림 보내기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p><a target="_blank" rel="noopener noreferrer" href="https://argocd-notifications.readthedocs.io/en/stable/">argo CD notification</a>에서 친절하게 설명이 되어 있지만, 메뉴얼을 따라하면서 실수 할 수 있는 부분을 기록으로 남긴다.</p><h2 id="slack-permission"><a href="#slack-permission" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Slack Permission</h2><p>Bot Token Scopes에서 Bot User로 보내기 위해서 <code>chat:write.public</code> permission도 같이 부여 한다.</p><img src="/static/images/argocd-notification-slack-permission.png" alt="argocd notification slack permission"/><p>그리고 아래처럼 Bot User Oauth Token을 사용하여, App이 채널에 message를 보낼 수 있도록 한다.</p><img src="/static/images/argocd-notification-slack-token.png" alt="argocd notification slack token"/><h2 id="kubernetes-설치"><a href="#kubernetes-설치" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Kubernetes 설치</h2><p>Argo CD notifcation controller을 아래처럼 설치한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/release-1.0/manifests/install.yaml
</span></code></pre></div><p>그리고 아래처럼 ConfigMap을 설치한다. <code>argocd-notifications-cm</code> ConfigMap에 알림을 보낸 message template들이 설정된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/release-1.0/catalog/install.yaml
</span></code></pre></div><p>위에서 설정한 <code>Bot User Oauth Token</code>을 <code>&lt;auth-token&gt;</code>에 넣어서 생성한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Secret
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> argocd<span class="token punctuation">-</span>notifications<span class="token punctuation">-</span>secret
</span><span class="code-line"><span class="token atrule key">stringData</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">slack-token</span><span class="token punctuation">:</span> &lt;auth<span class="token punctuation">-</span>token<span class="token punctuation">&gt;</span>
</span></code></pre></div><p>그리고 이미 ConfigMap이 만들어져 있기 때문에, patch를 통해서 slack 설정을 추가한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl patch cm argocd-notifications-cm -n argocd --type merge -p <span class="token string">&#x27;{&quot;data&quot;: {&quot;service.slack&quot;: &quot;{ token: $slack-token }&quot; }}&#x27;</span>
</span></code></pre></div><p>마지막으로 이미 ArgoCD에서 만들어진 App에 notification을 적용하고 싶으면, Annotation을 추가하면 된다. 아래처럼 ArgoCD CRD를 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ kubectl get app
</span><span class="code-line">
</span><span class="code-line">NAME           SYNC STATUS   HEALTH STATUS
</span><span class="code-line">sample         Synced        Healthy
</span></code></pre></div><p>sync가 성공적으로 되었을 때, Slack notification을 보내고 싶으면 아래와 같이 annotation을 넣으면 된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl patch app sample -p <span class="token string">&#x27;{&quot;metadata&quot;: {&quot;annotations&quot;: {&quot;notifications.argoproj.io/subscribe.on-sync-succeeded.slack&quot;:&quot;channel_name&quot;}}}&#x27;</span> --type merge
</span></code></pre></div><p>이제 Argo CD에서 해당 Application에서 Sync가 성공적으로 진행되면 해당 슬랙 채널로 메세지가 가게 된다.</p><h2 id="cli"><a href="#cli" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>CLI</h2><p><code>argocd-notification</code> binary로 CLI를 제공한다. Kubernetes container에서 아래와 같이 명령어로 사용할 수 있다. 이렇게 <code>applicaion_name</code>에 Argo CD application 이름을 설정하고, <code>channel_name</code>은 보내고 싶은 채널을 적으면 테스트로 메세지를 보내볼 수 있다. 위의 과정에서 슬랙 메세지가 정상적으로 오지 않으면 이 CLI로 요청해서 slack에서 어떤 응답이 오는지 확인하여 디버깅 할 수 있다. <code>channel_name</code>에 <code>@slack_username</code>으로 보내면 user conversation에 메세지를 보내서 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it argocd-notifications-controller-5d78489bc8-fkb2x -- /app/argocd-notifications template notify app-deployed application_name --recipient slack:channel_name
</span></code></pre></div><h2 id="custom-template"><a href="#custom-template" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Custom Template</h2><p>Slack에 오는 message의 내용과 format을 변경하고 싶으면, 아래와 같이 내가 정의한 template를 <code>argocd-notifications-cm</code> ConfigMap에 추가하면 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">template.app-deployed-custom</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">  slack:
</span></span><span class="code-line"><span class="token string scalar">    message: |
</span></span><span class="code-line"><span class="token string scalar">      {{if eq .app.metadata.name &quot;sample&quot;}}[test]{{end}}{{.app.metadata.name}} 정상적으로 배포가 완료되엇습니다.
</span></span><span class="code-line"><span class="token string scalar">    attachments: |
</span></span><span class="code-line"><span class="token string scalar">      [{
</span></span><span class="code-line"><span class="token string scalar">        &quot;title&quot;: &quot;{{ .app.metadata.name}}&quot;,
</span></span><span class="code-line"><span class="token string scalar">        &quot;color&quot;: &quot;#18be52&quot;,
</span></span><span class="code-line"><span class="token string scalar">        &quot;fields&quot;: [
</span></span><span class="code-line"><span class="token string scalar">        {
</span></span><span class="code-line"><span class="token string scalar">          &quot;title&quot;: &quot;Sync Status&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;value&quot;: &quot;{{.app.status.sync.status}}&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;short&quot;: true
</span></span><span class="code-line"><span class="token string scalar">        },
</span></span><span class="code-line"><span class="token string scalar">        {
</span></span><span class="code-line"><span class="token string scalar">          &quot;title&quot;: &quot;Repository&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;value&quot;: &quot;{{.app.spec.source.repoURL}}&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;short&quot;: true
</span></span><span class="code-line"><span class="token string scalar">        },
</span></span><span class="code-line"><span class="token string scalar">        {
</span></span><span class="code-line"><span class="token string scalar">          &quot;title&quot;: &quot;Revision&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;value&quot;: &quot;{{.app.status.sync.revision}}&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;short&quot;: true
</span></span><span class="code-line"><span class="token string scalar">        }
</span></span><span class="code-line"><span class="token string scalar">        {{range $index, $c := .app.status.conditions}}
</span></span><span class="code-line"><span class="token string scalar">        {{if not $index}},{{end}}
</span></span><span class="code-line"><span class="token string scalar">        {{if $index}},{{end}}
</span></span><span class="code-line"><span class="token string scalar">        {
</span></span><span class="code-line"><span class="token string scalar">          &quot;title&quot;: &quot;{{$c.type}}&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;value&quot;: &quot;{{$c.message}}&quot;,
</span></span><span class="code-line"><span class="token string scalar">          &quot;short&quot;: true
</span></span><span class="code-line"><span class="token string scalar">        }
</span></span><span class="code-line"><span class="token string scalar">        {{end}}
</span></span><span class="code-line"><span class="token string scalar">        ]
</span></span><span class="code-line"><span class="token string scalar">      }]</span>
</span></code></pre></div><p>CLI를 통해서 내가 변경한 슬랙 메세지 template이 어떻게 보이는지 확인하고</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it argocd-notifications-controller-5d78489bc8-fkb2x -- /app/argocd-notifications template notify app-deployed-custom application_name --recipient slack:channel_name
</span></code></pre></div><p>그리고 마지막으로 trigger 조건에서 내가 만든 <code>app-deployed-custom</code>을 사용하도록 수정한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">trigger.on-deployed</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">  - description: Application is synced and healthy. Triggered once per commit.
</span></span><span class="code-line"><span class="token string scalar">    oncePer: app.status.sync.revision
</span></span><span class="code-line"><span class="token string scalar">    send:
</span></span><span class="code-line"><span class="token string scalar">    - app-deployed-custom
</span></span><span class="code-line"><span class="token string scalar">    when: app.status.operationState.phase in [&#x27;Succeeded&#x27;] and app.status.health.status == &#x27;Healthy&#x27;</span>
</span></code></pre></div><p>이제 ArgoCD에서 새로운 revision으로 sync가 맞았을 때 슬랙 알림이 가게 된다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">Kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/argocd">ArgoCD</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231205-nginx-allow-ip">Kubernetes에서 Nginx로 IP allow list 제어</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231217-aws-sam-resolve-issue">AWS SAM으로 배포한 Lambda의 환경변수가 변경된 Secret Manager 값으로 반영이 안되는 문제</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=n=\u003el(n,\"__esModule\",{value:!0});var g=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),N=(n,s)=\u003e{i(n);for(var c in s)l(n,c,{get:s[c],enumerable:!0})},k=(n,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of p(s))!m.call(n,a)\u0026\u0026a!==\"default\"\u0026\u0026l(n,a,{get:()=\u003es[a],enumerable:!(c=d(s,a))||c.enumerable});return n},u=n=\u003ek(i(l(n!=null?o(h(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var r=g((A,t)=\u003e{t.exports=_jsx_runtime});var C={};N(C,{default:()=\u003ey,frontmatter:()=\u003eb});var e=u(r()),b={title:\"Argo CD Notification\\uC73C\\uB85C \\uAC04\\uB2E8\\uD558\\uAC8C Slack \\uC54C\\uB9BC \\uBCF4\\uB0B4\\uAE30\",date:\"2023-12-14\",tags:[\"Kubernetes\",\"ArgoCD\"],images:[\"/static/images/social-banner.png\"],summary:\"Argo CD Notification\\uAC00 \\uC774\\uBBF8 \\uC788\\uC5B4\\uC11C \\uC27D\\uAC8C Slack \\uC54C\\uB9BC\\uC744 \\uC5F0\\uB3D9\\uD560 \\uC218 \\uC788\\uB2E4. \\uBA54\\uB274\\uC5BC\\uC5D0\\uC11C \\uCE5C\\uC808\\uD558\\uAC8C \\uC14B\\uD305 \\uBC29\\uBC95\\uC744 \\uC124\\uBA85\\uD558\\uACE0 \\uC788\\uC9C0\\uB9CC, \\uCC98\\uC74C \\uBCF4\\uACE0 \\uC14B\\uD305\\uD560 \\uB54C \\uB193\\uCE60 \\uC218 \\uC788\\uB294 \\uBD80\\uBD84\\uC744 \\uAE30\\uB85D\\uC73C\\uB85C \\uB0A8\\uAE34\\uB2E4.\"};function f(n={}){let{wrapper:s}=n.components||{};return s?(0,e.jsx)(s,Object.assign({},n,{children:(0,e.jsx)(c,{})})):c();function c(){let a=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",code:\"code\",pre:\"pre\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://argocd-notifications.readthedocs.io/en/stable/\",children:\"argo CD notification\"}),\"\\uC5D0\\uC11C \\uCE5C\\uC808\\uD558\\uAC8C \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uC9C0\\uB9CC, \\uBA54\\uB274\\uC5BC\\uC744 \\uB530\\uB77C\\uD558\\uBA74\\uC11C \\uC2E4\\uC218 \\uD560 \\uC218 \\uC788\\uB294 \\uBD80\\uBD84\\uC744 \\uAE30\\uB85D\\uC73C\\uB85C \\uB0A8\\uAE34\\uB2E4.\"]}),(0,e.jsxs)(a.h2,{id:\"slack-permission\",children:[(0,e.jsx)(a.a,{href:\"#slack-permission\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Slack Permission\"]}),(0,e.jsxs)(a.p,{children:[\"Bot Token Scopes\\uC5D0\\uC11C Bot User\\uB85C \\uBCF4\\uB0B4\\uAE30 \\uC704\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"chat:write.public\"}),\" permission\\uB3C4 \\uAC19\\uC774 \\uBD80\\uC5EC \\uD55C\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/argocd-notification-slack-permission.png\",alt:\"argocd notification slack permission\"}),(0,e.jsx)(a.p,{children:\"\\uADF8\\uB9AC\\uACE0 \\uC544\\uB798\\uCC98\\uB7FC Bot User Oauth Token\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC, App\\uC774 \\uCC44\\uB110\\uC5D0 message\\uB97C \\uBCF4\\uB0BC \\uC218 \\uC788\\uB3C4\\uB85D \\uD55C\\uB2E4.\"}),(0,e.jsx)(\"img\",{src:\"/static/images/argocd-notification-slack-token.png\",alt:\"argocd notification slack token\"}),(0,e.jsxs)(a.h2,{id:\"kubernetes-\\uC124\\uCE58\",children:[(0,e.jsx)(a.a,{href:\"#kubernetes-\\uC124\\uCE58\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Kubernetes \\uC124\\uCE58\"]}),(0,e.jsx)(a.p,{children:\"Argo CD notifcation controller\\uC744 \\uC544\\uB798\\uCC98\\uB7FC \\uC124\\uCE58\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/release-1.0/manifests/install.yaml\n`})})}),(0,e.jsxs)(a.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uC544\\uB798\\uCC98\\uB7FC ConfigMap\\uC744 \\uC124\\uCE58\\uD55C\\uB2E4. \",(0,e.jsx)(a.code,{children:\"argocd-notifications-cm\"}),\" ConfigMap\\uC5D0 \\uC54C\\uB9BC\\uC744 \\uBCF4\\uB0B8 message template\\uB4E4\\uC774 \\uC124\\uC815\\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/release-1.0/catalog/install.yaml\n`})})}),(0,e.jsxs)(a.p,{children:[\"\\uC704\\uC5D0\\uC11C \\uC124\\uC815\\uD55C \",(0,e.jsx)(a.code,{children:\"Bot User Oauth Token\"}),\"\\uC744 \",(0,e.jsx)(a.code,{children:\"\u003cauth-token\u003e\"}),\"\\uC5D0 \\uB123\\uC5B4\\uC11C \\uC0DD\\uC131\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Secret\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" argocd\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"notifications\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`secret\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"stringData\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"slack-token\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \u003cauth\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"token\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\u003e\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uADF8\\uB9AC\\uACE0 \\uC774\\uBBF8 ConfigMap\\uC774 \\uB9CC\\uB4E4\\uC5B4\\uC838 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, patch\\uB97C \\uD1B5\\uD574\\uC11C slack \\uC124\\uC815\\uC744 \\uCD94\\uAC00\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl patch cm argocd-notifications-cm -n argocd --type merge -p \",(0,e.jsx)(a.span,{className:\"token string\",children:`'{\"data\": {\"service.slack\": \"{ token: $slack-token }\" }}'`}),`\n`]})})}),(0,e.jsx)(a.p,{children:\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \\uC774\\uBBF8 ArgoCD\\uC5D0\\uC11C \\uB9CC\\uB4E4\\uC5B4\\uC9C4 App\\uC5D0 notification\\uC744 \\uC801\\uC6A9\\uD558\\uACE0 \\uC2F6\\uC73C\\uBA74, Annotation\\uC744 \\uCD94\\uAC00\\uD558\\uBA74 \\uB41C\\uB2E4. \\uC544\\uB798\\uCC98\\uB7FC ArgoCD CRD\\uB97C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get app\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME           SYNC STATUS   HEALTH STATUS\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`sample         Synced        Healthy\n`})]})}),(0,e.jsx)(a.p,{children:\"sync\\uAC00 \\uC131\\uACF5\\uC801\\uC73C\\uB85C \\uB418\\uC5C8\\uC744 \\uB54C, Slack notification\\uC744 \\uBCF4\\uB0B4\\uACE0 \\uC2F6\\uC73C\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 annotation\\uC744 \\uB123\\uC73C\\uBA74 \\uB41C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl patch app sample -p \",(0,e.jsx)(a.span,{className:\"token string\",children:`'{\"metadata\": {\"annotations\": {\"notifications.argoproj.io/subscribe.on-sync-succeeded.slack\":\"channel_name\"}}}'`}),` --type merge\n`]})})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C Argo CD\\uC5D0\\uC11C \\uD574\\uB2F9 Application\\uC5D0\\uC11C Sync\\uAC00 \\uC131\\uACF5\\uC801\\uC73C\\uB85C \\uC9C4\\uD589\\uB418\\uBA74 \\uD574\\uB2F9 \\uC2AC\\uB799 \\uCC44\\uB110\\uB85C \\uBA54\\uC138\\uC9C0\\uAC00 \\uAC00\\uAC8C \\uB41C\\uB2E4.\"}),(0,e.jsxs)(a.h2,{id:\"cli\",children:[(0,e.jsx)(a.a,{href:\"#cli\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"CLI\"]}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.code,{children:\"argocd-notification\"}),\" binary\\uB85C CLI\\uB97C \\uC81C\\uACF5\\uD55C\\uB2E4. Kubernetes container\\uC5D0\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uBA85\\uB839\\uC5B4\\uB85C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uC774\\uB807\\uAC8C \",(0,e.jsx)(a.code,{children:\"applicaion_name\"}),\"\\uC5D0 Argo CD application \\uC774\\uB984\\uC744 \\uC124\\uC815\\uD558\\uACE0, \",(0,e.jsx)(a.code,{children:\"channel_name\"}),\"\\uC740 \\uBCF4\\uB0B4\\uACE0 \\uC2F6\\uC740 \\uCC44\\uB110\\uC744 \\uC801\\uC73C\\uBA74 \\uD14C\\uC2A4\\uD2B8\\uB85C \\uBA54\\uC138\\uC9C0\\uB97C \\uBCF4\\uB0B4\\uBCFC \\uC218 \\uC788\\uB2E4. \\uC704\\uC758 \\uACFC\\uC815\\uC5D0\\uC11C \\uC2AC\\uB799 \\uBA54\\uC138\\uC9C0\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC624\\uC9C0 \\uC54A\\uC73C\\uBA74 \\uC774 CLI\\uB85C \\uC694\\uCCAD\\uD574\\uC11C slack\\uC5D0\\uC11C \\uC5B4\\uB5A4 \\uC751\\uB2F5\\uC774 \\uC624\\uB294\\uC9C0 \\uD655\\uC778\\uD558\\uC5EC \\uB514\\uBC84\\uAE45 \\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(a.code,{children:\"channel_name\"}),\"\\uC5D0 \",(0,e.jsx)(a.code,{children:\"@slack_username\"}),\"\\uC73C\\uB85C \\uBCF4\\uB0B4\\uBA74 user conversation\\uC5D0 \\uBA54\\uC138\\uC9C0\\uB97C \\uBCF4\\uB0B4\\uC11C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it argocd-notifications-controller-5d78489bc8-fkb2x -- /app/argocd-notifications template notify app-deployed application_name --recipient slack:channel_name\n`]})})}),(0,e.jsxs)(a.h2,{id:\"custom-template\",children:[(0,e.jsx)(a.a,{href:\"#custom-template\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Custom Template\"]}),(0,e.jsxs)(a.p,{children:[\"Slack\\uC5D0 \\uC624\\uB294 message\\uC758 \\uB0B4\\uC6A9\\uACFC format\\uC744 \\uBCC0\\uACBD\\uD558\\uACE0 \\uC2F6\\uC73C\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uB0B4\\uAC00 \\uC815\\uC758\\uD55C template\\uB97C \",(0,e.jsx)(a.code,{children:\"argocd-notifications-cm\"}),\" ConfigMap\\uC5D0 \\uCD94\\uAC00\\uD558\\uBA74 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"template.app-deployed-custom\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`  slack:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`    message: |\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`      {{if eq .app.metadata.name \"sample\"}}[test]{{end}}{{.app.metadata.name}} \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uBC30\\uD3EC\\uAC00 \\uC644\\uB8CC\\uB418\\uC5C7\\uC2B5\\uB2C8\\uB2E4.\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`    attachments: |\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`      [{\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        \"title\": \"{{ .app.metadata.name}}\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        \"color\": \"#18be52\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        \"fields\": [\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"title\": \"Sync Status\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"value\": \"{{.app.status.sync.status}}\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"short\": true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        },\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"title\": \"Repository\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"value\": \"{{.app.spec.source.repoURL}}\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"short\": true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        },\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"title\": \"Revision\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"value\": \"{{.app.status.sync.revision}}\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"short\": true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        }\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {{range $index, $c := .app.status.conditions}}\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {{if not $index}},{{end}}\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {{if $index}},{{end}}\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"title\": \"{{$c.type}}\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"value\": \"{{$c.message}}\",\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          \"short\": true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        }\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        {{end}}\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        ]\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"      }]\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"CLI\\uB97C \\uD1B5\\uD574\\uC11C \\uB0B4\\uAC00 \\uBCC0\\uACBD\\uD55C \\uC2AC\\uB799 \\uBA54\\uC138\\uC9C0 template\\uC774 \\uC5B4\\uB5BB\\uAC8C \\uBCF4\\uC774\\uB294\\uC9C0 \\uD655\\uC778\\uD558\\uACE0\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it argocd-notifications-controller-5d78489bc8-fkb2x -- /app/argocd-notifications template notify app-deployed-custom application_name --recipient slack:channel_name\n`]})})}),(0,e.jsxs)(a.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C trigger \\uC870\\uAC74\\uC5D0\\uC11C \\uB0B4\\uAC00 \\uB9CC\\uB4E0 \",(0,e.jsx)(a.code,{children:\"app-deployed-custom\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC218\\uC815\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"trigger.on-deployed\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`  - description: Application is synced and healthy. Triggered once per commit.\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`    oncePer: app.status.sync.revision\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`    send:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`    - app-deployed-custom\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"    when: app.status.operationState.phase in ['Succeeded'] and app.status.health.status == 'Healthy'\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C ArgoCD\\uC5D0\\uC11C \\uC0C8\\uB85C\\uC6B4 revision\\uC73C\\uB85C sync\\uAC00 \\uB9DE\\uC558\\uC744 \\uB54C \\uC2AC\\uB799 \\uC54C\\uB9BC\\uC774 \\uAC00\\uAC8C \\uB41C\\uB2E4.\"})]})}}var y=f;return C;})();\n;return Component;","toc":[{"value":"Slack Permission","url":"#slack-permission","depth":2},{"value":"Kubernetes 설치","url":"#kubernetes-설치","depth":2},{"value":"CLI","url":"#cli","depth":2},{"value":"Custom Template","url":"#custom-template","depth":2}],"frontMatter":{"readingTime":{"text":"4 min read","minutes":3.175,"time":190500,"words":635},"slug":"20231214-argocd-notification","fileName":"20231214-argocd-notification.md","title":"Argo CD Notification으로 간단하게 Slack 알림 보내기","date":"2023-12-14T00:00:00.000Z","tags":["Kubernetes","ArgoCD"],"images":["/static/images/social-banner.png"],"summary":"Argo CD Notification가 이미 있어서 쉽게 Slack 알림을 연동할 수 있다. 메뉴얼에서 친절하게 셋팅 방법을 설명하고 있지만, 처음 보고 셋팅할 때 놓칠 수 있는 부분을 기록으로 남긴다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Kubernetes에서 Nginx로 IP allow list 제어","date":"2023-12-05T00:00:00.000Z","tags":["Kubernetes","Nginx"],"images":["/static/images/social-banner.png"],"summary":"Kubernetes cluster에서 Nginx로 허용 가능한 IP를 설정하고 싶었다. 간단하게 끝날 줄 알았던 작업은 또다른 삽질기가 되었다.😭 Kubernetes에서 SNAT이 되는 과정을 이해하고 externalTrafficPolicy를 Local로 설정했다. 그리고 External Load balancer에서는 client IP를 전달하기 위해서 Proxy Protocol와 같은 것을 설정하고, Nginx에서 그 Proxy protocol로 전달된 IP address로 Access control을 할 수 있도록 설정하였다.","slug":"20231205-nginx-allow-ip"},"next":{"title":"AWS SAM으로 배포한 Lambda의 환경변수가 변경된 Secret Manager 값으로 반영이 안되는 문제","date":"2023-12-17T00:00:00.000Z","tags":["AWS"],"images":["/static/images/social-banner.png"],"summary":"AWS Cloudformation에서 Secret Manager의 값을 참조하도록 할 수 있다. AWS SAM을 사용하여 배포된 Lambda의 환경변수가 Secret Manager의 값을 참조하는 경우가 있었다. 그런데 Secret manager의 값을 변경하여 다시 배포하여도 변경된 값이 Lambda 환경변수에 반영이 되지 않았다.🧐 AWS SAM의 리포에 관련된 Issue가 있었고, 제안한 해결방법을 적용하였다. 살짝 삽질을 했기 때문에 기록을 남겨 본다.🤪","slug":"20231217-aws-sam-resolve-issue"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20231214-argocd-notification"]},"buildId":"I4gAGHbi2VRGJGh6bqD35","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>