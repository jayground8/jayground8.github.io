<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Kubernetesì—ì„œ Nginxë¡œ IP allow list ì œì–´</title><meta name="robots" content="follow, index"/><meta name="description" content="Kubernetes clusterì—ì„œ Nginxë¡œ í—ˆìš© ê°€ëŠ¥í•œ IPë¥¼ ì„¤ì •í•˜ê³  ì‹¶ì—ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ëë‚  ì¤„ ì•Œì•˜ë˜ ì‘ì—…ì€ ë˜ë‹¤ë¥¸ ì‚½ì§ˆê¸°ê°€ ë˜ì—ˆë‹¤.ğŸ˜­ Kubernetesì—ì„œ SNATì´ ë˜ëŠ” ê³¼ì •ì„ ì´í•´í•˜ê³  externalTrafficPolicyë¥¼ Localë¡œ ì„¤ì •í–ˆë‹¤. ê·¸ë¦¬ê³  External Load balancerì—ì„œëŠ” client IPë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ Proxy Protocolì™€ ê°™ì€ ê²ƒì„ ì„¤ì •í•˜ê³ , Nginxì—ì„œ ê·¸ Proxy protocolë¡œ ì „ë‹¬ëœ IP addressë¡œ Access controlì„ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤."/><meta property="og:url" content="https://jayground8.github.io/blog/20231205-nginx-allow-ip"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Kubernetes clusterì—ì„œ Nginxë¡œ í—ˆìš© ê°€ëŠ¥í•œ IPë¥¼ ì„¤ì •í•˜ê³  ì‹¶ì—ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ëë‚  ì¤„ ì•Œì•˜ë˜ ì‘ì—…ì€ ë˜ë‹¤ë¥¸ ì‚½ì§ˆê¸°ê°€ ë˜ì—ˆë‹¤.ğŸ˜­ Kubernetesì—ì„œ SNATì´ ë˜ëŠ” ê³¼ì •ì„ ì´í•´í•˜ê³  externalTrafficPolicyë¥¼ Localë¡œ ì„¤ì •í–ˆë‹¤. ê·¸ë¦¬ê³  External Load balancerì—ì„œëŠ” client IPë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ Proxy Protocolì™€ ê°™ì€ ê²ƒì„ ì„¤ì •í•˜ê³ , Nginxì—ì„œ ê·¸ Proxy protocolë¡œ ì „ë‹¬ëœ IP addressë¡œ Access controlì„ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤."/><meta property="og:title" content="Kubernetesì—ì„œ Nginxë¡œ IP allow list ì œì–´"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Kubernetesì—ì„œ Nginxë¡œ IP allow list ì œì–´"/><meta name="twitter:description" content="Kubernetes clusterì—ì„œ Nginxë¡œ í—ˆìš© ê°€ëŠ¥í•œ IPë¥¼ ì„¤ì •í•˜ê³  ì‹¶ì—ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ëë‚  ì¤„ ì•Œì•˜ë˜ ì‘ì—…ì€ ë˜ë‹¤ë¥¸ ì‚½ì§ˆê¸°ê°€ ë˜ì—ˆë‹¤.ğŸ˜­ Kubernetesì—ì„œ SNATì´ ë˜ëŠ” ê³¼ì •ì„ ì´í•´í•˜ê³  externalTrafficPolicyë¥¼ Localë¡œ ì„¤ì •í–ˆë‹¤. ê·¸ë¦¬ê³  External Load balancerì—ì„œëŠ” client IPë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ Proxy Protocolì™€ ê°™ì€ ê²ƒì„ ì„¤ì •í•˜ê³ , Nginxì—ì„œ ê·¸ Proxy protocolë¡œ ì „ë‹¬ëœ IP addressë¡œ Access controlì„ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20231205-nginx-allow-ip"/><meta property="article:published_time" content="2023-12-05T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20231205-nginx-allow-ip"
  },
  "headline": "Kubernetesì—ì„œ Nginxë¡œ IP allow list ì œì–´",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2023-12-05T00:00:00.000Z",
  "dateModified": "2023-12-05T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Kubernetes clusterì—ì„œ Nginxë¡œ í—ˆìš© ê°€ëŠ¥í•œ IPë¥¼ ì„¤ì •í•˜ê³  ì‹¶ì—ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ëë‚  ì¤„ ì•Œì•˜ë˜ ì‘ì—…ì€ ë˜ë‹¤ë¥¸ ì‚½ì§ˆê¸°ê°€ ë˜ì—ˆë‹¤.ğŸ˜­ Kubernetesì—ì„œ SNATì´ ë˜ëŠ” ê³¼ì •ì„ ì´í•´í•˜ê³  externalTrafficPolicyë¥¼ Localë¡œ ì„¤ì •í–ˆë‹¤. ê·¸ë¦¬ê³  External Load balancerì—ì„œëŠ” client IPë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ Proxy Protocolì™€ ê°™ì€ ê²ƒì„ ì„¤ì •í•˜ê³ , Nginxì—ì„œ ê·¸ Proxy protocolë¡œ ì „ë‹¬ëœ IP addressë¡œ Access controlì„ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-13abdf7de53f3efe.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/bYSCJYJzTgWi7GtrLxUb1/_buildManifest.js" defer=""></script><script src="/_next/static/bYSCJYJzTgWi7GtrLxUb1/_ssgManifest.js" defer=""></script><script src="/_next/static/bYSCJYJzTgWi7GtrLxUb1/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">ë¸”ë¡œê·¸</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">ë¸”ë¡œê·¸</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-12-05T00:00:00.000Z">2023ë…„ 12ì›” 5ì¼ í™”ìš”ì¼</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Kubernetesì—ì„œ Nginxë¡œ IP allow list ì œì–´</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="nginx-allow-ip-address"><a href="#nginx-allow-ip-address" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nginx allow IP address</h2><p>Kubernetes clusterì—ì„œ Nginxë¥¼ í†µí•´ì„œ í—ˆìš©ëœ IPë¡œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ êµ¬ì„±í•˜ê³  ì‹¶ì—ˆë‹¤. Nginxì˜ <a target="_blank" rel="noopener noreferrer" href="https://nginx.org/en/docs/http/ngx_http_access_module.html">http_access_module</a>ë¥¼ ì‚¬ìš©í•´ì„œ ê°„ë‹¨í•˜ê²Œ IP allow listë‚˜ deny listë¥¼ ì…‹íŒ…í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ ê¸°ëŒ€ë¥¼ í–ˆë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ Kubernetes objectë¥¼ ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ë‹¤.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> ConfigMap
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>conf
</span><span class="code-line"><span class="token atrule key">data</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">nginx.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">    user nginx;
</span></span><span class="code-line"><span class="token string scalar">    worker_processes  auto;
</span></span><span class="code-line"><span class="token string scalar">    error_log  /var/log/nginx/error.log;
</span></span><span class="code-line"><span class="token string scalar">    events {
</span></span><span class="code-line"><span class="token string scalar">      worker_connections  1024;
</span></span><span class="code-line"><span class="token string scalar">    }
</span></span><span class="code-line"><span class="token string scalar">    http {
</span></span><span class="code-line"><span class="token string scalar">      log_format  main
</span></span><span class="code-line"><span class="token string scalar">              &#x27;remote_addr:$remote_addr\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;time_local:$time_local\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;method:$request_method\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;uri:$request_uri\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;host:$host\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;status:$status\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;bytes_sent:$body_bytes_sent\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;referer:$http_referer\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;useragent:$http_user_agent\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;forwardedfor:$http_x_forwarded_for\t&#x27;
</span></span><span class="code-line"><span class="token string scalar">              &#x27;request_time:$request_time&#x27;;
</span></span><span class="code-line"><span class="token string scalar">      access_log /dev/stdout main;
</span></span><span class="code-line"><span class="token string scalar">      server {
</span></span><span class="code-line"><span class="token string scalar">        listen 80 default_server;
</span></span><span class="code-line"><span class="token string scalar">        location / {
</span></span><span class="code-line"><span class="token string scalar">          allow 40.150.119.175;
</span></span><span class="code-line"><span class="token string scalar">          deny all;
</span></span><span class="code-line"><span class="token string scalar">          proxy_pass http://example.com/;
</span></span><span class="code-line"><span class="token string scalar">          proxy_http_version 1.1;
</span></span><span class="code-line"><span class="token string scalar">        }
</span></span><span class="code-line"><span class="token string scalar">      }
</span></span><span class="code-line"><span class="token string scalar">    }</span>
</span></code></pre></div><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span><span class="code-line">          <span class="token atrule key">image</span><span class="token punctuation">:</span> nginx
</span><span class="code-line">          <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</span><span class="code-line">          <span class="token atrule key">volumeMounts</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /etc/nginx
</span><span class="code-line">              <span class="token atrule key">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">              <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>conf
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /var/log/nginx
</span><span class="code-line">              <span class="token atrule key">name</span><span class="token punctuation">:</span> log
</span><span class="code-line">      <span class="token atrule key">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>conf
</span><span class="code-line">          <span class="token atrule key">configMap</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>conf
</span><span class="code-line">            <span class="token atrule key">items</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token punctuation">-</span> <span class="token atrule key">key</span><span class="token punctuation">:</span> nginx.conf
</span><span class="code-line">                <span class="token atrule key">path</span><span class="token punctuation">:</span> nginx.conf
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> log
</span></code></pre></div><p>Naver Cloudì˜ Network Proxy Loadbalancerë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•˜ì—¬ ì•„ë˜ì²˜ëŸ¼ annotationì„ ì •ì˜í•˜ì˜€ë‹¤. Network Proxy Load balancerì—ì„œ TLS terminationì„ í•˜ê³ , upstreamì—ëŠ” httpë¡œ ì ‘ê·¼ì„ í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Service
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">service.beta.kubernetes.io/ncloud-load-balancer-layer-type</span><span class="token punctuation">:</span> nplb
</span><span class="code-line">    <span class="token atrule key">service.beta.kubernetes.io/ncloud-load-balancer-ssl-certificate-no</span><span class="token punctuation">:</span> <span class="token string">&#x27;4134&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">service.beta.kubernetes.io/ncloud-load-balancer-tls-ports</span><span class="token punctuation">:</span> <span class="token string">&#x27;443&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">service.beta.kubernetes.io/ncloud-load-balancer-tls-min-version</span><span class="token punctuation">:</span> TLSV10
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> LoadBalancer
</span><span class="code-line">  <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
</span><span class="code-line">      <span class="token atrule key">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span></code></pre></div><p>í•˜ì§€ë§Œ <code>allow 40.150.119.175;</code> ì •ì˜ëœ ê²ƒì²˜ëŸ¼ ì ‘ì†í•˜ëŠ” client IPê°€ <code>40.150.119.175</code>ì¸ë°, 403 responseë¥¼ ë°›ì•˜ë‹¤. stdoutìœ¼ë¡œ ì„¤ì •í•œ access logë¥¼ í™•ì¸í•´ë³´ë‹ˆ <code>$remote_addr</code>ê°€ Kubernetes cluster ë‚´ë¶€ì˜ IP addressë¡œ ì°í˜”ë‹¤. (ì˜ˆ <code>192.18.7.140</code>, <code>192.18.0.55</code>) ê³ ë¯¼í•´ë³´ë‹ˆ Kubernetesì—ì„œëŠ” kube-proxyê°€ SNATì„ í•˜ëŠ” ë¶€ë¶„ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤ë¼ëŠ” ê²ƒì´ ìƒê°ë‚¬ë‹¤. Node portë‚˜ Load Balancer typeì˜ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ë•Œ, Worker nodeì˜ portë¡œ ì ‘ê·¼í•˜ê²Œ ëœë‹¤. ê·¸ëŸ°ë° ì ‘ê·¼í•˜ëŠ” Worker nodeì— í†µì‹ í•˜ë ¤ëŠ” Podê°€ ìˆì„ ìˆ˜ë„ ìˆê³  ì—†ì„ ìˆ˜ë„ ìˆë‹¤. ì—†ëŠ” ê²½ìš°ì—ë„ kube-proxyë¥¼ í†µí•´ì„œ ìˆëŠ” Node ìª½ìœ¼ë¡œ routingì´ ë  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  Iptableë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ì•„ë˜ì²˜ëŸ¼ trafficì„ randomí•˜ê²Œ ë¶„ë°°í•´ì¤„ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ podê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ë•Œ kube-proxyë¥¼ í†µí•´ì„œ load balancingë„ ëœë‹¤. ê·¸ëŸ¬ëŠ” ê³¼ì •ì—ì„œ SNATìœ¼ë¡œ client ipê°€ ìœ ì‹¤ ëœë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">sudo</span> iptables -t nat -A OUTPUT -d <span class="token number">10.99</span>.99.32 -j DNAT --to-destination <span class="token number">10.244</span>.15.196
</span><span class="code-line"><span class="token function">sudo</span> iptables -t nat -A OUTPUT -p tcp -d <span class="token number">10.99</span>.99.32 --dport <span class="token number">27017</span> -m statistic --mode random --probability <span class="token number">0.50000000000</span> -j DNAT --to-destination <span class="token number">10.244</span>.14.195:8090
</span><span class="code-line"><span class="token function">sudo</span> iptables -t nat -A OUTPUT -p tcp -d <span class="token number">10.99</span>.99.32 --dport <span class="token number">27017</span> -j DNAT --to-destination <span class="token number">10.244</span>.14.196:8090
</span></code></pre></div><p>ê¸°ë³¸ì ìœ¼ë¡œ <code>service.spec.externalTrafficPolicy</code>ëŠ” Clusterë¡œ ì„¤ì •ì´ ë˜ì–´ ìˆë‹¤. ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒì²˜ëŸ¼ ì‘ë™ì´ ëœë‹¤. ë„¤ì´ë²„ í´ë¼ìš°ë“œì—ì„œëŠ” CNIë¡œ ciliumì„ ì“°ê³  ìˆëŠ”ë°, access logì— ì°í˜”ë˜ <code>192.18.7.140</code>, <code>192.18.0.55</code>ëŠ” cilium host ipì˜€ë‹¤. <code>kubectl describe node</code>ë¥¼ ë³´ë‹ˆ <code>io.cilium.network.ipv4-cilium-host</code> annotationì´ ë¶™ì–´ ìˆì—ˆê³ , ì´ ê°’ì´ logì— ì°í˜”ë˜ IP addressì˜€ë‹¤.</p><p>ê·¸ëŸ¼ ì´ì œ client ipë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ <code>service.spec.externalTrafficPolicy</code>ë¥¼ Localë¡œ ë³€ê²½í•˜ì˜€ë‹¤. ì´ì œ Load balancerì˜ CIDRì˜ IP addressê°€ access logì— ì°íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <code>Local</code>ë¡œ í–ˆì„ ë•ŒëŠ” ì´ì œ ì—°ê²°ëœ Nodeë‚´ì˜ pod endpointë§Œ ì ‘ì†ì„ ì‹œë„í•˜ê³  ì—†ìœ¼ë©´ packetì´ dropëœë‹¤. <code>Load balancer</code> typeìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , Nodeê°€ ì„¸ ê°œë¼ê³  í•œë‹¤ê³  í•˜ë©´ Load balancerì˜ Targetìœ¼ë¡œ ì„¸ ê°œì˜ Nodeê°€ ë¶™ì„ ê²ƒì´ë‹¤. ê·¸ëŸ°ë° serviceì˜ endpointê°€ í•˜ë‚˜ë§Œ ì¡´ì¬í•œë‹¤ê³  í•˜ë©´(runningì¤‘ì¸ podê°€ í•˜ë‚˜ë¼ë©´), ê·¸ podê°€ ìˆëŠ” Nodeì€ health checkë¥¼ ì„±ê³µí•˜ê³  ë‚˜ë¨¸ì§€ Nodeì—ì„œëŠ” ì‹¤íŒ¨í•œë‹¤. Load balancerì—ì„œ healthyí•œ Nodeì—ë§Œ trafficì„ ë³´ë‚´ê¸° ë•Œë¬¸ì—, <code>Local</code>ë¡œ ì„¤ì •í•˜ì—¬ë„ ì •ìƒì ìœ¼ë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•  ìˆ˜ê°€ ìˆë‹¤.</p><p>í•˜ì§€ë§Œ ì•„ì§ë„ ë¬¸ì œê°€ ìˆë‹¤. Load balancerì˜ IP addressëŠ” ìµœì´ˆì˜ ìš”ì²­í•˜ëŠ” client IPê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— <code>allow 40.150.119.175;</code>ë¥¼ ë§Œì¡±í•˜ì§€ ì•ŠëŠ”ë‹¤. ë™ì¼í•˜ê²Œ 403 ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.</p><h2 id="x-forwared-for--proxy-protocol"><a href="#x-forwared-for--proxy-protocol" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>X-Forwared-For &amp; Proxy Protocol</h2><p>source ipë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ Headerì— <code>X-Forwarded-For</code>, <code>X-Real-IP</code>ì— hopí•˜ëŠ” Ip addressë¥¼ ë‹´ì•„ì„œ ë³´ë‚´ëŠ” ê²ƒë„ ìˆê³ , L4ì—ì„œ ì „ë‹¬í•  ë•Œ Proxy Protocolì„ ì‚¬ìš©í•˜ì—¬ ì „ë‹¬í•  ìˆ˜ë„ ìˆë‹¤. ì´ì œ ë„¤ì´ë²„ í´ë¼ìš°ë“œ Load balancerì—ì„œë„ proxy protocolë¥¼ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ì•„ë˜ì²˜ëŸ¼ annotationì„ ì¶”ê°€í•˜ì—¬ source ipë¥¼ ì „ë‹¬í•˜ë„ë¡ í•œë‹¤.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Service
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>clone
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">service.beta.kubernetes.io/ncloud-load-balancer-proxy-protocol</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span></code></pre></div><p>ê·¸ë¦¬ê³  Nginxì—ì„œ Proxy protocolì„ ë°›ì„ ìˆ˜ ìˆê³ , ê·¸ê²ƒì„ access logì— ë³´ì—¬ ì¤„ ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•œë‹¤. <code>$proxy_protocol_add</code>ë¥¼ í†µí•´ì„œ source ipë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆê³ , proxy protocolì„ acceptí•  ìˆ˜ ìˆë„ë¡ <code>listen 80 proxy_protocol</code>ë¡œ ì •ì˜ë¥¼ í•´ì¤€ë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">http <span class="token punctuation">{</span>
</span><span class="code-line">  log_format  main
</span><span class="code-line">  <span class="token string">&#x27;remote_addr:$remote_addr\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;time_local:$time_local\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;method:$request_method\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;uri:$request_uri\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;host:$host\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;status:$status\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;bytes_sent:$body_bytes_sent\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;referer:$http_referer\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;useragent:$http_user_agent\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;forwardedfor:$http_x_forwarded_for\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;proxy_addr:$proxy_protocol_addr\t&#x27;</span>
</span><span class="code-line">  <span class="token string">&#x27;request_time:$request_time&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">  access_log /dev/stdout main<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  server <span class="token punctuation">{</span>
</span><span class="code-line">    listen <span class="token number">80</span> proxy_protocol<span class="token punctuation">;</span>
</span><span class="code-line">    location / <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">..</span>.
</span></code></pre></div><p>ì´ë ‡ê²Œ í•´ì£¼ë©´ ë  ì¤„ ì•Œì•˜ì§€ë§Œ, ì—¬ì „íˆ 403ë¥¼ ë±‰ì–´ ë‚´ì—ˆë‹¤. ğŸ˜­ğŸ˜­ <code>$proxy_protocol_addr</code>ëŠ” ì´ì œ client Ipê°€ ì°í˜”ì§€ë§Œ, ì—¬ì „íˆ <code>$remote_addr</code>ëŠ” Load balancerì˜ Ipê°€ ì°í˜”ë‹¤. ê·¸ë˜ì„œ ìˆœê°„ Luaë¡œ moduleì„ ë§Œë“¤ì–´ì„œ í•´ë‹¹ ì •ë³´ë¥¼ ë­”ê°€ <code>$remote_addr</code>ì— ì„¤ì •í•´ì¤˜ì•¼ í•˜ëŠ”ê±´ê°€ ìƒê°ì´ ë“¤ì—ˆë‹¤.</p><h2 id="nginx-ingress-controller"><a href="#nginx-ingress-controller" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nginx Ingress Controller</h2><p>ë§ˆì¹¨ <code>Nginx Ingress Controller</code>ë„ ê°™ì´ í…ŒìŠ¤íŠ¸í•´ë³´ê³  ìˆëŠ” ìƒí™©ì´ì–´ì„œ <code>Nginx Ingress Controller</code>ì—ì„œëŠ” Proxy protocolë¡œ ë³´ë‚¸ client ipë¡œ allow list í™•ì¸ì„ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì°¾ì•„ë³´ê¸° ì‹œì‘í–ˆë‹¤. <a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes/ingress-nginx/issues/4305">Nginx Ingress Controller ê¹ƒí—™ì˜ ì´ìŠˆ</a>ì—ì„œ ì‚¬ë¬´ì‹¤ IP CIDRë¡œ ì ‘ê·¼ ì œì–´ê°€ ë˜ì—ˆë‹¤ë¼ëŠ” ì´ì•¼ê¸°ê°€ ë‚˜ì™”ë‹¤.</p><p>Nginx Ingress Controllerì˜ Resourceë“¤ì„ ë§Œë“¤ë•Œ, ConfigMapì—ì„œ <code>use-proxy-protocol</code>ì„ <code>true</code>ë¡œ ì„¤ì •ì„ í•´ì¤¬ë‹¤.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">data</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">allow-snippet-annotations</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line">  <span class="token atrule key">use-proxy-protocol</span><span class="token punctuation">:</span> <span class="token string">&#x27;true&#x27;</span>
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> ConfigMap
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/component</span><span class="token punctuation">:</span> controller
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/instance</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span><span class="code-line">    <span class="token atrule key">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.8.2
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx<span class="token punctuation">-</span>controller
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
</span></code></pre></div><p>ê·¸ë¦¬ê³  IngressëŠ” ì•„ë˜ì™€ ê°™ì´ annotationì„ ì¶”ê°€í•˜ì—¬ Ip allow listë¥¼ ì„¤ì •í•˜ì˜€ë‹¤.</p><div class="relative"><pre><code class="language-yaml code-highlight"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Ingress
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress
</span><span class="code-line">  <span class="token atrule key">annotations</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> <span class="token string">&#x27;nginx&#x27;</span>
</span><span class="code-line">    <span class="token atrule key">nginx.ingress.kubernetes.io/whitelist-source-range</span><span class="token punctuation">:</span> <span class="token string">&#x27;40.150.119.175&#x27;</span>
</span></code></pre></div><p>ê·¸ë¦¬ê³  ë§Œë“¤ì–´ì§„ Load balancerì˜ proxy protocol ì„¤ì •ì„ enableí•´ì£¼ê³ , ì ‘ì†í•˜ë‹ˆê¹ ì´ì œ ë“œë””ì–´ ì •ìƒì ìœ¼ë¡œ ì ‘ì†ì´ ë˜ì—ˆë‹¤. <code>whitelist-source-range</code>ë¥¼ ë³€ê²½í•˜ë‹ˆê¹ ì´ì œ ë‹¤ì‹œ 403 ì—ëŸ¬ë¥¼ ë¦¬í„´ ë°›ì•˜ë‹¤. ğŸ™‚</p><h2 id="nginxconf-í™•ì¸"><a href="#nginxconf-í™•ì¸" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Nginx.conf í™•ì¸</h2><p>ê·¸ë˜ì„œ ì´ì œ ì´ê³¼ì •ì—ì„œ ë§Œë“¤ì–´ì§„ nginx podì— ì ‘ì†í•˜ì—¬ <code>nginx.conf</code> ê°’ì„ í™•ì¸í•´ë³´ê²Œ ë˜ì—ˆë‹¤. ì²˜ìŒì— Lua scriptë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ë³´ì—¬ì„œ, Lua scriptë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•œ ê²ƒì¸ê°€ ìƒê°ì´ ë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ ì­‰ ì‚´í´ë³´ë‹¤ê°€ ì•„ë˜ì˜ ì„¤ì •ë“¤ì„ ë³´ê²Œ ë˜ì—ˆë‹¤.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">real_ip_header      proxy_protocol<span class="token punctuation">;</span>
</span><span class="code-line">real_ip_recursive   on<span class="token punctuation">;</span>
</span></code></pre></div><p>ë­”ê°€ <code>ì•„í•˜!</code>í•˜ëŠ” ìƒê°ì´ ë“¤ì—ˆê³ , <a target="_blank" rel="noopener noreferrer" href="https://nginx.org/en/docs/http/ngx_http_realip_module.html">Nginx http_realip_module</a>ì„ í™•ì¸í•´ë³´ë‹ˆ ì•„ë˜ì™€ ê°™ì´ ì„¤ëª…ì´ ë˜ì–´ ìˆì—ˆë‹¤.</p><blockquote><p>Defines the request header field whose value will be used to replace the client address.</p></blockquote><p>ì´ì œ ëŠë‚Œì´ ì™€ì„œ ì‹ ë‚˜ì„œ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í–ˆì§€ë§Œ, ì—¬ì „íˆ 403 ì—ëŸ¬ë¥¼ ë¦¬í„´í–ˆë‹¤. ğŸ˜‡</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">http <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">..</span>.
</span><span class="code-line">  real_ip_header proxy_protocol<span class="token punctuation">;</span>
</span></code></pre></div><p>ì¢€ë” <code>nginx.conf</code>ë¥¼ ë³´ë‹ˆ <code>set_real_ip_from</code>ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. ì´ì œ ì•„ë˜ì²˜ëŸ¼ ì„¤ì •í•˜ê³  ë‚˜ë‹ˆ ì •ìƒì ìœ¼ë¡œ allow listì— ì ìš©ë˜ì–´ ë°ì´í„°ë¥¼ ë°›ì•„ì™”ë‹¤. ê·¸ë¦¬ê³  <code>$remote_addr</code>ì—ë„ client ipê°€ ì°íˆê²Œ ë˜ì—ˆë‹¤. ğŸ˜­ğŸ˜­</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">http <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token punctuation">..</span>.
</span><span class="code-line">  real_ip_header proxy_protocol<span class="token punctuation">;</span>
</span><span class="code-line">  real_ip_recursive on<span class="token punctuation">;</span>
</span><span class="code-line">  set_real_ip_from <span class="token number">0.0</span>.0.0/0<span class="token punctuation">;</span>
</span></code></pre></div><p>ì´ì œ <code>set_real_ip_from</code>ì€ load balancerê°€ internalí•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ” IP addressë¥¼ ì•Œê³  ìˆìœ¼ë‹ˆê¹, <code>0.0.0.0/0</code> ëŒ€ì‹ ì— <code>10.200.5.0/24</code>ì²˜ëŸ¼ ë„£ì–´ì„œ ë§ˆë¬´ë¦¬ë¥¼ í–ˆë‹¤.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">Kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/nginx">Nginx</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231122-cname-flattening">CNAME flattening</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231214-argocd-notification">Argo CD Notificationìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ Slack ì•Œë¦¼ ë³´ë‚´ê¸°</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">â† Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> â€¢ </div><div>Â© 2025</div><div> â€¢ </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003el(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=\u003e{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=\u003ek(i(l(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var t=u((P,r)=\u003e{r.exports=_jsx_runtime});var _={};N(_,{default:()=\u003eb,frontmatter:()=\u003ey});var e=g(t()),y={title:\"Kubernetes\\uC5D0\\uC11C Nginx\\uB85C IP allow list \\uC81C\\uC5B4\",date:\"2023-12-05\",tags:[\"Kubernetes\",\"Nginx\"],images:[\"/static/images/social-banner.png\"],summary:\"Kubernetes cluster\\uC5D0\\uC11C Nginx\\uB85C \\uD5C8\\uC6A9 \\uAC00\\uB2A5\\uD55C IP\\uB97C \\uC124\\uC815\\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. \\uAC04\\uB2E8\\uD558\\uAC8C \\uB05D\\uB0A0 \\uC904 \\uC54C\\uC558\\uB358 \\uC791\\uC5C5\\uC740 \\uB610\\uB2E4\\uB978 \\uC0BD\\uC9C8\\uAE30\\uAC00 \\uB418\\uC5C8\\uB2E4.\\u{1F62D} Kubernetes\\uC5D0\\uC11C SNAT\\uC774 \\uB418\\uB294 \\uACFC\\uC815\\uC744 \\uC774\\uD574\\uD558\\uACE0 externalTrafficPolicy\\uB97C Local\\uB85C \\uC124\\uC815\\uD588\\uB2E4. \\uADF8\\uB9AC\\uACE0 External Load balancer\\uC5D0\\uC11C\\uB294 client IP\\uB97C \\uC804\\uB2EC\\uD558\\uAE30 \\uC704\\uD574\\uC11C Proxy Protocol\\uC640 \\uAC19\\uC740 \\uAC83\\uC744 \\uC124\\uC815\\uD558\\uACE0, Nginx\\uC5D0\\uC11C \\uADF8 Proxy protocol\\uB85C \\uC804\\uB2EC\\uB41C IP address\\uB85C Access control\\uC744 \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"};function x(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",pre:\"pre\",code:\"code\",blockquote:\"blockquote\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"nginx-allow-ip-address\",children:[(0,e.jsx)(n.a,{href:\"#nginx-allow-ip-address\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Nginx allow IP address\"]}),(0,e.jsxs)(n.p,{children:[\"Kubernetes cluster\\uC5D0\\uC11C Nginx\\uB97C \\uD1B5\\uD574\\uC11C \\uD5C8\\uC6A9\\uB41C IP\\uB85C\\uB9CC \\uC811\\uADFC \\uAC00\\uB2A5\\uD558\\uAC8C \\uAD6C\\uC131\\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. Nginx\\uC758 \",(0,e.jsx)(n.a,{href:\"https://nginx.org/en/docs/http/ngx_http_access_module.html\",children:\"http_access_module\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \\uAC04\\uB2E8\\uD558\\uAC8C IP allow list\\uB098 deny list\\uB97C \\uC14B\\uD305\\uD560 \\uC218 \\uC788\\uC744 \\uAC83\\uC774\\uB77C \\uAE30\\uB300\\uB97C \\uD588\\uB2E4. \\uB530\\uB77C\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 Kubernetes object\\uB97C \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD574\\uBCF4\\uC558\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ConfigMap\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"clone\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nginx.conf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    user nginx;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    worker_processes  auto;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    error_log  /var/log/nginx/error.log;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    events {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      worker_connections  1024;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    }\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    http {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      log_format  main\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'remote_addr:$remote_addr\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'time_local:$time_local\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'method:$request_method\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'uri:$request_uri\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'host:$host\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'status:$status\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'bytes_sent:$body_bytes_sent\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'referer:$http_referer\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'useragent:$http_user_agent\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'forwardedfor:$http_x_forwarded_for\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'request_time:$request_time';\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      access_log /dev/stdout main;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      server {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        listen 80 default_server;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        location / {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          allow 40.150.119.175;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          deny all;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          proxy_pass http://example.com/;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          proxy_http_version 1.1;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        }\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      }\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"    }\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /etc/nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /var/log/nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` log\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"configMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"clone\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"items\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"key\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx.conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"path\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx.conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` log\n`]})]})}),(0,e.jsx)(n.p,{children:\"Naver Cloud\\uC758 Network Proxy Loadbalancer\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD558\\uC5EC \\uC544\\uB798\\uCC98\\uB7FC annotation\\uC744 \\uC815\\uC758\\uD558\\uC600\\uB2E4. Network Proxy Load balancer\\uC5D0\\uC11C TLS termination\\uC744 \\uD558\\uACE0, upstream\\uC5D0\\uB294 http\\uB85C \\uC811\\uADFC\\uC744 \\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-layer-type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nplb\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-ssl-certificate-no\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'4134'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-tls-ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'443'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-tls-min-version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` TLSV10\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` LoadBalancer\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"targetPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:\"allow 40.150.119.175;\"}),\" \\uC815\\uC758\\uB41C \\uAC83\\uCC98\\uB7FC \\uC811\\uC18D\\uD558\\uB294 client IP\\uAC00 \",(0,e.jsx)(n.code,{children:\"40.150.119.175\"}),\"\\uC778\\uB370, 403 response\\uB97C \\uBC1B\\uC558\\uB2E4. stdout\\uC73C\\uB85C \\uC124\\uC815\\uD55C access log\\uB97C \\uD655\\uC778\\uD574\\uBCF4\\uB2C8 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uAC00 Kubernetes cluster \\uB0B4\\uBD80\\uC758 IP address\\uB85C \\uCC0D\\uD614\\uB2E4. (\\uC608 \",(0,e.jsx)(n.code,{children:\"192.18.7.140\"}),\", \",(0,e.jsx)(n.code,{children:\"192.18.0.55\"}),\") \\uACE0\\uBBFC\\uD574\\uBCF4\\uB2C8 Kubernetes\\uC5D0\\uC11C\\uB294 kube-proxy\\uAC00 SNAT\\uC744 \\uD558\\uB294 \\uBD80\\uBD84\\uC774 \\uC0DD\\uAE38 \\uC218 \\uC788\\uB2E4\\uB77C\\uB294 \\uAC83\\uC774 \\uC0DD\\uAC01\\uB0AC\\uB2E4. Node port\\uB098 Load Balancer type\\uC758 \\uC11C\\uBE44\\uC2A4\\uC5D0 \\uC811\\uADFC\\uD560 \\uB54C, Worker node\\uC758 port\\uB85C \\uC811\\uADFC\\uD558\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB7F0\\uB370 \\uC811\\uADFC\\uD558\\uB294 Worker node\\uC5D0 \\uD1B5\\uC2E0\\uD558\\uB824\\uB294 Pod\\uAC00 \\uC788\\uC744 \\uC218\\uB3C4 \\uC788\\uACE0 \\uC5C6\\uC744 \\uC218\\uB3C4 \\uC788\\uB2E4. \\uC5C6\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB3C4 kube-proxy\\uB97C \\uD1B5\\uD574\\uC11C \\uC788\\uB294 Node \\uCABD\\uC73C\\uB85C routing\\uC774 \\uB420 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 Iptable\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uC544\\uB798\\uCC98\\uB7FC traffic\\uC744 random\\uD558\\uAC8C \\uBD84\\uBC30\\uD574\\uC904 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB798\\uC11C pod\\uAC00 \\uC5EC\\uB7EC \\uAC1C \\uC788\\uC744 \\uB54C kube-proxy\\uB97C \\uD1B5\\uD574\\uC11C load balancing\\uB3C4 \\uB41C\\uB2E4. \\uADF8\\uB7EC\\uB294 \\uACFC\\uC815\\uC5D0\\uC11C SNAT\\uC73C\\uB85C client ip\\uAC00 \\uC720\\uC2E4 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" iptables -t nat -A OUTPUT -d \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.99\"}),\".99.32 -j DNAT --to-destination \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.244\"}),`.15.196\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" iptables -t nat -A OUTPUT -p tcp -d \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.99\"}),\".99.32 --dport \",(0,e.jsx)(n.span,{className:\"token number\",children:\"27017\"}),\" -m statistic --mode random --probability \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.50000000000\"}),\" -j DNAT --to-destination \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.244\"}),`.14.195:8090\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" iptables -t nat -A OUTPUT -p tcp -d \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.99\"}),\".99.32 --dport \",(0,e.jsx)(n.span,{className:\"token number\",children:\"27017\"}),\" -j DNAT --to-destination \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.244\"}),`.14.196:8090\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uAE30\\uBCF8\\uC801\\uC73C\\uB85C \",(0,e.jsx)(n.code,{children:\"service.spec.externalTrafficPolicy\"}),\"\\uB294 Cluster\\uB85C \\uC124\\uC815\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4. \\uC704\\uC5D0\\uC11C \\uC124\\uBA85\\uD55C \\uAC83\\uCC98\\uB7FC \\uC791\\uB3D9\\uC774 \\uB41C\\uB2E4. \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC5D0\\uC11C\\uB294 CNI\\uB85C cilium\\uC744 \\uC4F0\\uACE0 \\uC788\\uB294\\uB370, access log\\uC5D0 \\uCC0D\\uD614\\uB358 \",(0,e.jsx)(n.code,{children:\"192.18.7.140\"}),\", \",(0,e.jsx)(n.code,{children:\"192.18.0.55\"}),\"\\uB294 cilium host ip\\uC600\\uB2E4. \",(0,e.jsx)(n.code,{children:\"kubectl describe node\"}),\"\\uB97C \\uBCF4\\uB2C8 \",(0,e.jsx)(n.code,{children:\"io.cilium.network.ipv4-cilium-host\"}),\" annotation\\uC774 \\uBD99\\uC5B4 \\uC788\\uC5C8\\uACE0, \\uC774 \\uAC12\\uC774 log\\uC5D0 \\uCC0D\\uD614\\uB358 IP address\\uC600\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB7FC \\uC774\\uC81C client ip\\uB97C \\uC720\\uC9C0\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,e.jsx)(n.code,{children:\"service.spec.externalTrafficPolicy\"}),\"\\uB97C Local\\uB85C \\uBCC0\\uACBD\\uD558\\uC600\\uB2E4. \\uC774\\uC81C Load balancer\\uC758 CIDR\\uC758 IP address\\uAC00 access log\\uC5D0 \\uCC0D\\uD788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"Local\"}),\"\\uB85C \\uD588\\uC744 \\uB54C\\uB294 \\uC774\\uC81C \\uC5F0\\uACB0\\uB41C Node\\uB0B4\\uC758 pod endpoint\\uB9CC \\uC811\\uC18D\\uC744 \\uC2DC\\uB3C4\\uD558\\uACE0 \\uC5C6\\uC73C\\uBA74 packet\\uC774 drop\\uB41C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"Load balancer\"}),\" type\\uC73C\\uB85C \\uC11C\\uBE44\\uC2A4\\uB97C \\uC0DD\\uC131\\uD558\\uACE0, Node\\uAC00 \\uC138 \\uAC1C\\uB77C\\uACE0 \\uD55C\\uB2E4\\uACE0 \\uD558\\uBA74 Load balancer\\uC758 Target\\uC73C\\uB85C \\uC138 \\uAC1C\\uC758 Node\\uAC00 \\uBD99\\uC744 \\uAC83\\uC774\\uB2E4. \\uADF8\\uB7F0\\uB370 service\\uC758 endpoint\\uAC00 \\uD558\\uB098\\uB9CC \\uC874\\uC7AC\\uD55C\\uB2E4\\uACE0 \\uD558\\uBA74(running\\uC911\\uC778 pod\\uAC00 \\uD558\\uB098\\uB77C\\uBA74), \\uADF8 pod\\uAC00 \\uC788\\uB294 Node\\uC740 health check\\uB97C \\uC131\\uACF5\\uD558\\uACE0 \\uB098\\uBA38\\uC9C0 Node\\uC5D0\\uC11C\\uB294 \\uC2E4\\uD328\\uD55C\\uB2E4. Load balancer\\uC5D0\\uC11C healthy\\uD55C Node\\uC5D0\\uB9CC traffic\\uC744 \\uBCF4\\uB0B4\\uAE30 \\uB54C\\uBB38\\uC5D0, \",(0,e.jsx)(n.code,{children:\"Local\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uC5EC\\uB3C4 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uD2B8\\uB798\\uD53D\\uC744 \\uC804\\uB2EC\\uD560 \\uC218\\uAC00 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \\uC544\\uC9C1\\uB3C4 \\uBB38\\uC81C\\uAC00 \\uC788\\uB2E4. Load balancer\\uC758 IP address\\uB294 \\uCD5C\\uCD08\\uC758 \\uC694\\uCCAD\\uD558\\uB294 client IP\\uAC00 \\uC544\\uB2C8\\uAE30 \\uB54C\\uBB38\\uC5D0 \",(0,e.jsx)(n.code,{children:\"allow 40.150.119.175;\"}),\"\\uB97C \\uB9CC\\uC871\\uD558\\uC9C0 \\uC54A\\uB294\\uB2E4. \\uB3D9\\uC77C\\uD558\\uAC8C 403 \\uC5D0\\uB7EC\\uAC00 \\uBC1C\\uC0DD\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"x-forwared-for--proxy-protocol\",children:[(0,e.jsx)(n.a,{href:\"#x-forwared-for--proxy-protocol\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"X-Forwared-For \u0026 Proxy Protocol\"]}),(0,e.jsxs)(n.p,{children:[\"source ip\\uB97C \\uC804\\uB2EC\\uD558\\uB294 \\uBC29\\uBC95\\uC73C\\uB85C Header\\uC5D0 \",(0,e.jsx)(n.code,{children:\"X-Forwarded-For\"}),\", \",(0,e.jsx)(n.code,{children:\"X-Real-IP\"}),\"\\uC5D0 hop\\uD558\\uB294 Ip address\\uB97C \\uB2F4\\uC544\\uC11C \\uBCF4\\uB0B4\\uB294 \\uAC83\\uB3C4 \\uC788\\uACE0, L4\\uC5D0\\uC11C \\uC804\\uB2EC\\uD560 \\uB54C Proxy Protocol\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC804\\uB2EC\\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4. \\uC774\\uC81C \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC Load balancer\\uC5D0\\uC11C\\uB3C4 proxy protocol\\uB97C \\uC9C0\\uC6D0\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC544\\uB798\\uCC98\\uB7FC annotation\\uC744 \\uCD94\\uAC00\\uD558\\uC5EC source ip\\uB97C \\uC804\\uB2EC\\uD558\\uB3C4\\uB85D \\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-proxy-protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'true'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 Nginx\\uC5D0\\uC11C Proxy protocol\\uC744 \\uBC1B\\uC744 \\uC218 \\uC788\\uACE0, \\uADF8\\uAC83\\uC744 access log\\uC5D0 \\uBCF4\\uC5EC \\uC904 \\uC218 \\uC788\\uB3C4\\uB85D \\uC218\\uC815\\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"$proxy_protocol_add\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C source ip\\uB97C \\uBCF4\\uC5EC\\uC904 \\uC218 \\uC788\\uACE0, proxy protocol\\uC744 accept\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \",(0,e.jsx)(n.code,{children:\"listen 80 proxy_protocol\"}),\"\\uB85C \\uC815\\uC758\\uB97C \\uD574\\uC900\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"http \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  log_format  main\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'remote_addr:$remote_addr\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'time_local:$time_local\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'method:$request_method\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'uri:$request_uri\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'host:$host\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'status:$status\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'bytes_sent:$body_bytes_sent\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'referer:$http_referer\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'useragent:$http_user_agent\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'forwardedfor:$http_x_forwarded_for\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'proxy_addr:$proxy_protocol_addr\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'request_time:$request_time'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  access_log /dev/stdout main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    listen \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),\" proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    location / \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uB807\\uAC8C \\uD574\\uC8FC\\uBA74 \\uB420 \\uC904 \\uC54C\\uC558\\uC9C0\\uB9CC, \\uC5EC\\uC804\\uD788 403\\uB97C \\uBC49\\uC5B4 \\uB0B4\\uC5C8\\uB2E4. \\u{1F62D}\\u{1F62D} \",(0,e.jsx)(n.code,{children:\"$proxy_protocol_addr\"}),\"\\uB294 \\uC774\\uC81C client Ip\\uAC00 \\uCC0D\\uD614\\uC9C0\\uB9CC, \\uC5EC\\uC804\\uD788 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uB294 Load balancer\\uC758 Ip\\uAC00 \\uCC0D\\uD614\\uB2E4. \\uADF8\\uB798\\uC11C \\uC21C\\uAC04 Lua\\uB85C module\\uC744 \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uD574\\uB2F9 \\uC815\\uBCF4\\uB97C \\uBB54\\uAC00 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uC5D0 \\uC124\\uC815\\uD574\\uC918\\uC57C \\uD558\\uB294\\uAC74\\uAC00 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"nginx-ingress-controller\",children:[(0,e.jsx)(n.a,{href:\"#nginx-ingress-controller\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Nginx Ingress Controller\"]}),(0,e.jsxs)(n.p,{children:[\"\\uB9C8\\uCE68 \",(0,e.jsx)(n.code,{children:\"Nginx Ingress Controller\"}),\"\\uB3C4 \\uAC19\\uC774 \\uD14C\\uC2A4\\uD2B8\\uD574\\uBCF4\\uACE0 \\uC788\\uB294 \\uC0C1\\uD669\\uC774\\uC5B4\\uC11C \",(0,e.jsx)(n.code,{children:\"Nginx Ingress Controller\"}),\"\\uC5D0\\uC11C\\uB294 Proxy protocol\\uB85C \\uBCF4\\uB0B8 client ip\\uB85C allow list \\uD655\\uC778\\uC744 \\uC5B4\\uB5BB\\uAC8C \\uD558\\uB294\\uC9C0 \\uCC3E\\uC544\\uBCF4\\uAE30 \\uC2DC\\uC791\\uD588\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://github.com/kubernetes/ingress-nginx/issues/4305\",children:\"Nginx Ingress Controller \\uAE43\\uD5D9\\uC758 \\uC774\\uC288\"}),\"\\uC5D0\\uC11C \\uC0AC\\uBB34\\uC2E4 IP CIDR\\uB85C \\uC811\\uADFC \\uC81C\\uC5B4\\uAC00 \\uB418\\uC5C8\\uB2E4\\uB77C\\uB294 \\uC774\\uC57C\\uAE30\\uAC00 \\uB098\\uC654\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"Nginx Ingress Controller\\uC758 Resource\\uB4E4\\uC744 \\uB9CC\\uB4E4\\uB54C, ConfigMap\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"use-proxy-protocol\"}),\"\\uC744 \",(0,e.jsx)(n.code,{children:\"true\"}),\"\\uB85C \\uC124\\uC815\\uC744 \\uD574\\uC92C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"allow-snippet-annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"use-proxy-protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ConfigMap\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/component\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` controller\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/instance\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/part-of\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` 1.8.2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`controller\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB9AC\\uACE0 Ingress\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uC774 annotation\\uC744 \\uCD94\\uAC00\\uD558\\uC5EC Ip allow list\\uB97C \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` networking.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Ingress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`ingress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kubernetes.io/ingress.class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'nginx'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nginx.ingress.kubernetes.io/whitelist-source-range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'40.150.119.175'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uB9CC\\uB4E4\\uC5B4\\uC9C4 Load balancer\\uC758 proxy protocol \\uC124\\uC815\\uC744 enable\\uD574\\uC8FC\\uACE0, \\uC811\\uC18D\\uD558\\uB2C8\\uAE50 \\uC774\\uC81C \\uB4DC\\uB514\\uC5B4 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC811\\uC18D\\uC774 \\uB418\\uC5C8\\uB2E4. \",(0,e.jsx)(n.code,{children:\"whitelist-source-range\"}),\"\\uB97C \\uBCC0\\uACBD\\uD558\\uB2C8\\uAE50 \\uC774\\uC81C \\uB2E4\\uC2DC 403 \\uC5D0\\uB7EC\\uB97C \\uB9AC\\uD134 \\uBC1B\\uC558\\uB2E4. \\u{1F642}\"]}),(0,e.jsxs)(n.h2,{id:\"nginxconf-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{href:\"#nginxconf-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Nginx.conf \\uD655\\uC778\"]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB798\\uC11C \\uC774\\uC81C \\uC774\\uACFC\\uC815\\uC5D0\\uC11C \\uB9CC\\uB4E4\\uC5B4\\uC9C4 nginx pod\\uC5D0 \\uC811\\uC18D\\uD558\\uC5EC \",(0,e.jsx)(n.code,{children:\"nginx.conf\"}),\" \\uAC12\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4. \\uCC98\\uC74C\\uC5D0 Lua script\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294\\uAC8C \\uBCF4\\uC5EC\\uC11C, Lua script\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uD574\\uACB0\\uD55C \\uAC83\\uC778\\uAC00 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uCB49 \\uC0B4\\uD3B4\\uBCF4\\uB2E4\\uAC00 \\uC544\\uB798\\uC758 \\uC124\\uC815\\uB4E4\\uC744 \\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"real_ip_header      proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"real_ip_recursive   on\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uBB54\\uAC00 \",(0,e.jsx)(n.code,{children:\"\\uC544\\uD558!\"}),\"\\uD558\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uACE0, \",(0,e.jsx)(n.a,{href:\"https://nginx.org/en/docs/http/ngx_http_realip_module.html\",children:\"Nginx http_realip_module\"}),\"\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uB2C8 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Defines the request header field whose value will be used to replace the client address.\"})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uB290\\uB08C\\uC774 \\uC640\\uC11C \\uC2E0\\uB098\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uCD94\\uAC00\\uD588\\uC9C0\\uB9CC, \\uC5EC\\uC804\\uD788 403 \\uC5D0\\uB7EC\\uB97C \\uB9AC\\uD134\\uD588\\uB2E4. \\u{1F607}\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"http \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  real_ip_header proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC880\\uB354 \",(0,e.jsx)(n.code,{children:\"nginx.conf\"}),\"\\uB97C \\uBCF4\\uB2C8 \",(0,e.jsx)(n.code,{children:\"set_real_ip_from\"}),\"\\uAC00 \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4. \\uC774\\uC81C \\uC544\\uB798\\uCC98\\uB7FC \\uC124\\uC815\\uD558\\uACE0 \\uB098\\uB2C8 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C allow list\\uC5D0 \\uC801\\uC6A9\\uB418\\uC5B4 \\uB370\\uC774\\uD130\\uB97C \\uBC1B\\uC544\\uC654\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uC5D0\\uB3C4 client ip\\uAC00 \\uCC0D\\uD788\\uAC8C \\uB418\\uC5C8\\uB2E4. \\u{1F62D}\\u{1F62D}\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"http \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  real_ip_header proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  real_ip_recursive on\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  set_real_ip_from \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.0\"}),\".0.0/0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C \",(0,e.jsx)(n.code,{children:\"set_real_ip_from\"}),\"\\uC740 load balancer\\uAC00 internal\\uD558\\uAC8C \\uB9CC\\uB4E4\\uC5B4\\uC9C0\\uB294 IP address\\uB97C \\uC54C\\uACE0 \\uC788\\uC73C\\uB2C8\\uAE50, \",(0,e.jsx)(n.code,{children:\"0.0.0.0/0\"}),\" \\uB300\\uC2E0\\uC5D0 \",(0,e.jsx)(n.code,{children:\"10.200.5.0/24\"}),\"\\uCC98\\uB7FC \\uB123\\uC5B4\\uC11C \\uB9C8\\uBB34\\uB9AC\\uB97C \\uD588\\uB2E4.\"]})]})}}var b=x;return _;})();\n;return Component;","toc":[{"value":"Nginx allow IP address","url":"#nginx-allow-ip-address","depth":2},{"value":"X-Forwared-For \u0026 Proxy Protocol","url":"#x-forwared-for--proxy-protocol","depth":2},{"value":"Nginx Ingress Controller","url":"#nginx-ingress-controller","depth":2},{"value":"Nginx.conf í™•ì¸","url":"#nginxconf-í™•ì¸","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.425,"time":445500,"words":1485},"slug":"20231205-nginx-allow-ip","fileName":"20231205-nginx-allow-ip.md","title":"Kubernetesì—ì„œ Nginxë¡œ IP allow list ì œì–´","date":"2023-12-05T00:00:00.000Z","tags":["Kubernetes","Nginx"],"images":["/static/images/social-banner.png"],"summary":"Kubernetes clusterì—ì„œ Nginxë¡œ í—ˆìš© ê°€ëŠ¥í•œ IPë¥¼ ì„¤ì •í•˜ê³  ì‹¶ì—ˆë‹¤. ê°„ë‹¨í•˜ê²Œ ëë‚  ì¤„ ì•Œì•˜ë˜ ì‘ì—…ì€ ë˜ë‹¤ë¥¸ ì‚½ì§ˆê¸°ê°€ ë˜ì—ˆë‹¤.ğŸ˜­ Kubernetesì—ì„œ SNATì´ ë˜ëŠ” ê³¼ì •ì„ ì´í•´í•˜ê³  externalTrafficPolicyë¥¼ Localë¡œ ì„¤ì •í–ˆë‹¤. ê·¸ë¦¬ê³  External Load balancerì—ì„œëŠ” client IPë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ Proxy Protocolì™€ ê°™ì€ ê²ƒì„ ì„¤ì •í•˜ê³ , Nginxì—ì„œ ê·¸ Proxy protocolë¡œ ì „ë‹¬ëœ IP addressë¡œ Access controlì„ í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"CNAME flattening","date":"2023-11-22T00:00:00.000Z","tags":["DNS"],"images":["/static/images/social-banner.png"],"summary":"CNAME flatteningì´ ì–´ë–»ê²Œ ì‘ë™í•˜ê³ , ì™œ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆëŠ”ì§€ ì´í•´í•˜ê²Œ ë˜ì—ˆë‹¤.","slug":"20231122-cname-flattening"},"next":{"title":"Argo CD Notificationìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ Slack ì•Œë¦¼ ë³´ë‚´ê¸°","date":"2023-12-14T00:00:00.000Z","tags":["Kubernetes","ArgoCD"],"images":["/static/images/social-banner.png"],"summary":"Argo CD Notificationê°€ ì´ë¯¸ ìˆì–´ì„œ ì‰½ê²Œ Slack ì•Œë¦¼ì„ ì—°ë™í•  ìˆ˜ ìˆë‹¤. ë©”ë‰´ì–¼ì—ì„œ ì¹œì ˆí•˜ê²Œ ì…‹íŒ… ë°©ë²•ì„ ì„¤ëª…í•˜ê³  ìˆì§€ë§Œ, ì²˜ìŒ ë³´ê³  ì…‹íŒ…í•  ë•Œ ë†“ì¹  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ ê¸°ë¡ìœ¼ë¡œ ë‚¨ê¸´ë‹¤.","slug":"20231214-argocd-notification"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20231205-nginx-allow-ip"]},"buildId":"bYSCJYJzTgWi7GtrLxUb1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>