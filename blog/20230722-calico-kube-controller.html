<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Calico kube-controller 이해하기</title><meta name="robots" content="follow, index"/><meta name="description" content="Calico에서 어떻게 CRD를 활용하는지 이해하기 위해서 Calico Opensource 버전의 깃헙 소스코드를 살펴보게 되었다. Calico archiecture에서 kube-controller 부분이 어떤 역할을 하는지 소스 코드를 통해서 이해할 수 있게 되었다. kube-controller들은 kubernetes native resource에 대한 변경을 calico data store와 sync해주는 역할을 하고 있다. 내가 사용하는 Minikbue Kubernetes Cluster에서는 Calico의 data store는 kubernetes로 설정되어 있기 때문에, CRD로 Calico data들이 저장되고 Felix가 이것을 watch하여 변화에 대해서 network rule을 업데이트 하게 된다."/><meta property="og:url" content="https://jayground8.github.io/jayground8//blog/20230722-calico-kube-controller"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Calico에서 어떻게 CRD를 활용하는지 이해하기 위해서 Calico Opensource 버전의 깃헙 소스코드를 살펴보게 되었다. Calico archiecture에서 kube-controller 부분이 어떤 역할을 하는지 소스 코드를 통해서 이해할 수 있게 되었다. kube-controller들은 kubernetes native resource에 대한 변경을 calico data store와 sync해주는 역할을 하고 있다. 내가 사용하는 Minikbue Kubernetes Cluster에서는 Calico의 data store는 kubernetes로 설정되어 있기 때문에, CRD로 Calico data들이 저장되고 Felix가 이것을 watch하여 변화에 대해서 network rule을 업데이트 하게 된다."/><meta property="og:title" content="Calico kube-controller 이해하기"/><meta property="og:image" content="https://jayground8.github.io/jayground8/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Calico kube-controller 이해하기"/><meta name="twitter:description" content="Calico에서 어떻게 CRD를 활용하는지 이해하기 위해서 Calico Opensource 버전의 깃헙 소스코드를 살펴보게 되었다. Calico archiecture에서 kube-controller 부분이 어떤 역할을 하는지 소스 코드를 통해서 이해할 수 있게 되었다. kube-controller들은 kubernetes native resource에 대한 변경을 calico data store와 sync해주는 역할을 하고 있다. 내가 사용하는 Minikbue Kubernetes Cluster에서는 Calico의 data store는 kubernetes로 설정되어 있기 때문에, CRD로 Calico data들이 저장되고 Felix가 이것을 watch하여 변화에 대해서 network rule을 업데이트 하게 된다."/><meta name="twitter:image" content="https://jayground8.github.io/jayground8/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/jayground8//blog/20230722-calico-kube-controller"/><meta property="article:published_time" content="2023-07-22T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/jayground8//blog/20230722-calico-kube-controller"
  },
  "headline": "Calico kube-controller 이해하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/jayground8/social-banner.png"
    }
  ],
  "datePublished": "2023-07-22T00:00:00.000Z",
  "dateModified": "2023-07-22T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jaemyun Lee"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jaemyun Lee",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/jayground8/playground.png"
    }
  },
  "description": "Calico에서 어떻게 CRD를 활용하는지 이해하기 위해서 Calico Opensource 버전의 깃헙 소스코드를 살펴보게 되었다. Calico archiecture에서 kube-controller 부분이 어떤 역할을 하는지 소스 코드를 통해서 이해할 수 있게 되었다. kube-controller들은 kubernetes native resource에 대한 변경을 calico data store와 sync해주는 역할을 하고 있다. 내가 사용하는 Minikbue Kubernetes Cluster에서는 Calico의 data store는 kubernetes로 설정되어 있기 때문에, CRD로 Calico data들이 저장되고 Felix가 이것을 watch하여 변화에 대해서 network rule을 업데이트 하게 된다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6da01d8c4d117037.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/6wD5WOxHuwCf3uz6-6MEg/_buildManifest.js" defer=""></script><script src="/_next/static/6wD5WOxHuwCf3uz6-6MEg/_ssgManifest.js" defer=""></script><script src="/_next/static/6wD5WOxHuwCf3uz6-6MEg/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">블로그</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">블로그</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-07-22T00:00:00.000Z">2023년 7월 22일 토요일</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Calico kube-controller 이해하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jaemyun Lee</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>이전에 <code>kubebuilder</code>를 통해서 <code>Programming Kubernetes</code>에서 설명한 <a target="_blank" rel="noopener noreferrer" href="https://jayground8.github.io/blog/20230715-k8s-controller">At resource를 watch하는 Custom controller를 직접 작성</a>했다. 그다음에는 ifkakao(2022) <code>Testing Kubernetes Controller</code> 발표에서 사용된 <a target="_blank" rel="noopener noreferrer" href="https://jayground8.github.io/blog/20230716-if-kakao-2022-k8s-controller">example인 BlueGreen resource에 대한 Custom controller를 kubebuilder로 작성</a>했다. 이번에는 Calico에서 어떻게 CRD와 Custom contoller를 활용하고 있는지 <a target="_blank" rel="noopener noreferrer" href="https://github.com/projectcalico/calico">Source code</a>를 확인해봤다. (이 글을 작성하는 시점에는 Calico OpenSource Version 3.26을 확인하였다.)</p><h2 id="calico-kube-controllers"><a href="#calico-kube-controllers" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Calico kube-controllers</h2><p>source code를 보면 <code>kube-controllers</code> 디렉터리 안에 아래처럼 controller 코드가 있는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token builtin class-name">.</span>
</span><span class="code-line">├── controller
</span><span class="code-line">│   └── controller.go
</span><span class="code-line">├── flannelmigration
</span><span class="code-line">│   ├── config.go
</span><span class="code-line">│   ├── config_test.go
</span><span class="code-line">│   ├── flannel_migration_fv_test.go
</span><span class="code-line">│   ├── flannelmigration_suite_test.go
</span><span class="code-line">│   ├── ipam_migrator.go
</span><span class="code-line">│   ├── k8s_resources.go
</span><span class="code-line">│   ├── migration_controller.go
</span><span class="code-line">│   └── network_migrator.go
</span><span class="code-line">├── namespace
</span><span class="code-line">│   ├── namespace_controller.go
</span><span class="code-line">│   ├── namespace_controller_fv_test.go
</span><span class="code-line">│   └── namespace_suite_test.go
</span><span class="code-line">├── networkpolicy
</span><span class="code-line">│   ├── policy_controller.go
</span><span class="code-line">│   ├── policy_controller_fv_test.go
</span><span class="code-line">│   └── policy_suite_test.go
</span><span class="code-line">├── node
</span><span class="code-line">│   ├── auto_hep_fv_test.go
</span><span class="code-line">│   ├── controller.go
</span><span class="code-line">│   ├── errors.go
</span><span class="code-line">│   ├── etcd_ipam_gc_fv_test.go
</span><span class="code-line">│   ├── fake_client.go
</span><span class="code-line">│   ├── hostendpoints.go
</span><span class="code-line">│   ├── ipam.go
</span><span class="code-line">│   ├── ipam_allocation.go
</span><span class="code-line">│   ├── ipam_test.go
</span><span class="code-line">│   ├── kdd_ipam_gc_fv_test.go
</span><span class="code-line">│   ├── labels.go
</span><span class="code-line">│   ├── metrics_fv_test.go
</span><span class="code-line">│   ├── node_controller_fv_test.go
</span><span class="code-line">│   ├── node_deleter.go
</span><span class="code-line">│   ├── node_suite_test.go
</span><span class="code-line">│   ├── pool_manager.go
</span><span class="code-line">│   └── syncer.go
</span><span class="code-line">├── pod
</span><span class="code-line">│   ├── pod_controller.go
</span><span class="code-line">│   ├── pod_controller_fv_test.go
</span><span class="code-line">│   └── pod_suite_test.go
</span><span class="code-line">└── serviceaccount
</span><span class="code-line">    ├── serviceaccount_controller.go
</span><span class="code-line">    ├── serviceaccount_controller_fv_test.go
</span><span class="code-line">    └── serviceaccount_suite_test.go
</span></code></pre></div><p><code>Makefile</code>를 확인해보면 아래와 같이 build환경을 갖춘 Container Image를 통해서 compile을 하게 된다. (기타 arguments 생략)</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">go build -o bin/kube-controllers-linux-amd64 ./cmd/kube-controllers/
</span></code></pre></div><p>build하는 <code>/cmd/kube-controllers</code>의 <code>main.go</code>를 확인해보면, <code>controllerControl</code>이라는 struct type에 Controller instance들을 저장하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">controllerCtrl <span class="token operator">:=</span> <span class="token operator">&amp;</span>controllerControl<span class="token punctuation">{</span>
</span><span class="code-line">		ctx<span class="token punctuation">:</span>         ctx<span class="token punctuation">,</span>
</span><span class="code-line">		controllers<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>controller<span class="token punctuation">.</span>Controller<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">		stop<span class="token punctuation">:</span>        stop<span class="token punctuation">,</span>
</span><span class="code-line">		informers<span class="token punctuation">:</span>   <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>cache<span class="token punctuation">.</span>SharedIndexInformer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span></code></pre></div><p><code>InitControllers</code> method를 확인하면 설정값에 따라서 <code>Pod</code>, <code>Namespace</code>, <code>NetworkPolicy</code>, <code>Node</code>, <code>ServiceAccount</code>에 관련된 controller를 설정하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">controllerCtrl<span class="token punctuation">.</span><span class="token function">InitControllers</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> runCfg<span class="token punctuation">,</span> k8sClientset<span class="token punctuation">,</span> calicoClient<span class="token punctuation">)</span>
</span></code></pre></div><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">if</span> cfg<span class="token punctuation">.</span>Controllers<span class="token punctuation">.</span>WorkloadEndpoint <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">  podController <span class="token operator">:=</span> pod<span class="token punctuation">.</span><span class="token function">NewPodController</span><span class="token punctuation">(</span><span class="token operator">...</span>생략<span class="token punctuation">)</span>
</span><span class="code-line">  cc<span class="token punctuation">.</span>controllers<span class="token punctuation">[</span><span class="token string">&quot;Pod&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> podController
</span><span class="code-line">  cc<span class="token punctuation">.</span><span class="token function">registerInformers</span><span class="token punctuation">(</span>podInformer<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> cfg<span class="token punctuation">.</span>Controllers<span class="token punctuation">.</span>Namespace <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">  namespaceController <span class="token operator">:=</span> namespace<span class="token punctuation">.</span><span class="token function">NewNamespaceController</span><span class="token punctuation">(</span><span class="token operator">...</span>생략<span class="token punctuation">)</span>
</span><span class="code-line">  cc<span class="token punctuation">.</span>controllers<span class="token punctuation">[</span><span class="token string">&quot;Namespace&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> namespaceController
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">...</span>생략
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://docs.tigera.io/calico/latest/reference/kube-controllers/configuration#the-calicokube-controllers-container">kube-controller에 대한 설정값을 문서</a>를 확인해보면 calico datasource로 Kubernetes의 etcd를 공유해서 사용하고 싶으면 환경 변수 <code>DATASTORE_TYPE</code> 값을 <code>kubernetes</code>로 설정해줘야 한다. 그리고 <code>node</code>에 관한 <code>kube-controller</code>를 enable하기 위해서 <code>ENABLED_CONTROLLERS</code>환경변수를 <code>node</code>로 설정해야 한다. 나머지 controller는 default로 enable되기 때문에 사용하지 않고 싶을 때만 명시적으로 환경변수로 disable 시켜줘야 한다.</p><p>나는 Minikube에서 Addon으로 Calico를 추가해서 Kubernetes cluster를 사용하고 있다. 그래서 <code>calico-kube-controllers</code>의 환경변수 설정값을 확인하니 아래처럼 설정된 것을 확인 할 수 있었다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl describe deployments calico-kube-controllers -n kube-system
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">Environment:
</span><span class="code-line">  ENABLED_CONTROLLERS:  node
</span><span class="code-line">  DATASTORE_TYPE:       kubernetes
</span></code></pre></div><p>그다음에 <code>main.go</code>에서 최종적으로 <code>RunController</code> method를 호출하고, goroutine으로 <code>controllerControl</code> struct에 추가했던 <code>informer</code>와 <code>controller</code>들의 Run method를 호출해준다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>cc <span class="token operator">*</span>controllerControl<span class="token punctuation">)</span> <span class="token function">RunControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> inf <span class="token operator">:=</span> <span class="token keyword">range</span> cc<span class="token punctuation">.</span>informers <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">WithField</span><span class="token punctuation">(</span><span class="token string">&quot;informer&quot;</span><span class="token punctuation">,</span> inf<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Starting informer&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">go</span> inf<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>stop<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">for</span> controllerType<span class="token punctuation">,</span> c <span class="token operator">:=</span> <span class="token keyword">range</span> cc<span class="token punctuation">.</span>controllers <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">WithField</span><span class="token punctuation">(</span><span class="token string">&quot;ControllerType&quot;</span><span class="token punctuation">,</span> controllerType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Starting controller&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">go</span> c<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>stop<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">select</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>cc<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token string">&quot;context cancelled&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>cc<span class="token punctuation">.</span>restart<span class="token punctuation">:</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token string">&quot;configuration changed; restarting&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token function">close</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>stop<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>c.Run(cc.stop)</code>은 아래처럼 work process를 groutine으로 실행하게 되고, workqueue에 item이 추가될때까지 기다리게 되는 무한 loop으로 돌아간다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> c<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span>NumberOfWorkers<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">go</span> c<span class="token punctuation">.</span><span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">...</span>생략
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>namespaceController<span class="token punctuation">)</span> <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">for</span> c<span class="token punctuation">.</span><span class="token function">processNextItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>namespaceController<span class="token punctuation">)</span> <span class="token function">processNextItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
</span><span class="code-line">	workqueue <span class="token operator">:=</span> c<span class="token punctuation">.</span>resourceCache<span class="token punctuation">.</span><span class="token function">GetQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token operator">...</span> 생략
</span><span class="code-line">  workqueue<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">return</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>각각의 contoller가 하는 일은 <a target="_blank" rel="noopener noreferrer" href="https://docs.tigera.io/calico/latest/reference/kube-controllers/configuration#the-calicokube-controllers-container">문서에서 아래처럼 친절하게 설명되어 있다</a>.</p><ul><li>policy controller: watches Kubernetes network policies in the Kubernetes API, and syncs the policies to the datastore (etcd) as Calico network policies. Felix implements network policies in the dataplane.</li><li>namespace controller: watches namespaces and programs Calico profiles.</li><li>serviceaccount controller: watches service accounts and programs Calico profiles.</li><li>workloadendpoint controller: watches for changes to pod labels and updates Calico workload endpoints.</li><li>node controller: watches for the removal of Kubernetes nodes and removes corresponding data from Calico, and optionally watches for node updates to create and sync host endpoints for each node.</li></ul><p>이제 controller의 코드를 확인해본다. 이전에는 kubebuilder로 bootstrap을 해서 작성을 했었다. calico에서는 kubebuilder를 쓰는 것이 아니기 때문에, <a target="_blank" rel="noopener noreferrer" href="https://github.com/kubernetes/code-generator">kubernetes code-generator</a>를 활용하여 custom controller를 작성하는 방법을 참조하여 코드를 이해했다.</p><h3 id="pod-controller"><a href="#pod-controller" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>pod controller</h3><p><code>workloadendpoint controller</code>는 Pod informer를 사용하고 있다. <code>informer factory</code>를 통해서 worker들이 공유해서 사용할 수 있는 <code>informer</code>를 생성한다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">factory <span class="token operator">:=</span> informers<span class="token punctuation">.</span><span class="token function">NewSharedInformerFactory</span><span class="token punctuation">(</span>k8sClientset<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line">podInformer <span class="token operator">:=</span> factory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Informer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p><code>controller</code>에서는 인자로 전달된 informer에 이제 <code>ADD</code>, <code>UPDATE</code>, <code>DELETE</code> event를 처리할 event handler를 추가하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> informer<span class="token punctuation">.</span><span class="token function">AddEventHandler</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">{</span>
</span><span class="code-line">		AddFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    UpdateFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>oldObj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> newObj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    DeleteFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Informer는 cache를 통해서 매번 API server에 요청할 필요가 없고, polling 대신에 watch로 resource에 대한 변화 Event에 작동될 수 있는 Interface를 제공한다. Controller에서는 정의된 Informer에 event에 따라 실행할 로직을 event handler를 등록하여 추가하게 된다. 이렇게 <code>podInformer</code>로 Pod object가 변화될 때마다 calico data store와 sync를 맞춰준다.</p><p>calico custom resource에 대한 Interface제공하는 clientsets은 아래처럼 WorkloadEndpoints를 처음 가져와서 cache에 담는데 사용한다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">workloadEndpoints<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">WorkloadEndpoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> options<span class="token punctuation">.</span>ListOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><h3 id="networkpolicy-controller"><a href="#networkpolicy-controller" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>networkpolicy controller</h3><p>Pod resource에 대한 informer는 <code>NewSharedInformerFactory</code>을 통해서 이제 여러 worker이 공유해서 사용할 수 있도록 했는데, networkpolicy controller에서는 아래처럼 informer를 생성하고 있다. 이렇게 한 이유는 pod informer의 경우에는 node controller와 pod controller가 둘다 사용하고 있기 때문이고, networkpolicy resource에 대해서는 여러 worker가 사용하지 않으니깐 이렇게 생성한 것일까? 그렇다면 node informer는 node controller에서 밖에 사용하지 않는데, 왜 <code>NewSharedInformerFactory</code>를 사용했을까?</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">listWatcher <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">NewListWatchFromClient</span><span class="token punctuation">(</span>
</span><span class="code-line">  clientset<span class="token punctuation">.</span><span class="token function">NetworkingV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RESTClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token string">&quot;networkpolicies&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  fields<span class="token punctuation">.</span><span class="token function">Everything</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token boolean">_</span><span class="token punctuation">,</span> informer <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">NewIndexerInformer</span><span class="token punctuation">(</span>listWatcher<span class="token punctuation">,</span> <span class="token operator">&amp;</span>networkingv1<span class="token punctuation">.</span>NetworkPolicy<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">{</span>
</span><span class="code-line">		AddFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    UpdateFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>oldObj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> newObj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    DeleteFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span>Indexers<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><p><code>pod Controller</code>와 동일하게 Kubernetes NetworkPolicy resource가 <code>ADD</code>, <code>UPDATE</code>, <code>DELETE</code>되었을 때, calico datastore를 업데이트 해주는 역할을 한다. 그리고 아래처럼 calico clientsets으로 <code>projectcalico.org</code> Group <code>v3</code> Version <code>NetworkPolicy</code> Kind를 가져오고 있다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">calicoPolicies<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">NetworkPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> options<span class="token punctuation">.</span>ListOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code></pre></div><h3 id="calico-crd와-연결점은-어떻게-되는거지"><a href="#calico-crd와-연결점은-어떻게-되는거지" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Calico CRD와 연결점은 어떻게 되는거지?</h3><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/programming-kubernetes/cnat/blob/master/cnat-client-go/main.go">code-generator를 사용하는 At custom controller의 소스 코드</a>를 보면 아래처럼 custom resource에 대해서 code-generator로 생성된 informer를 사용하고 있다. At resource가 변경될 때, Event에 따라서 로직을 수행하게 된다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line">informers <span class="token string">&quot;github.com/programming-kubernetes/cnat/cnat-client-go/pkg/generated/informers/externalversions&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">...</span>생략
</span><span class="code-line">cnatInformerFactory <span class="token operator">:=</span> informers<span class="token punctuation">.</span><span class="token function">NewSharedInformerFactory</span><span class="token punctuation">(</span>cnatClient<span class="token punctuation">,</span> time<span class="token punctuation">.</span>Minute<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>
</span></code></pre></div><p><code>Calico</code>를 Addon으로 추가한 Minikube에서 <code>kubectl get crds</code>를 실행하면 아래처럼 <code>crd</code>가 있는 것을 확인할 수 있다. <code>pod controller</code>, <code>network policy contoller</code>, <code>service account controller</code>를 보면, kubernetest의 native resource가 변화할 때 informer를 통해서 calico data store를 sync하고 있다. 그런데 아래의 CRD의 custom resource가 변경되는 거에 대해서 로직을 수행하는 코드는 controller에 없다. 그럼 그부분은 어디서 담당하고 있는 것일까?</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">NAME                                                  CREATED AT
</span><span class="code-line">bgpconfigurations.crd.projectcalico.org               <span class="token number">2023</span>-07-03T07:55:54Z
</span><span class="code-line">bgppeers.crd.projectcalico.org                        <span class="token number">2023</span>-07-03T07:55:54Z
</span><span class="code-line">blockaffinities.crd.projectcalico.org                 <span class="token number">2023</span>-07-03T07:55:54Z
</span><span class="code-line">caliconodestatuses.crd.projectcalico.org              <span class="token number">2023</span>-07-03T07:55:54Z
</span><span class="code-line">clusterinformations.crd.projectcalico.org             <span class="token number">2023</span>-07-03T07:55:54Z
</span><span class="code-line">felixconfigurations.crd.projectcalico.org             <span class="token number">2023</span>-07-03T07:55:54Z
</span><span class="code-line">globalnetworkpolicies.crd.projectcalico.org           <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">globalnetworksets.crd.projectcalico.org               <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">hostendpoints.crd.projectcalico.org                   <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">ipamblocks.crd.projectcalico.org                      <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">ipamconfigs.crd.projectcalico.org                     <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">ipamhandles.crd.projectcalico.org                     <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">ippools.crd.projectcalico.org                         <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">ipreservations.crd.projectcalico.org                  <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">kubecontrollersconfigurations.crd.projectcalico.org   <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">networkpolicies.crd.projectcalico.org                 <span class="token number">2023</span>-07-03T07:55:55Z
</span><span class="code-line">networksets.crd.projectcalico.org                     <span class="token number">2023</span>-07-03T07:55:55Z
</span></code></pre></div><p>calicoctl을 통해서 custom resource를 생성해본다. (calicoctl을 통해서 calico에서 필요한 validation과 defaulting을 수행한다. 그런데 calico apiserver를 설치하면 calicoctl없이 그냥 kubectl을 이용해서 할 수 있다.)</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">calicoctl create -f - <span class="token operator">&lt;&lt;</span><span class="token string">EOF
</span></span><span class="code-line"><span class="token string">apiVersion: projectcalico.org/v3
</span></span><span class="code-line"><span class="token string">kind: NetworkPolicy
</span></span><span class="code-line"><span class="token string">metadata:
</span></span><span class="code-line"><span class="token string">  name: allow-busybox-egress
</span></span><span class="code-line"><span class="token string">  namespace: advanced-policy-demo
</span></span><span class="code-line"><span class="token string">spec:
</span></span><span class="code-line"><span class="token string">  selector: run == &#x27;access&#x27;
</span></span><span class="code-line"><span class="token string">  types:
</span></span><span class="code-line"><span class="token string">  - Egress
</span></span><span class="code-line"><span class="token string">  egress:
</span></span><span class="code-line"><span class="token string">  - action: Allow
</span></span><span class="code-line"><span class="token string">EOF</span>
</span></code></pre></div><p><code>kubectl api-resources</code>로 확인해보면 NetworkPolicy로 동일한 KIND인데 Group과 Version이 다른 것이 보인다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
</span><span class="code-line">networkpolicies                                crd.projectcalico.org/v1               <span class="token boolean">true</span>         NetworkPolicy
</span><span class="code-line">networkpolicies                   netpol       networking.k8s.io/v1                   <span class="token boolean">true</span>         NetworkPolicy
</span></code></pre></div><p><code>kubectl get networkpolicy -A</code>를 하게 되면, networking.k8s.io/v1의 NetworkPolicy만 보여주기 때문에 아래처럼 Group과 Version을 명시해서 resource를 가져왔다.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">kubectl get networkpolicy.v1.crd.projectcalico.org
</span></code></pre></div><p>이렇게 Custom Resource를 생성했으면 이것이 Calico의 data store와 sync가 되고, 그 데이터를 통해서 Felix가 iptables rule이나 eBPF로 해당 내용을 적용할 것이다. 그런데 Calico system에서 custom resource가 생성되고나 변경된 것을 탐지해서 그것에 따라서 로직을 수행하는 부분은 어디에서 찾을 수 있는거지? 🤔</p><p>Calico는 Kubernetes말고 OpenStack이나 cluster가 아닌 환경에서도 설치해서 사용할 수 있는 것을 생각하면 Kubernetes와의 coupling을 최소한으로 했을 것이라 추측했다. 그래서 Calico node는 Kubernetes의 존재는 모르고 calico datasource의 변화에 대해서 event를 받아서 로직이 수행된다고 생각했다. Kubernetes와의 coupling을 최소한으로 하고, kubernetes native resource가 변화하는 것에 대해서는 kube-controller로 watch해서 변화된 내용을 calico datasource에 sync를 해주는 것일 것이다. 그런데 Kubernetes CRD가 <code>projectcalico.org</code> group으로 많은 것이 존재하는데, 이것이 어떻게 Calico system에 반영이 되는지 의아했다. 어제 블로그를 정리할 때는 실마리가 보이지 않았는데, 문득 calicoctl이나 calico apiserver가 하고 있을 것이라는 생각이 들었다. calicoctl로 적용을 하면 calico datasource와 kubernetes CRD를 같이 변경하는 것이다. kubernetes custom resource를 controller로 watch하여 status를 맞춰주는 것이 아니라, 그냥 client에서 custom resource를 적용할 때 작업을 해주는 것이다. calico apiserver를 사용하여 그냥 kubectl를 적용한다면, 이부분이 들어가지 않았을까? 이러한 생각을 가지고 다시 한번 소스 코드를 살펴보게 되었다.</p><p>calicoctl의 코드를 보면 최종적으로 <code>libcalico-go/lib/clientv3</code>를 사용하게 된다. clientv3에서 <code>networkPolicies</code>의 method <code>Create</code>를 살펴보면 아래와 같다. calico apiserver를 사용하면 이게 대신에 defaulting과 validation을 해주는데, 여기에 그에 대한 로직이 들어가 있다. <code>libcalico-go</code>는 이제 calico에서 내부적으로 사용하기 위한 코드이고, 이걸 custom controller를 만들 때 code-generator로 만든 clientSets대신에 사용하는 이유이다. 이렇게 defaulting과 validation을 하고 custom resource를 생성해주고 있다.</p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>r networkPolicies<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> res <span class="token operator">*</span>apiv3<span class="token punctuation">.</span>NetworkPolicy<span class="token punctuation">,</span> opts options<span class="token punctuation">.</span>SetOptions<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>apiv3<span class="token punctuation">.</span>NetworkPolicy<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token keyword">if</span> res <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token comment">// Since we&#x27;re about to default some fields, take a (shallow) copy of the input data</span>
</span><span class="code-line">		<span class="token comment">// before we do so.</span>
</span><span class="code-line">		resCopy <span class="token operator">:=</span> <span class="token operator">*</span>res
</span><span class="code-line">		res <span class="token operator">=</span> <span class="token operator">&amp;</span>resCopy
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token function">defaultPolicyTypesField</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Ingress<span class="token punctuation">,</span> res<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Egress<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Types<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">:=</span> validator<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Properly prefix the name</span>
</span><span class="code-line">	res<span class="token punctuation">.</span><span class="token function">GetObjectMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token function">convertPolicyNameForStorage</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">GetObjectMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">	out<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>client<span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> apiv3<span class="token punctuation">.</span>KindNetworkPolicy<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> out <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token comment">// Remove the prefix out of the returned policy name.</span>
</span><span class="code-line">		out<span class="token punctuation">.</span><span class="token function">GetObjectMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token function">convertPolicyNameFromStorage</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token function">GetObjectMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>apiv3<span class="token punctuation">.</span>NetworkPolicy<span class="token punctuation">)</span><span class="token punctuation">,</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Remove the prefix out of the returned policy name.</span>
</span><span class="code-line">	res<span class="token punctuation">.</span><span class="token function">GetObjectMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token function">convertPolicyNameFromStorage</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">GetObjectMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>생각해보니 나의 Minikube Kubernetes cluster환경에서 Calico datastore Kubernetes를 사용하도록 설정이 되어 있다. CRD로 존재하는 것들이 Calico datastore의 data인 것이고, 예를 들어서 custom resource인 GlobalNetworkPolicy나 NetworkPolicy를 생성하면, 그것이 Calico datastore에 저장이 된 것이다. Calico datastore를 별도의 etcdv3로 설정하지 않고, Kubernetes를 했기 때문에 이러한 CRD가 생성된 것이다. 따라서 kubectl + calico apiserver나 calicoctl로 CRD를 생성한다는 것은 Calico data store에 데이터를 저장/변경하는 것이다. 따라서 Felix는 이 CRD의 custom resource의 변화에 따라서 network rule을 정의할 것이다. 이제 Felix 소스코드에서 <code>daemon.go</code>를 보면, <code>flexsyncer</code> instance를 생성하는 것을 볼 수 있다.</p><p><code>daemon.go</code></p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span>configFile <span class="token builtin">string</span><span class="token punctuation">,</span> gitVersion <span class="token builtin">string</span><span class="token punctuation">,</span> buildDate <span class="token builtin">string</span><span class="token punctuation">,</span> gitRevision <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token comment">// Use the syncer locally.</span>
</span><span class="code-line">		syncer <span class="token operator">=</span> felixsyncer<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>backendClient<span class="token punctuation">,</span> datastoreConfig<span class="token punctuation">.</span>Spec<span class="token punctuation">,</span> syncerToValidator<span class="token punctuation">,</span> configParams<span class="token punctuation">.</span><span class="token function">IsLeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;using resource updates where applicable&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">		configParams<span class="token punctuation">.</span><span class="token function">SetUseNodeResourceUpdates</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>이제 <code>flexsyncerv1.go</code>를 살펴보면 이렇게 go type으로 정의된 Kind 종류를 정의하는 부분이 생긴다. <code>apiv3.KindGlobalNetworkPolicy</code>는 GlobalNetworkPolicy Kind를 의미한다.</p><p><code>felixsyncerv1.go</code></p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>client api<span class="token punctuation">.</span>Client<span class="token punctuation">,</span> cfg apiconfig<span class="token punctuation">.</span>CalicoAPIConfigSpec<span class="token punctuation">,</span> callbacks api<span class="token punctuation">.</span>SyncerCallbacks<span class="token punctuation">,</span> isLeader <span class="token builtin">bool</span><span class="token punctuation">)</span> api<span class="token punctuation">.</span>Syncer <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">  <span class="token keyword">if</span> isLeader <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token comment">// These resources are only required if this is the active Felix instance on the node.</span>
</span><span class="code-line">		additionalTypes <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>watchersyncer<span class="token punctuation">.</span>ResourceType<span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindGlobalNetworkPolicy<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewGlobalNetworkPolicyUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindGlobalNetworkSet<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewGlobalNetworkSetUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindIPPool<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewIPPoolUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> libapiv3<span class="token punctuation">.</span>KindNode<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewFelixNodeUpdateProcessor</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>K8sUsePodCIDR<span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindProfile<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewProfileUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> libapiv3<span class="token punctuation">.</span>KindWorkloadEndpoint<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewWorkloadEndpointUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindNetworkPolicy<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewNetworkPolicyUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindNetworkSet<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewNetworkSetUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span>   model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindHostEndpoint<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">				UpdateProcessor<span class="token punctuation">:</span> updateprocessors<span class="token punctuation">.</span><span class="token function">NewHostEndpointUpdateProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">{</span>
</span><span class="code-line">				ListInterface<span class="token punctuation">:</span> model<span class="token punctuation">.</span>ResourceListOptions<span class="token punctuation">{</span>Kind<span class="token punctuation">:</span> apiv3<span class="token punctuation">.</span>KindBGPConfiguration<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">			<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> watchersyncer<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>
</span><span class="code-line">		client<span class="token punctuation">,</span>
</span><span class="code-line">		resourceTypes<span class="token punctuation">,</span>
</span><span class="code-line">		callbacks<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>위에서 &#x27;GlobalNetworkPolicy&#x27;, &#x27;GlobalNetworkSet&#x27;등 필요한 resource들에 대해서 정의가 되었는데, 이제 <code>watchersyncer.go</code>에서는 그러한 resource들을 slice에 저장한다.</p><p><code>watchersyncer.go</code></p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>client api<span class="token punctuation">.</span>Client<span class="token punctuation">,</span> resourceTypes <span class="token punctuation">[</span><span class="token punctuation">]</span>ResourceType<span class="token punctuation">,</span> callbacks api<span class="token punctuation">.</span>SyncerCallbacks<span class="token punctuation">)</span> api<span class="token punctuation">.</span>Syncer <span class="token punctuation">{</span>
</span><span class="code-line">	rs <span class="token operator">:=</span> <span class="token operator">&amp;</span>watcherSyncer<span class="token punctuation">{</span>
</span><span class="code-line">		watcherCaches<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>watcherCache<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>resourceTypes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">		results<span class="token punctuation">:</span>       <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">		callbacks<span class="token punctuation">:</span>     callbacks<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">for</span> i<span class="token punctuation">,</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> resourceTypes <span class="token punctuation">{</span>
</span><span class="code-line">		rs<span class="token punctuation">.</span>watcherCaches<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newWatcherCache</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> r<span class="token punctuation">,</span> rs<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> rs
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>이제 <code>run</code>이 호출되면 아까 slice에 저장해놨던 resource별 watcherCache의 run을 forloop을 통해서 다시 호출하게 된다.</p><p><code>watchersyncer.go</code></p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>ws <span class="token operator">*</span>watcherSyncer<span class="token punctuation">)</span> <span class="token function">run</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;Sending initial status event and starting watchers&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	ws<span class="token punctuation">.</span><span class="token function">sendStatusUpdate</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>WaitForDatastore<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> wc <span class="token operator">:=</span> <span class="token keyword">range</span> ws<span class="token punctuation">.</span>watcherCaches <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token comment">// no need for ws.wgwc.Add(1), been set already</span>
</span><span class="code-line">		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>wc <span class="token operator">*</span>watcherCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">defer</span> ws<span class="token punctuation">.</span>wgwc<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">			wc<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">			log<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;Watcher cache run completed&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token punctuation">}</span><span class="token punctuation">(</span>wc<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>마지막으로 <code>watchercache.go</code>를 살펴보면 <code>resyncAndCreateWatcher</code>가 호출되고, 이것은 먼저 resync가 필요하면 List를 하고, 그 다음에 앞으로 변화는 것만 Watch로 Event를 받도록 되어 있다. 이제 felix가 Kubernetes의 custom resource를 Watch하면서 변경되었을 때 Event를 받고, Event별로 정의된 event handler 로직을 수행하게 되는 것이다.</p><p><code>watchercache.go</code></p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>wc <span class="token operator">*</span>watcherCache<span class="token punctuation">)</span> <span class="token function">run</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	wc<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token string">&quot;Watcher cache starting, start initial sync processing&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	wc<span class="token punctuation">.</span><span class="token function">resyncAndCreateWatcher</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>watchercache.go</code></p><div class="relative"><pre><code class="language-go code-highlight"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>wc <span class="token operator">*</span>watcherCache<span class="token punctuation">)</span> <span class="token function">resyncAndCreateWatcher</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">  l<span class="token punctuation">,</span> err <span class="token operator">:=</span> wc<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> wc<span class="token punctuation">.</span>resourceType<span class="token punctuation">.</span>ListInterface<span class="token punctuation">,</span> wc<span class="token punctuation">.</span>currentWatchRevision<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token operator">...</span>생략
</span><span class="code-line">  w<span class="token punctuation">,</span> err <span class="token operator">:=</span> wc<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Watch</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> wc<span class="token punctuation">.</span>resourceType<span class="token punctuation">.</span>ListInterface<span class="token punctuation">,</span> wc<span class="token punctuation">.</span>currentWatchRevision<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/calico">calico</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230717-book-review-indistractable-hooked">책 두 권 &lt;초집중&gt;, &lt;훅&gt;</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20230723-book-review-tiny-habit">행동 설계 7단계를 내 실생활에 적용해보자</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://kr.linkedin.com/in/jaemyun-lee-165697130?trk=people-guest_people_search-card"><span class="sr-only">linkedin</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jaemyun Lee</div><div> • </div><div>© 2023</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var m=(a,c)=\u003e()=\u003e(c||a((c={exports:{}}).exports,c),c.exports),N=(a,c)=\u003e{t(a);for(var s in c)l(a,s,{get:c[s],enumerable:!0})},k=(a,c,s)=\u003e{if(c\u0026\u0026typeof c==\"object\"||typeof c==\"function\")for(let e of d(c))!h.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026l(a,e,{get:()=\u003ec[e],enumerable:!(s=p(c,e))||s.enumerable});return a},g=a=\u003ek(t(l(a!=null?r(u(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var i=m((v,o)=\u003e{o.exports=_jsx_runtime});var y={};N(y,{default:()=\u003ew,frontmatter:()=\u003ef});var n=g(i()),f={title:\"Calico kube-controller \\uC774\\uD574\\uD558\\uAE30\",date:\"2023-07-22\",tags:[\"kubernetes\",\"calico\"],summary:\"Calico\\uC5D0\\uC11C \\uC5B4\\uB5BB\\uAC8C CRD\\uB97C \\uD65C\\uC6A9\\uD558\\uB294\\uC9C0 \\uC774\\uD574\\uD558\\uAE30 \\uC704\\uD574\\uC11C Calico Opensource \\uBC84\\uC804\\uC758 \\uAE43\\uD5D9 \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB97C \\uC0B4\\uD3B4\\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4. Calico archiecture\\uC5D0\\uC11C kube-controller \\uBD80\\uBD84\\uC774 \\uC5B4\\uB5A4 \\uC5ED\\uD560\\uC744 \\uD558\\uB294\\uC9C0 \\uC18C\\uC2A4 \\uCF54\\uB4DC\\uB97C \\uD1B5\\uD574\\uC11C \\uC774\\uD574\\uD560 \\uC218 \\uC788\\uAC8C \\uB418\\uC5C8\\uB2E4. kube-controller\\uB4E4\\uC740 kubernetes native resource\\uC5D0 \\uB300\\uD55C \\uBCC0\\uACBD\\uC744 calico data store\\uC640 sync\\uD574\\uC8FC\\uB294 \\uC5ED\\uD560\\uC744 \\uD558\\uACE0 \\uC788\\uB2E4. \\uB0B4\\uAC00 \\uC0AC\\uC6A9\\uD558\\uB294 Minikbue Kubernetes Cluster\\uC5D0\\uC11C\\uB294 Calico\\uC758 data store\\uB294 kubernetes\\uB85C \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, CRD\\uB85C Calico data\\uB4E4\\uC774 \\uC800\\uC7A5\\uB418\\uACE0 Felix\\uAC00 \\uC774\\uAC83\\uC744 watch\\uD558\\uC5EC \\uBCC0\\uD654\\uC5D0 \\uB300\\uD574\\uC11C network rule\\uC744 \\uC5C5\\uB370\\uC774\\uD2B8 \\uD558\\uAC8C \\uB41C\\uB2E4.\"};function b(a={}){let{wrapper:c}=a.components||{};return c?(0,n.jsx)(c,Object.assign({},a,{children:(0,n.jsx)(s,{})})):s();function s(){let e=Object.assign({p:\"p\",code:\"code\",a:\"a\",h2:\"h2\",span:\"span\",pre:\"pre\",ul:\"ul\",li:\"li\",h3:\"h3\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC804\\uC5D0 \",(0,n.jsx)(e.code,{children:\"kubebuilder\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"Programming Kubernetes\"}),\"\\uC5D0\\uC11C \\uC124\\uBA85\\uD55C \",(0,n.jsx)(e.a,{href:\"https://jayground8.github.io/blog/20230715-k8s-controller\",children:\"At resource\\uB97C watch\\uD558\\uB294 Custom controller\\uB97C \\uC9C1\\uC811 \\uC791\\uC131\"}),\"\\uD588\\uB2E4. \\uADF8\\uB2E4\\uC74C\\uC5D0\\uB294 ifkakao(2022) \",(0,n.jsx)(e.code,{children:\"Testing Kubernetes Controller\"}),\" \\uBC1C\\uD45C\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uB41C \",(0,n.jsx)(e.a,{href:\"https://jayground8.github.io/blog/20230716-if-kakao-2022-k8s-controller\",children:\"example\\uC778 BlueGreen resource\\uC5D0 \\uB300\\uD55C Custom controller\\uB97C kubebuilder\\uB85C \\uC791\\uC131\"}),\"\\uD588\\uB2E4. \\uC774\\uBC88\\uC5D0\\uB294 Calico\\uC5D0\\uC11C \\uC5B4\\uB5BB\\uAC8C CRD\\uC640 Custom contoller\\uB97C \\uD65C\\uC6A9\\uD558\\uACE0 \\uC788\\uB294\\uC9C0 \",(0,n.jsx)(e.a,{href:\"https://github.com/projectcalico/calico\",children:\"Source code\"}),\"\\uB97C \\uD655\\uC778\\uD574\\uBD24\\uB2E4. (\\uC774 \\uAE00\\uC744 \\uC791\\uC131\\uD558\\uB294 \\uC2DC\\uC810\\uC5D0\\uB294 Calico OpenSource Version 3.26\\uC744 \\uD655\\uC778\\uD558\\uC600\\uB2E4.)\"]}),(0,n.jsxs)(e.h2,{id:\"calico-kube-controllers\",children:[(0,n.jsx)(e.a,{href:\"#calico-kube-controllers\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Calico kube-controllers\"]}),(0,n.jsxs)(e.p,{children:[\"source code\\uB97C \\uBCF4\\uBA74 \",(0,n.jsx)(e.code,{children:\"kube-controllers\"}),\" \\uB514\\uB809\\uD130\\uB9AC \\uC548\\uC5D0 \\uC544\\uB798\\uCC98\\uB7FC controller \\uCF54\\uB4DC\\uAC00 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\".\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 controller\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 flannelmigration\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 config.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 config_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 flannel_migration_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 flannelmigration_suite_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 ipam_migrator.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 k8s_resources.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 migration_controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 network_migrator.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 namespace\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 namespace_controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 namespace_controller_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 namespace_suite_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 networkpolicy\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 policy_controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 policy_controller_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 policy_suite_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 node\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 auto_hep_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 errors.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 etcd_ipam_gc_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 fake_client.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 hostendpoints.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 ipam.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 ipam_allocation.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 ipam_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 kdd_ipam_gc_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 labels.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 metrics_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 node_controller_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 node_deleter.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 node_suite_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 pool_manager.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 syncer.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 pod\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 pod_controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u251C\\u2500\\u2500 pod_controller_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 pod_suite_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 serviceaccount\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u251C\\u2500\\u2500 serviceaccount_controller.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u251C\\u2500\\u2500 serviceaccount_controller_fv_test.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u2514\\u2500\\u2500 serviceaccount_suite_test.go\n`})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"Makefile\"}),\"\\uB97C \\uD655\\uC778\\uD574\\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 build\\uD658\\uACBD\\uC744 \\uAC16\\uCD98 Container Image\\uB97C \\uD1B5\\uD574\\uC11C compile\\uC744 \\uD558\\uAC8C \\uB41C\\uB2E4. (\\uAE30\\uD0C0 arguments \\uC0DD\\uB7B5)\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`go build -o bin/kube-controllers-linux-amd64 ./cmd/kube-controllers/\n`})})}),(0,n.jsxs)(e.p,{children:[\"build\\uD558\\uB294 \",(0,n.jsx)(e.code,{children:\"/cmd/kube-controllers\"}),\"\\uC758 \",(0,n.jsx)(e.code,{children:\"main.go\"}),\"\\uB97C \\uD655\\uC778\\uD574\\uBCF4\\uBA74, \",(0,n.jsx)(e.code,{children:\"controllerControl\"}),\"\\uC774\\uB77C\\uB294 struct type\\uC5D0 Controller instance\\uB4E4\\uC744 \\uC800\\uC7A5\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"controllerCtrl \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"controllerControl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"         ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tcontrollers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"make\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"controller\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Controller\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tstop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"        stop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tinformers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   \",(0,n.jsx)(e.span,{className:\"token function\",children:\"make\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SharedIndexInformer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"InitControllers\"}),\" method\\uB97C \\uD655\\uC778\\uD558\\uBA74 \\uC124\\uC815\\uAC12\\uC5D0 \\uB530\\uB77C\\uC11C \",(0,n.jsx)(e.code,{children:\"Pod\"}),\", \",(0,n.jsx)(e.code,{children:\"Namespace\"}),\", \",(0,n.jsx)(e.code,{children:\"NetworkPolicy\"}),\", \",(0,n.jsx)(e.code,{children:\"Node\"}),\", \",(0,n.jsx)(e.code,{children:\"ServiceAccount\"}),\"\\uC5D0 \\uAD00\\uB828\\uB41C controller\\uB97C \\uC124\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"controllerCtrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"InitControllers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" runCfg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" k8sClientset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" calicoClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" cfg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Controllers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"WorkloadEndpoint \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  podController \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" pod\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewPodController\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),\"\\uC0DD\\uB7B5\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"controllers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Pod\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` podController\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"registerInformers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"podInformer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" cfg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Controllers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  namespaceController \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewNamespaceController\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),\"\\uC0DD\\uB7B5\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"controllers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Namespace\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),` namespaceController\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://docs.tigera.io/calico/latest/reference/kube-controllers/configuration#the-calicokube-controllers-container\",children:\"kube-controller\\uC5D0 \\uB300\\uD55C \\uC124\\uC815\\uAC12\\uC744 \\uBB38\\uC11C\"}),\"\\uB97C \\uD655\\uC778\\uD574\\uBCF4\\uBA74 calico datasource\\uB85C Kubernetes\\uC758 etcd\\uB97C \\uACF5\\uC720\\uD574\\uC11C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC2F6\\uC73C\\uBA74 \\uD658\\uACBD \\uBCC0\\uC218 \",(0,n.jsx)(e.code,{children:\"DATASTORE_TYPE\"}),\" \\uAC12\\uC744 \",(0,n.jsx)(e.code,{children:\"kubernetes\"}),\"\\uB85C \\uC124\\uC815\\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,n.jsx)(e.code,{children:\"node\"}),\"\\uC5D0 \\uAD00\\uD55C \",(0,n.jsx)(e.code,{children:\"kube-controller\"}),\"\\uB97C enable\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"ENABLED_CONTROLLERS\"}),\"\\uD658\\uACBD\\uBCC0\\uC218\\uB97C \",(0,n.jsx)(e.code,{children:\"node\"}),\"\\uB85C \\uC124\\uC815\\uD574\\uC57C \\uD55C\\uB2E4. \\uB098\\uBA38\\uC9C0 controller\\uB294 default\\uB85C enable\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uACE0 \\uC2F6\\uC744 \\uB54C\\uB9CC \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uD658\\uACBD\\uBCC0\\uC218\\uB85C disable \\uC2DC\\uCF1C\\uC918\\uC57C \\uD55C\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[\"\\uB098\\uB294 Minikube\\uC5D0\\uC11C Addon\\uC73C\\uB85C Calico\\uB97C \\uCD94\\uAC00\\uD574\\uC11C Kubernetes cluster\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uB2E4. \\uADF8\\uB798\\uC11C \",(0,n.jsx)(e.code,{children:\"calico-kube-controllers\"}),\"\\uC758 \\uD658\\uACBD\\uBCC0\\uC218 \\uC124\\uC815\\uAC12\\uC744 \\uD655\\uC778\\uD558\\uB2C8 \\uC544\\uB798\\uCC98\\uB7FC \\uC124\\uC815\\uB41C \\uAC83\\uC744 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl describe deployments calico-kube-controllers -n kube-system\n`})})}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Environment:\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  ENABLED_CONTROLLERS:  node\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  DATASTORE_TYPE:       kubernetes\n`})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB2E4\\uC74C\\uC5D0 \",(0,n.jsx)(e.code,{children:\"main.go\"}),\"\\uC5D0\\uC11C \\uCD5C\\uC885\\uC801\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"RunController\"}),\" method\\uB97C \\uD638\\uCD9C\\uD558\\uACE0, goroutine\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"controllerControl\"}),\" struct\\uC5D0 \\uCD94\\uAC00\\uD588\\uB358 \",(0,n.jsx)(e.code,{children:\"informer\"}),\"\\uC640 \",(0,n.jsx)(e.code,{children:\"controller\"}),\"\\uB4E4\\uC758 Run method\\uB97C \\uD638\\uCD9C\\uD574\\uC900\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"controllerControl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"RunControllers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" inf \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"informers \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithField\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"informer\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" inf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Starting informer\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"go\"}),\" inf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"stop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" controllerType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"controllers \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithField\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"ControllerType\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" controllerType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Starting controller\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"go\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"stop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c-\"}),\"cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Done\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Warn\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"context cancelled\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c-\"}),\"cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"restart\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Warn\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"configuration changed; restarting\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"close\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"stop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"c.Run(cc.stop)\"}),\"\\uC740 \\uC544\\uB798\\uCC98\\uB7FC work process\\uB97C groutine\\uC73C\\uB85C \\uC2E4\\uD589\\uD558\\uAC8C \\uB418\\uACE0, workqueue\\uC5D0 item\\uC774 \\uCD94\\uAC00\\uB420\\uB54C\\uAE4C\\uC9C0 \\uAE30\\uB2E4\\uB9AC\\uAC8C \\uB418\\uB294 \\uBB34\\uD55C loop\\uC73C\\uB85C \\uB3CC\\uC544\\uAC04\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"cfg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NumberOfWorkers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"go\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"runWorker\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"namespaceController\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"runWorker\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"processNextItem\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"namespaceController\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"processNextItem\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bool\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tworkqueue \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"resourceCache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetQueue\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),` \\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  workqueue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Done\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uAC01\\uAC01\\uC758 contoller\\uAC00 \\uD558\\uB294 \\uC77C\\uC740 \",(0,n.jsx)(e.a,{href:\"https://docs.tigera.io/calico/latest/reference/kube-controllers/configuration#the-calicokube-controllers-container\",children:\"\\uBB38\\uC11C\\uC5D0\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \\uCE5C\\uC808\\uD558\\uAC8C \\uC124\\uBA85\\uB418\\uC5B4 \\uC788\\uB2E4\"}),\".\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"policy controller: watches Kubernetes network policies in the Kubernetes API, and syncs the policies to the datastore (etcd) as Calico network policies. Felix implements network policies in the dataplane.\"}),(0,n.jsx)(e.li,{children:\"namespace controller: watches namespaces and programs Calico profiles.\"}),(0,n.jsx)(e.li,{children:\"serviceaccount controller: watches service accounts and programs Calico profiles.\"}),(0,n.jsx)(e.li,{children:\"workloadendpoint controller: watches for changes to pod labels and updates Calico workload endpoints.\"}),(0,n.jsx)(e.li,{children:\"node controller: watches for the removal of Kubernetes nodes and removes corresponding data from Calico, and optionally watches for node updates to create and sync host endpoints for each node.\"})]}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C controller\\uC758 \\uCF54\\uB4DC\\uB97C \\uD655\\uC778\\uD574\\uBCF8\\uB2E4. \\uC774\\uC804\\uC5D0\\uB294 kubebuilder\\uB85C bootstrap\\uC744 \\uD574\\uC11C \\uC791\\uC131\\uC744 \\uD588\\uC5C8\\uB2E4. calico\\uC5D0\\uC11C\\uB294 kubebuilder\\uB97C \\uC4F0\\uB294 \\uAC83\\uC774 \\uC544\\uB2C8\\uAE30 \\uB54C\\uBB38\\uC5D0, \",(0,n.jsx)(e.a,{href:\"https://github.com/kubernetes/code-generator\",children:\"kubernetes code-generator\"}),\"\\uB97C \\uD65C\\uC6A9\\uD558\\uC5EC custom controller\\uB97C \\uC791\\uC131\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uCC38\\uC870\\uD558\\uC5EC \\uCF54\\uB4DC\\uB97C \\uC774\\uD574\\uD588\\uB2E4.\"]}),(0,n.jsxs)(e.h3,{id:\"pod-controller\",children:[(0,n.jsx)(e.a,{href:\"#pod-controller\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"pod controller\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"workloadendpoint controller\"}),\"\\uB294 Pod informer\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uB2E4. \",(0,n.jsx)(e.code,{children:\"informer factory\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C worker\\uB4E4\\uC774 \\uACF5\\uC720\\uD574\\uC11C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB294 \",(0,n.jsx)(e.code,{children:\"informer\"}),\"\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"factory \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" informers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewSharedInformerFactory\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"k8sClientset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"podInformer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" factory\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Core\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"V1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Pods\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Informer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"controller\"}),\"\\uC5D0\\uC11C\\uB294 \\uC778\\uC790\\uB85C \\uC804\\uB2EC\\uB41C informer\\uC5D0 \\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"ADD\"}),\", \",(0,n.jsx)(e.code,{children:\"UPDATE\"}),\", \",(0,n.jsx)(e.code,{children:\"DELETE\"}),\" event\\uB97C \\uCC98\\uB9AC\\uD560 event handler\\uB97C \\uCD94\\uAC00\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" informer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddEventHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceEventHandlerFuncs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tAddFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    UpdateFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"oldObj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" newObj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    DeleteFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"Informer\\uB294 cache\\uB97C \\uD1B5\\uD574\\uC11C \\uB9E4\\uBC88 API server\\uC5D0 \\uC694\\uCCAD\\uD560 \\uD544\\uC694\\uAC00 \\uC5C6\\uACE0, polling \\uB300\\uC2E0\\uC5D0 watch\\uB85C resource\\uC5D0 \\uB300\\uD55C \\uBCC0\\uD654 Event\\uC5D0 \\uC791\\uB3D9\\uB420 \\uC218 \\uC788\\uB294 Interface\\uB97C \\uC81C\\uACF5\\uD55C\\uB2E4. Controller\\uC5D0\\uC11C\\uB294 \\uC815\\uC758\\uB41C Informer\\uC5D0 event\\uC5D0 \\uB530\\uB77C \\uC2E4\\uD589\\uD560 \\uB85C\\uC9C1\\uC744 event handler\\uB97C \\uB4F1\\uB85D\\uD558\\uC5EC \\uCD94\\uAC00\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC774\\uB807\\uAC8C \",(0,n.jsx)(e.code,{children:\"podInformer\"}),\"\\uB85C Pod object\\uAC00 \\uBCC0\\uD654\\uB420 \\uB54C\\uB9C8\\uB2E4 calico data store\\uC640 sync\\uB97C \\uB9DE\\uCDB0\\uC900\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:\"calico custom resource\\uC5D0 \\uB300\\uD55C Interface\\uC81C\\uACF5\\uD558\\uB294 clientsets\\uC740 \\uC544\\uB798\\uCC98\\uB7FC WorkloadEndpoints\\uB97C \\uCC98\\uC74C \\uAC00\\uC838\\uC640\\uC11C cache\\uC5D0 \\uB2F4\\uB294\\uB370 \\uC0AC\\uC6A9\\uD55C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"workloadEndpoints\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WorkloadEndpoints\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"networkpolicy-controller\",children:[(0,n.jsx)(e.a,{href:\"#networkpolicy-controller\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"networkpolicy controller\"]}),(0,n.jsxs)(e.p,{children:[\"Pod resource\\uC5D0 \\uB300\\uD55C informer\\uB294 \",(0,n.jsx)(e.code,{children:\"NewSharedInformerFactory\"}),\"\\uC744 \\uD1B5\\uD574\\uC11C \\uC774\\uC81C \\uC5EC\\uB7EC worker\\uC774 \\uACF5\\uC720\\uD574\\uC11C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uD588\\uB294\\uB370, networkpolicy controller\\uC5D0\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC informer\\uB97C \\uC0DD\\uC131\\uD558\\uACE0 \\uC788\\uB2E4. \\uC774\\uB807\\uAC8C \\uD55C \\uC774\\uC720\\uB294 pod informer\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 node controller\\uC640 pod controller\\uAC00 \\uB458\\uB2E4 \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uAE30 \\uB54C\\uBB38\\uC774\\uACE0, networkpolicy resource\\uC5D0 \\uB300\\uD574\\uC11C\\uB294 \\uC5EC\\uB7EC worker\\uAC00 \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uC73C\\uB2C8\\uAE50 \\uC774\\uB807\\uAC8C \\uC0DD\\uC131\\uD55C \\uAC83\\uC77C\\uAE4C? \\uADF8\\uB807\\uB2E4\\uBA74 node informer\\uB294 node controller\\uC5D0\\uC11C \\uBC16\\uC5D0 \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uB294\\uB370, \\uC65C \",(0,n.jsx)(e.code,{children:\"NewSharedInformerFactory\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD588\\uC744\\uAE4C?\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"listWatcher \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewListWatchFromClient\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  clientset\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NetworkingV1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"RESTClient\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"networkpolicies\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  fields\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Everything\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" informer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewIndexerInformer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"listWatcher\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"networkingv1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceEventHandlerFuncs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tAddFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    UpdateFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"oldObj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" newObj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    DeleteFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"obj \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Indexers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"pod Controller\"}),\"\\uC640 \\uB3D9\\uC77C\\uD558\\uAC8C Kubernetes NetworkPolicy resource\\uAC00 \",(0,n.jsx)(e.code,{children:\"ADD\"}),\", \",(0,n.jsx)(e.code,{children:\"UPDATE\"}),\", \",(0,n.jsx)(e.code,{children:\"DELETE\"}),\"\\uB418\\uC5C8\\uC744 \\uB54C, calico datastore\\uB97C \\uC5C5\\uB370\\uC774\\uD2B8 \\uD574\\uC8FC\\uB294 \\uC5ED\\uD560\\uC744 \\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uC544\\uB798\\uCC98\\uB7FC calico clientsets\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"projectcalico.org\"}),\" Group \",(0,n.jsx)(e.code,{children:\"v3\"}),\" Version \",(0,n.jsx)(e.code,{children:\"NetworkPolicy\"}),\" Kind\\uB97C \\uAC00\\uC838\\uC624\\uACE0 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"calicoPolicies\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NetworkPolicies\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"calico-crd\\uC640-\\uC5F0\\uACB0\\uC810\\uC740-\\uC5B4\\uB5BB\\uAC8C-\\uB418\\uB294\\uAC70\\uC9C0\",children:[(0,n.jsx)(e.a,{href:\"#calico-crd\\uC640-\\uC5F0\\uACB0\\uC810\\uC740-\\uC5B4\\uB5BB\\uAC8C-\\uB418\\uB294\\uAC70\\uC9C0\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Calico CRD\\uC640 \\uC5F0\\uACB0\\uC810\\uC740 \\uC5B4\\uB5BB\\uAC8C \\uB418\\uB294\\uAC70\\uC9C0?\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/programming-kubernetes/cnat/blob/master/cnat-client-go/main.go\",children:\"code-generator\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 At custom controller\\uC758 \\uC18C\\uC2A4 \\uCF54\\uB4DC\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC custom resource\\uC5D0 \\uB300\\uD574\\uC11C code-generator\\uB85C \\uC0DD\\uC131\\uB41C informer\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC788\\uB2E4. At resource\\uAC00 \\uBCC0\\uACBD\\uB420 \\uB54C, Event\\uC5D0 \\uB530\\uB77C\\uC11C \\uB85C\\uC9C1\\uC744 \\uC218\\uD589\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"informers \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github.com/programming-kubernetes/cnat/cnat-client-go/pkg/generated/informers/externalversions\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"cnatInformerFactory \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" informers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewSharedInformerFactory\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cnatClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Minute\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"Calico\"}),\"\\uB97C Addon\\uC73C\\uB85C \\uCD94\\uAC00\\uD55C Minikube\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"kubectl get crds\"}),\"\\uB97C \\uC2E4\\uD589\\uD558\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"crd\"}),\"\\uAC00 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,n.jsx)(e.code,{children:\"pod controller\"}),\", \",(0,n.jsx)(e.code,{children:\"network policy contoller\"}),\", \",(0,n.jsx)(e.code,{children:\"service account controller\"}),\"\\uB97C \\uBCF4\\uBA74, kubernetest\\uC758 native resource\\uAC00 \\uBCC0\\uD654\\uD560 \\uB54C informer\\uB97C \\uD1B5\\uD574\\uC11C calico data store\\uB97C sync\\uD558\\uACE0 \\uC788\\uB2E4. \\uADF8\\uB7F0\\uB370 \\uC544\\uB798\\uC758 CRD\\uC758 custom resource\\uAC00 \\uBCC0\\uACBD\\uB418\\uB294 \\uAC70\\uC5D0 \\uB300\\uD574\\uC11C \\uB85C\\uC9C1\\uC744 \\uC218\\uD589\\uD558\\uB294 \\uCF54\\uB4DC\\uB294 controller\\uC5D0 \\uC5C6\\uB2E4. \\uADF8\\uB7FC \\uADF8\\uBD80\\uBD84\\uC740 \\uC5B4\\uB514\\uC11C \\uB2F4\\uB2F9\\uD558\\uACE0 \\uC788\\uB294 \\uAC83\\uC77C\\uAE4C?\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`NAME                                                  CREATED AT\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"bgpconfigurations.crd.projectcalico.org               \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:54Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"bgppeers.crd.projectcalico.org                        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:54Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"blockaffinities.crd.projectcalico.org                 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:54Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"caliconodestatuses.crd.projectcalico.org              \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:54Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"clusterinformations.crd.projectcalico.org             \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:54Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"felixconfigurations.crd.projectcalico.org             \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:54Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"globalnetworkpolicies.crd.projectcalico.org           \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"globalnetworksets.crd.projectcalico.org               \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"hostendpoints.crd.projectcalico.org                   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ipamblocks.crd.projectcalico.org                      \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ipamconfigs.crd.projectcalico.org                     \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ipamhandles.crd.projectcalico.org                     \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ippools.crd.projectcalico.org                         \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"ipreservations.crd.projectcalico.org                  \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"kubecontrollersconfigurations.crd.projectcalico.org   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"networkpolicies.crd.projectcalico.org                 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"networksets.crd.projectcalico.org                     \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2023\"}),`-07-03T07:55:55Z\n`]})]})}),(0,n.jsx)(e.p,{children:\"calicoctl\\uC744 \\uD1B5\\uD574\\uC11C custom resource\\uB97C \\uC0DD\\uC131\\uD574\\uBCF8\\uB2E4. (calicoctl\\uC744 \\uD1B5\\uD574\\uC11C calico\\uC5D0\\uC11C \\uD544\\uC694\\uD55C validation\\uACFC defaulting\\uC744 \\uC218\\uD589\\uD55C\\uB2E4. \\uADF8\\uB7F0\\uB370 calico apiserver\\uB97C \\uC124\\uCE58\\uD558\\uBA74 calicoctl\\uC5C6\\uC774 \\uADF8\\uB0E5 kubectl\\uC744 \\uC774\\uC6A9\\uD574\\uC11C \\uD560 \\uC218 \\uC788\\uB2E4.)\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"calicoctl create -f - \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\u003c\"}),(0,n.jsx)(e.span,{className:\"token string\",children:`EOF\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`apiVersion: projectcalico.org/v3\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`kind: NetworkPolicy\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`metadata:\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  name: allow-busybox-egress\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  namespace: advanced-policy-demo\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`spec:\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  selector: run == 'access'\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  types:\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  - Egress\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  egress:\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`  - action: Allow\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:\"EOF\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"kubectl api-resources\"}),\"\\uB85C \\uD655\\uC778\\uD574\\uBCF4\\uBA74 NetworkPolicy\\uB85C \\uB3D9\\uC77C\\uD55C KIND\\uC778\\uB370 Group\\uACFC Version\\uC774 \\uB2E4\\uB978 \\uAC83\\uC774 \\uBCF4\\uC778\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"networkpolicies                                crd.projectcalico.org/v1               \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`         NetworkPolicy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"networkpolicies                   netpol       networking.k8s.io/v1                   \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`         NetworkPolicy\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"kubectl get networkpolicy -A\"}),\"\\uB97C \\uD558\\uAC8C \\uB418\\uBA74, networking.k8s.io/v1\\uC758 NetworkPolicy\\uB9CC \\uBCF4\\uC5EC\\uC8FC\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC544\\uB798\\uCC98\\uB7FC Group\\uACFC Version\\uC744 \\uBA85\\uC2DC\\uD574\\uC11C resource\\uB97C \\uAC00\\uC838\\uC654\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`kubectl get networkpolicy.v1.crd.projectcalico.org\n`})})}),(0,n.jsx)(e.p,{children:\"\\uC774\\uB807\\uAC8C Custom Resource\\uB97C \\uC0DD\\uC131\\uD588\\uC73C\\uBA74 \\uC774\\uAC83\\uC774 Calico\\uC758 data store\\uC640 sync\\uAC00 \\uB418\\uACE0, \\uADF8 \\uB370\\uC774\\uD130\\uB97C \\uD1B5\\uD574\\uC11C Felix\\uAC00 iptables rule\\uC774\\uB098 eBPF\\uB85C \\uD574\\uB2F9 \\uB0B4\\uC6A9\\uC744 \\uC801\\uC6A9\\uD560 \\uAC83\\uC774\\uB2E4. \\uADF8\\uB7F0\\uB370 Calico system\\uC5D0\\uC11C custom resource\\uAC00 \\uC0DD\\uC131\\uB418\\uACE0\\uB098 \\uBCC0\\uACBD\\uB41C \\uAC83\\uC744 \\uD0D0\\uC9C0\\uD574\\uC11C \\uADF8\\uAC83\\uC5D0 \\uB530\\uB77C\\uC11C \\uB85C\\uC9C1\\uC744 \\uC218\\uD589\\uD558\\uB294 \\uBD80\\uBD84\\uC740 \\uC5B4\\uB514\\uC5D0\\uC11C \\uCC3E\\uC744 \\uC218 \\uC788\\uB294\\uAC70\\uC9C0? \\u{1F914}\"}),(0,n.jsxs)(e.p,{children:[\"Calico\\uB294 Kubernetes\\uB9D0\\uACE0 OpenStack\\uC774\\uB098 cluster\\uAC00 \\uC544\\uB2CC \\uD658\\uACBD\\uC5D0\\uC11C\\uB3C4 \\uC124\\uCE58\\uD574\\uC11C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB294 \\uAC83\\uC744 \\uC0DD\\uAC01\\uD558\\uBA74 Kubernetes\\uC640\\uC758 coupling\\uC744 \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uD588\\uC744 \\uAC83\\uC774\\uB77C \\uCD94\\uCE21\\uD588\\uB2E4. \\uADF8\\uB798\\uC11C Calico node\\uB294 Kubernetes\\uC758 \\uC874\\uC7AC\\uB294 \\uBAA8\\uB974\\uACE0 calico datasource\\uC758 \\uBCC0\\uD654\\uC5D0 \\uB300\\uD574\\uC11C event\\uB97C \\uBC1B\\uC544\\uC11C \\uB85C\\uC9C1\\uC774 \\uC218\\uD589\\uB41C\\uB2E4\\uACE0 \\uC0DD\\uAC01\\uD588\\uB2E4. Kubernetes\\uC640\\uC758 coupling\\uC744 \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uD558\\uACE0, kubernetes native resource\\uAC00 \\uBCC0\\uD654\\uD558\\uB294 \\uAC83\\uC5D0 \\uB300\\uD574\\uC11C\\uB294 kube-controller\\uB85C watch\\uD574\\uC11C \\uBCC0\\uD654\\uB41C \\uB0B4\\uC6A9\\uC744 calico datasource\\uC5D0 sync\\uB97C \\uD574\\uC8FC\\uB294 \\uAC83\\uC77C \\uAC83\\uC774\\uB2E4. \\uADF8\\uB7F0\\uB370 Kubernetes CRD\\uAC00 \",(0,n.jsx)(e.code,{children:\"projectcalico.org\"}),\" group\\uC73C\\uB85C \\uB9CE\\uC740 \\uAC83\\uC774 \\uC874\\uC7AC\\uD558\\uB294\\uB370, \\uC774\\uAC83\\uC774 \\uC5B4\\uB5BB\\uAC8C Calico system\\uC5D0 \\uBC18\\uC601\\uC774 \\uB418\\uB294\\uC9C0 \\uC758\\uC544\\uD588\\uB2E4. \\uC5B4\\uC81C \\uBE14\\uB85C\\uADF8\\uB97C \\uC815\\uB9AC\\uD560 \\uB54C\\uB294 \\uC2E4\\uB9C8\\uB9AC\\uAC00 \\uBCF4\\uC774\\uC9C0 \\uC54A\\uC558\\uB294\\uB370, \\uBB38\\uB4DD calicoctl\\uC774\\uB098 calico apiserver\\uAC00 \\uD558\\uACE0 \\uC788\\uC744 \\uAC83\\uC774\\uB77C\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. calicoctl\\uB85C \\uC801\\uC6A9\\uC744 \\uD558\\uBA74 calico datasource\\uC640 kubernetes CRD\\uB97C \\uAC19\\uC774 \\uBCC0\\uACBD\\uD558\\uB294 \\uAC83\\uC774\\uB2E4. kubernetes custom resource\\uB97C controller\\uB85C watch\\uD558\\uC5EC status\\uB97C \\uB9DE\\uCDB0\\uC8FC\\uB294 \\uAC83\\uC774 \\uC544\\uB2C8\\uB77C, \\uADF8\\uB0E5 client\\uC5D0\\uC11C custom resource\\uB97C \\uC801\\uC6A9\\uD560 \\uB54C \\uC791\\uC5C5\\uC744 \\uD574\\uC8FC\\uB294 \\uAC83\\uC774\\uB2E4. calico apiserver\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uADF8\\uB0E5 kubectl\\uB97C \\uC801\\uC6A9\\uD55C\\uB2E4\\uBA74, \\uC774\\uBD80\\uBD84\\uC774 \\uB4E4\\uC5B4\\uAC00\\uC9C0 \\uC54A\\uC558\\uC744\\uAE4C? \\uC774\\uB7EC\\uD55C \\uC0DD\\uAC01\\uC744 \\uAC00\\uC9C0\\uACE0 \\uB2E4\\uC2DC \\uD55C\\uBC88 \\uC18C\\uC2A4 \\uCF54\\uB4DC\\uB97C \\uC0B4\\uD3B4\\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[\"calicoctl\\uC758 \\uCF54\\uB4DC\\uB97C \\uBCF4\\uBA74 \\uCD5C\\uC885\\uC801\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"libcalico-go/lib/clientv3\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uAC8C \\uB41C\\uB2E4. clientv3\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"networkPolicies\"}),\"\\uC758 method \",(0,n.jsx)(e.code,{children:\"Create\"}),\"\\uB97C \\uC0B4\\uD3B4\\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4. calico apiserver\\uB97C \\uC0AC\\uC6A9\\uD558\\uBA74 \\uC774\\uAC8C \\uB300\\uC2E0\\uC5D0 defaulting\\uACFC validation\\uC744 \\uD574\\uC8FC\\uB294\\uB370, \\uC5EC\\uAE30\\uC5D0 \\uADF8\\uC5D0 \\uB300\\uD55C \\uB85C\\uC9C1\\uC774 \\uB4E4\\uC5B4\\uAC00 \\uC788\\uB2E4. \",(0,n.jsx)(e.code,{children:\"libcalico-go\"}),\"\\uB294 \\uC774\\uC81C calico\\uC5D0\\uC11C \\uB0B4\\uBD80\\uC801\\uC73C\\uB85C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD55C \\uCF54\\uB4DC\\uC774\\uACE0, \\uC774\\uAC78 custom controller\\uB97C \\uB9CC\\uB4E4 \\uB54C code-generator\\uB85C \\uB9CC\\uB4E0 clientSets\\uB300\\uC2E0\\uC5D0 \\uC0AC\\uC6A9\\uD558\\uB294 \\uC774\\uC720\\uC774\\uB2E4. \\uC774\\uB807\\uAC8C defaulting\\uACFC validation\\uC744 \\uD558\\uACE0 custom resource\\uB97C \\uC0DD\\uC131\\uD574\\uC8FC\\uACE0 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r networkPolicies\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" opts options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SetOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" res \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Since we're about to default some fields, take a (shallow) copy of the input data\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// before we do so.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tresCopy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),`res\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tres \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),`resCopy\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"defaultPolicyTypesField\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Ingress\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Egress\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Types\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" validator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Validate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Properly prefix the name\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tres\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetObjectMeta\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"convertPolicyNameForStorage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetObjectMeta\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"resources\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Create\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" opts\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindNetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" out \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Remove the prefix out of the returned policy name.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetObjectMeta\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"convertPolicyNameFromStorage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetObjectMeta\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" out\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Remove the prefix out of the returned policy name.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tres\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetObjectMeta\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"convertPolicyNameFromStorage\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"res\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetObjectMeta\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetName\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC0DD\\uAC01\\uD574\\uBCF4\\uB2C8 \\uB098\\uC758 Minikube Kubernetes cluster\\uD658\\uACBD\\uC5D0\\uC11C Calico datastore Kubernetes\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4. CRD\\uB85C \\uC874\\uC7AC\\uD558\\uB294 \\uAC83\\uB4E4\\uC774 Calico datastore\\uC758 data\\uC778 \\uAC83\\uC774\\uACE0, \\uC608\\uB97C \\uB4E4\\uC5B4\\uC11C custom resource\\uC778 GlobalNetworkPolicy\\uB098 NetworkPolicy\\uB97C \\uC0DD\\uC131\\uD558\\uBA74, \\uADF8\\uAC83\\uC774 Calico datastore\\uC5D0 \\uC800\\uC7A5\\uC774 \\uB41C \\uAC83\\uC774\\uB2E4. Calico datastore\\uB97C \\uBCC4\\uB3C4\\uC758 etcdv3\\uB85C \\uC124\\uC815\\uD558\\uC9C0 \\uC54A\\uACE0, Kubernetes\\uB97C \\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC774\\uB7EC\\uD55C CRD\\uAC00 \\uC0DD\\uC131\\uB41C \\uAC83\\uC774\\uB2E4. \\uB530\\uB77C\\uC11C kubectl + calico apiserver\\uB098 calicoctl\\uB85C CRD\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4\\uB294 \\uAC83\\uC740 Calico data store\\uC5D0 \\uB370\\uC774\\uD130\\uB97C \\uC800\\uC7A5/\\uBCC0\\uACBD\\uD558\\uB294 \\uAC83\\uC774\\uB2E4. \\uB530\\uB77C\\uC11C Felix\\uB294 \\uC774 CRD\\uC758 custom resource\\uC758 \\uBCC0\\uD654\\uC5D0 \\uB530\\uB77C\\uC11C network rule\\uC744 \\uC815\\uC758\\uD560 \\uAC83\\uC774\\uB2E4. \\uC774\\uC81C Felix \\uC18C\\uC2A4\\uCF54\\uB4DC\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"daemon.go\"}),\"\\uB97C \\uBCF4\\uBA74, \",(0,n.jsx)(e.code,{children:\"flexsyncer\"}),\" instance\\uB97C \\uC0DD\\uC131\\uD558\\uB294 \\uAC83\\uC744 \\uBCFC \\uC218 \\uC788\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"daemon.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"configFile \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gitVersion \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" buildDate \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gitRevision \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Use the syncer locally.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tsyncer \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" felixsyncer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"New\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"backendClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" datastoreConfig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" syncerToValidator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" configParams\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IsLeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"using resource updates where applicable\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tconfigParams\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetUseNodeResourceUpdates\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"flexsyncerv1.go\"}),\"\\uB97C \\uC0B4\\uD3B4\\uBCF4\\uBA74 \\uC774\\uB807\\uAC8C go type\\uC73C\\uB85C \\uC815\\uC758\\uB41C Kind \\uC885\\uB958\\uB97C \\uC815\\uC758\\uD558\\uB294 \\uBD80\\uBD84\\uC774 \\uC0DD\\uAE34\\uB2E4. \",(0,n.jsx)(e.code,{children:\"apiv3.KindGlobalNetworkPolicy\"}),\"\\uB294 GlobalNetworkPolicy Kind\\uB97C \\uC758\\uBBF8\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"felixsyncerv1.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"New\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"client api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" cfg apiconfig\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CalicoAPIConfigSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" callbacks api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SyncerCallbacks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" isLeader \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"bool\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Syncer \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" isLeader \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// These resources are only required if this is the active Felix instance on the node.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tadditionalTypes \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"watchersyncer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindGlobalNetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewGlobalNetworkPolicyUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindGlobalNetworkSet\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewGlobalNetworkSetUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindIPPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewIPPoolUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" libapiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindNode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewFelixNodeUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"cfg\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"K8sUsePodCIDR\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindProfile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewProfileUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" libapiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindWorkloadEndpoint\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewWorkloadEndpointUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindNetworkPolicy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewNetworkPolicyUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindNetworkSet\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewNetworkSetUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"   model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindHostEndpoint\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tUpdateProcessor\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" updateprocessors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewHostEndpointUpdateProcessor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" model\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResourceListOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Kind\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" apiv3\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KindBGPConfiguration\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" watchersyncer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"New\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tclient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tresourceTypes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tcallbacks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC704\\uC5D0\\uC11C 'GlobalNetworkPolicy', 'GlobalNetworkSet'\\uB4F1 \\uD544\\uC694\\uD55C resource\\uB4E4\\uC5D0 \\uB300\\uD574\\uC11C \\uC815\\uC758\\uAC00 \\uB418\\uC5C8\\uB294\\uB370, \\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"watchersyncer.go\"}),\"\\uC5D0\\uC11C\\uB294 \\uADF8\\uB7EC\\uD55C resource\\uB4E4\\uC744 slice\\uC5D0 \\uC800\\uC7A5\\uD55C\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"watchersyncer.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"New\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"client api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" resourceTypes \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"ResourceType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" callbacks api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SyncerCallbacks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Syncer \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\trs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"watcherSyncer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\twatcherCaches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"make\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"watcherCache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"resourceTypes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tresults\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       \",(0,n.jsx)(e.span,{className:\"token function\",children:\"make\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"chan\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2000\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tcallbacks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"     callbacks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" resourceTypes \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\trs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"watcherCaches\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"i\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"newWatcherCache\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" rs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"results\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` rs\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"run\"}),\"\\uC774 \\uD638\\uCD9C\\uB418\\uBA74 \\uC544\\uAE4C slice\\uC5D0 \\uC800\\uC7A5\\uD574\\uB1A8\\uB358 resource\\uBCC4 watcherCache\\uC758 run\\uC744 forloop\\uC744 \\uD1B5\\uD574\\uC11C \\uB2E4\\uC2DC \\uD638\\uCD9C\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"watchersyncer.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ws \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"watcherSyncer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Debug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Sending initial status event and starting watchers\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"sendStatusUpdate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"WaitForDatastore\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" wc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" ws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"watcherCaches \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// no need for ws.wgwc.Add(1), been set already\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"go\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"wc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"watcherCache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"defer\"}),\" ws\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"wgwc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Done\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\twc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Debug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Watcher cache run completed\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \",(0,n.jsx)(e.code,{children:\"watchercache.go\"}),\"\\uB97C \\uC0B4\\uD3B4\\uBCF4\\uBA74 \",(0,n.jsx)(e.code,{children:\"resyncAndCreateWatcher\"}),\"\\uAC00 \\uD638\\uCD9C\\uB418\\uACE0, \\uC774\\uAC83\\uC740 \\uBA3C\\uC800 resync\\uAC00 \\uD544\\uC694\\uD558\\uBA74 List\\uB97C \\uD558\\uACE0, \\uADF8 \\uB2E4\\uC74C\\uC5D0 \\uC55E\\uC73C\\uB85C \\uBCC0\\uD654\\uB294 \\uAC83\\uB9CC Watch\\uB85C Event\\uB97C \\uBC1B\\uB3C4\\uB85D \\uB418\\uC5B4 \\uC788\\uB2E4. \\uC774\\uC81C felix\\uAC00 Kubernetes\\uC758 custom resource\\uB97C Watch\\uD558\\uBA74\\uC11C \\uBCC0\\uACBD\\uB418\\uC5C8\\uC744 \\uB54C Event\\uB97C \\uBC1B\\uACE0, Event\\uBCC4\\uB85C \\uC815\\uC758\\uB41C event handler \\uB85C\\uC9C1\\uC744 \\uC218\\uD589\\uD558\\uAC8C \\uB418\\uB294 \\uAC83\\uC774\\uB2E4.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"watchercache.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"wc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"watcherCache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\twc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"logger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Debug\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Watcher cache starting, start initial sync processing\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\twc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"resyncAndCreateWatcher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"watchercache.go\"})}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"wc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"watcherCache\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"resyncAndCreateWatcher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  l\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"List\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"resourceType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"currentWatchRevision\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Watch\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"resourceType\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ListInterface\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" wc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"currentWatchRevision\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})})]})}}var w=b;return y;})();\n;return Component;","toc":[{"value":"Calico kube-controllers","url":"#calico-kube-controllers","depth":2},{"value":"pod controller","url":"#pod-controller","depth":3},{"value":"networkpolicy controller","url":"#networkpolicy-controller","depth":3},{"value":"Calico CRD와 연결점은 어떻게 되는거지?","url":"#calico-crd와-연결점은-어떻게-되는거지","depth":3}],"frontMatter":{"readingTime":{"text":"16 min read","minutes":15.38,"time":922800,"words":3076},"slug":"20230722-calico-kube-controller","fileName":"20230722-calico-kube-controller.md","title":"Calico kube-controller 이해하기","date":"2023-07-22T00:00:00.000Z","tags":["kubernetes","calico"],"summary":"Calico에서 어떻게 CRD를 활용하는지 이해하기 위해서 Calico Opensource 버전의 깃헙 소스코드를 살펴보게 되었다. Calico archiecture에서 kube-controller 부분이 어떤 역할을 하는지 소스 코드를 통해서 이해할 수 있게 되었다. kube-controller들은 kubernetes native resource에 대한 변경을 calico data store와 sync해주는 역할을 하고 있다. 내가 사용하는 Minikbue Kubernetes Cluster에서는 Calico의 data store는 kubernetes로 설정되어 있기 때문에, CRD로 Calico data들이 저장되고 Felix가 이것을 watch하여 변화에 대해서 network rule을 업데이트 하게 된다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.155,"time":9300,"words":31},"slug":["default"],"fileName":"default.md","name":"Jaemyun Lee","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"책 두 권 \u003c초집중\u003e, \u003c훅\u003e","date":"2023-07-17T00:00:00.000Z","tags":["book"],"summary":"나의 집중력을 되찾고 싶은 마음에 책 \u003c초집중\u003e을 읽었다. 그리고 애 책의 저자중 한명이 과거에 쓴 \u003c훅\u003e도 읽게 되었다. \u003c흑\u003e은 2014년에 출간된 책으로 조금 오래된 책이지만, 사업모델이 습관에 의존한다면 이 책이 도움이 될거라는 설명에 읽어보게 되었다. 계기, 행동, 가변적 보상, 투자라는 키워드를 현재 내가 일하고 있는 프로덕트와 내가 한번 쯤 만들어보고 싶은 서비스와 연관지어서 생각해보는 시간을 가졌다. 그 과정에서 떠오른 아이디어도 PM분들과 공유해보았다.","slug":"20230717-book-review-indistractable-hooked"},"next":{"title":"행동 설계 7단계를 내 실생활에 적용해보자","date":"2023-07-23T00:00:00.000Z","tags":["book"],"summary":"책 \"훅(Hooked)\"에서 포그 행동모델을 알게 되었다. 이번에는 포그가 쓴 책 \"습관의 디테일(Tiny Habits)\"을 읽어 보게 되었다. 내가 과거에 습관으로 잘 형성했던 행동들을 행동 모델 7단계 관점에서 생각을 해보았다. 그리고 내가 습관화 하지 못했던 행동들에 대해서도 생각해보면서 다시 한번 어떻게 꾸준히 할 수 있을까 고민해보았다. 알고리즘 꾸준히 공부하기는 내가 습관화 하고 싶었던 것 중에 하나였는데 매번 실패하는 행동이었다. 이번에 행동 모델 7단계에 내용들을 적용하여 다시 시도해본다.","slug":"20230723-book-review-tiny-habit"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20230722-calico-kube-controller"]},"buildId":"6wD5WOxHuwCf3uz6-6MEg","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>