<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Kubernetes에서 GPU 사용하기</title><meta name="robots" content="follow, index"/><meta name="description" content="Pytorch를 컨테이너로 띄우고 GPU를 사용하고 싶었다. 따라서 Docker container에서 NVIDIA GPU를 사용할 수 있도록 셋팅을 해보았다. 그리고 최종적으로 Kubernetes에서 GPU hardware를 사용할 수 있도록 nvidia device plugin을 DaemonSet으로 띄우고 Pod를 실행해보았다."/><meta property="og:url" content="https://jayground8.github.io/blog/20231029-gpu-on-k8s"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Pytorch를 컨테이너로 띄우고 GPU를 사용하고 싶었다. 따라서 Docker container에서 NVIDIA GPU를 사용할 수 있도록 셋팅을 해보았다. 그리고 최종적으로 Kubernetes에서 GPU hardware를 사용할 수 있도록 nvidia device plugin을 DaemonSet으로 띄우고 Pod를 실행해보았다."/><meta property="og:title" content="Kubernetes에서 GPU 사용하기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Kubernetes에서 GPU 사용하기"/><meta name="twitter:description" content="Pytorch를 컨테이너로 띄우고 GPU를 사용하고 싶었다. 따라서 Docker container에서 NVIDIA GPU를 사용할 수 있도록 셋팅을 해보았다. 그리고 최종적으로 Kubernetes에서 GPU hardware를 사용할 수 있도록 nvidia device plugin을 DaemonSet으로 띄우고 Pod를 실행해보았다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20231029-gpu-on-k8s"/><meta property="article:published_time" content="2023-10-29T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20231029-gpu-on-k8s"
  },
  "headline": "Kubernetes에서 GPU 사용하기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2023-10-29T00:00:00.000Z",
  "dateModified": "2023-10-29T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Pytorch를 컨테이너로 띄우고 GPU를 사용하고 싶었다. 따라서 Docker container에서 NVIDIA GPU를 사용할 수 있도록 셋팅을 해보았다. 그리고 최종적으로 Kubernetes에서 GPU hardware를 사용할 수 있도록 nvidia device plugin을 DaemonSet으로 띄우고 Pod를 실행해보았다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-466fb5a20c8f55ee.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/Bf9vZuf10B_ZqDl2hZbNP/_buildManifest.js" defer=""></script><script src="/_next/static/Bf9vZuf10B_ZqDl2hZbNP/_ssgManifest.js" defer=""></script><script src="/_next/static/Bf9vZuf10B_ZqDl2hZbNP/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-10-29T00:00:00.000Z">Sunday, October 29, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Kubernetes에서 GPU 사용하기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="container에서-gpu-사용하도록-설정"><a href="#container에서-gpu-사용하도록-설정" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>container에서 GPU 사용하도록 설정</h2><p><a target="_blank" rel="noopener noreferrer" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">digialocean</a>에서 설명된 방법으로 Docker를 Ubuntu20.04에 설치를 하였다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y apt-transport-https ca-certificates <span class="token function">curl</span> software-properties-common
</span><span class="code-line"><span class="token function">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
</span><span class="code-line"><span class="token function">sudo</span> add-apt-repository <span class="token string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable&quot;</span>
</span><span class="code-line"><span class="token function">apt-cache</span> policy docker-ce
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y docker-ce
</span></code></pre></div><p>이제 gpus를 사용해서 docker container를 아래처럼 실행한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> docker run -it --runtime<span class="token operator">=</span>nvidia --gpus all python:3.9 <span class="token function">bash</span>
</span></code></pre></div><p>하지만 아래와 같은 에러 메세지와 함께 nvidia로 설정하여 실행할 수가 없다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">docker: Error response from daemon: unknown or invalid runtime name: nvidia.
</span><span class="code-line">See <span class="token string">&#x27;docker run --help&#x27;</span>
</span></code></pre></div><p>Container에서 nvida driver를 사용할 수 있도록 <a target="_blank" rel="noopener noreferrer" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">nvidia-container-toolkit</a>을 설치해야 한다. 문서에 나온 것처럼 아래와 같이 설치를 한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">curl</span> -fsSL https://nvidia.github.io/libnvidia-container/gpgkey <span class="token operator">|</span> <span class="token function">sudo</span> gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg <span class="token punctuation">\</span>
</span><span class="code-line">  <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list <span class="token operator">|</span> <span class="token punctuation">\</span>
</span><span class="code-line">    <span class="token function">sed</span> <span class="token string">&#x27;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#x27;</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
</span><span class="code-line">    <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nvidia-container-toolkit.list <span class="token punctuation">\</span>
</span><span class="code-line">  <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
</span><span class="code-line">    <span class="token function">sudo</span> <span class="token function">apt-get</span> update
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y nvidia-container-toolkit
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> nvidia-ctk runtime configure --runtime<span class="token operator">=</span>docker
</span></code></pre></div><p>docker config 파일이 아래처럼 <code>nvidia-container-runtime</code>을 사용하도록 설정된 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">sudo</span> <span class="token function">cat</span> /etc/docker/daemon.json
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token string">&quot;runtimes&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token string">&quot;nvidia&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token string">&quot;args&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
</span><span class="code-line">          <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nvidia-container-runtime&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span></code></pre></div><p>해당 config가 적용될 수 있도록 docker daemon을 재시작한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> systemctl restart docker
</span></code></pre></div><p>이제 runtime option을 nvidia로 설정을 해도 정상적으로 실행이 될 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> docker run -it --runtime<span class="token operator">=</span>nvidia --gpus all python:3.9 <span class="token function">bash</span>
</span></code></pre></div><h2 id="pytorch-사용해보기"><a href="#pytorch-사용해보기" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>pytorch 사용해보기</h2><p>이제 pytorch를 containerization을 해서 사용해본다. 먼저 <code>nvidia-smi</code>로 CUDA version을 확인한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ nvidia-smi
</span><span class="code-line">+-----------------------------------------------------------------------------+
</span><span class="code-line"><span class="token operator">|</span> NVIDIA-SMI <span class="token number">470.199</span>.02   Driver Version: <span class="token number">470.199</span>.02   CUDA Version: <span class="token number">11.4</span>     <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>-------------------------------+----------------------+----------------------+
</span><span class="code-line"><span class="token operator">|</span> GPU  Name        Persistence-M<span class="token operator">|</span> Bus-Id        Disp.A <span class="token operator">|</span> Volatile Uncorr. ECC <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span> Fan  Temp  Perf  Pwr:Usage/Cap<span class="token operator">|</span>         Memory-Usage <span class="token operator">|</span> GPU-Util  Compute M. <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>               MIG M. <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>   <span class="token number">0</span>  Tesla T4            On   <span class="token operator">|</span> 00000000:00:05.0 Off <span class="token operator">|</span>                  Off <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span> N/A   27C    P8     8W /  70W <span class="token operator">|</span>      0MiB / 16127MiB <span class="token operator">|</span>      <span class="token number">0</span>%      Default <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>                               <span class="token operator">|</span>                      <span class="token operator">|</span>                  N/A <span class="token operator">|</span>
</span><span class="code-line">+-------------------------------+----------------------+----------------------+
</span><span class="code-line">
</span><span class="code-line">+-----------------------------------------------------------------------------+
</span><span class="code-line"><span class="token operator">|</span> Processes:                                                                  <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>  GPU   GI   CI        PID   Type   Process name                  GPU Memory <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>        ID   ID                                                   Usage      <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>  No running processes found                                                 <span class="token operator">|</span>
</span><span class="code-line">+-----------------------------------------------------------------------------+
</span></code></pre></div><p>위에서처럼 CUDA version이 <code>11.4</code>라고 하면, torch를 <code>11.4</code>를 사용할 수 있도록 설치를 한다. 먼저 python 3.9 image로 container를 실행하고,</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> docker run -it --runtime<span class="token operator">=</span>nvidia --gpus all python:3.9 <span class="token function">bash</span>
</span></code></pre></div><p>원하는 버전의 package들을 설치한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">pip <span class="token function">install</span> <span class="token assign-left variable">torch</span><span class="token operator">==</span><span class="token number">1.12</span>.1+cu113 <span class="token assign-left variable">torchvision</span><span class="token operator">==</span><span class="token number">0.13</span>.1+cu113 <span class="token assign-left variable">torchaudio</span><span class="token operator">==</span><span class="token number">0.12</span>.1+cu113 -f https://download.pytorch.org/whl/torch_stable.html
</span></code></pre></div><p>이제 torch가 설치가 완료되면 python interpreter를 실행해서 torch가 사용하는 CUDA version을 아래와 같이 확인한다. 아래처럼 <code>11.3</code> 값을 리턴하는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">import</span> torch
</span><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> torch.version.cuda
</span><span class="code-line"><span class="token string">&#x27;11.3&#x27;</span>
</span></code></pre></div><p>그리고 cuda를 사용가능한지 확인해보면 <code>True</code>가 리턴되는 것을 확인 할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> torch.cuda.is_available<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">True
</span></code></pre></div><p>CUDA version이 상위 버전이면 아래와 같은 에러 메세지가 발생한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">import</span> torch
</span><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> torch.cuda.is_available<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">/usr/local/lib/python3.9/site-packages/torch/cuda/__init__.py:138: UserWarning: CUDA initialization: The NVIDIA driver on your system is too old <span class="token punctuation">(</span>found version <span class="token number">11040</span><span class="token punctuation">)</span>. Please update your GPU driver by downloading and installing a new version from the URL: http://www.nvidia.com/Download/index.aspx Alternatively, go to: https://pytorch.org to <span class="token function">install</span> a PyTorch version that has been compiled with your version of the CUDA driver. <span class="token punctuation">(</span>Triggered internally at <span class="token punctuation">..</span>/c10/cuda/CUDAFunctions.cpp:108.<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token builtin class-name">return</span> torch._C._cuda_getDeviceCount<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
</span><span class="code-line">False
</span></code></pre></div><h2 id="kubernetes에서-torch-application을-실행하기"><a href="#kubernetes에서-torch-application을-실행하기" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Kubernetes에서 torch application을 실행하기</h2><p>이제 kubernetes에서 pod로 container가 실행할 때 kubelet이 GPU를 사용하도록 설정을 해야 한다. Kubernetes에서는 <a target="_blank" rel="noopener noreferrer" href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/">device plugin</a>를 제공하여 kubelet이 특정 device를 인지하고 사용할 수 있도록 한다. 따라서 NVIDIA에서 <a target="_blank" rel="noopener noreferrer" href="https://github.com/NVIDIA/k8s-device-plugin">k8s-device-plugin</a>을 제공한다.</p><p>device plugin을 DaemonSet object로 Host의 <code>/var/lib/kubelet/device-plugins</code> 경로에 mount하여 설정할 수 있다. 설치하는 <a target="_blank" rel="noopener noreferrer" href="https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/v0.14.1/nvidia-device-plugin.yml">DaemonSet의 manifest 파일</a>을 확인하면 아래와 같다.</p><div class="relative"><pre><code class="code-highlight language-yml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> DaemonSet
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> nvidia<span class="token punctuation">-</span>device<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>daemonset
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">name</span><span class="token punctuation">:</span> nvidia<span class="token punctuation">-</span>device<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>ds
</span><span class="code-line">  <span class="token atrule key">updateStrategy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">type</span><span class="token punctuation">:</span> RollingUpdate
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">name</span><span class="token punctuation">:</span> nvidia<span class="token punctuation">-</span>device<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>ds
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">tolerations</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">key</span><span class="token punctuation">:</span> nvidia.com/gpu
</span><span class="code-line">          <span class="token atrule key">operator</span><span class="token punctuation">:</span> Exists
</span><span class="code-line">          <span class="token atrule key">effect</span><span class="token punctuation">:</span> NoSchedule
</span><span class="code-line">      <span class="token comment"># Mark this pod as a critical add-on; when enabled, the critical add-on</span>
</span><span class="code-line">      <span class="token comment"># scheduler reserves resources for critical add-on pods so that they can</span>
</span><span class="code-line">      <span class="token comment"># be rescheduled after a failure.</span>
</span><span class="code-line">      <span class="token comment"># See https://kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/</span>
</span><span class="code-line">      <span class="token atrule key">priorityClassName</span><span class="token punctuation">:</span> <span class="token string">&#x27;system-node-critical&#x27;</span>
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">image</span><span class="token punctuation">:</span> nvcr.io/nvidia/k8s<span class="token punctuation">-</span>device<span class="token punctuation">-</span>plugin<span class="token punctuation">:</span>v0.14.1
</span><span class="code-line">          <span class="token atrule key">name</span><span class="token punctuation">:</span> nvidia<span class="token punctuation">-</span>device<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>ctr
</span><span class="code-line">          <span class="token atrule key">env</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> FAIL_ON_INIT_ERROR
</span><span class="code-line">              <span class="token atrule key">value</span><span class="token punctuation">:</span> <span class="token string">&#x27;false&#x27;</span>
</span><span class="code-line">          <span class="token atrule key">securityContext</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">            <span class="token atrule key">capabilities</span><span class="token punctuation">:</span>
</span><span class="code-line">              <span class="token atrule key">drop</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;ALL&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">          <span class="token atrule key">volumeMounts</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> device<span class="token punctuation">-</span>plugin
</span><span class="code-line">              <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /var/lib/kubelet/device<span class="token punctuation">-</span>plugins
</span><span class="code-line">      <span class="token atrule key">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> device<span class="token punctuation">-</span>plugin
</span><span class="code-line">          <span class="token atrule key">hostPath</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token atrule key">path</span><span class="token punctuation">:</span> /var/lib/kubelet/device<span class="token punctuation">-</span>plugins
</span></code></pre></div><p>테스트하는 kubernetes cluster의 container runtime이 <code>containerd</code>로 되어 있기 때문에, Docker 예제에서 한것처럼 <a target="_blank" rel="noopener noreferrer" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">문서</a>를 따라서 아래와 같이 설정을 해준다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> nvidia-ctk runtime configure --runtime<span class="token operator">=</span>containerd
</span><span class="code-line"><span class="token function">sudo</span> systemctl restart containerd
</span></code></pre></div><p>그리고 마지막으로 테스트로 해당 Pod를 띄우면</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token punctuation bash"> <span class="token operator">|</span> kubectl apply -f -</span>
</span></span><span class="code-line"><span class="token string">apiVersion: v1
</span></span><span class="code-line"><span class="token string">kind: Pod
</span></span><span class="code-line"><span class="token string">metadata:
</span></span><span class="code-line"><span class="token string">  name: gpu-pod
</span></span><span class="code-line"><span class="token string">spec:
</span></span><span class="code-line"><span class="token string">  restartPolicy: Never
</span></span><span class="code-line"><span class="token string">  containers:
</span></span><span class="code-line"><span class="token string">    - name: cuda-container
</span></span><span class="code-line"><span class="token string">      image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda10.2
</span></span><span class="code-line"><span class="token string">      resources:
</span></span><span class="code-line"><span class="token string">        limits:
</span></span><span class="code-line"><span class="token string">          nvidia.com/gpu: 1 # requesting 1 GPU
</span></span><span class="code-line"><span class="token string">  tolerations:
</span></span><span class="code-line"><span class="token string">  - key: nvidia.com/gpu
</span></span><span class="code-line"><span class="token string">    operator: Exists
</span></span><span class="code-line"><span class="token string">    effect: NoSchedule
</span></span><span class="code-line"><span class="token string">EOF</span>
</span></code></pre></div><p>아래처럼 정상적으로 테스트를 통과한 Pod 로그를 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">Test PASSED
</span><span class="code-line">Done
</span></code></pre></div><p>이제 kubernetes에서 정상적으로 셋팅이 되었으니, GPU를 사용하여 torch application을 실행할 수 있다. 그런데 여기서 주의할 것은 kubeblet이 GPU hardware를 사용하도록 container을 실행할 때 아래와 같이 resource request/limit이 없으면 기본으로 CPU를 사용하도록 한다.</p><div class="relative"><pre><code class="code-highlight language-yml"><span class="code-line"><span class="token atrule key">resources</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">limits</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">nvidia.com/gpu</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># requesting 1 GPU</span>
</span></code></pre></div></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/kubernetes">kubernetes</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231021-csi-driver">aws-ebs-csi-driver 코드로 csi driver 이해하기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20231111-update-ubuntu-kernel">CVE 취약점 확인하고 Ubuntu Kernel Update 해보기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var t=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=\u003ek(i(l(a!=null?t(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((D,o)=\u003e{o.exports=_jsx_runtime});var f={};u(f,{default:()=\u003ey,frontmatter:()=\u003eb});var e=g(r()),b={title:\"Kubernetes\\uC5D0\\uC11C GPU \\uC0AC\\uC6A9\\uD558\\uAE30\",date:\"2023-10-29\",tags:[\"kubernetes\"],images:[\"/static/images/social-banner.png\"],summary:\"Pytorch\\uB97C \\uCEE8\\uD14C\\uC774\\uB108\\uB85C \\uB744\\uC6B0\\uACE0 GPU\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. \\uB530\\uB77C\\uC11C Docker container\\uC5D0\\uC11C NVIDIA GPU\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uC14B\\uD305\\uC744 \\uD574\\uBCF4\\uC558\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uCD5C\\uC885\\uC801\\uC73C\\uB85C Kubernetes\\uC5D0\\uC11C GPU hardware\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D nvidia device plugin\\uC744 DaemonSet\\uC73C\\uB85C \\uB744\\uC6B0\\uACE0 Pod\\uB97C \\uC2E4\\uD589\\uD574\\uBCF4\\uC558\\uB2E4.\"};function v(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",pre:\"pre\",code:\"code\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"container\\uC5D0\\uC11C-gpu-\\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#container\\uC5D0\\uC11C-gpu-\\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"container\\uC5D0\\uC11C GPU \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04\",children:\"digialocean\"}),\"\\uC5D0\\uC11C \\uC124\\uBA85\\uB41C \\uBC29\\uBC95\\uC73C\\uB85C Docker\\uB97C Ubuntu20.04\\uC5D0 \\uC124\\uCE58\\uB97C \\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),\" -y apt-transport-https ca-certificates \",(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),` software-properties-common\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -fsSL https://download.docker.com/linux/ubuntu/gpg \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" apt-key \",(0,e.jsx)(n.span,{className:\"token function\",children:\"add\"}),` -\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" add-apt-repository \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"apt-cache\"}),` policy docker-ce\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y docker-ce\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C gpus\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C docker container\\uB97C \\uC544\\uB798\\uCC98\\uB7FC \\uC2E4\\uD589\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" docker run -it --runtime\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"nvidia --gpus all python:3.9 \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bash\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uD558\\uC9C0\\uB9CC \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uC5D0\\uB7EC \\uBA54\\uC138\\uC9C0\\uC640 \\uD568\\uAED8 nvidia\\uB85C \\uC124\\uC815\\uD558\\uC5EC \\uC2E4\\uD589\\uD560 \\uC218\\uAC00 \\uC5C6\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`docker: Error response from daemon: unknown or invalid runtime name: nvidia.\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"See \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'docker run --help'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Container\\uC5D0\\uC11C nvida driver\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \",(0,e.jsx)(n.a,{href:\"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html\",children:\"nvidia-container-toolkit\"}),\"\\uC744 \\uC124\\uCE58\\uD574\\uC57C \\uD55C\\uB2E4. \\uBB38\\uC11C\\uC5D0 \\uB098\\uC628 \\uAC83\\uCC98\\uB7FC \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uCE58\\uB97C \\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -fsSL https://nvidia.github.io/libnvidia-container/gpgkey \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sed\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"tee\"}),\" /etc/apt/sources.list.d/nvidia-container-toolkit.list \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt-get\"}),` update\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt-get\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y nvidia-container-toolkit\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" nvidia-ctk runtime configure --runtime\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`docker\n`]})})}),(0,e.jsxs)(n.p,{children:[\"docker config \\uD30C\\uC77C\\uC774 \\uC544\\uB798\\uCC98\\uB7FC \",(0,e.jsx)(n.code,{children:\"nvidia-container-runtime\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /etc/docker/daemon.json\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"runtimes\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nvidia\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"args\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"path\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"nvidia-container-runtime\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uD574\\uB2F9 config\\uAC00 \\uC801\\uC6A9\\uB420 \\uC218 \\uC788\\uB3C4\\uB85D docker daemon\\uC744 \\uC7AC\\uC2DC\\uC791\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart docker\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C runtime option\\uC744 nvidia\\uB85C \\uC124\\uC815\\uC744 \\uD574\\uB3C4 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC2E4\\uD589\\uC774 \\uB420 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" docker run -it --runtime\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"nvidia --gpus all python:3.9 \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bash\"}),`\n`]})})}),(0,e.jsxs)(n.h2,{id:\"pytorch-\\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\",children:[(0,e.jsx)(n.a,{href:\"#pytorch-\\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"pytorch \\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C pytorch\\uB97C containerization\\uC744 \\uD574\\uC11C \\uC0AC\\uC6A9\\uD574\\uBCF8\\uB2E4. \\uBA3C\\uC800 \",(0,e.jsx)(n.code,{children:\"nvidia-smi\"}),\"\\uB85C CUDA version\\uC744 \\uD655\\uC778\\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ nvidia-smi\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+-----------------------------------------------------------------------------+\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" NVIDIA-SMI \",(0,e.jsx)(n.span,{className:\"token number\",children:\"470.199\"}),\".02   Driver Version: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"470.199\"}),\".02   CUDA Version: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"11.4\"}),\"     \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`-------------------------------+----------------------+----------------------+\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" GPU  Name        Persistence-M\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Bus-Id        Disp.A \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Volatile Uncorr. ECC \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Fan  Temp  Perf  Pwr:Usage/Cap\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"         Memory-Usage \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" GPU-Util  Compute M. \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                               \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                      \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"               MIG M. \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"   \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\"  Tesla T4            On   \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" 00000000:00:05.0 Off \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                  Off \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" N/A   27C    P8     8W /  70W \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"      0MiB / 16127MiB \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"      \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\"%      Default \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                               \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                      \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                  N/A \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+-------------------------------+----------------------+----------------------+\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+-----------------------------------------------------------------------------+\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Processes:                                                                  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"  GPU   GI   CI        PID   Type   Process name                  GPU Memory \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"        ID   ID                                                   Usage      \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"  No running processes found                                                 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+-----------------------------------------------------------------------------+\n`})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC704\\uC5D0\\uC11C\\uCC98\\uB7FC CUDA version\\uC774 \",(0,e.jsx)(n.code,{children:\"11.4\"}),\"\\uB77C\\uACE0 \\uD558\\uBA74, torch\\uB97C \",(0,e.jsx)(n.code,{children:\"11.4\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uC124\\uCE58\\uB97C \\uD55C\\uB2E4. \\uBA3C\\uC800 python 3.9 image\\uB85C container\\uB97C \\uC2E4\\uD589\\uD558\\uACE0,\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" docker run -it --runtime\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"nvidia --gpus all python:3.9 \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bash\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uC6D0\\uD558\\uB294 \\uBC84\\uC804\\uC758 package\\uB4E4\\uC744 \\uC124\\uCE58\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pip \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"torch\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1.12\"}),\".1+cu113 \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"torchvision\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.13\"}),\".1+cu113 \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"torchaudio\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.12\"}),`.1+cu113 -f https://download.pytorch.org/whl/torch_stable.html\n`]})})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C torch\\uAC00 \\uC124\\uCE58\\uAC00 \\uC644\\uB8CC\\uB418\\uBA74 python interpreter\\uB97C \\uC2E4\\uD589\\uD574\\uC11C torch\\uAC00 \\uC0AC\\uC6A9\\uD558\\uB294 CUDA version\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD655\\uC778\\uD55C\\uB2E4. \\uC544\\uB798\\uCC98\\uB7FC \",(0,e.jsx)(n.code,{children:\"11.3\"}),\" \\uAC12\\uC744 \\uB9AC\\uD134\\uD558\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"import\"}),` torch\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` torch.version.cuda\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"'11.3'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 cuda\\uB97C \\uC0AC\\uC6A9\\uAC00\\uB2A5\\uD55C\\uC9C0 \\uD655\\uC778\\uD574\\uBCF4\\uBA74 \",(0,e.jsx)(n.code,{children:\"True\"}),\"\\uAC00 \\uB9AC\\uD134\\uB418\\uB294 \\uAC83\\uC744 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" torch.cuda.is_available\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`True\n`})]})}),(0,e.jsx)(n.p,{children:\"CUDA version\\uC774 \\uC0C1\\uC704 \\uBC84\\uC804\\uC774\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uC5D0\\uB7EC \\uBA54\\uC138\\uC9C0\\uAC00 \\uBC1C\\uC0DD\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"import\"}),` torch\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" torch.cuda.is_available\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"/usr/local/lib/python3.9/site-packages/torch/cuda/__init__.py:138: UserWarning: CUDA initialization: The NVIDIA driver on your system is too old \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"found version \",(0,e.jsx)(n.span,{className:\"token number\",children:\"11040\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\". Please update your GPU driver by downloading and installing a new version from the URL: http://www.nvidia.com/Download/index.aspx Alternatively, go to: https://pytorch.org to \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),\" a PyTorch version that has been compiled with your version of the CUDA driver. \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Triggered internally at \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),\"/c10/cuda/CUDAFunctions.cpp:108.\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"return\"}),\" torch._C._cuda_getDeviceCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`False\n`})]})}),(0,e.jsxs)(n.h2,{id:\"kubernetes\\uC5D0\\uC11C-torch-application\\uC744-\\uC2E4\\uD589\\uD558\\uAE30\",children:[(0,e.jsx)(n.a,{href:\"#kubernetes\\uC5D0\\uC11C-torch-application\\uC744-\\uC2E4\\uD589\\uD558\\uAE30\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kubernetes\\uC5D0\\uC11C torch application\\uC744 \\uC2E4\\uD589\\uD558\\uAE30\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C kubernetes\\uC5D0\\uC11C pod\\uB85C container\\uAC00 \\uC2E4\\uD589\\uD560 \\uB54C kubelet\\uC774 GPU\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC744 \\uD574\\uC57C \\uD55C\\uB2E4. Kubernetes\\uC5D0\\uC11C\\uB294 \",(0,e.jsx)(n.a,{href:\"https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/\",children:\"device plugin\"}),\"\\uB97C \\uC81C\\uACF5\\uD558\\uC5EC kubelet\\uC774 \\uD2B9\\uC815 device\\uB97C \\uC778\\uC9C0\\uD558\\uACE0 \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uD55C\\uB2E4. \\uB530\\uB77C\\uC11C NVIDIA\\uC5D0\\uC11C \",(0,e.jsx)(n.a,{href:\"https://github.com/NVIDIA/k8s-device-plugin\",children:\"k8s-device-plugin\"}),\"\\uC744 \\uC81C\\uACF5\\uD55C\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"device plugin\\uC744 DaemonSet object\\uB85C Host\\uC758 \",(0,e.jsx)(n.code,{children:\"/var/lib/kubelet/device-plugins\"}),\" \\uACBD\\uB85C\\uC5D0 mount\\uD558\\uC5EC \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uC124\\uCE58\\uD558\\uB294 \",(0,e.jsx)(n.a,{href:\"https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/v0.14.1/nvidia-device-plugin.yml\",children:\"DaemonSet\\uC758 manifest \\uD30C\\uC77C\"}),\"\\uC744 \\uD655\\uC778\\uD558\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` DaemonSet\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nvidia\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"plugin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`daemonset\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" kube\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nvidia\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"plugin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`ds\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"updateStrategy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` RollingUpdate\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nvidia\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"plugin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`ds\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"tolerations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"key\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nvidia.com/gpu\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"operator\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Exists\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"effect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` NoSchedule\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Mark this pod as a critical add-on; when enabled, the critical add-on\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# scheduler reserves resources for critical add-on pods so that they can\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# be rescheduled after a failure.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# See https://kubernetes.io/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"priorityClassName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'system-node-critical'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nvcr.io/nvidia/k8s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"plugin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`v0.14.1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nvidia\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"plugin\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`ctr\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` FAIL_ON_INIT_ERROR\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'false'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"securityContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"allowPrivilegeEscalation\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"capabilities\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"drop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ALL'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`plugin\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" /var/lib/kubelet/device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`plugins\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`plugin\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"hostPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"path\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" /var/lib/kubelet/device\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`plugins\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uD14C\\uC2A4\\uD2B8\\uD558\\uB294 kubernetes cluster\\uC758 container runtime\\uC774 \",(0,e.jsx)(n.code,{children:\"containerd\"}),\"\\uB85C \\uB418\\uC5B4 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, Docker \\uC608\\uC81C\\uC5D0\\uC11C \\uD55C\\uAC83\\uCC98\\uB7FC \",(0,e.jsx)(n.a,{href:\"https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html\",children:\"\\uBB38\\uC11C\"}),\"\\uB97C \\uB530\\uB77C\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uC744 \\uD574\\uC900\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" nvidia-ctk runtime configure --runtime\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`containerd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart containerd\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB9AC\\uACE0 \\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \\uD14C\\uC2A4\\uD2B8\\uB85C \\uD574\\uB2F9 Pod\\uB97C \\uB744\\uC6B0\\uBA74\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\u003c\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:[\"EOF\",(0,e.jsxs)(n.span,{className:\"token punctuation bash\",children:[\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" kubectl apply -f -\"]}),`\n`]})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`apiVersion: v1\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`kind: Pod\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`metadata:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  name: gpu-pod\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`spec:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  restartPolicy: Never\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  containers:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    - name: cuda-container\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`      image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda10.2\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`      resources:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`        limits:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`          nvidia.com/gpu: 1 # requesting 1 GPU\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  tolerations:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  - key: nvidia.com/gpu\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    operator: Exists\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`    effect: NoSchedule\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"EOF\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC544\\uB798\\uCC98\\uB7FC \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD1B5\\uACFC\\uD55C Pod \\uB85C\\uADF8\\uB97C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Test PASSED\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Done\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C kubernetes\\uC5D0\\uC11C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC14B\\uD305\\uC774 \\uB418\\uC5C8\\uC73C\\uB2C8, GPU\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC torch application\\uC744 \\uC2E4\\uD589\\uD560 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB7F0\\uB370 \\uC5EC\\uAE30\\uC11C \\uC8FC\\uC758\\uD560 \\uAC83\\uC740 kubeblet\\uC774 GPU hardware\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D container\\uC744 \\uC2E4\\uD589\\uD560 \\uB54C \\uC544\\uB798\\uC640 \\uAC19\\uC774 resource request/limit\\uC774 \\uC5C6\\uC73C\\uBA74 \\uAE30\\uBCF8\\uC73C\\uB85C CPU\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"resources\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"limits\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nvidia.com/gpu\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# requesting 1 GPU\"}),`\n`]})]})})]})}}var y=v;return f;})();\n;return Component;","toc":[{"value":"container에서 GPU 사용하도록 설정","url":"#container에서-gpu-사용하도록-설정","depth":2},{"value":"pytorch 사용해보기","url":"#pytorch-사용해보기","depth":2},{"value":"Kubernetes에서 torch application을 실행하기","url":"#kubernetes에서-torch-application을-실행하기","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.47,"time":388200,"words":1294},"slug":"20231029-gpu-on-k8s","fileName":"20231029-gpu-on-k8s.md","title":"Kubernetes에서 GPU 사용하기","date":"2023-10-29T00:00:00.000Z","tags":["kubernetes"],"images":["/static/images/social-banner.png"],"summary":"Pytorch를 컨테이너로 띄우고 GPU를 사용하고 싶었다. 따라서 Docker container에서 NVIDIA GPU를 사용할 수 있도록 셋팅을 해보았다. 그리고 최종적으로 Kubernetes에서 GPU hardware를 사용할 수 있도록 nvidia device plugin을 DaemonSet으로 띄우고 Pod를 실행해보았다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"aws-ebs-csi-driver 코드로 csi driver 이해하기","date":"2023-10-21T00:00:00.000Z","tags":["kubernetes"],"images":["/static/images/social-banner.png"],"summary":"aws-ebs-csi-driver 소스코드를 보고 csi driver가 하는 역할을 이해해보았다. 크게 Controller plugin과 Node plugin으로 구성되어 있고, 다양한 sidecar container들이 존재한다. 이 sidecar container들이 Volume을 생성하고, 노드에 부착하고, Host 혹은 container directory에 mount하는 것을 진행한다. 이과정에서 CSI driver로 cloud vendor마다 다른 로직으로 그들의 volume을 제어하게 된다. 네이버 클라우드에서 storage가 처음 생성될 때 서버에 부착이 되어야만 하는 제약사항이 있어서, PVC로 PV 동적 할당을 할 때 volumeBindingMode이 Immediate이면 자동으로 Node에 부착이 된다.","slug":"20231021-csi-driver"},"next":{"title":"CVE 취약점 확인하고 Ubuntu Kernel Update 해보기","date":"2023-11-11T00:00:00.000Z","tags":["ubuntu","security"],"images":["/static/images/social-banner.png"],"summary":"OpenSCAP으로 Ubuntu20.04 이미지를 사용하는 가상서버의 취약점 리포트를 만들어보고, 보고된 취약점이 패치된 커널 버전으로 업그레이드 하여 해당 이슈를 해결해보았다. 이렇게 업그레이드 된 커널과 패키지들이 정상적으로 작동하는지 확인하고 사용할 수 있는 파이프라인을 만드는 것도 나중에 고민해봐야겠다.","slug":"20231111-update-ubuntu-kernel"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20231029-gpu-on-k8s"]},"buildId":"Bf9vZuf10B_ZqDl2hZbNP","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>