<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Understanding how to build Bitnami Mindeb image and Google Distroless image</title><meta name="robots" content="follow, index"/><meta name="description" content="Recently, Bitnami announced that secure container images would only be available under a paid plan, and that they would stop maintaining most of their previous images, except for a few open-source projects. Bitnami container images are based on the minideb image, which includes fewer packages than a standard Debian image. I started wondering whether I could replace this with a Distroless image built using Bazel and maintain it myself.This blog explains how minideb and Distroless images are built."/><meta property="og:url" content="https://jayground8.github.io/blog/20250824-bazel"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Recently, Bitnami announced that secure container images would only be available under a paid plan, and that they would stop maintaining most of their previous images, except for a few open-source projects. Bitnami container images are based on the minideb image, which includes fewer packages than a standard Debian image. I started wondering whether I could replace this with a Distroless image built using Bazel and maintain it myself.This blog explains how minideb and Distroless images are built."/><meta property="og:title" content="Understanding how to build Bitnami Mindeb image and Google Distroless image"/><meta property="og:image" content="https://jayground8.github.io/static/images/thumbnail/distroless.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Understanding how to build Bitnami Mindeb image and Google Distroless image"/><meta name="twitter:description" content="Recently, Bitnami announced that secure container images would only be available under a paid plan, and that they would stop maintaining most of their previous images, except for a few open-source projects. Bitnami container images are based on the minideb image, which includes fewer packages than a standard Debian image. I started wondering whether I could replace this with a Distroless image built using Bazel and maintain it myself.This blog explains how minideb and Distroless images are built."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/thumbnail/distroless.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20250824-bazel"/><meta property="article:published_time" content="2025-08-24T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20250824-bazel"
  },
  "headline": "Understanding how to build Bitnami Mindeb image and Google Distroless image",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/thumbnail/distroless.png"
    }
  ],
  "datePublished": "2025-08-24T00:00:00.000Z",
  "dateModified": "2025-08-24T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Recently, Bitnami announced that secure container images would only be available under a paid plan, and that they would stop maintaining most of their previous images, except for a few open-source projects. Bitnami container images are based on the minideb image, which includes fewer packages than a standard Debian image. I started wondering whether I could replace this with a Distroless image built using Bazel and maintain it myself.This blog explains how minideb and Distroless images are built."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0e373dd4633ec194.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/byMjVt7p1j1f5Lba1yluX/_buildManifest.js" defer=""></script><script src="/_next/static/byMjVt7p1j1f5Lba1yluX/_ssgManifest.js" defer=""></script><script src="/_next/static/byMjVt7p1j1f5Lba1yluX/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-08-24T00:00:00.000Z">Sunday, August 24, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Understanding how to build Bitnami Mindeb image and Google Distroless image</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>I use Distroless images as the base for my applications. Distroless images not only reduce the overall container size but also minimize the surface area for security vulnerabilities. Last year, I briefly explored how Bazel works in order to add a package to a Distroless image, since some applications required additional Debian packages.</p><p>Recently, Bitnami announced that secure container images will only be available under a paid plan, and that they would stop maintaining most of their previous images except for a few open-source projects. That made me wonder: Would it be possible to replace all Bitnami container images with Distroless as the base? That’s where this journey began.</p><p>To meet security requirements in the past, I often had to modify Dockerfiles from open-source projects and rebuild the images myself. I also needed to review all containers to ensure they passed security compliance checks and report on them regularly. It was a tedious and repetitive job. With Distroless images, however, much of that effort can be avoided. Since Distroless does not even include a shell by default, direct container access is restricted—and in many cases, that alone allows you to bypass a number of security compliance checks.</p><h2 id="understanding-bitnami-mindeb-image"><a href="#understanding-bitnami-mindeb-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Understanding Bitnami Mindeb Image</h2><p>Bitnami Images use <a target="_blank" rel="noopener noreferrer" href="https://github.com/bitnami/minideb">minideb image</a> as their base image. Let’s take a closer look at how a minideb base image can be built.</p><p>Before that, it’s important to understand what the debootstrap package does. The debootstrap package allows you to create minimal Debian base systems. For example, you can quickly build a Debian-based container image using Docker and debootstrap on Ubuntu:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">apt install debootstrap
</span><span class="code-line">DEBOOTSTRAP_DIR=$(mktemp -d)
</span><span class="code-line">sudo debootstrap --variant=minbase --arch=amd64 trixie $DEBOOTSTRAP_DIR
</span><span class="code-line">sudo tar -C $DEBOOTSTRAP_DIR -cf - . | docker import - debian:stable
</span></code></pre></div><p>Now you’ve generated a Debian container image. You can check the Debian version inside the container:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">$ docker run -it debian:stable cat /etc/debian_version
</span><span class="code-line">13.0
</span></code></pre></div><h3 id="which-packages-get-installed-during-debootstrap"><a href="#which-packages-get-installed-during-debootstrap" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Which packages get installed during debootstrap?</h3><p>The installation process is defined by predefined debootstrap scripts. For example, if you’re using the current stable release Trixie, you can find its script at:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">cat</span> /usr/share/debootstrap/scripts/trixie
</span></code></pre></div><p>In fact, the scripts for Bookworm, Bullseye, and Trixie all point to a shared script called debian-common:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">mirror_style release
</span><span class="code-line">download_style <span class="token function">apt</span>
</span><span class="code-line">finddebs_style from-indices
</span><span class="code-line">variants - buildd fakechroot minbase
</span><span class="code-line">keyring /usr/share/keyrings/debian-archive-keyring.gpg
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># include common settings</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">[</span> -e <span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>/scripts/debian-common&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line"> <span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>/scripts/debian-common&quot;</span>
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token punctuation">[</span> -e /debootstrap/debian-common <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line"> <span class="token builtin class-name">.</span> /debootstrap/debian-common
</span><span class="code-line"><span class="token keyword">elif</span> <span class="token punctuation">[</span> -e <span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>/debian-common&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line"> <span class="token builtin class-name">.</span> <span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>/debian-common&quot;</span>
</span><span class="code-line"><span class="token keyword">else</span>
</span><span class="code-line"> error <span class="token number">1</span> NOCOMMON <span class="token string">&quot;File not found: debian-common&quot;</span>
</span><span class="code-line"><span class="token keyword">fi</span>
</span></code></pre></div><p>Inside <code>debian-common</code>, you’ll find three main functions. In short, they download Debian packages and initialize the system configuration:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ <span class="token function">cat</span> /usr/share/debootstrap/scripts/debian-common
</span><span class="code-line">
</span><span class="code-line"><span class="token function function-name">work_out_debs</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function function-name">first_stage_install</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function function-name">second_stage_install</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="the-work_out_debs-function"><a href="#the-work_out_debs-function" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The work_out_debs function</h3><p>The key part is the work_out_debs function, which determines which packages get installed. By default, it selects all Debian packages with the required priority:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token variable assign-left">required</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>get_debs Priority: required<span class="token variable">)</span></span>&quot;</span>
</span></code></pre></div><p>For example, you can check the priority of the bash package:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ <span class="token function">apt-cache</span> show <span class="token function">bash</span>
</span><span class="code-line">Package: <span class="token function">bash</span>
</span><span class="code-line">Architecture: amd64
</span><span class="code-line">Version: <span class="token number">5.2</span>.21-2ubuntu4
</span><span class="code-line">Multi-Arch: foreign
</span><span class="code-line">Priority: required
</span><span class="code-line">Essential: <span class="token function">yes</span>
</span><span class="code-line">Section: shells
</span><span class="code-line">Origin: Ubuntu
</span><span class="code-line">Maintainer: Ubuntu Developers <span class="token operator">&lt;</span>ubuntu-devel-discuss@lists.ubuntu.com<span class="token operator">&gt;</span>
</span><span class="code-line">Original-Maintainer: Matthias Klose <span class="token operator">&lt;</span>doko@debian.org<span class="token operator">&gt;</span>
</span><span class="code-line">Bugs: https://bugs.launchpad.net/ubuntu/+filebug
</span><span class="code-line">Installed-Size: <span class="token number">1900</span>
</span><span class="code-line">Pre-Depends: libc6 <span class="token punctuation">(</span><span class="token operator">&gt;=</span> <span class="token number">2.38</span><span class="token punctuation">)</span>, libtinfo6 <span class="token punctuation">(</span><span class="token operator">&gt;=</span> <span class="token number">6</span><span class="token punctuation">)</span>
</span><span class="code-line">Depends: base-files <span class="token punctuation">(</span><span class="token operator">&gt;=</span> <span class="token number">2.1</span>.12<span class="token punctuation">)</span>, debianutils <span class="token punctuation">(</span><span class="token operator">&gt;=</span> <span class="token number">5.6</span>-0.1<span class="token punctuation">)</span>
</span><span class="code-line">Recommends: bash-completion
</span><span class="code-line">Suggests: bash-doc
</span><span class="code-line">Filename: pool/main/b/bash/bash_5.2.21-2ubuntu4_amd64.deb
</span><span class="code-line">Size: <span class="token number">794086</span>
</span><span class="code-line">MD5sum: 627cdbb775b1a60dadd502e96e0426b1
</span><span class="code-line">SHA1: 8065b79389fc555b38cf71e297a259773b09c38e
</span><span class="code-line">SHA256: 73de311a21e094e29ac01527d2b52226cc87fde0a5b57032902251b426d92c66
</span><span class="code-line">SHA512: c14c2c8fa0d1ae7530efa0375845257b4ec0baa5bc42982efca2d7fa860b4e4ea3f04d31cfa328d2f250b2baeac3795c8b31aa5ff2d514ed16a5cf8c3132a590
</span><span class="code-line">Homepage: http://tiswww.case.edu/php/chet/bash/bashtop.html
</span><span class="code-line">Description-en: GNU Bourne Again SHell
</span><span class="code-line"> Bash is an sh-compatible <span class="token builtin class-name">command</span> language interpreter that executes
</span><span class="code-line"> commands <span class="token builtin class-name">read</span> from the standard input or from a file.  Bash also
</span><span class="code-line"> incorporates useful features from the Korn and C shells <span class="token punctuation">(</span>ksh and csh<span class="token punctuation">)</span>.
</span><span class="code-line"> <span class="token builtin class-name">.</span>
</span><span class="code-line"> Bash is ultimately intended to be a conformant implementation of the
</span><span class="code-line"> IEEE POSIX Shell and Tools specification <span class="token punctuation">(</span>IEEE Working Group <span class="token number">1003.2</span><span class="token punctuation">)</span>.
</span><span class="code-line"> <span class="token builtin class-name">.</span>
</span><span class="code-line"> The Programmable Completion Code, by Ian Macdonald, is now found <span class="token keyword">in</span>
</span><span class="code-line"> the bash-completion package.
</span><span class="code-line">Description-md5: 3522aa7b4374048d6450e348a5bb45d9
</span><span class="code-line">Task: minimal
</span></code></pre></div><p>Since bash is marked as required, you can expect it to be installed during debootstrap initialization.</p><h3 id="bitnamis-customization"><a href="#bitnamis-customization" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Bitnami’s customization</h3><p>Bitnami overrides the default debootstrap script to better suit container image generation. <a target="_blank" rel="noopener noreferrer" href="https://github.com/bitnami/minideb/blob/master/debootstrap/bullseye">Here’s their version for Bullseye.</a></p><p>In their script, the required variable explicitly lists which Debian packages should be included:</p><p><code>debootstrap/bullseye</code></p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">mirror_style release
</span><span class="code-line">download_style <span class="token function">apt</span>
</span><span class="code-line">finddebs_style from-indices
</span><span class="code-line">variants - container fakechroot
</span><span class="code-line">keyring /usr/share/keyrings/debian-archive-keyring.gpg
</span><span class="code-line">
</span><span class="code-line"><span class="token function function-name">work_out_debs</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token variable assign-left">required</span><span class="token operator">=</span><span class="token string">&quot;adduser base-files base-passwd bash bsdutils coreutils dash debian-archive-keyring diffutils dpkg findutils grep gzip hostname init-system-helpers libc-bin login lsb-base mawk ncurses-base passwd sed sysv-rc tar tzdata util-linux mount&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This is why their build script copies these custom files into the DEBOOTSTRAP_DIR and sets the --variant=container flag when running debootstrap:</p><p><code>mkimage</code></p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token variable assign-left">DEBOOTSTRAP_DIR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp -d<span class="token variable">)</span></span>
</span><span class="code-line"><span class="token function">cp</span> -a /usr/share/debootstrap/* <span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>&quot;</span>
</span><span class="code-line"><span class="token function">cp</span> -a /usr/share/keyrings/debian-archive-keyring.gpg <span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>&quot;</span>
</span><span class="code-line"><span class="token function">cp</span> -a <span class="token string">&quot;<span class="token variable">${ROOT}</span>/debootstrap/&quot;</span>* <span class="token string">&quot;<span class="token variable">${DEBOOTSTRAP_DIR}</span>/scripts&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">
</span><span class="code-line"><span class="token variable assign-left">DEBOOTSTRAP_DIR</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$DEBOOTSTRAP_DIR</span>&quot;</span> <span class="token function">debootstrap</span> <span class="token string">&quot;<span class="token variable">${debootstrap_arch_args<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span>  --keyring <span class="token string">&quot;<span class="token variable">$KEYRING</span>&quot;</span> --variant container --foreign <span class="token string">&quot;<span class="token variable">${DIST}</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$rootfsDir</span>&quot;</span>
</span></code></pre></div><h2 id="understanding-distroless-image"><a href="#understanding-distroless-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Understanding Distroless Image</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8/example-bazel">Example Source Code</a></p><p>This time, let’s take a closer look at how a Distroless image can be built with Bazel. I’ll be using Bazelisk to run Bazel.</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">sudo curl -o /usr/bin/bazelisk -L https://github.com/bazelbuild/bazelisk/releases/download/v1.27.0/bazelisk-linux-amd64
</span><span class="code-line">sudo chmod a+x /usr/bin/bazelisk
</span></code></pre></div><p>You can specify the version of Bazel you want to use in the .bazelversion file. Bazelisk automatically sets up the specified version and runs Bazel commands. I set it to the latest version at the time of writing:</p><p><code>.bazelversion</code></p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">8.3.1
</span></code></pre></div><h3 id="setting-up-the-bazel-workspace"><a href="#setting-up-the-bazel-workspace" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Setting up the Bazel workspace</h3><p>Bazel requires a specific workspace structure. First, you need to add a MODULE.bazel file at the root of your project. In this file, you can declare external dependencies using predefined methods. In the examples below, we’ll use three methods:</p><ul><li>bazel_dep</li><li>use_extension</li><li>use_repo</li></ul><p>Here’s an example <code>MODULE.bazel</code> file:</p><p><code>MODULE.bazel</code></p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">bazel_dep(name = &quot;aspect_bazel_lib&quot;, version = &quot;2.21.1&quot;)
</span><span class="code-line">bazel_dep(name = &quot;rules_oci&quot;, version = &quot;2.2.6&quot;)
</span><span class="code-line">bazel_dep(name = &quot;rules_distroless&quot;, version = &quot;0.5.3&quot;)
</span><span class="code-line">apt = use_extension(&quot;@rules_distroless//apt:extensions.bzl&quot;, &quot;apt&quot;)
</span><span class="code-line">
</span><span class="code-line">REPO = &quot;trixie&quot;
</span><span class="code-line">
</span><span class="code-line">apt.install(
</span><span class="code-line">    name = REPO,
</span><span class="code-line">    lock = &quot;//:{}.lock.json&quot;.format(REPO),
</span><span class="code-line">    manifest = &quot;//:{}.yaml&quot;.format(REPO),
</span><span class="code-line">    resolve_transitive = False,
</span><span class="code-line">    mergedusr = True,
</span><span class="code-line">)
</span><span class="code-line">
</span><span class="code-line">use_repo(apt, REPO)
</span></code></pre></div><h3 id="external-bazel-modules"><a href="#external-bazel-modules" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>External Bazel modules</h3><p>The <a target="_blank" rel="noopener noreferrer" href="https://registry.bazel.build/">Bazel Centry Registry</a> hosts external Bazel modules. You can use <code>bazel_dep</code> to declare which version of each external module you want to use. In this example, we’re using three modules:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">bazel_dep(name = &quot;aspect_bazel_lib&quot;, version = &quot;2.21.1&quot;)
</span><span class="code-line">bazel_dep(name = &quot;rules_oci&quot;, version = &quot;2.2.6&quot;)
</span><span class="code-line">bazel_dep(name = &quot;rules_distroless&quot;, version = &quot;0.5.3&quot;)
</span></code></pre></div><h3 id="configuring-debian-repositories"><a href="#configuring-debian-repositories" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Configuring Debian repositories</h3><p>Next, let’s configure the Debian repositories and packages to be installed in the Distroless image. We’ll use two methods:</p><ul><li>use_extension</li><li>use_repo.</li></ul><p>Here, we configure only the current Debian stable release:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token function">apt</span> <span class="token operator">=</span> use_extension<span class="token punctuation">(</span><span class="token string">&quot;@rules_distroless//apt:extensions.bzl&quot;</span>, <span class="token string">&quot;apt&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">REPO <span class="token operator">=</span> <span class="token string">&quot;trixie&quot;</span>
</span><span class="code-line">
</span><span class="code-line">apt.install<span class="token punctuation">(</span>
</span><span class="code-line">    name <span class="token operator">=</span> REPO,
</span><span class="code-line">    lock <span class="token operator">=</span> <span class="token string">&quot;//:{}.lock.json&quot;</span>.format<span class="token punctuation">(</span>REPO<span class="token punctuation">)</span>,
</span><span class="code-line">    manifest <span class="token operator">=</span> <span class="token string">&quot;//:{}.yaml&quot;</span>.format<span class="token punctuation">(</span>REPO<span class="token punctuation">)</span>,
</span><span class="code-line">    resolve_transitive <span class="token operator">=</span> False,
</span><span class="code-line">    mergedusr <span class="token operator">=</span> True,
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">use_repo<span class="token punctuation">(</span>apt, REPO<span class="token punctuation">)</span>
</span></code></pre></div><p>The <code>trixie.lock.json</code> file specifies the exact package versions you want installed. For example, the latest version of ca-certificates in Debian Trixie is <a target="_blank" rel="noopener noreferrer" href="https://packages.debian.org/trixie/ca-certificates">20250419 at the time of writing</a>. If you need to patch vulnerabilities (CVEs), you’ll need to update this lock file.</p><p><code>trixie.lock.json</code></p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;arch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arm64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ca-certificates_20250419_arm64&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ca-certificates&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;sha256&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ef590f89563aa4b46c8260d49d1cea0fc1b181d19e8df3782694706adf05c184&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://snapshot.debian.org/archive/debian/20250812T210203Z/pool/main/c/ca-certificates/ca-certificates_20250419_all.deb&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;20250419&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>I copied both <code>trixie.lock.json</code> and <code>trixie.yaml</code> <a target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleContainerTools/distroless/blob/0125c4d9736d0a4b037ba32d5107e9fac773d7ca/private/repos/deb/trixie.lock.json">from the Distroless GitHub repo</a>. The <code>trixie.yaml</code> file must follow the format described in <a target="_blank" rel="noopener noreferrer" href="https://github.com/bazel-contrib/rules_distroless/blob/cd8abc5d1c25d4cb87e3f48390514a946aa715eb/docs/apt.md">the rules_distroless documentation</a>.</p><h3 id="defining-the-base-image"><a href="#defining-the-base-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Defining the base image</h3><p>Now, let’s write a base.bzl file to define the base image using our external modules.</p><ul><li><code>aspect_bazel_lib</code> is used to create tar files.</li><li><code>rules_distroless</code> is used to define the Debian filesystem.</li><li><code>rules_oci</code> is used to build the final OCI container images.</li></ul><p><code>bazel.bzl</code></p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">load(&quot;@aspect_bazel_lib//lib:tar.bzl&quot;, &quot;tar&quot;)
</span><span class="code-line">load(&quot;@rules_distroless//distroless:defs.bzl&quot;, &quot;cacerts&quot;, &quot;group&quot;, &quot;home&quot;, &quot;locale&quot;, &quot;os_release&quot;, &quot;passwd&quot;)
</span><span class="code-line">load(&quot;@rules_oci//oci:defs.bzl&quot;, &quot;oci_image&quot;, &quot;oci_image_index&quot;)
</span><span class="code-line">load(&quot;:variables.bzl&quot;, &quot;MTIME&quot;, &quot;NOBODY&quot;, &quot;NONROOT&quot;, &quot;ROOT&quot;, &quot;USER_VARIANTS&quot;)
</span><span class="code-line">
</span><span class="code-line">def base_image():
</span><span class="code-line">    tar(
</span><span class="code-line">        name = &quot;rootfs&quot;,
</span><span class="code-line">        srcs = [],
</span><span class="code-line">        args = [
</span><span class="code-line">            &quot;--format&quot;,
</span><span class="code-line">            &quot;gnutar&quot;,
</span><span class="code-line">        ],
</span><span class="code-line">        compress = &quot;gzip&quot;,
</span><span class="code-line">        mtree = [&quot;./ type=dir uid=0 gid=0 time=0.0&quot;],
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    tar(
</span><span class="code-line">        name = &quot;tmp&quot;,
</span><span class="code-line">        srcs = [],
</span><span class="code-line">        # original tmp.tar was created on a gnutar, mimic that.
</span><span class="code-line">        args = [
</span><span class="code-line">            &quot;--format&quot;,
</span><span class="code-line">            &quot;gnutar&quot;,
</span><span class="code-line">        ],
</span><span class="code-line">        compress = &quot;gzip&quot;,
</span><span class="code-line">        mtree = [&quot;./tmp gname=root uname=root time=1501783453.0 mode=1777 gid=0 uid=0 type=dir&quot;],
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    os_release(
</span><span class="code-line">        name = &quot;os_release_debian13&quot;,
</span><span class="code-line">        content = {
</span><span class="code-line">            &quot;PRETTY_NAME&quot;: &quot;Distroless&quot;,
</span><span class="code-line">            &quot;NAME&quot;: &quot;Debian GNU/Linux&quot;,
</span><span class="code-line">            &quot;ID&quot;: &quot;debian&quot;,
</span><span class="code-line">            &quot;VERSION_ID&quot;: &quot;13&quot;,
</span><span class="code-line">            &quot;VERSION&quot;: &quot;Debian GNU/Linux 13 (trixie)&quot;,
</span><span class="code-line">        },
</span><span class="code-line">        time = MTIME,
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    locale(
</span><span class="code-line">        name = &quot;locale_debian13_arm64&quot;,
</span><span class="code-line">        charset = &quot;C.utf8&quot;,
</span><span class="code-line">        package = &quot;@trixie//libc-bin/arm64:data&quot;,
</span><span class="code-line">        time = MTIME,
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    cacerts(
</span><span class="code-line">        name = &quot;cacerts_debian13_arm64&quot;,
</span><span class="code-line">        package = &quot;@trixie//ca-certificates/arm64:data&quot;,
</span><span class="code-line">        time = MTIME,
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    group(
</span><span class="code-line">        name = &quot;group&quot;,
</span><span class="code-line">        entries = [
</span><span class="code-line">            {
</span><span class="code-line">                &quot;name&quot;: &quot;root&quot;,  # root_group
</span><span class="code-line">                &quot;gid&quot;: ROOT,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;name&quot;: &quot;nobody&quot;,  # nobody_group
</span><span class="code-line">                &quot;gid&quot;: NOBODY,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;name&quot;: &quot;tty&quot;,  # tty_group
</span><span class="code-line">                &quot;gid&quot;: 5,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;name&quot;: &quot;staff&quot;,  # staff_group
</span><span class="code-line">                &quot;gid&quot;: 50,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;name&quot;: &quot;nonroot&quot;,  # nonroot_group
</span><span class="code-line">                &quot;gid&quot;: NONROOT,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">            },
</span><span class="code-line">        ],
</span><span class="code-line">        time = MTIME,
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    passwd(
</span><span class="code-line">        name = &quot;passwd&quot;,
</span><span class="code-line">        entries = [
</span><span class="code-line">            {
</span><span class="code-line">                &quot;gecos&quot;: [&quot;root&quot;],
</span><span class="code-line">                &quot;gid&quot;: ROOT,
</span><span class="code-line">                &quot;shell&quot;: &quot;/sbin/nologin&quot;,
</span><span class="code-line">                &quot;home&quot;: &quot;/root&quot;,
</span><span class="code-line">                &quot;uid&quot;: ROOT,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">                &quot;username&quot;: &quot;root&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;gecos&quot;: [&quot;nobody&quot;],
</span><span class="code-line">                &quot;gid&quot;: NOBODY,
</span><span class="code-line">                &quot;home&quot;: &quot;/nonexistent&quot;,
</span><span class="code-line">                &quot;shell&quot;: &quot;/sbin/nologin&quot;,
</span><span class="code-line">                &quot;uid&quot;: NOBODY,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">                &quot;username&quot;: &quot;nobody&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;gecos&quot;: [&quot;nonroot&quot;],
</span><span class="code-line">                &quot;gid&quot;: NONROOT,
</span><span class="code-line">                &quot;home&quot;: &quot;/home/nonroot&quot;,
</span><span class="code-line">                &quot;shell&quot;: &quot;/sbin/nologin&quot;,
</span><span class="code-line">                &quot;uid&quot;: NONROOT,
</span><span class="code-line">                &quot;password&quot;: &quot;x&quot;,
</span><span class="code-line">                &quot;username&quot;: &quot;nonroot&quot;,
</span><span class="code-line">            },
</span><span class="code-line">        ],
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    home(
</span><span class="code-line">        name = &quot;home&quot;,
</span><span class="code-line">        dirs = [
</span><span class="code-line">            {
</span><span class="code-line">                &quot;home&quot;: &quot;/root&quot;,
</span><span class="code-line">                &quot;uid&quot;: ROOT,
</span><span class="code-line">                &quot;gid&quot;: ROOT,
</span><span class="code-line">                &quot;mode&quot;: 700,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;home&quot;: &quot;/home&quot;,
</span><span class="code-line">                &quot;uid&quot;: ROOT,
</span><span class="code-line">                &quot;gid&quot;: ROOT,
</span><span class="code-line">                &quot;mode&quot;: 755,
</span><span class="code-line">            },
</span><span class="code-line">            {
</span><span class="code-line">                &quot;home&quot;: &quot;/home/nonroot&quot;,
</span><span class="code-line">                &quot;uid&quot;: NONROOT,
</span><span class="code-line">                &quot;gid&quot;: NONROOT,
</span><span class="code-line">                &quot;mode&quot;: 700,
</span><span class="code-line">            },
</span><span class="code-line">        ],
</span><span class="code-line">    )
</span><span class="code-line">
</span><span class="code-line">    for (user, _, _) in USER_VARIANTS:
</span><span class="code-line">        oci_image_index(
</span><span class="code-line">            name = &quot;static_&quot; + user + &quot;_&quot; + &quot;debian13&quot;,
</span><span class="code-line">            images = [
</span><span class="code-line">                &quot;static_&quot; + user + &quot;_&quot; + &quot;arm64&quot; + &quot;_&quot; + &quot;debian13&quot;,
</span><span class="code-line">            ],
</span><span class="code-line">        )
</span><span class="code-line">
</span><span class="code-line">    for (user, uid, workdir) in USER_VARIANTS:
</span><span class="code-line">        oci_image(
</span><span class="code-line">            name = &quot;static_&quot; + user + &quot;_&quot; + &quot;arm64&quot; + &quot;_&quot; + &quot;debian13&quot;,
</span><span class="code-line">            env = {
</span><span class="code-line">                &quot;PATH&quot;: &quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,
</span><span class="code-line">                # allows openssl to find the certificates by default
</span><span class="code-line">                # TODO: We should run update-ca-certifaces, but that requires &quot;openssl rehash&quot;
</span><span class="code-line">                # which would probably need to be run inside the container
</span><span class="code-line">                &quot;SSL_CERT_FILE&quot;: &quot;/etc/ssl/certs/ca-certificates.crt&quot;,
</span><span class="code-line">            },
</span><span class="code-line">            tars = [
</span><span class="code-line">                &quot;@trixie//base-files/arm64&quot;,
</span><span class="code-line">                &quot;@trixie//netbase/arm64&quot;,
</span><span class="code-line">                &quot;@trixie//tzdata/arm64&quot;,
</span><span class="code-line">                &quot;@trixie//media-types/arm64&quot;,
</span><span class="code-line">                &quot;//:rootfs&quot;,
</span><span class="code-line">                &quot;//:passwd&quot;,
</span><span class="code-line">                &quot;//:home&quot;,
</span><span class="code-line">                &quot;//:group&quot;,
</span><span class="code-line">                # Create /tmp, too many things assume it exists.
</span><span class="code-line">                # tmp.tar has a /tmp with the correct permissions 01777
</span><span class="code-line">                &quot;//:tmp&quot;,
</span><span class="code-line">                &quot;:nsswitch.tar&quot;,
</span><span class="code-line">                &quot;//:os_release_&quot; + &quot;debian13&quot;,
</span><span class="code-line">                &quot;//:cacerts_&quot; + &quot;debian13&quot; + &quot;_&quot; + &quot;arm64&quot;,
</span><span class="code-line">            ],
</span><span class="code-line">            user = &quot;%d&quot; % uid,
</span><span class="code-line">            workdir = workdir,
</span><span class="code-line">            os = &quot;linux&quot;,
</span><span class="code-line">            architecture = &quot;arm64&quot;,
</span><span class="code-line">        )
</span></code></pre></div><h3 id="variables-file"><a href="#variables-file" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Variables file</h3><p>You can keep constants and variables in a separate <code>{name}.bzl</code> file and load them into your Bazel rules:</p><p><code>base.bzl</code></p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">load(&quot;:variables.bzl&quot;, &quot;MTIME&quot;, &quot;NOBODY&quot;, &quot;NONROOT&quot;, &quot;ROOT&quot;, &quot;USER_VARIANTS&quot;)
</span></code></pre></div><p><code>variables.bzl</code></p><div class="relative"><pre><code class="code-highlight"><span class="code-line">NOBODY = 65534
</span><span class="code-line">NONROOT = 65532
</span><span class="code-line">ROOT = 0
</span><span class="code-line">MTIME = &quot;946684800&quot;
</span><span class="code-line">USER_VARIANTS = [(&quot;root&quot;, 0, &quot;/&quot;), (&quot;nonroot&quot;, NONROOT, &quot;/home/nonroot&quot;)]
</span></code></pre></div><h3 id="adding-packages-to-the-image"><a href="#adding-packages-to-the-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Adding packages to the image</h3><p>Since we already declared the Debian repositories in <code>MODULE.bazel</code> with <code>rules_distroless</code>, you can add packages by referencing them like <code>@trixie//base-files/arm64</code>.</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">oci_image(
</span><span class="code-line">    name = &quot;static_&quot; + user + &quot;_&quot; + &quot;arm64&quot; + &quot;_&quot; + &quot;debian13&quot;,
</span><span class="code-line">    env = {
</span><span class="code-line">        &quot;PATH&quot;: &quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,
</span><span class="code-line">        # allows openssl to find the certificates by default
</span><span class="code-line">        # TODO: We should run update-ca-certifaces, but that requires &quot;openssl rehash&quot;
</span><span class="code-line">        # which would probably need to be run inside the container
</span><span class="code-line">        &quot;SSL_CERT_FILE&quot;: &quot;/etc/ssl/certs/ca-certificates.crt&quot;,
</span><span class="code-line">    },
</span><span class="code-line">    tars = [
</span><span class="code-line">        &quot;@trixie//base-files/arm64&quot;,
</span><span class="code-line">        &quot;@trixie//netbase/arm64&quot;,
</span><span class="code-line">        &quot;@trixie//tzdata/arm64&quot;,
</span><span class="code-line">        &quot;@trixie//media-types/arm64&quot;,
</span><span class="code-line">        &quot;//:rootfs&quot;,
</span><span class="code-line">        &quot;//:passwd&quot;,
</span><span class="code-line">        &quot;//:home&quot;,
</span><span class="code-line">        &quot;//:group&quot;,
</span><span class="code-line">        # Create /tmp, too many things assume it exists.
</span><span class="code-line">        # tmp.tar has a /tmp with the correct permissions 01777
</span><span class="code-line">        &quot;//:tmp&quot;,
</span><span class="code-line">        &quot;:nsswitch.tar&quot;,
</span><span class="code-line">        &quot;//:os_release_&quot; + &quot;debian13&quot;,
</span><span class="code-line">        &quot;//:cacerts_&quot; + &quot;debian13&quot; + &quot;_&quot; + &quot;arm64&quot;,
</span><span class="code-line">    ],
</span><span class="code-line">    user = &quot;%d&quot; % uid,
</span><span class="code-line">    workdir = workdir,
</span><span class="code-line">    os = &quot;linux&quot;,
</span><span class="code-line">    architecture = &quot;arm64&quot;,
</span><span class="code-line">)
</span></code></pre></div><p>Interestingly, Bazel files allow for loops. This is useful, for example, when you want to build multiple images for different users or architectures:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">def base_image():
</span><span class="code-line">    ...
</span><span class="code-line">    for (user, uid, workdir) in USER_VARIANTS:
</span><span class="code-line">        ...
</span></code></pre></div><h3 id="build-file"><a href="#build-file" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>BUILD file</h3><p>Finally, you need a BUILD file to wire everything together. Here, we import the function from base.bzl and call it:</p><p><code>BUILD</code></p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">load(&quot;:base.bzl&quot;, &quot;base_image&quot;)
</span><span class="code-line">
</span><span class="code-line">base_image()
</span></code></pre></div><h3 id="building-the-image"><a href="#building-the-image" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Building the image</h3><p>Now we’re ready to build the Distroless image with Bazel:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">bazelisk build //...
</span></code></pre></div><p>If the build succeeds, you’ll find two OCI images created:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">$ ls bazel-bin/static_nonroot_arm64_debian13
</span><span class="code-line">blobs      index.json oci-layout
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">$ ls bazel-bin/static_root_arm64_debian13
</span><span class="code-line">blobs      index.json oci-layout
</span></code></pre></div><p>You can load an OCI image into the Docker daemon using Skopeo:</p><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">brew install skopeo
</span></code></pre></div><div class="relative"><pre><code class="code-highlight language-sh"><span class="code-line">skopeo copy oci:./bazel-bin/static_nonroot_arm64_debian13 docker-daemon:my-distroless-image:stable
</span></code></pre></div><h2 id="conclusion"><a href="#conclusion" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conclusion</h2><p>The Bitnami Minideb image is used as the base image in the Bitnami project. I learned that it is built using custom scripts on top of the debootstrap package. By reviewing these scripts, you can see which Debian packages are included.</p><p>Google’s Distroless image goes even further by including an even smaller set of Debian packages. I took a closer look at how Distroless images can be generated with Bazel. Based on this understanding, I will try replacing the Minideb image with a Distroless image.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/bazel">bazel</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/security">security</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20250810-conventional-commits">Automating Semantic Versioning and Releases in Node.js with Conventional Commits</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var t=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var c=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{c(a);for(var i in s)l(a,i,{get:s[i],enumerable:!0})},b=(a,s,i)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(i=t(s,n))||i.enumerable});return a},g=a=\u003eb(c(l(a!=null?o(p(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((O,d)=\u003e{d.exports=_jsx_runtime});var y={};u(y,{default:()=\u003e_,frontmatter:()=\u003ek});var e=g(r()),k={title:\"Understanding how to build Bitnami Mindeb image and Google Distroless image\",date:\"2025-08-24\",tags:[\"bazel\",\"security\"],images:[\"/static/images/thumbnail/distroless.png\"],summary:\"Recently, Bitnami announced that secure container images would only be available under a paid plan, and that they would stop maintaining most of their previous images, except for a few open-source projects. Bitnami container images are based on the minideb image, which includes fewer packages than a standard Debian image. I started wondering whether I could replace this with a Distroless image built using Bazel and maintain it myself.This blog explains how minideb and Distroless images are built.\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(i,{})})):i();function i(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",pre:\"pre\",code:\"code\",h3:\"h3\",ul:\"ul\",li:\"li\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"I use Distroless images as the base for my applications. Distroless images not only reduce the overall container size but also minimize the surface area for security vulnerabilities. Last year, I briefly explored how Bazel works in order to add a package to a Distroless image, since some applications required additional Debian packages.\"}),(0,e.jsx)(n.p,{children:\"Recently, Bitnami announced that secure container images will only be available under a paid plan, and that they would stop maintaining most of their previous images except for a few open-source projects. That made me wonder: Would it be possible to replace all Bitnami container images with Distroless as the base? That\\u2019s where this journey began.\"}),(0,e.jsx)(n.p,{children:\"To meet security requirements in the past, I often had to modify Dockerfiles from open-source projects and rebuild the images myself. I also needed to review all containers to ensure they passed security compliance checks and report on them regularly. It was a tedious and repetitive job. With Distroless images, however, much of that effort can be avoided. Since Distroless does not even include a shell by default, direct container access is restricted\\u2014and in many cases, that alone allows you to bypass a number of security compliance checks.\"}),(0,e.jsxs)(n.h2,{id:\"understanding-bitnami-mindeb-image\",children:[(0,e.jsx)(n.a,{href:\"#understanding-bitnami-mindeb-image\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding Bitnami Mindeb Image\"]}),(0,e.jsxs)(n.p,{children:[\"Bitnami Images use \",(0,e.jsx)(n.a,{href:\"https://github.com/bitnami/minideb\",children:\"minideb image\"}),\" as their base image. Let\\u2019s take a closer look at how a minideb base image can be built.\"]}),(0,e.jsx)(n.p,{children:\"Before that, it\\u2019s important to understand what the debootstrap package does. The debootstrap package allows you to create minimal Debian base systems. For example, you can quickly build a Debian-based container image using Docker and debootstrap on Ubuntu:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`apt install debootstrap\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`DEBOOTSTRAP_DIR=$(mktemp -d)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`sudo debootstrap --variant=minbase --arch=amd64 trixie $DEBOOTSTRAP_DIR\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`sudo tar -C $DEBOOTSTRAP_DIR -cf - . | docker import - debian:stable\n`})]})}),(0,e.jsx)(n.p,{children:\"Now you\\u2019ve generated a Debian container image. You can check the Debian version inside the container:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ docker run -it debian:stable cat /etc/debian_version\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`13.0\n`})]})}),(0,e.jsxs)(n.h3,{id:\"which-packages-get-installed-during-debootstrap\",children:[(0,e.jsx)(n.a,{href:\"#which-packages-get-installed-during-debootstrap\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Which packages get installed during debootstrap?\"]}),(0,e.jsx)(n.p,{children:\"The installation process is defined by predefined debootstrap scripts. For example, if you\\u2019re using the current stable release Trixie, you can find its script at:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /usr/share/debootstrap/scripts/trixie\n`]})})}),(0,e.jsx)(n.p,{children:\"In fact, the scripts for Bookworm, Bullseye, and Trixie all point to a shared script called debian-common:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`mirror_style release\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"download_style \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`finddebs_style from-indices\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`variants - buildd fakechroot minbase\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`keyring /usr/share/keyrings/debian-archive-keyring.gpg\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# include common settings\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -e \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'/scripts/debian-common\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'/scripts/debian-common\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -e /debootstrap/debian-common \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),` /debootstrap/debian-common\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"elif\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\" -e \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'/debian-common\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'/debian-common\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" error \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" NOCOMMON \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"File not found: debian-common\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Inside \",(0,e.jsx)(n.code,{children:\"debian-common\"}),\", you\\u2019ll find three main functions. In short, they download Debian packages and initialize the system configuration:\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /usr/share/debootstrap/scripts/debian-common\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function function-name\",children:\"work_out_debs\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function function-name\",children:\"first_stage_install\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function function-name\",children:\"second_stage_install\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"the-work_out_debs-function\",children:[(0,e.jsx)(n.a,{href:\"#the-work_out_debs-function\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The work_out_debs function\"]}),(0,e.jsx)(n.p,{children:\"The key part is the work_out_debs function, which determines which packages get installed. By default, it selects all Debian packages with the required priority:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"required\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"get_debs Priority: required\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),'\"']}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"For example, you can check the priority of the bash package:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt-cache\"}),\" show \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bash\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Package: \",(0,e.jsx)(n.span,{className:\"token function\",children:\"bash\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Architecture: amd64\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Version: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5.2\"}),`.21-2ubuntu4\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Multi-Arch: foreign\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Priority: required\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Essential: \",(0,e.jsx)(n.span,{className:\"token function\",children:\"yes\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Section: shells\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Origin: Ubuntu\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Maintainer: Ubuntu Developers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"ubuntu-devel-discuss@lists.ubuntu.com\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Original-Maintainer: Matthias Klose \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"doko@debian.org\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Bugs: https://bugs.launchpad.net/ubuntu/+filebug\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Installed-Size: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1900\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Pre-Depends: libc6 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2.38\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\", libtinfo6 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Depends: base-files \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2.1\"}),\".12\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\", debianutils \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5.6\"}),\"-0.1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Recommends: bash-completion\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Suggests: bash-doc\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Filename: pool/main/b/bash/bash_5.2.21-2ubuntu4_amd64.deb\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Size: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"794086\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`MD5sum: 627cdbb775b1a60dadd502e96e0426b1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SHA1: 8065b79389fc555b38cf71e297a259773b09c38e\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SHA256: 73de311a21e094e29ac01527d2b52226cc87fde0a5b57032902251b426d92c66\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`SHA512: c14c2c8fa0d1ae7530efa0375845257b4ec0baa5bc42982efca2d7fa860b4e4ea3f04d31cfa328d2f250b2baeac3795c8b31aa5ff2d514ed16a5cf8c3132a590\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Homepage: http://tiswww.case.edu/php/chet/bash/bashtop.html\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Description-en: GNU Bourne Again SHell\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" Bash is an sh-compatible \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"command\"}),` language interpreter that executes\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" commands \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"read\"}),` from the standard input or from a file.  Bash also\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" incorporates useful features from the Korn and C shells \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ksh and csh\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:` Bash is ultimately intended to be a conformant implementation of the\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" IEEE POSIX Shell and Tools specification \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"IEEE Working Group \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1003.2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\".\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" The Programmable Completion Code, by Ian Macdonald, is now found \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:` the bash-completion package.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Description-md5: 3522aa7b4374048d6450e348a5bb45d9\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Task: minimal\n`})]})}),(0,e.jsx)(n.p,{children:\"Since bash is marked as required, you can expect it to be installed during debootstrap initialization.\"}),(0,e.jsxs)(n.h3,{id:\"bitnamis-customization\",children:[(0,e.jsx)(n.a,{href:\"#bitnamis-customization\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Bitnami\\u2019s customization\"]}),(0,e.jsxs)(n.p,{children:[\"Bitnami overrides the default debootstrap script to better suit container image generation. \",(0,e.jsx)(n.a,{href:\"https://github.com/bitnami/minideb/blob/master/debootstrap/bullseye\",children:\"Here\\u2019s their version for Bullseye.\"})]}),(0,e.jsx)(n.p,{children:\"In their script, the required variable explicitly lists which Debian packages should be included:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"debootstrap/bullseye\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`mirror_style release\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"download_style \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`finddebs_style from-indices\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`variants - container fakechroot\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`keyring /usr/share/keyrings/debian-archive-keyring.gpg\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function function-name\",children:\"work_out_debs\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"required\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"adduser base-files base-passwd bash bsdutils coreutils dash debian-archive-keyring diffutils dpkg findutils grep gzip hostname init-system-helpers libc-bin login lsb-base mawk ncurses-base passwd sed sysv-rc tar tzdata util-linux mount\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"This is why their build script copies these custom files into the DEBOOTSTRAP_DIR and sets the --variant=container flag when running debootstrap:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"mkimage\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"DEBOOTSTRAP_DIR\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"mktemp -d\",(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cp\"}),\" -a /usr/share/debootstrap/* \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cp\"}),\" -a /usr/share/keyrings/debian-archive-keyring.gpg \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cp\"}),\" -a \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${ROOT}\"}),'/debootstrap/\"']}),\"* \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${DEBOOTSTRAP_DIR}\"}),'/scripts\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"DEBOOTSTRAP_DIR\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$DEBOOTSTRAP_DIR\"}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"debootstrap\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token variable\",children:[\"${debootstrap_arch_args\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"@\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"}\"]}),'\"']}),\"  --keyring \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KEYRING\"}),'\"']}),\" --variant container --foreign \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${DIST}\"}),'\"']}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$rootfsDir\"}),'\"']}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"understanding-distroless-image\",children:[(0,e.jsx)(n.a,{href:\"#understanding-distroless-image\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Understanding Distroless Image\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.a,{href:\"https://github.com/jayground8/example-bazel\",children:\"Example Source Code\"})}),(0,e.jsx)(n.p,{children:\"This time, let\\u2019s take a closer look at how a Distroless image can be built with Bazel. I\\u2019ll be using Bazelisk to run Bazel.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`sudo curl -o /usr/bin/bazelisk -L https://github.com/bazelbuild/bazelisk/releases/download/v1.27.0/bazelisk-linux-amd64\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`sudo chmod a+x /usr/bin/bazelisk\n`})]})}),(0,e.jsx)(n.p,{children:\"You can specify the version of Bazel you want to use in the .bazelversion file. Bazelisk automatically sets up the specified version and runs Bazel commands. I set it to the latest version at the time of writing:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\".bazelversion\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-sh\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`8.3.1\n`})})}),(0,e.jsxs)(n.h3,{id:\"setting-up-the-bazel-workspace\",children:[(0,e.jsx)(n.a,{href:\"#setting-up-the-bazel-workspace\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Setting up the Bazel workspace\"]}),(0,e.jsx)(n.p,{children:\"Bazel requires a specific workspace structure. First, you need to add a MODULE.bazel file at the root of your project. In this file, you can declare external dependencies using predefined methods. In the examples below, we\\u2019ll use three methods:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"bazel_dep\"}),(0,e.jsx)(n.li,{children:\"use_extension\"}),(0,e.jsx)(n.li,{children:\"use_repo\"})]}),(0,e.jsxs)(n.p,{children:[\"Here\\u2019s an example \",(0,e.jsx)(n.code,{children:\"MODULE.bazel\"}),\" file:\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"MODULE.bazel\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`bazel_dep(name = \"aspect_bazel_lib\", version = \"2.21.1\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`bazel_dep(name = \"rules_oci\", version = \"2.2.6\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`bazel_dep(name = \"rules_distroless\", version = \"0.5.3\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`apt = use_extension(\"@rules_distroless//apt:extensions.bzl\", \"apt\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`REPO = \"trixie\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`apt.install(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    name = REPO,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    lock = \"//:{}.lock.json\".format(REPO),\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    manifest = \"//:{}.yaml\".format(REPO),\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    resolve_transitive = False,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    mergedusr = True,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`)\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`use_repo(apt, REPO)\n`})]})}),(0,e.jsxs)(n.h3,{id:\"external-bazel-modules\",children:[(0,e.jsx)(n.a,{href:\"#external-bazel-modules\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"External Bazel modules\"]}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.a,{href:\"https://registry.bazel.build/\",children:\"Bazel Centry Registry\"}),\" hosts external Bazel modules. You can use \",(0,e.jsx)(n.code,{children:\"bazel_dep\"}),\" to declare which version of each external module you want to use. In this example, we\\u2019re using three modules:\"]}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`bazel_dep(name = \"aspect_bazel_lib\", version = \"2.21.1\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`bazel_dep(name = \"rules_oci\", version = \"2.2.6\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`bazel_dep(name = \"rules_distroless\", version = \"0.5.3\")\n`})]})}),(0,e.jsxs)(n.h3,{id:\"configuring-debian-repositories\",children:[(0,e.jsx)(n.a,{href:\"#configuring-debian-repositories\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Configuring Debian repositories\"]}),(0,e.jsx)(n.p,{children:\"Next, let\\u2019s configure the Debian repositories and packages to be installed in the Distroless image. We\\u2019ll use two methods:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"use_extension\"}),(0,e.jsx)(n.li,{children:\"use_repo.\"})]}),(0,e.jsx)(n.p,{children:\"Here, we configure only the current Debian stable release:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" use_extension\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"@rules_distroless//apt:extensions.bzl\"'}),\", \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"apt\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"REPO \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"trixie\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"apt.install\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` REPO,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    lock \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"//:{}.lock.json\"'}),\".format\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"REPO\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    manifest \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"//:{}.yaml\"'}),\".format\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"REPO\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    resolve_transitive \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` False,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    mergedusr \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` True,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"use_repo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"apt, REPO\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"trixie.lock.json\"}),\" file specifies the exact package versions you want installed. For example, the latest version of ca-certificates in Debian Trixie is \",(0,e.jsx)(n.a,{href:\"https://packages.debian.org/trixie/ca-certificates\",children:\"20250419 at the time of writing\"}),\". If you need to patch vulnerabilities (CVEs), you\\u2019ll need to update this lock file.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"trixie.lock.json\"})}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"packages\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"arch\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"arm64\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"dependencies\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"key\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ca-certificates_20250419_arm64\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ca-certificates\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sha256\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ef590f89563aa4b46c8260d49d1cea0fc1b181d19e8df3782694706adf05c184\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"url\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"https://snapshot.debian.org/archive/debian/20250812T210203Z/pool/main/c/ca-certificates/ca-certificates_20250419_all.deb\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"version\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"20250419\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"I copied both \",(0,e.jsx)(n.code,{children:\"trixie.lock.json\"}),\" and \",(0,e.jsx)(n.code,{children:\"trixie.yaml\"}),\" \",(0,e.jsx)(n.a,{href:\"https://github.com/GoogleContainerTools/distroless/blob/0125c4d9736d0a4b037ba32d5107e9fac773d7ca/private/repos/deb/trixie.lock.json\",children:\"from the Distroless GitHub repo\"}),\". The \",(0,e.jsx)(n.code,{children:\"trixie.yaml\"}),\" file must follow the format described in \",(0,e.jsx)(n.a,{href:\"https://github.com/bazel-contrib/rules_distroless/blob/cd8abc5d1c25d4cb87e3f48390514a946aa715eb/docs/apt.md\",children:\"the rules_distroless documentation\"}),\".\"]}),(0,e.jsxs)(n.h3,{id:\"defining-the-base-image\",children:[(0,e.jsx)(n.a,{href:\"#defining-the-base-image\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Defining the base image\"]}),(0,e.jsx)(n.p,{children:\"Now, let\\u2019s write a base.bzl file to define the base image using our external modules.\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"aspect_bazel_lib\"}),\" is used to create tar files.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"rules_distroless\"}),\" is used to define the Debian filesystem.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"rules_oci\"}),\" is used to build the final OCI container images.\"]})]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"bazel.bzl\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`load(\"@aspect_bazel_lib//lib:tar.bzl\", \"tar\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`load(\"@rules_distroless//distroless:defs.bzl\", \"cacerts\", \"group\", \"home\", \"locale\", \"os_release\", \"passwd\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`load(\"@rules_oci//oci:defs.bzl\", \"oci_image\", \"oci_image_index\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`load(\":variables.bzl\", \"MTIME\", \"NOBODY\", \"NONROOT\", \"ROOT\", \"USER_VARIANTS\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`def base_image():\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    tar(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"rootfs\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        srcs = [],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        args = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"--format\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"gnutar\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        compress = \"gzip\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        mtree = [\"./ type=dir uid=0 gid=0 time=0.0\"],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    tar(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"tmp\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        srcs = [],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        # original tmp.tar was created on a gnutar, mimic that.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        args = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"--format\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"gnutar\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        compress = \"gzip\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        mtree = [\"./tmp gname=root uname=root time=1501783453.0 mode=1777 gid=0 uid=0 type=dir\"],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    os_release(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"os_release_debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        content = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"PRETTY_NAME\": \"Distroless\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"NAME\": \"Debian GNU/Linux\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"ID\": \"debian\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"VERSION_ID\": \"13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            \"VERSION\": \"Debian GNU/Linux 13 (trixie)\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        time = MTIME,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    locale(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"locale_debian13_arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        charset = \"C.utf8\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        package = \"@trixie//libc-bin/arm64:data\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        time = MTIME,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    cacerts(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"cacerts_debian13_arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        package = \"@trixie//ca-certificates/arm64:data\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        time = MTIME,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    group(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"group\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        entries = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"name\": \"root\",  # root_group\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"name\": \"nobody\",  # nobody_group\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": NOBODY,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"name\": \"tty\",  # tty_group\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": 5,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"name\": \"staff\",  # staff_group\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": 50,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"name\": \"nonroot\",  # nonroot_group\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": NONROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        time = MTIME,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    passwd(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"passwd\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        entries = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gecos\": [\"root\"],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"shell\": \"/sbin/nologin\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"home\": \"/root\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"uid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"username\": \"root\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gecos\": [\"nobody\"],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": NOBODY,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"home\": \"/nonexistent\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"shell\": \"/sbin/nologin\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"uid\": NOBODY,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"username\": \"nobody\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gecos\": [\"nonroot\"],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": NONROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"home\": \"/home/nonroot\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"shell\": \"/sbin/nologin\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"uid\": NONROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"password\": \"x\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"username\": \"nonroot\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    home(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        name = \"home\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        dirs = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"home\": \"/root\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"uid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"mode\": 700,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"home\": \"/home\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"uid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": ROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"mode\": 755,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"home\": \"/home/nonroot\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"uid\": NONROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"gid\": NONROOT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"mode\": 700,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    for (user, _, _) in USER_VARIANTS:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        oci_image_index(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            name = \"static_\" + user + \"_\" + \"debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            images = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"static_\" + user + \"_\" + \"arm64\" + \"_\" + \"debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        )\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    for (user, uid, workdir) in USER_VARIANTS:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        oci_image(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            name = \"static_\" + user + \"_\" + \"arm64\" + \"_\" + \"debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            env = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"PATH\": \"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                # allows openssl to find the certificates by default\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                # TODO: We should run update-ca-certifaces, but that requires \"openssl rehash\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                # which would probably need to be run inside the container\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"SSL_CERT_FILE\": \"/etc/ssl/certs/ca-certificates.crt\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            tars = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"@trixie//base-files/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"@trixie//netbase/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"@trixie//tzdata/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"@trixie//media-types/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:rootfs\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:passwd\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:home\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:group\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                # Create /tmp, too many things assume it exists.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                # tmp.tar has a /tmp with the correct permissions 01777\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:tmp\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \":nsswitch.tar\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:os_release_\" + \"debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \"//:cacerts_\" + \"debian13\" + \"_\" + \"arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            user = \"%d\" % uid,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            workdir = workdir,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            os = \"linux\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`            architecture = \"arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        )\n`})]})}),(0,e.jsxs)(n.h3,{id:\"variables-file\",children:[(0,e.jsx)(n.a,{href:\"#variables-file\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Variables file\"]}),(0,e.jsxs)(n.p,{children:[\"You can keep constants and variables in a separate \",(0,e.jsx)(n.code,{children:\"{name}.bzl\"}),\" file and load them into your Bazel rules:\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"base.bzl\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-sh\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`load(\":variables.bzl\", \"MTIME\", \"NOBODY\", \"NONROOT\", \"ROOT\", \"USER_VARIANTS\")\n`})})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"variables.bzl\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`NOBODY = 65534\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`NONROOT = 65532\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ROOT = 0\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`MTIME = \"946684800\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`USER_VARIANTS = [(\"root\", 0, \"/\"), (\"nonroot\", NONROOT, \"/home/nonroot\")]\n`})]})}),(0,e.jsxs)(n.h3,{id:\"adding-packages-to-the-image\",children:[(0,e.jsx)(n.a,{href:\"#adding-packages-to-the-image\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Adding packages to the image\"]}),(0,e.jsxs)(n.p,{children:[\"Since we already declared the Debian repositories in \",(0,e.jsx)(n.code,{children:\"MODULE.bazel\"}),\" with \",(0,e.jsx)(n.code,{children:\"rules_distroless\"}),\", you can add packages by referencing them like \",(0,e.jsx)(n.code,{children:\"@trixie//base-files/arm64\"}),\".\"]}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`oci_image(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    name = \"static_\" + user + \"_\" + \"arm64\" + \"_\" + \"debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    env = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"PATH\": \"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        # allows openssl to find the certificates by default\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        # TODO: We should run update-ca-certifaces, but that requires \"openssl rehash\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        # which would probably need to be run inside the container\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"SSL_CERT_FILE\": \"/etc/ssl/certs/ca-certificates.crt\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    },\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    tars = [\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"@trixie//base-files/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"@trixie//netbase/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"@trixie//tzdata/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"@trixie//media-types/arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:rootfs\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:passwd\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:home\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:group\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        # Create /tmp, too many things assume it exists.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        # tmp.tar has a /tmp with the correct permissions 01777\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:tmp\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \":nsswitch.tar\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:os_release_\" + \"debian13\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        \"//:cacerts_\" + \"debian13\" + \"_\" + \"arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    ],\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    user = \"%d\" % uid,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    workdir = workdir,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    os = \"linux\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    architecture = \"arm64\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`)\n`})]})}),(0,e.jsx)(n.p,{children:\"Interestingly, Bazel files allow for loops. This is useful, for example, when you want to build multiple images for different users or architectures:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`def base_image():\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    ...\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    for (user, uid, workdir) in USER_VARIANTS:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        ...\n`})]})}),(0,e.jsxs)(n.h3,{id:\"build-file\",children:[(0,e.jsx)(n.a,{href:\"#build-file\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"BUILD file\"]}),(0,e.jsx)(n.p,{children:\"Finally, you need a BUILD file to wire everything together. Here, we import the function from base.bzl and call it:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"BUILD\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`load(\":base.bzl\", \"base_image\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`base_image()\n`})]})}),(0,e.jsxs)(n.h3,{id:\"building-the-image\",children:[(0,e.jsx)(n.a,{href:\"#building-the-image\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Building the image\"]}),(0,e.jsx)(n.p,{children:\"Now we\\u2019re ready to build the Distroless image with Bazel:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-sh\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`bazelisk build //...\n`})})}),(0,e.jsx)(n.p,{children:\"If the build succeeds, you\\u2019ll find two OCI images created:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ ls bazel-bin/static_nonroot_arm64_debian13\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`blobs      index.json oci-layout\n`})]})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-sh\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ ls bazel-bin/static_root_arm64_debian13\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`blobs      index.json oci-layout\n`})]})}),(0,e.jsx)(n.p,{children:\"You can load an OCI image into the Docker daemon using Skopeo:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-sh\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`brew install skopeo\n`})})}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight language-sh\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`skopeo copy oci:./bazel-bin/static_nonroot_arm64_debian13 docker-daemon:my-distroless-image:stable\n`})})}),(0,e.jsxs)(n.h2,{id:\"conclusion\",children:[(0,e.jsx)(n.a,{href:\"#conclusion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),(0,e.jsx)(n.p,{children:\"The Bitnami Minideb image is used as the base image in the Bitnami project. I learned that it is built using custom scripts on top of the debootstrap package. By reviewing these scripts, you can see which Debian packages are included.\"}),(0,e.jsx)(n.p,{children:\"Google\\u2019s Distroless image goes even further by including an even smaller set of Debian packages. I took a closer look at how Distroless images can be generated with Bazel. Based on this understanding, I will try replacing the Minideb image with a Distroless image.\"})]})}}var _=f;return y;})();\n;return Component;","toc":[{"value":"Understanding Bitnami Mindeb Image","url":"#understanding-bitnami-mindeb-image","depth":2},{"value":"Which packages get installed during debootstrap?","url":"#which-packages-get-installed-during-debootstrap","depth":3},{"value":"The work_out_debs function","url":"#the-work_out_debs-function","depth":3},{"value":"Bitnami’s customization","url":"#bitnamis-customization","depth":3},{"value":"Understanding Distroless Image","url":"#understanding-distroless-image","depth":2},{"value":"Setting up the Bazel workspace","url":"#setting-up-the-bazel-workspace","depth":3},{"value":"External Bazel modules","url":"#external-bazel-modules","depth":3},{"value":"Configuring Debian repositories","url":"#configuring-debian-repositories","depth":3},{"value":"Defining the base image","url":"#defining-the-base-image","depth":3},{"value":"Variables file","url":"#variables-file","depth":3},{"value":"Adding packages to the image","url":"#adding-packages-to-the-image","depth":3},{"value":"BUILD file","url":"#build-file","depth":3},{"value":"Building the image","url":"#building-the-image","depth":3},{"value":"Conclusion","url":"#conclusion","depth":2}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.84,"time":770400,"words":2568},"slug":"20250824-bazel","fileName":"20250824-bazel.md","title":"Understanding how to build Bitnami Mindeb image and Google Distroless image","date":"2025-08-24T00:00:00.000Z","tags":["bazel","security"],"images":["/static/images/thumbnail/distroless.png"],"summary":"Recently, Bitnami announced that secure container images would only be available under a paid plan, and that they would stop maintaining most of their previous images, except for a few open-source projects. Bitnami container images are based on the minideb image, which includes fewer packages than a standard Debian image. I started wondering whether I could replace this with a Distroless image built using Bazel and maintain it myself.This blog explains how minideb and Distroless images are built."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Automating Semantic Versioning and Releases in Node.js with Conventional Commits","date":"2025-08-10T00:00:00.000Z","tags":["nodejs","dev"],"images":["/static/images/thumbnail/conventional-commits.png"],"summary":"I introduced several open-source tools that help ensure everyone follows the same commit message conventions and make it easy to manage versions and release notes based on those consistent messages.","slug":"20250810-conventional-commits"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20250824-bazel"]},"buildId":"byMjVt7p1j1f5Lba1yluX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>