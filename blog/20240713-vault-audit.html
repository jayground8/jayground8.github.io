<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="manifest" href="/jayground8/static/favicons/manifest.json"/><link rel="manifest" href="/jayground8/static/favicons/site.webmanifest"/><link rel="shortcut icon" href="/jayground8/static/favicons/favicon.ico"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8773084925406986" crossorigin="anonymous"></script><title>Vault Audit Log를 남기기</title><meta name="robots" content="follow, index"/><meta name="description" content="Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다."/><meta property="og:url" content="https://jayground8.github.io/blog/20240713-vault-audit"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Jayground8"/><meta property="og:description" content="Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다."/><meta property="og:title" content="Vault Audit Log를 남기기"/><meta property="og:image" content="https://jayground8.github.io/static/images/social-banner.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Vault Audit Log를 남기기"/><meta name="twitter:description" content="Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다."/><meta name="twitter:image" content="https://jayground8.github.io/static/images/social-banner.png"/><link rel="canonical" href="https://jayground8.github.io/blog/20240713-vault-audit"/><meta property="article:published_time" content="2024-07-13T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jayground8.github.io/blog/20240713-vault-audit"
  },
  "headline": "Vault Audit Log를 남기기",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://jayground8.github.io/static/images/social-banner.png"
    }
  ],
  "datePublished": "2024-07-13T00:00:00.000Z",
  "dateModified": "2024-07-13T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Jay"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Jay",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jayground8.github.ioplayground.png"
    }
  },
  "description": "Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다."
}</script><meta name="next-head-count" content="24"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/414f98a58444a4f1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/414f98a58444a4f1.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-690364db8bfb1f01.js" defer=""></script><script src="/_next/static/chunks/main-eea1c213342d95c3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e9fc7f3433b9eec.js" defer=""></script><script src="/_next/static/chunks/675-70b09cbf0a5309ea.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/712-376d32740a4ac813.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-8ab66ff6ebabec4c.js" defer=""></script><script src="/_next/static/W4OJIiHqN_WQQ9TfZMwI5/_buildManifest.js" defer=""></script><script src="/_next/static/W4OJIiHqN_WQQ9TfZMwI5/_ssgManifest.js" defer=""></script><script src="/_next/static/W4OJIiHqN_WQQ9TfZMwI5/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Jayground8" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="53.87" height="43.61" viewBox="0 0 512 512" class="fill-black dark:fill-white"><path d="M368.4 17c-8.8 1.3-18.3 5-25.3 9.9-3.8 2.5-22.6 16.1-41.9 30.1-37.1 26.9-38.6 28.3-36.3 33.9 1.7 4 4.9 5.1 14.6 5.1h8.5v128h-17.9c-18.2 0-22.2.6-27.3 4.2l-2.8 1.9V116.9l2.5-2.4c1.5-1.6 3.6-2.5 5.5-2.5s4 .9 5.5 2.5l2.5 2.4v42c0 29.1.3 42.8 1.1 44.5 2.6 5.7 11.5 5.5 13.9-.3.7-1.9 1-15.6.8-46.2-.3-40.1-.4-43.7-2.2-46.9-4.8-9-11.9-13.4-21.6-13.4-13.8 0-22.8 9.1-23.8 24.1l-.5 7.3h-31.5l-1.2-2.9c-1.6-3.9-6-5.8-9.9-4.1-1.6.6-3.5 2.5-4.1 4.1l-1.2 2.9h-63.6l-1.2-2.9c-2.5-6.2-11.5-6.2-14 0l-1.2 2.9H64.3l-.5-7.3c-1-15-10-24.1-23.8-24.1-9.7 0-16.8 4.4-21.6 13.4-1.8 3.3-1.9 7.5-2.2 75-.2 50 .1 72.3.8 74.1 2.1 5.1 8.6 6.3 12.5 2.4l2.5-2.4V116.9l2.5-2.4c3.2-3.3 7.8-3.3 11 0l2.5 2.4V448H32V284.9l-2.5-2.4c-3.8-3.9-10.2-2.7-12.4 2.2-1.6 3.4-1.6 171.2 0 174.6.6 1.4 2.2 3 3.6 3.6 1.6.7 15.6 1.1 43.7 1.1 38 0 41.5-.1 43.4-1.8 1.2-.9 33.4-50.5 71.7-110.2 38.3-59.7 70.5-109.3 71.7-110.3 1.8-1.5 4.3-1.7 19.4-1.7H288v16h-12.5c-13.1 0-16.6.8-18.3 4.4-2 4.5-138.5 216.2-140.4 217.9-1.9 1.6-5.6 1.7-47.9 1.7-31.9 0-46.6.3-48.3 1.1-5.7 2.6-5.5 11.5.3 13.9 1.9.7 16.7 1 50.1.8 46.4-.3 47.6-.3 51.5-2.5 2.2-1.1 5.1-3.3 6.5-4.7 1.3-1.5 10.1-14.7 19.6-29.4l17.1-26.7 18.4-.5c10.1-.3 19.1-.9 20-1.3.9-.5 2.1-1.9 2.8-3.3 1.5-3.4 1.5-35.4 0-38.8-1.1-2.3-4-4-8-4.8-1.3-.2 1.5-5.2 11.5-20.7l13.1-20.5.5 56.5c.3 31 .9 57.1 1.3 58 1.5 3 5.6 3.9 18.2 3.9H256v14c0 14.9.7 18.1 4.7 19.9 1.7.8 34.7 1.1 115.3 1.1s113.6-.3 115.3-1.1c1.4-.6 3-2.2 3.6-3.6 1.5-3.4 1.5-83.2 0-86.6-2.2-4.9-8.6-6.1-12.4-2.2l-2.5 2.4V480H272V272h208v107.1l2.5 2.4c3.8 3.9 10.2 2.7 12.4-2.2 1.5-3.4 1.5-115.2 0-118.6-1.8-3.9-5-4.7-18.4-4.7H464v-40.5c0-27.9-.3-41.2-1.1-42.9-2.6-5.5-11.2-5.5-13.8 0-.8 1.7-1.1 15-1.1 42.9V256h-24v-34.5c0-21.3-.4-36.4-1.1-39.7-3.6-17.3-19.3-32.9-36.7-36.7-16.2-3.4-31.4 1.1-43.3 12.9-7.4 7.3-11.2 13.9-13.4 23.2-1.8 7.9-2.1 50.3-.4 54.2 1.6 3.5 6.1 5.2 9.8 3.7 4.7-2 5.1-4.2 5.1-29.6 0-21.5.2-23.9 2.2-29.2C350.6 168.4 363 160 376 160s25.4 8.4 29.8 20.3c2.1 5.5 2.2 7.4 2.2 40.7v35H304V96h144v24.5c0 16 .4 25.3 1.1 26.9 2.6 5.5 11.2 5.5 13.8 0 .7-1.6 1.1-10.9 1.1-26.9V96h8.5c9.7 0 12.9-1.1 14.6-5.1 2.1-5.2.1-7.5-17.7-20.4C446.2 53.8 445 53 442.1 53c-4.1.1-7.5 3.5-7.5 7.7 0 4 2.2 6.3 14.8 15.3l4.8 3.5-39.1.3c-21.5.1-56.7.1-78.2 0l-39.1-.3 14.9-10.7c8.2-5.9 20.7-15.1 27.8-20.4 14.5-10.8 20.5-14 29.4-15.5 11.6-2.1 22.4 1.3 36.5 11.4 4.3 3.1 9 5.7 10.3 5.7 3.9 0 7.5-4.4 7.1-8.7-.3-3.3-1.1-4.4-7.8-9.6-15.3-11.8-32.3-17.1-47.6-14.7zM96 152v8H64v-16h32v8zm80 0v8h-64v-16h64v8zm48 0v8h-32v-16h32v8zM96 280v104h-4.5c-5.5 0-9 1.5-10.4 4.7-1.5 3.3-1.5 35.4 0 38.7 1.7 3.6 3.1 4 16.2 4.6l11.9.5-5.1 7.7L99 448H64V176h32v104zm80-27.8v76.3l-17.8 27.7-17.7 27.7-14.2.1H112V176h64v76.2zm48-37.3v38.9l-15.6 24.4c-8.6 13.3-15.8 24.5-16 24.7-.2.2-.4-28.2-.4-63.2V176h32v38.9zM256 369v76h-16V317.1l7.8-12c4.2-6.7 7.8-12.1 8-12.1.1 0 .2 34.2.2 76zm-129.1 34.7c-1.2 2.1-3.6 5.7-5.1 8l-2.9 4.3H96v-16h33.2l-2.3 3.7zM192 408v8h-15.1l3.7-5.8c2-3.1 4.4-6.7 5.2-8 .8-1.2 2.4-2.2 3.8-2.2 2.3 0 2.4.2 2.4 8z"></path><path d="M322.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM418.5 114.5c-1.6 1.5-2.5 3.6-2.5 5.5s.9 4 2.5 5.5c1.5 1.6 3.6 2.5 5.5 2.5s4-.9 5.5-2.5c1.6-1.5 2.5-3.6 2.5-5.5s-.9-4-2.5-5.5c-1.5-1.6-3.6-2.5-5.5-2.5s-4 .9-5.5 2.5zM290.2 290.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.5 290.5c-5 4.9-1.5 13.5 5.5 13.5 4.1 0 8-3.9 8-8s-3.9-8-8-8c-1.9 0-4 .9-5.5 2.5zM358.1 322c-8.3 2.2-16.5 5.7-19.8 8.6-3.3 2.8-3.9 7.3-1.4 10.6 3.3 4.1 6.4 4.3 13.8.8 23.3-10.9 47.3-7 64.8 10.5 11.5 11.4 16.5 23.6 16.5 39.7 0 15.9-5.1 28.1-16.4 39.4C404.2 443 392.1 448 376 448s-28.1-5-39.5-16.5c-11-11.1-16.5-24.2-16.5-39.5.1-9.5 1.2-14.5 5.6-24.3 3.8-8.3 3.8-10.4.1-14.5-4.7-5.1-10.8-1.7-15.4 8.6-8.6 19.5-8.4 42.7.6 61.7 9.1 19.3 28.3 34.5 49.5 39 11.9 2.6 28.4 1.7 39.3-2.2 23.9-8.6 41.3-27.9 46.9-51.9 1.9-8.5 1.9-24.4-.1-33.1-5.9-25.5-26.7-46.6-52.5-53.3-10.1-2.6-25.8-2.6-35.9 0zM290.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6zM450.2 450.3c-5 5.3-1.3 13.7 5.9 13.7 4.7 0 7.9-3.4 7.9-8.1 0-7.1-9-10.7-13.8-5.6z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Jayground8</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-07-13T00:00:00.000Z">Saturday, July 13, 2024</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Vault Audit Log를 남기기</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" srcSet="https://jayground8.github.io/static/images/profile.png?w=48&amp;q=75 1x, https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75 2x" src="https://jayground8.github.io/static/images/profile.png?w=96&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Jay</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>이번에는 Kubernetes에서 Vault를 운영할 때 Audit log를 남기는 방법을 알아본다. Vault에서 Audit 기능을 제공하여 API 요청과 응답을 Log로 남길 수 있다. <a target="_blank" rel="noopener noreferrer" href="https://developer.hashicorp.com/vault/docs/audit">Vault 공식 문서</a>에서 친절하게 설명하고 있다.</p><h2 id="file-audit-device-사용"><a href="#file-audit-device-사용" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>File audit device 사용</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/hashicorp/vault-helm/blob/main/values.yaml">Vault를 Helm Chart</a>로 설치할 때, <code>auditStorage</code>의 <code>enabled</code>를 true로 설정하면 PVC가 생성된다. 그리고 mount path는 <code>/vault/audit</code>이 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">auditStorage</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span><span class="code-line">	<span class="token comment"># Size of the PVC created</span>
</span><span class="code-line">	<span class="token atrule key">size</span><span class="token punctuation">:</span> 10Gi
</span><span class="code-line">	<span class="token comment"># Location where the PVC will be mounted.</span>
</span><span class="code-line">	<span class="token atrule key">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/vault/audit&quot;</span>
</span><span class="code-line">	<span class="token comment"># Name of the storage class to use.  If null it will use the</span>
</span><span class="code-line">	<span class="token comment"># configured default Storage Class.</span>
</span><span class="code-line">	<span class="token atrule key">storageClass</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">	<span class="token comment"># Access Mode of the storage device being used for the PVC</span>
</span><span class="code-line">	<span class="token atrule key">accessMode</span><span class="token punctuation">:</span> ReadWriteOnce
</span><span class="code-line">	<span class="token comment"># Annotations to apply to the PVC</span>
</span><span class="code-line">	<span class="token atrule key">annotations</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token comment"># Labels to apply to the PVC</span>
</span><span class="code-line">	<span class="token atrule key">labels</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><p>vault에서 audit 기능을 사용하도록 CLI로 설정할 때 <code>file_path</code>를 설정하게 된다. 위에서 mount된 volume의 path로 설정한다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">vault audit <span class="token builtin class-name">enable</span> -path<span class="token operator">=</span><span class="token string">&quot;vault_audit&quot;</span> <span class="token function">file</span> <span class="token assign-left variable">file_path</span><span class="token operator">=</span>/vault/audit/audit.log
</span></code></pre></div><p>audit list 명령어로 정상적으로 등록되면 아래처럼 audit device 목록을 볼 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ vault audit list
</span><span class="code-line">Path              Type    Description
</span><span class="code-line">----              ----    -----------
</span><span class="code-line">vault_audit/    <span class="token function">file</span>    n/a
</span></code></pre></div><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/hashicorp/vault-helm/blob/main/values.yaml">Vault를 Helm Chart</a>에서 기본적으로 <code>dataStorage</code>의 <code>enabled</code>가 true로 설정되어 있기 때문에, PVC가 생성되고 Volume이 <code>/vault/data</code> 경로에 마운팅 된다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">dataStorage</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">	<span class="token comment"># Size of the PVC created</span>
</span><span class="code-line">	<span class="token atrule key">size</span><span class="token punctuation">:</span> 10Gi
</span><span class="code-line">	<span class="token comment"># Location where the PVC will be mounted.</span>
</span><span class="code-line">	<span class="token atrule key">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/vault/data&quot;</span>
</span><span class="code-line">	<span class="token comment"># Name of the storage class to use.  If null it will use the</span>
</span><span class="code-line">	<span class="token comment"># configured default Storage Class.</span>
</span><span class="code-line">	<span class="token atrule key">storageClass</span><span class="token punctuation">:</span> <span class="token important null">null</span>
</span><span class="code-line">	<span class="token comment"># Access Mode of the storage device being used for the PVC</span>
</span><span class="code-line">	<span class="token atrule key">accessMode</span><span class="token punctuation">:</span> ReadWriteOnce
</span><span class="code-line">	<span class="token comment"># Annotations to apply to the PVC</span>
</span><span class="code-line">	<span class="token atrule key">annotations</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token comment"># Labels to apply to the PVC</span>
</span><span class="code-line">	<span class="token atrule key">labels</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><p>그리고 Vault의 High Availability 설정을 하고, storage를 <code>raft</code>로 설정하면 Vault Node들이 Raft를 통해서 data들이 복제된다. Raft을 통해서 data가 각 Vault Node들에 저장되는 경로를 위에서 마운팅 된 Volume 경로인 <code>/vault/data</code>로 설정한다.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">ha</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">	<span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
</span><span class="code-line">	<span class="token atrule key">raft</span><span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token atrule key">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">		<span class="token atrule key">setNodeId</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">
</span><span class="code-line">		<span class="token atrule key">config</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token string scalar">
</span></span><span class="code-line"><span class="token string scalar">			...생략
</span></span><span class="code-line"><span class="token string scalar">			storage &quot;raft&quot; {
</span></span><span class="code-line"><span class="token string scalar">				path = &quot;/vault/data&quot;
</span></span><span class="code-line"><span class="token string scalar">			}</span>
</span></code></pre></div><p>이렇게 <code>replica</code>가 <code>3</code>으로 설정되었기 때문에 아래의 명령어로 확인하면 세 개의 Node가 목록에 나오는 것을 확인할 수 있다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ vault operator raft list-peers
</span><span class="code-line">Node       Address                        State       Voter
</span><span class="code-line">----       -------                        -----       -----
</span><span class="code-line">vault-0    vault-0.vault-internal:8201    follower    <span class="token boolean">true</span>
</span><span class="code-line">vault-1    vault-1.vault-internal:8201    leader      <span class="token boolean">true</span>
</span><span class="code-line">vault-2    vault-2.vault-internal:8201    follower    <span class="token boolean">true</span>
</span></code></pre></div><p>Vault Leader Node가 요청을 처리하기 때문에, 위에서 leader 역할의 vault-1 Node에 audit log가 저장된다. vault-1 container에 접속하여 파일을 확인해본다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">kubectl <span class="token builtin class-name">exec</span> -it vault-1 -- /bin/sh
</span></code></pre></div><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">ls</span> /vault/audit/
</span><span class="code-line">audit.log
</span></code></pre></div><p>Vault에서 secret 정보들을 가져오면 <code>audit.log</code>에 아래와 같은 log가 남은 것을 확인할 수 있다. Log에 남는 비밀 정보의 경우에는 hmac으로 hash 처리되어 있다. (hash값은 <a target="_blank" rel="noopener noreferrer" href="https://developer.hashicorp.com/vault/api-docs/system/audit-hash">/sys/audit-hash</a> API를 사용해서 처리가 되고, audit device를 새로 생성하면 새로운 salt가 생성된다.) 그리고 vault 인증 방법을 userpass로 했기 때문에 어떤 username으로 접근을 했는지도 Log를 통해서 확인할 수 있다.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-12T23:53:50.294066904Z&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;response&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;client_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:936a185caaa266bb9cbe981e9e05cb78cd732b0b3280eb944412bb6f8f8f07af&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;accessor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:bb136af09813f2b2ac32f44a32379d5e66ec62022f4d9f557fdc606f8e35b996&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;display_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;userpass-myuser&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;policies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;token_policies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;policy_results&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;allowed&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;granting_policies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;namespace_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;acl&quot;</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myuser&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;entity_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a9fe7d93-2312-38cf-fw83-5e4a1a9c86c8&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;token_ttl&quot;</span><span class="token operator">:</span> <span class="token number">2764800</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;token_issue_time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-07-12T23:16:30Z&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cf25e9c9-5e9d-edf6-2b7k-61e9d48d5caa&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;client_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a9fe7d93-2312-38cf-fw83-5e4a1a9c86c8&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;operation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_point&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sample/&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kv&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_accessor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kv_0d071af0&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_running_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v0.16.1+builtin&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;secret&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;client_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:936a185caaa266bb9cbe981e9e05cb78cd732b0b3280eb944412bb6f8f8f07af&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;client_token_accessor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:bb136af09813f2b2ac32f44a32379d5e66ec62022f4d9f557fdc606f8e35b996&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;namespace&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sample/data/hello&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;remote_address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10.70.7.27&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;remote_port&quot;</span><span class="token operator">:</span> <span class="token number">40766</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;mount_point&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sample/&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kv&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_accessor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kv_0d071af0&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_running_plugin_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v0.16.1+builtin&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;mount_class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;secret&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">&quot;DUMMY&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:77c825c1329848f7ff467567365b15e027be7bcf720d9d1db86a6e4b0187a4a5&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">&quot;created_time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:a1aabe17c371bc59be05e18a7e494078d8ba93aa41346ef3cd07d68c47e7a66d&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;custom_metadata&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;deletion_time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hmac-sha256:764d7c9b6d83d95578dc1f839a386bfee7ad74e8cf5ca19255aa123aa8d63d2f&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;destroyed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">8</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h2 id="container에서-audit-log-수집"><a href="#container에서-audit-log-수집" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Container에서 audit log 수집</h2><p>Vault File Audit Device를 통해서 audit log를 파일로 저장할 수 있는 것을 확인하였다. PVC를 통해서 별도의 Storage에 해당 log를 저장하기 때문에, 해당 Storage를 주기적으로 Snapshot하여 보관할 수 있다. 하지만 이렇게 구성했을 때 audit log를 종합적으로 관리하고 검색하는 것이 어렵다.</p><p>Kubernetes에서 운영하고 있기 때문에 Pod의 stdout, stderr로 보내는 로그들을 다양한 Log 수집 Tool을 통해서 쉽게 수집하고 검색할 수 있다. 따라서 Vault audit log를 file로 저장하지 않고 바로 stdout으로 설정하면 이러한 문제를 해결할 수 있다. <code>file_path</code> 설정값을 <code>stdout</code>으로만 바꾸면 된다.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">vault audit <span class="token builtin class-name">enable</span> -path<span class="token operator">=</span><span class="token string">&quot;vault_audit_stdout&quot;</span> <span class="token function">file</span> <span class="token assign-left variable">file_path</span><span class="token operator">=</span>stdout
</span></code></pre></div><h2 id="결론"><a href="#결론" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>결론</h2><p>다행히 Vault Opensource 버전에서 Audit Log를 남길수 있는 기능을 제공한다. Audit Device로 file, syslog, socket등을 제공한다. Socket은 log 손실 가능성이 있고, syslog는 Vault Pod에서 추가적인 패키지 설치와 설정이 필요하다. 따라서 file로 audit log를 남기는 것을 선택하였다. 그리고 실제로 audit.log 파일로 남길때 disk 용량이 꽉차게 되면 Vault 장애를 가져오게 된다. Vault에서 log rotation은 제공하지 않기 때문에 별도의 tool을 통해서 설정을 해야 한다. Kubernetes에서 Vault를 운영중한다면 Log를 수집하고 검색하는 도구들이 이미 갖춰있을 가능성이 높다. 따라서 Vault audit log를 stdout으로 남겨서 이러한 도구들이 수집하고 종합적으로 관리하는 방식으로 진행할 수 있다.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300"></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/vault">vault</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/devsecops">devsecops</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240615-modsecurity">ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/20240713-add-package-to-distroless-image">Distroless Image에 Package 추가하기</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:jayground8@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/jayground8"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Jay</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Jayground8</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var r=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var t=n=\u003ec(n,\"__esModule\",{value:!0});var N=(n,s)=\u003e()=\u003e(s||n((s={exports:{}}).exports,s),s.exports),u=(n,s)=\u003e{t(n);for(var l in s)c(n,l,{get:s[l],enumerable:!0})},k=(n,s,l)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let a of p(s))!m.call(n,a)\u0026\u0026a!==\"default\"\u0026\u0026c(n,a,{get:()=\u003es[a],enumerable:!(l=d(s,a))||l.enumerable});return n},g=n=\u003ek(t(c(n!=null?r(h(n)):{},\"default\",n\u0026\u0026n.__esModule\u0026\u0026\"default\"in n?{get:()=\u003en.default,enumerable:!0}:{value:n,enumerable:!0})),n);var o=N((V,i)=\u003e{i.exports=_jsx_runtime});var v={};u(v,{default:()=\u003ef,frontmatter:()=\u003ey});var e=g(o()),y={title:\"Vault Audit Log\\uB97C \\uB0A8\\uAE30\\uAE30\",date:\"2024-07-13\",tags:[\"vault\",\"devsecops\"],images:[\"/static/images/social-banner.png\"],summary:\"Vault\\uC5D0\\uC11C \\uB2E4\\uC591\\uD55C credentials\\uB97C \\uBCF4\\uAD00\\uD558\\uAC8C \\uB41C\\uB2E4. \\uB530\\uB77C\\uC11C \\uC5B4\\uB5A4 \\uC811\\uADFC\\uB4E4\\uC774 \\uC788\\uC5C8\\uB294\\uC9C0 Audit Log\\uB4E4\\uC744 \\uB0A8\\uACA8\\uC11C \\uAD00\\uB9AC\\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. Vault\\uC5D0\\uC11C Audit Device \\uAE30\\uB2A5\\uC744 \\uC81C\\uACF5\\uD558\\uC5EC\\uC11C file, syslog, socket\\uB4F1\\uC73C\\uB85C Vault API \\uC694\\uCCAD\\uACFC \\uC751\\uB2F5\\uC744 \\uB85C\\uADF8\\uB85C \\uB0A8\\uAE38 \\uC218 \\uC788\\uB2E4. socket\\uC740 log \\uC190\\uC2E4\\uC758 \\uC704\\uD5D8\\uC774 \\uC788\\uACE0, syslog\\uB294 Vault Pod\\uC5D0\\uC11C \\uCD94\\uAC00\\uC801\\uC778 package\\uC124\\uCE58\\uC640 \\uC124\\uC815\\uC774 \\uD544\\uC694\\uD558\\uB2E4. \\uB530\\uB77C\\uC11C Kubernetes\\uC5D0\\uC11C Vault\\uB97C \\uC6B4\\uC601\\uD558\\uB294 \\uACFC\\uC815\\uC5D0\\uC11C file \\uBC29\\uC2DD\\uC73C\\uB85C Audit log\\uB97C \\uB0A8\\uACA8\\uBCF4\\uC558\\uB2E4.\"};function b(n={}){let{wrapper:s}=n.components||{};return s?(0,e.jsx)(s,Object.assign({},n,{children:(0,e.jsx)(l,{})})):l();function l(){let a=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",code:\"code\",pre:\"pre\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a.p,{children:[\"\\uC774\\uBC88\\uC5D0\\uB294 Kubernetes\\uC5D0\\uC11C Vault\\uB97C \\uC6B4\\uC601\\uD560 \\uB54C Audit log\\uB97C \\uB0A8\\uAE30\\uB294 \\uBC29\\uBC95\\uC744 \\uC54C\\uC544\\uBCF8\\uB2E4. Vault\\uC5D0\\uC11C Audit \\uAE30\\uB2A5\\uC744 \\uC81C\\uACF5\\uD558\\uC5EC API \\uC694\\uCCAD\\uACFC \\uC751\\uB2F5\\uC744 Log\\uB85C \\uB0A8\\uAE38 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://developer.hashicorp.com/vault/docs/audit\",children:\"Vault \\uACF5\\uC2DD \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uCE5C\\uC808\\uD558\\uAC8C \\uC124\\uBA85\\uD558\\uACE0 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(a.h2,{id:\"file-audit-device-\\uC0AC\\uC6A9\",children:[(0,e.jsx)(a.a,{href:\"#file-audit-device-\\uC0AC\\uC6A9\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"File audit device \\uC0AC\\uC6A9\"]}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://github.com/hashicorp/vault-helm/blob/main/values.yaml\",children:\"Vault\\uB97C Helm Chart\"}),\"\\uB85C \\uC124\\uCE58\\uD560 \\uB54C, \",(0,e.jsx)(a.code,{children:\"auditStorage\"}),\"\\uC758 \",(0,e.jsx)(a.code,{children:\"enabled\"}),\"\\uB97C true\\uB85C \\uC124\\uC815\\uD558\\uBA74 PVC\\uAC00 \\uC0DD\\uC131\\uB41C\\uB2E4. \\uADF8\\uB9AC\\uACE0 mount path\\uB294 \",(0,e.jsx)(a.code,{children:\"/vault/audit\"}),\"\\uC774 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"auditStorage\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"false\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Size of the PVC created\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"size\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 10Gi\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Location where the PVC will be mounted.\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/audit\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Name of the storage class to use.  If null it will use the\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# configured default Storage Class.\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"storageClass\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Access Mode of the storage device being used for the PVC\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"accessMode\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ReadWriteOnce\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Annotations to apply to the PVC\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Labels to apply to the PVC\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"vault\\uC5D0\\uC11C audit \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D CLI\\uB85C \\uC124\\uC815\\uD560 \\uB54C \",(0,e.jsx)(a.code,{children:\"file_path\"}),\"\\uB97C \\uC124\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC704\\uC5D0\\uC11C mount\\uB41C volume\\uC758 path\\uB85C \\uC124\\uC815\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault audit \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"enable\"}),\" -path\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"vault_audit\"'}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"file\"}),\" \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"file_path\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),`/vault/audit/audit.log\n`]})})}),(0,e.jsx)(a.p,{children:\"audit list \\uBA85\\uB839\\uC5B4\\uB85C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB4F1\\uB85D\\uB418\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC audit device \\uBAA9\\uB85D\\uC744 \\uBCFC \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ vault audit list\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Path              Type    Description\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`----              ----    -----------\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault_audit/    \",(0,e.jsx)(a.span,{className:\"token function\",children:\"file\"}),`    n/a\n`]})]})}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://github.com/hashicorp/vault-helm/blob/main/values.yaml\",children:\"Vault\\uB97C Helm Chart\"}),\"\\uC5D0\\uC11C \\uAE30\\uBCF8\\uC801\\uC73C\\uB85C \",(0,e.jsx)(a.code,{children:\"dataStorage\"}),\"\\uC758 \",(0,e.jsx)(a.code,{children:\"enabled\"}),\"\\uAC00 true\\uB85C \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, PVC\\uAC00 \\uC0DD\\uC131\\uB418\\uACE0 Volume\\uC774 \",(0,e.jsx)(a.code,{children:\"/vault/data\"}),\" \\uACBD\\uB85C\\uC5D0 \\uB9C8\\uC6B4\\uD305 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"dataStorage\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Size of the PVC created\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"size\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 10Gi\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Location where the PVC will be mounted.\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/data\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Name of the storage class to use.  If null it will use the\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# configured default Storage Class.\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"storageClass\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token important null\",children:\"null\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Access Mode of the storage device being used for the PVC\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"accessMode\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ReadWriteOnce\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Annotations to apply to the PVC\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Labels to apply to the PVC\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uADF8\\uB9AC\\uACE0 Vault\\uC758 High Availability \\uC124\\uC815\\uC744 \\uD558\\uACE0, storage\\uB97C \",(0,e.jsx)(a.code,{children:\"raft\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uBA74 Vault Node\\uB4E4\\uC774 Raft\\uB97C \\uD1B5\\uD574\\uC11C data\\uB4E4\\uC774 \\uBCF5\\uC81C\\uB41C\\uB2E4. Raft\\uC744 \\uD1B5\\uD574\\uC11C data\\uAC00 \\uAC01 Vault Node\\uB4E4\\uC5D0 \\uC800\\uC7A5\\uB418\\uB294 \\uACBD\\uB85C\\uB97C \\uC704\\uC5D0\\uC11C \\uB9C8\\uC6B4\\uD305 \\uB41C Volume \\uACBD\\uB85C\\uC778 \",(0,e.jsx)(a.code,{children:\"/vault/data\"}),\"\\uB85C \\uC124\\uC815\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"ha\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"raft\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"setNodeId\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"config\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\t\t\t...\\uC0DD\\uB7B5\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\t\t\tstorage \"raft\" {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\t\t\t\tpath = \"/vault/data\"\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"\t\t\t}\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uB807\\uAC8C \",(0,e.jsx)(a.code,{children:\"replica\"}),\"\\uAC00 \",(0,e.jsx)(a.code,{children:\"3\"}),\"\\uC73C\\uB85C \\uC124\\uC815\\uB418\\uC5C8\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC544\\uB798\\uC758 \\uBA85\\uB839\\uC5B4\\uB85C \\uD655\\uC778\\uD558\\uBA74 \\uC138 \\uAC1C\\uC758 Node\\uAC00 \\uBAA9\\uB85D\\uC5D0 \\uB098\\uC624\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ vault operator raft list-peers\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Node       Address                        State       Voter\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`----       -------                        -----       -----\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-0    vault-0.vault-internal:8201    follower    \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-1    vault-1.vault-internal:8201    leader      \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-2    vault-2.vault-internal:8201    follower    \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"Vault Leader Node\\uAC00 \\uC694\\uCCAD\\uC744 \\uCC98\\uB9AC\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0, \\uC704\\uC5D0\\uC11C leader \\uC5ED\\uD560\\uC758 vault-1 Node\\uC5D0 audit log\\uAC00 \\uC800\\uC7A5\\uB41C\\uB2E4. vault-1 container\\uC5D0 \\uC811\\uC18D\\uD558\\uC5EC \\uD30C\\uC77C\\uC744 \\uD655\\uC778\\uD574\\uBCF8\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),` -it vault-1 -- /bin/sh\n`]})})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(a.span,{className:\"token function\",children:\"ls\"}),` /vault/audit/\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`audit.log\n`})]})}),(0,e.jsxs)(a.p,{children:[\"Vault\\uC5D0\\uC11C secret \\uC815\\uBCF4\\uB4E4\\uC744 \\uAC00\\uC838\\uC624\\uBA74 \",(0,e.jsx)(a.code,{children:\"audit.log\"}),\"\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC740 log\\uAC00 \\uB0A8\\uC740 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. Log\\uC5D0 \\uB0A8\\uB294 \\uBE44\\uBC00 \\uC815\\uBCF4\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 hmac\\uC73C\\uB85C hash \\uCC98\\uB9AC\\uB418\\uC5B4 \\uC788\\uB2E4. (hash\\uAC12\\uC740 \",(0,e.jsx)(a.a,{href:\"https://developer.hashicorp.com/vault/api-docs/system/audit-hash\",children:\"/sys/audit-hash\"}),\" API\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \\uCC98\\uB9AC\\uAC00 \\uB418\\uACE0, audit device\\uB97C \\uC0C8\\uB85C \\uC0DD\\uC131\\uD558\\uBA74 \\uC0C8\\uB85C\\uC6B4 salt\\uAC00 \\uC0DD\\uC131\\uB41C\\uB2E4.) \\uADF8\\uB9AC\\uACE0 vault \\uC778\\uC99D \\uBC29\\uBC95\\uC744 userpass\\uB85C \\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC5B4\\uB5A4 username\\uC73C\\uB85C \\uC811\\uADFC\\uC744 \\uD588\\uB294\\uC9C0\\uB3C4 Log\\uB97C \\uD1B5\\uD574\\uC11C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-json\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"time\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"2024-07-12T23:53:50.294066904Z\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"response\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"auth\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"client_token\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:936a185caaa266bb9cbe981e9e05cb78cd732b0b3280eb944412bb6f8f8f07af\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"accessor\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:bb136af09813f2b2ac32f44a32379d5e66ec62022f4d9f557fdc606f8e35b996\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"display_name\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"userpass-myuser\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"policies\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"default\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"example\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"token_policies\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"default\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"example\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"policy_results\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"allowed\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"granting_policies\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"name\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"example\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"namespace_id\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"root\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"acl\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"metadata\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"username\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"myuser\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"entity_id\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"a9fe7d93-2312-38cf-fw83-5e4a1a9c86c8\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"token_type\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"service\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"token_ttl\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"2764800\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"token_issue_time\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"2024-07-12T23:16:30Z\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"request\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"cf25e9c9-5e9d-edf6-2b7k-61e9d48d5caa\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"client_id\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"a9fe7d93-2312-38cf-fw83-5e4a1a9c86c8\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"operation\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"read\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_point\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"sample/\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_type\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"kv\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_accessor\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"kv_0d071af0\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_running_version\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"v0.16.1+builtin\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_class\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"secret\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"client_token\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:936a185caaa266bb9cbe981e9e05cb78cd732b0b3280eb944412bb6f8f8f07af\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"client_token_accessor\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:bb136af09813f2b2ac32f44a32379d5e66ec62022f4d9f557fdc606f8e35b996\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"namespace\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"root\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"path\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"sample/data/hello\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"remote_address\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"10.70.7.27\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"remote_port\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"40766\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"response\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_point\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"sample/\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_type\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"kv\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_accessor\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"kv_0d071af0\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_running_plugin_version\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"v0.16.1+builtin\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"mount_class\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"secret\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"data\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"data\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"DUMMY\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:77c825c1329848f7ff467567365b15e027be7bcf720d9d1db86a6e4b0187a4a5\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"metadata\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"created_time\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:a1aabe17c371bc59be05e18a7e494078d8ba93aa41346ef3cd07d68c47e7a66d\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"custom_metadata\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token null keyword\",children:\"null\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"deletion_time\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"hmac-sha256:764d7c9b6d83d95578dc1f839a386bfee7ad74e8cf5ca19255aa123aa8d63d2f\"'}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"destroyed\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token property\",children:'\"version\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.h2,{id:\"container\\uC5D0\\uC11C-audit-log-\\uC218\\uC9D1\",children:[(0,e.jsx)(a.a,{href:\"#container\\uC5D0\\uC11C-audit-log-\\uC218\\uC9D1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Container\\uC5D0\\uC11C audit log \\uC218\\uC9D1\"]}),(0,e.jsx)(a.p,{children:\"Vault File Audit Device\\uB97C \\uD1B5\\uD574\\uC11C audit log\\uB97C \\uD30C\\uC77C\\uB85C \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD558\\uC600\\uB2E4. PVC\\uB97C \\uD1B5\\uD574\\uC11C \\uBCC4\\uB3C4\\uC758 Storage\\uC5D0 \\uD574\\uB2F9 log\\uB97C \\uC800\\uC7A5\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0, \\uD574\\uB2F9 Storage\\uB97C \\uC8FC\\uAE30\\uC801\\uC73C\\uB85C Snapshot\\uD558\\uC5EC \\uBCF4\\uAD00\\uD560 \\uC218 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uC774\\uB807\\uAC8C \\uAD6C\\uC131\\uD588\\uC744 \\uB54C audit log\\uB97C \\uC885\\uD569\\uC801\\uC73C\\uB85C \\uAD00\\uB9AC\\uD558\\uACE0 \\uAC80\\uC0C9\\uD558\\uB294 \\uAC83\\uC774 \\uC5B4\\uB835\\uB2E4.\"}),(0,e.jsxs)(a.p,{children:[\"Kubernetes\\uC5D0\\uC11C \\uC6B4\\uC601\\uD558\\uACE0 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0 Pod\\uC758 stdout, stderr\\uB85C \\uBCF4\\uB0B4\\uB294 \\uB85C\\uADF8\\uB4E4\\uC744 \\uB2E4\\uC591\\uD55C Log \\uC218\\uC9D1 Tool\\uC744 \\uD1B5\\uD574\\uC11C \\uC27D\\uAC8C \\uC218\\uC9D1\\uD558\\uACE0 \\uAC80\\uC0C9\\uD560 \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C Vault audit log\\uB97C file\\uB85C \\uC800\\uC7A5\\uD558\\uC9C0 \\uC54A\\uACE0 \\uBC14\\uB85C stdout\\uC73C\\uB85C \\uC124\\uC815\\uD558\\uBA74 \\uC774\\uB7EC\\uD55C \\uBB38\\uC81C\\uB97C \\uD574\\uACB0\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(a.code,{children:\"file_path\"}),\" \\uC124\\uC815\\uAC12\\uC744 \",(0,e.jsx)(a.code,{children:\"stdout\"}),\"\\uC73C\\uB85C\\uB9CC \\uBC14\\uAFB8\\uBA74 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault audit \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"enable\"}),\" -path\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"vault_audit_stdout\"'}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"file\"}),\" \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"file_path\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),`stdout\n`]})})}),(0,e.jsxs)(a.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(a.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(a.p,{children:\"\\uB2E4\\uD589\\uD788 Vault Opensource \\uBC84\\uC804\\uC5D0\\uC11C Audit Log\\uB97C \\uB0A8\\uAE38\\uC218 \\uC788\\uB294 \\uAE30\\uB2A5\\uC744 \\uC81C\\uACF5\\uD55C\\uB2E4. Audit Device\\uB85C file, syslog, socket\\uB4F1\\uC744 \\uC81C\\uACF5\\uD55C\\uB2E4. Socket\\uC740 log \\uC190\\uC2E4 \\uAC00\\uB2A5\\uC131\\uC774 \\uC788\\uACE0, syslog\\uB294 Vault Pod\\uC5D0\\uC11C \\uCD94\\uAC00\\uC801\\uC778 \\uD328\\uD0A4\\uC9C0 \\uC124\\uCE58\\uC640 \\uC124\\uC815\\uC774 \\uD544\\uC694\\uD558\\uB2E4. \\uB530\\uB77C\\uC11C file\\uB85C audit log\\uB97C \\uB0A8\\uAE30\\uB294 \\uAC83\\uC744 \\uC120\\uD0DD\\uD558\\uC600\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uC2E4\\uC81C\\uB85C audit.log \\uD30C\\uC77C\\uB85C \\uB0A8\\uAE38\\uB54C disk \\uC6A9\\uB7C9\\uC774 \\uAF49\\uCC28\\uAC8C \\uB418\\uBA74 Vault \\uC7A5\\uC560\\uB97C \\uAC00\\uC838\\uC624\\uAC8C \\uB41C\\uB2E4. Vault\\uC5D0\\uC11C log rotation\\uC740 \\uC81C\\uACF5\\uD558\\uC9C0 \\uC54A\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uBCC4\\uB3C4\\uC758 tool\\uC744 \\uD1B5\\uD574\\uC11C \\uC124\\uC815\\uC744 \\uD574\\uC57C \\uD55C\\uB2E4. Kubernetes\\uC5D0\\uC11C Vault\\uB97C \\uC6B4\\uC601\\uC911\\uD55C\\uB2E4\\uBA74 Log\\uB97C \\uC218\\uC9D1\\uD558\\uACE0 \\uAC80\\uC0C9\\uD558\\uB294 \\uB3C4\\uAD6C\\uB4E4\\uC774 \\uC774\\uBBF8 \\uAC16\\uCDB0\\uC788\\uC744 \\uAC00\\uB2A5\\uC131\\uC774 \\uB192\\uB2E4. \\uB530\\uB77C\\uC11C Vault audit log\\uB97C stdout\\uC73C\\uB85C \\uB0A8\\uACA8\\uC11C \\uC774\\uB7EC\\uD55C \\uB3C4\\uAD6C\\uB4E4\\uC774 \\uC218\\uC9D1\\uD558\\uACE0 \\uC885\\uD569\\uC801\\uC73C\\uB85C \\uAD00\\uB9AC\\uD558\\uB294 \\uBC29\\uC2DD\\uC73C\\uB85C \\uC9C4\\uD589\\uD560 \\uC218 \\uC788\\uB2E4.\"})]})}}var f=b;return v;})();\n;return Component;","toc":[{"value":"File audit device 사용","url":"#file-audit-device-사용","depth":2},{"value":"Container에서 audit log 수집","url":"#container에서-audit-log-수집","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.33,"time":379800,"words":1266},"slug":"20240713-vault-audit","fileName":"20240713-vault-audit.md","title":"Vault Audit Log를 남기기","date":"2024-07-13T00:00:00.000Z","tags":["vault","devsecops"],"images":["/static/images/social-banner.png"],"summary":"Vault에서 다양한 credentials를 보관하게 된다. 따라서 어떤 접근들이 있었는지 Audit Log들을 남겨서 관리하고 싶었다. Vault에서 Audit Device 기능을 제공하여서 file, syslog, socket등으로 Vault API 요청과 응답을 로그로 남길 수 있다. socket은 log 손실의 위험이 있고, syslog는 Vault Pod에서 추가적인 package설치와 설정이 필요하다. 따라서 Kubernetes에서 Vault를 운영하는 과정에서 file 방식으로 Audit log를 남겨보았다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"ModSecurity를 Nginx Ingress Controller에 연동하여 WAF 설정하기","date":"2024-06-15T00:00:00.000Z","tags":["kubernetes","nginx","modsecurity","devsecops"],"images":["/static/images/social-banner.png"],"summary":"ModSecurity는 오픈소스로 제공하는 WAF이다. Nginx connector를 통해서 ModSecurity를 Nginx에 쉽게 연동할 수 있다. Nginx Ingress Controller에서는 해당 설정을 할 수 있도록 Configmap에 설정 옵션들을 제공한다. 해당 옵션들을 설정함으로서 쉽게 Nginx에 WAF를 구현할 수 있다. ModSecurity는 Trustware라는 회사가 관리하다가 2024년 1월에 OWASP foundation으로 넘어가게 되었다. ModSecurity는 오래된 프로젝트이고, Production Ready라고 소개되고 있다. 하지만 ModSecurity가 앞으로도 계속 커뮤니티를 통해서 활발히 관리될지는 지켜봐야겠다.","slug":"20240615-modsecurity"},"next":{"title":"Distroless Image에 Package 추가하기","date":"2024-07-13T00:00:00.000Z","tags":["kubernetes","distroless","devsecops"],"images":["/static/images/social-banner.png"],"summary":"컨테이너 이미지에 최소한으로 필요한 software만 포함하는 것이 보안적으로 모범사례이다. 이러한 모범사례를 따르는 가장 쉽고 합리적인 방법은 구글에서 제공하는 Distroless Image를 활용하는 것이다. Distroless Image는 nonroot, debug, debug-nonroot Tag를 가지고 있다. nonroot은 conatiner에게 root 권한을 주지않고, shell도 없어서 Terminal로 접속이 불가능하다. 그런데 Distroless Image에 추가로 필요한 debian package를 설치하면 어떻게 해야할까? 이번 글에서는 bazel로 빌드할 때 원하는 debian package를 추가하는 방법을 알아 본다.","slug":"20240713-add-package-to-distroless-image"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["20240713-vault-audit"]},"buildId":"W4OJIiHqN_WQQ9TfZMwI5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>