{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=a=>l(a,\"__esModule\",{value:!0});var h=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!u.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},S=a=>k(t(l(a!=null?o(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var i=h((M,r)=>{r.exports=_jsx_runtime});var v={};N(v,{default:()=>A,frontmatter:()=>g});var e=S(i()),g={title:\"AWS SAM\\uC73C\\uB85C \\uBC30\\uD3EC\\uD55C Lambda\\uC758 \\uD658\\uACBD\\uBCC0\\uC218\\uAC00 \\uBCC0\\uACBD\\uB41C Secret Manager \\uAC12\\uC73C\\uB85C \\uBC18\\uC601\\uC774 \\uC548\\uB418\\uB294 \\uBB38\\uC81C\",date:\"2023-12-17\",tags:[\"AWS\"],images:[\"/static/images/social-banner.png\"],summary:\"AWS Cloudformation\\uC5D0\\uC11C Secret Manager\\uC758 \\uAC12\\uC744 \\uCC38\\uC870\\uD558\\uB3C4\\uB85D \\uD560 \\uC218 \\uC788\\uB2E4. AWS SAM\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC \\uBC30\\uD3EC\\uB41C Lambda\\uC758 \\uD658\\uACBD\\uBCC0\\uC218\\uAC00 Secret Manager\\uC758 \\uAC12\\uC744 \\uCC38\\uC870\\uD558\\uB294 \\uACBD\\uC6B0\\uAC00 \\uC788\\uC5C8\\uB2E4. \\uADF8\\uB7F0\\uB370 Secret manager\\uC758 \\uAC12\\uC744 \\uBCC0\\uACBD\\uD558\\uC5EC \\uB2E4\\uC2DC \\uBC30\\uD3EC\\uD558\\uC5EC\\uB3C4 \\uBCC0\\uACBD\\uB41C \\uAC12\\uC774 Lambda \\uD658\\uACBD\\uBCC0\\uC218\\uC5D0 \\uBC18\\uC601\\uC774 \\uB418\\uC9C0 \\uC54A\\uC558\\uB2E4.\\u{1F9D0} AWS SAM\\uC758 \\uB9AC\\uD3EC\\uC5D0 \\uAD00\\uB828\\uB41C Issue\\uAC00 \\uC788\\uC5C8\\uACE0, \\uC81C\\uC548\\uD55C \\uD574\\uACB0\\uBC29\\uBC95\\uC744 \\uC801\\uC6A9\\uD558\\uC600\\uB2E4. \\uC0B4\\uC9DD \\uC0BD\\uC9C8\\uC744 \\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uAE30\\uB85D\\uC744 \\uB0A8\\uACA8 \\uBCF8\\uB2E4.\\u{1F92A}\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",pre:\"pre\",code:\"code\",span:\"span\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"AWS SAM Template\\uC73C\\uB85C Serverless Architecture\\uB97C \\uAD6C\\uC131\\uD560 \\uB54C, Lambda\\uC758 Runtime\\uC911\\uC5D0 AWS Secret Manager\\uC5D0\\uC11C credential\\uC744 \\uAC00\\uC9C0\\uACE0 \\uC624\\uB294 \\uAC83\\uC774 \\uC544\\uB2C8\\uB77C Environment Variable\\uC5D0 crendential\\uC744 \\uB123\\uC5B4\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294 \\uACBD\\uC6B0\\uAC00 \\uC788\\uC5C8\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/dynamic-references.html\",children:\"Cloudformation\\uC5D0\\uC11C Secret Manager\\uC5D0 \\uC800\\uC7A5\\uB41C Value\\uB97C \\uCC38\\uC870\\uD574\\uC11C resource\\uB97C \\uC0DD\\uC131\\uD558\\uB294 \\uBC29\\uBC95\"}),\"\\uC744 \\uC81C\\uACF5\\uD55C\\uB2E4. Secret Manager\\uB97C \\uC0AC\\uC6A9\\uD560 \\uACBD\\uC6B0 \\uC544\\uB798\\uCC98\\uB7FC \\uC791\\uC131\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Resources\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Sample\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" AWS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"Serverless\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`Function\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"CodeUri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` sample/\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Handler\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` app.lambdaHandler\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Runtime\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nodejs18.x\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Architectures\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` x86_64\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Environment\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Variables\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"SECRET\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'{{resolve:secretsmanager:secretName:SecretString:keyName}}'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"AWS Secret manager Console\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294 secret\\uC758 version ID\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"{{resolve:secretsmanager:secretName:SecretString:keyName}}\"}),\"\\uC5D0\\uC11C version id\\uB97C \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uC815\\uC758\\uD558\\uC9C0 \\uC54A\\uC73C\\uBA74 AWSCURRENT\\uAC00 default\\uB85C \\uC124\\uC815\\uB41C\\uB2E4. \\uB530\\uB77C\\uC11C Secret\\uC758 value\\uB97C \\uC218\\uC815\\uD588\\uC73C\\uBA74, \\uCD5C\\uC2E0\\uC758 \\uC218\\uC815\\uB41C version id\\uAC00 \\uC790\\uB3D9\\uC73C\\uB85C \\uC801\\uC6A9\\uB41C\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/resolve-secret-manager.png\",alt:\"aws secret manager version id\"}),(0,e.jsxs)(n.p,{children:[\"\\uC608\\uB97C \\uB4E4\\uC5B4\\uC11C Secret \",(0,e.jsx)(n.code,{children:\"secretName\"}),\"\\uC758 \",(0,e.jsx)(n.code,{children:\"keyName\"}),\" \\uAC12\\uC744 \\uBCC0\\uACBD\\uD558\\uACE0, SAM Template\\uC744 \\uC801\\uC6A9\\uD558\\uBA74 Lambda\\uC758 Environment Variable\\uC774 \\uBCC0\\uACBD\\uB41C \\uAC12\\uC73C\\uB85C \\uBC18\\uC601\\uB420 \\uAC70\\uB77C \\uAE30\\uB300\\uB97C \\uD588\\uB2E4. \\uADF8\\uB7F0\\uB370 Lambda\\uAC00 Update \\uB418\\uC5C8\\uB294\\uB370\\uB3C4, \\uBCC0\\uACBD\\uB41C Secret \\uAC12\\uC774 \\uBC18\\uC601\\uB418\\uC9C0 \\uC54A\\uACE0 \\uC774\\uC804 \\uAC12\\uACFC \\uB3D9\\uC77C\\uD558\\uAC8C \\uC720\\uC9C0\\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uCC3E\\uC544\\uBCF4\\uB2C8 \\uAD00\\uB828\\uB41C \",(0,e.jsx)(n.a,{href:\"https://github.com/aws/serverless-application-model/issues/1267\",children:\"SAM Github Repository\\uC5D0 issue\"}),\"\\uAC00 \\uC788\\uC5C8\\uACE0, Secret Manager\\uCC98\\uB7FC \\uCC38\\uC870\\uB41C \\uD658\\uACBD\\uBCC0\\uC218\\uB9CC \\uBCC0\\uACBD\\uB420 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uC0C8\\uB85C\\uC6B4 \\uAC12\\uC774 \\uBC18\\uC601\\uB418\\uC9C0 \\uC54A\\uB294\\uB2E4. \\uD604\\uC7AC\\uC758 \\uD574\\uACB0\\uBC29\\uBC95\\uC73C\\uB85C Environment Variable\\uC5D0 \\uD56D\\uC0C1 \\uBC14\\uB00C\\uB294 \\uAC12\\uC744 \\uC8FC\\uC785\\uD558\\uB294 \\uAC83\\uC744 \\uACF5\\uC720\\uD558\\uACE0 \\uC788\\uB2E4. Github Action\\uC744 \\uC0AC\\uC6A9\\uD560 \\uB54C\\uB294 \",(0,e.jsx)(n.code,{children:\"GITHUB_SHA\"}),\" \\uD658\\uACBD\\uBCC0\\uC218\\uB97C Revision parameter\\uC5D0 \\uC8FC\\uC785\\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Parameters\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Revision\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` String\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Resources\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Sample\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" AWS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"Serverless\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`Function\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Properties\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"CodeUri\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` sample/\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Handler\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` app.lambdaHandler\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Runtime\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nodejs18.x\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Architectures\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` x86_64\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Environment\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Variables\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"SECRET\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'{{resolve:secretsmanager:secretName:SecretString:keyName}}'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"REVISION\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token tag\",children:\"!Ref\"}),` Revision\n`]})]})})]})}}var A=y;return v;})();\n;return Component;","toc":[],"frontMatter":{"readingTime":{"text":"2 min read","minutes":1.98,"time":118800,"words":396},"slug":"20231217-aws-sam-resolve-issue","fileName":"20231217-aws-sam-resolve-issue.md","title":"AWS SAM으로 배포한 Lambda의 환경변수가 변경된 Secret Manager 값으로 반영이 안되는 문제","date":"2023-12-17T00:00:00.000Z","tags":["AWS"],"images":["/static/images/social-banner.png"],"summary":"AWS Cloudformation에서 Secret Manager의 값을 참조하도록 할 수 있다. AWS SAM을 사용하여 배포된 Lambda의 환경변수가 Secret Manager의 값을 참조하는 경우가 있었다. 그런데 Secret manager의 값을 변경하여 다시 배포하여도 변경된 값이 Lambda 환경변수에 반영이 되지 않았다.🧐 AWS SAM의 리포에 관련된 Issue가 있었고, 제안한 해결방법을 적용하였다. 살짝 삽질을 했기 때문에 기록을 남겨 본다.🤪"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.155,"time":9300,"words":31},"slug":["default"],"fileName":"default.md","name":"Jaemyun Lee","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Argo CD Notification으로 간단하게 Slack 알림 보내기","date":"2023-12-14T00:00:00.000Z","tags":["Kubernetes","ArgoCD"],"images":["/static/images/social-banner.png"],"summary":"Argo CD Notification가 이미 있어서 쉽게 Slack 알림을 연동할 수 있다. 메뉴얼에서 친절하게 셋팅 방법을 설명하고 있지만, 처음 보고 셋팅할 때 놓칠 수 있는 부분을 기록으로 남긴다.","slug":"20231214-argocd-notification"},"next":{"title":"vault secrets operator 사용해보기","date":"2023-12-22T00:00:00.000Z","tags":["Kubernetes","vault"],"images":["/static/images/social-banner.png"],"summary":"GitOps에서 Secret을 어떻게 관리할지 고민을 하였고, 개발자들의 인지부하를 줄이기 위해서 Vault UI로 자신의 앱의 비밀값을 관리하는 것이 제일 효율적이라는 판단을 했다. Vault secrets operator가 GA로 공유가 되었고, Secrets Store CSI나 External secrets 프로젝트보다 깔금한 방식이라는 생각이 들었다. Vault secrets operator의 CRD로 vault secret과 kubernetes secret의 sync를 맞추고, reloader로 secret이 변경되었을 때 다시 pod를 배포하는 것을 테스트해보았다.","slug":"20231222-vault-on-k8s"}},"__N_SSG":true}