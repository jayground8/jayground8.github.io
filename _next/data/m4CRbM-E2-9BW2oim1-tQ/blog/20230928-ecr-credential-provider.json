{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=>k(i(l(a!=null?o(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var t=u((R,r)=>{r.exports=_jsx_runtime});var y={};N(y,{default:()=>v,frontmatter:()=>b});var e=g(t()),b={title:\"ECR Credential-Provider \\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\",date:\"2023-09-28\",tags:[\"kubernetes\"],summary:\"Kubeadm\\uC73C\\uB85C \\uB9CC\\uB4E0 Kubernetes Cluster\\uC5D0\\uC11C AWS ECR\\uB97C private container image repository\\uB97C \\uC0AC\\uC6A9\\uD558\\uACE0\\uC790 \\uD558\\uC600\\uB2E4. private repository\\uB97C \\uC811\\uADFC\\uD558\\uAE30 \\uC704\\uD574\\uC11C Kubernetes 1.26\\uBD80\\uD130 stable feature\\uB85C \\uC81C\\uACF5\\uD558\\uB294 kubelet crendential provider\\uB97C \\uC0AC\\uC6A9\\uD558\\uC600\\uB2E4.\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"cronjob\\uC744-\\uC774\\uC6A9\",children:[(0,e.jsx)(n.a,{href:\"#cronjob\\uC744-\\uC774\\uC6A9\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"CronJob\\uC744 \\uC774\\uC6A9?\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC790\\uCCB4\\uC801\\uC73C\\uB85C EC2(Ubuntu 20.04)\\uC5D0 Kubernetes Cluster\\uB97C Kubeadm\\uB85C \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294\\uB370, ECR\\uB97C \\uC5F0\\uACB0\\uD558\\uC5EC \\uC0AC\\uC6A9\\uD558\\uB824\\uACE0 \\uD588\\uB2E4. AWS cli \\uBA85\\uB839\\uC5B4 \",(0,e.jsx)(n.code,{children:\"aws ecr get-login-password\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC Docker secret\\uC5D0 \\uCD94\\uAC00\\uD558\\uC5EC \\uC778\\uC99D\\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#create-a-secret-by-providing-credentials-on-the-command-line\",children:\"Kubernetes \\uACF5\\uC2DD\\uBB38\\uC11C\"}),\"\\uC5D0 \\uCE5C\\uC808\\uD558\\uAC8C \\uB098\\uC640 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uC774\\uB807\\uAC8C \",(0,e.jsx)(n.code,{children:\"aws ecr get-login-password\"}),\"\\uB85C \\uBC1B\\uC740 token\\uC740 12\\uC2DC\\uAC04\\uB3D9\\uC548 \\uC720\\uD6A8\\uD558\\uAC8C \\uB41C\\uB2E4. \\uB530\\uB77C\\uC11C Cronjob\\uC744 \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uC8FC\\uAE30\\uC801\\uC73C\\uB85C \\uC5C5\\uB370\\uC774\\uD2B8\\uD574\\uC8FC\\uB294 \\uC791\\uC5C5\\uC73C\\uB85C \\uD574\\uACB0\\uD55C \\uBE14\\uB85C\\uADF8\\uB4E4\\uC744 \\uC5EC\\uB7FF \\uBCF4\\uC558\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"kubelet-crendential-provider\\uB97C-\\uC0AC\\uC6A9\",children:[(0,e.jsx)(n.a,{href:\"#kubelet-crendential-provider\\uB97C-\\uC0AC\\uC6A9\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kubelet Crendential Provider\\uB97C \\uC0AC\\uC6A9\"]}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \\uC880 \\uB354 \\uAE54\\uB054\\uD55C \\uBC29\\uBC95\\uC774 \\uC788\\uC744 \\uAC83 \\uAC19\\uC544\\uC11C \\uCC3E\\uC544\\uBCF4\\uB294 \\uACFC\\uC815\\uC5D0\\uC11C 1.26\\uBD80\\uD130 stable\\uB41C \",(0,e.jsx)(n.a,{href:\"https://kubernetes.io/docs/tasks/administer-cluster/kubelet-credential-provider/\",children:\"kubelet image credential provider \\uC124\\uC815\"}),\"\\uC744 \\uBC1C\\uACAC\\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC774 \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC \\uB450\\uAC00\\uC9C0\\uC758 kubelet flag\\uB97C \\uC124\\uC815\\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"--image-credential-provider-config\"}),\" \",(0,e.jsx)(n.code,{children:\"--image-credential-provider-bin-dir\"})]}),(0,e.jsxs)(n.h3,{id:\"kubelet-flag-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#kubelet-flag-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kubelet flag \\uC124\\uC815\"]}),(0,e.jsx)(n.p,{children:\"kubeadm\\uC744 \\uC0AC\\uC6A9\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 kubelet systemd service \\uC124\\uC815\\uAC12\\uC744 \\uBCF4\\uBA74 \\uC544\\uB798\\uCC98\\uB7FC \\uD658\\uACBD\\uBCC0\\uC218 \\uAC12\\uC744 \\uAC00\\uC838\\uC624\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`systemctl status kubelet\n`})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u25CF kubelet.service - kubelet: The Kubernetes Node Agent\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     Loaded: loaded \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"/lib/systemd/system/kubelet.service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" enabled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" vendor preset: enabled\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    Drop-In: /usr/lib/systemd/system/kubelet.service.d\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`             \\u2514\\u250010-kubeadm.conf\n`})]})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),` /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Environment\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"Environment\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:'# This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"EnvironmentFile\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`-/var/lib/kubelet/kubeadm-flags.env\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"EnvironmentFile\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`-/etc/sysconfig/kubelet\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"ExecStart\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"ExecStart\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"/usr/bin/kubelet \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_KUBECONFIG_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_CONFIG_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_KUBEADM_ARGS\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBELET_EXTRA_ARGS\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uB098\\uB294 \\uC5EC\\uAE30\\uC5D0 \\uCD94\\uAC00\\uD574\\uC57C \\uB418\\uB294 flag \\uB450 \\uAC1C\\uB97C \\uB123\\uC5B4\\uC918\\uC11C \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"cat\"}),\" /var/lib/kubelet\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# cat kubeadm-flags.env\"}),`\n`]})})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_KUBEADM_ARGS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),'\"--container-runtime-endpoint',(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"unix:///var/run/containerd/containerd.sock --pod-infra-container-image\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`registry.k8s.io/pause:3.9\n`]})})}),(0,e.jsxs)(n.h3,{id:\"plugin-binary-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#plugin-binary-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"plugin binary \\uC124\\uC815\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"--image-credential-provider-bin-dir\"}),\"\\uC5D0\\uC11C plugin binary file \\uACBD\\uB85C\\uB97C \\uAC00\\uB974\\uCF1C\\uC57C \\uD558\\uB294\\uB370, go\\uB85C source code\\uB97C compile\\uD558\\uC600\\uB2E4. \\uADF8\\uB9AC\\uACE0 binary file\\uC744 \",(0,e.jsx)(n.code,{children:\"/usr/local/bin\"}),\"\\uC73C\\uB85C \\uC774\\uB3D9\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),` -OL https://go.dev/dl/go1.20.8.linux-amd64.tar.gz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"tar\"}),` -C /usr/local -xvf go1.20.8.linux-amd64.tar.gz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"PATH\"})}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"$PATH\"}),`:/usr/local/go/bin\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"git\"}),` clone https://github.com/kubernetes/cloud-provider-aws.git\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"cd\"}),` cloud-provider-aws/cmd/ecr-credential-provider\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`go build\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"mv\"}),` ecr-credential-provider /usr/local/bin\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"config-file-\\uC124\\uC815\",children:[(0,e.jsx)(n.a,{href:\"#config-file-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"config file \\uC124\\uC815\"]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"--image-credential-provider-config\"}),\"\\uC5D0 \\uC5F0\\uACB0\\uD55C config \\uD30C\\uC77C\\uB3C4 \\uC791\\uC131\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"ecr.yml\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` kubelet.config.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` CredentialProviderConfig\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"providers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ecr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"credential\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`provider\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchImages\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.*.amazonaws.com'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.*.amazonaws.com.cn'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr-fips.*.amazonaws.com'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.us-iso-east-1.c2s.ic.gov'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*.dkr.ecr.us-isob-east-1.sc2s.sgov.gov'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` credentialprovider.kubelet.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"defaultCacheDuration\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'12h'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC900\\uBE44\\uAC00 \\uB418\\uC5B4\\uC11C \",(0,e.jsx)(n.code,{children:\"/var/lib/kubelet# cat kubeadm-flags.env\"}),\"\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC218\\uC815\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBELET_KUBEADM_ARGS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"--container-runtime-endpoint=unix:///var/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9 --image-credential-provider-config=/home/ubuntu/ecr.yml --image-credential-provider-bin-dir=/usr/local/bin/\"'}),`\n`]})})}),(0,e.jsxs)(n.h3,{id:\"ecr-pull-\\uAD8C\\uD55C\",children:[(0,e.jsx)(n.a,{href:\"#ecr-pull-\\uAD8C\\uD55C\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"ECR pull \\uAD8C\\uD55C\"]}),(0,e.jsxs)(n.p,{children:[\"\\uCD5C\\uC18C\\uD55C\\uC758 \\uAD8C\\uD55C\\uB9CC \\uC8FC\\uB294\\uAC8C Best practice\\uC9C0\\uB9CC \\uC77C\\uB2E8 Read\\uCABD \\uAD8C\\uD55C \\uC804\\uBD80\\uC640 \",(0,e.jsx)(n.code,{children:\"GetAuthorizationToken\"}),\"\\uB97C \\uCD94\\uAC00\\uD558\\uC5EC \\uD14C\\uC2A4\\uD2B8\\uB97C \\uC9C4\\uD589\\uD588\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Version\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Statement\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Sid\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"VisualEditor0\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Effect\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Action\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetRegistryPolicy\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeImageScanFindings\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetLifecyclePolicyPreview\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetDownloadUrlForLayer\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeRegistry\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribePullThroughCacheRules\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeImageReplicationStatus\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetAuthorizationToken\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:ListTagsForResource\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:ListImages\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:BatchGetRepositoryScanningConfiguration\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetRegistryScanningConfiguration\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:BatchGetImage\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeImages\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:DescribeRepositories\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:BatchCheckLayerAvailability\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetRepositoryPolicy\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ecr:GetLifecyclePolicy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Resource\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"kubelet-restart\",children:[(0,e.jsx)(n.a,{href:\"#kubelet-restart\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"kubelet restart\"]}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uC0C8\\uB85C\\uC6B4 flag\\uAC00 \\uC801\\uC6A9\\uB418\\uB3C4\\uB85D restart\\uB97C \\uD558\\uBA74 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C ECR\\uC5D0\\uC11C image\\uB97C pull\\uD574\\uC628\\uB2E4. \\u{1F60E}\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" systemctl daemon-reload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart kubelet\n`]})})})]})}}var v=f;return y;})();\n;return Component;","toc":[{"value":"CronJob을 이용?","url":"#cronjob을-이용","depth":2},{"value":"Kubelet Crendential Provider를 사용","url":"#kubelet-crendential-provider를-사용","depth":2},{"value":"Kubelet flag 설정","url":"#kubelet-flag-설정","depth":3},{"value":"plugin binary 설정","url":"#plugin-binary-설정","depth":3},{"value":"config file 설정","url":"#config-file-설정","depth":3},{"value":"ECR pull 권한","url":"#ecr-pull-권한","depth":3},{"value":"kubelet restart","url":"#kubelet-restart","depth":3}],"frontMatter":{"readingTime":{"text":"4 min read","minutes":3.165,"time":189900,"words":633},"slug":"20230928-ecr-credential-provider","fileName":"20230928-ecr-credential-provider.md","title":"ECR Credential-Provider 사용해보기","date":"2023-09-28T00:00:00.000Z","tags":["kubernetes"],"summary":"Kubeadm으로 만든 Kubernetes Cluster에서 AWS ECR를 private container image repository를 사용하고자 하였다. private repository를 접근하기 위해서 Kubernetes 1.26부터 stable feature로 제공하는 kubelet crendential provider를 사용하였다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.155,"time":9300,"words":31},"slug":["default"],"fileName":"default.md","name":"Jaemyun Lee","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"콜드 스타트 이론","date":"2023-08-04T00:00:00.000Z","tags":["book"],"summary":"<콜드 스타트> 책은 네트워크 상품이 어떻게 성장하고, 성장과 함께 어떠한 단계를 경험할 수 있는지 설명한다. 새로운 네트워크 상품은 네트워크를 처음부터 구축해야 되는 콜드 스타트 문제를 가진다. 작지만 밀도가 높은 원자적 네트워크를 구성하여 초기 콜드 스타트 문제를 해결해야 하고, 이것은 초기 생존과 연관된다. 원자적 네트워크를 바탕으로 확장하고 네트워크가 성장하면 네트워크 효과를 가질 수 있다. 동일한 기능을 모방하여 도전하는 경쟁자가 생긴다고 해도 네트워크 효과가 방어막이 될 수 있다.","slug":"20230804-book-review-the-cold-start-problem"},"next":null},"__N_SSG":true}