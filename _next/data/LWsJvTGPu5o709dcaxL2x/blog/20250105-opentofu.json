{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var t=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var r=a=>l(a,\"__esModule\",{value:!0});var N=(a,c)=>()=>(c||a((c={exports:{}}).exports,c),c.exports),u=(a,c)=>{r(a);for(var s in c)l(a,s,{get:c[s],enumerable:!0})},g=(a,c,s)=>{if(c&&typeof c==\"object\"||typeof c==\"function\")for(let n of p(c))!h.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>c[n],enumerable:!(s=d(c,n))||s.enumerable});return a},_=a=>g(r(l(a!=null?t(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=N((v,i)=>{i.exports=_jsx_runtime});var b={};u(b,{default:()=>f,frontmatter:()=>k});var e=_(o()),k={title:\"GCP Secret Manager\\uC5D0\\uC11C \\uBE44\\uBC00\\uAC12\\uC744 OpenTofu\\uB85C \\uAD00\\uB9AC\\uD558\\uAE30\",date:\"2025-01-05\",tags:[\"gcp\",\"terraform\",\"opentofu\"],images:[\"/static/images/social-banner.png\"],summary:\"GCP Secret Manager\\uB97C IaS\\uB85C \\uAD00\\uB9AC\\uD560 \\uB54C, \\uC800\\uC7A5\\uD558\\uB294 Secret \\uAC12\\uC744 Key Management Service\\uC758 \\uBE44\\uB300\\uCE6D\\uD0A4\\uC640 Terraform\\uC758 google_kms_secret_asymmetric data source\\uB85C \\uAD00\\uB9AC\\uD560 \\uC218 \\uC788\\uB2E4. \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uD55C \\uBE44\\uBC00 \\uAC12\\uC744 Terraform resource definition\\uC5D0 \\uC815\\uC758\\uD558\\uACE0, \\uB7F0\\uD0C0\\uC784 \\uACFC\\uC815\\uC5D0\\uC11C \\uBCF5\\uD638\\uD654\\uD558\\uC5EC Secret Manager\\uC758 \\uBE44\\uBC00\\uAC12\\uC73C\\uB85C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C Git\\uC5D0 \\uD3C9\\uC11C\\uBB38 \\uB300\\uC2E0\\uC5D0 \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uD55C \\uBE44\\uBC00 \\uAC12\\uC73C\\uB85C \\uC815\\uC758\\uD55C Terraform \\uD30C\\uC77C\\uC744 \\uC800\\uC7A5\\uD558\\uC5EC \\uAD00\\uB9AC\\uD560 \\uC218 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uD574\\uB2F9 \\uBE44\\uBC00 \\uAC12\\uC740 State output \\uAC19\\uC740 \\uACF3\\uC5D0 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uADF8\\uB300\\uB85C \\uB178\\uCD9C \\uB420 \\uC218 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0, remote state\\uB85C \\uAD00\\uB9AC\\uD560 \\uB54C\\uB294 \\uD574\\uB2F9 state \\uD30C\\uC77C\\uC774 \\uB178\\uCD9C\\uB418\\uC9C0 \\uC54A\\uB3C4\\uB85D \\uAD00\\uB9AC\\uB97C \\uC798\\uD574\\uC57C \\uD55C\\uB2E4. OpenTofu\\uB97C \\uC774\\uC6A9\\uD560 \\uB54C\\uB294 State \\uD30C\\uC77C\\uC744 \\uC554\\uD638\\uD654 \\uD558\\uB294 \\uC635\\uC158\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC State \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD574\\uC11C \\uAD00\\uB9AC\\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4.\"};function y(a={}){let{wrapper:c}=a.components||{};return c?(0,e.jsx)(c,Object.assign({},a,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",blockquote:\"blockquote\",code:\"code\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"IaS(Infrastructure As Code)\\uB85C GCP Secret Manager\\uC758 Secret \\uAC12\\uC744 \\uAD00\\uB9AC\\uD560 \\uB54C, \\uC5B4\\uB5BB\\uAC8C \\uD558\\uBA74 \\uC88B\\uC744\\uAE4C? Terraform\\uC744 \\uC774\\uC6A9\\uD558\\uC5EC tf\\uD30C\\uC77C\\uC744 Git\\uC73C\\uB85C \\uAD00\\uB9AC\\uD558\\uB294 \\uAC83\\uC744 \\uC0DD\\uAC01\\uD574\\uBCFC \\uC218 \\uC788\\uB294\\uB370, Private Git Repository\\uB97C \\uC0AC\\uC6A9\\uD55C\\uB2E4\\uACE0 \\uD558\\uB354\\uB77C\\uB3C4 tf\\uD30C\\uC77C\\uC5D0 Secret \\uAC12\\uB4E4\\uC744 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uC62C\\uB9AC\\uB294 \\uAC83\\uC740 \\uBC14\\uB78C\\uC9C1\\uD558\\uC9C0 \\uC54A\\uB2E4.\"}),(0,e.jsxs)(n.h2,{id:\"kms_secret_asymmetric\",children:[(0,e.jsx)(n.a,{href:\"#kms_secret_asymmetric\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"kms_secret_asymmetric\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uB7F4 \\uB54C, Terraform \",(0,e.jsx)(n.a,{href:\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_secret_asymmetric\",children:\"google_kms_secret_asymmetric\"}),\" data source\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC744 \\uACE0\\uB824\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.p,{children:\"GCP\\uC758 KMS(Key Management Service)\\uB97C \\uC774\\uC6A9\\uD558\\uC5EC \\uBE44\\uB300\\uCE6D\\uD0A4\\uB97C \\uC0DD\\uC131\\uD558\\uC5EC \\uAD00\\uB9AC\\uD558\\uACE0, Terraform Resource Definition\\uC5D0\\uB294 \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uB41C \\uAC12\\uC744 \\uC791\\uC131\\uD55C\\uB2E4. \\uCD5C\\uC885\\uC801\\uC73C\\uB85C Secret Manager\\uC758 Secret \\uAC12\\uC740 Runtime\\uC911\\uC5D0 google_kms_secret_asymmetric data source\\uB97C \\uD1B5\\uD574\\uC11C \\uBCF5\\uD638\\uD654\\uB41C \\uAC12\\uC774 \\uC124\\uC815\\uB418\\uAC8C \\uB41C\\uB2E4.\"}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/kms_secret_asymmetric\",children:\"Hashcorp google provider \\uBB38\\uC11C\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC5B4\\uB5BB\\uAC8C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB294\\uC9C0 \\uC790\\uC138\\uD788 \\uC124\\uBA85\\uB418\\uC5B4 \\uC788\\uB2E4. google_kms_secret_asymmetric data source\\uB294 terraform-provider-google-beta provider\\uC5D0\\uC11C \\uC81C\\uACF5\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0 google-beta\\uB97C \\uC124\\uC815\\uD574\\uC900\\uB2E4.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"This resource is in beta, and should be used with the terraform-provider-google-beta provider. See Provider Versions for more details on beta resources.\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.tf\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  required_providers {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    google-beta = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      source = \"hashicorp/google-beta\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      version = \"6.14.1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`provider \"google\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  project = \"tutorial\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  region  = \"us-central1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`provider \"google-beta\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  project = \"tutorial\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  region  = \"us-central1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uC544\\uB798\\uCC98\\uB7FC GCP KMS\\uC5D0\\uC11C \\uBE44\\uB300\\uCE6D\\uD0A4\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD558\\uC5EC resource\\uB97C \\uC815\\uC758\\uD558\\uACE0, \\uCD5C\\uC885\\uC801\\uC73C\\uB85C local\\uD658\\uACBD\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uD560 public key\\uB97C \\uC800\\uC7A5\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"main.tf\"})}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`data \"google_kms_key_ring\" \"tutorial_keyring\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  name     = \"tutorial-keyring\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  location = \"us-central1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"google_kms_crypto_key\" \"tutorial_secret\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  name     = \"tutorial_secret\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  key_ring = data.google_kms_key_ring.tutorial_keyring.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  purpose  = \"ASYMMETRIC_DECRYPT\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  version_template {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    algorithm = \"RSA_DECRYPT_OAEP_4096_SHA256\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`data \"google_kms_crypto_key_version\" \"tutorial_secret\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  crypto_key = google_kms_crypto_key.tutorial_secret.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"local_file\" \"public_key\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:'    filename = \"${path.module}/public-key.pem\"\\n'}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    content     = data.google_kms_crypto_key_version.tutorial_secret.public_key[0].pem\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uC0DD\\uC131\\uB41C public key\\uB85C \\uC6D0\\uD558\\uB294 \\uAC12\\uC744 \\uC554\\uD638\\uD654\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" -n hello  \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  openssl pkeyutl -in - \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -encrypt \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pubin \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -inkey public-key.pem \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pkeyopt rsa_padding_mode:oaep \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pkeyopt rsa_oaep_md:sha256 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -pkeyopt rsa_mgf1_md:sha256 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        -out tutorial.enc\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB9AC\\uACE0 crc32 checksum\\uC744 \\uC800\\uC7A5\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"$HOME\"}),\"/go/bin/crc32 -polynomial castagnoli \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),` tutorial.enc\n`]})})}),(0,e.jsx)(n.p,{children:\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \\uC554\\uD638\\uD654\\uD588\\uB358 \\uAC83\\uC744 base64\\uB85C \\uC778\\uCF54\\uB529 \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"openssl base64 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  -in tutorial.enc \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  -out tutorial.enc.b64\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uB807\\uAC8C \\uACC4\\uC0B0\\uD55C base64 \\uC778\\uCF54\\uB529 \\uAC12\\uC744 ciphertext\\uC5D0 \\uC800\\uC7A5\\uD558\\uACE0, checksum\\uC744 \\uC704\\uD574\\uC11C crc32 \\uAC12\\uB3C4 \\uCD94\\uAC00\\uD574\\uC900\\uB2E4.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`data \"google_kms_secret_asymmetric\" \"secret_data\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  crypto_key_version = data.google_kms_crypto_key_version.opentofu-secret.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  crc32              = \"920961a5\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  ciphertext         = <<EOT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    UCIDSu19B3c3twcdppvPUGfu+QWtXEJdCgEru80jwW7r0Zzq1nNIEW9ZaFYGlUUT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    xreYLOF+VsIY5ejnzr0QKuU7Y/0vnZrc7RU6WBNW8R/IyrOXT8LB6e1KwfomduaI\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    4VMrx2WQxo+kaU1Tw2p6JoAKZICzoaZZg2eatMESxlxLlMIQTK6QDbtD0mOu1rzI\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    rz257/jI1FNzxLq9K3BmfxjFWCuL45QnyM0Y8Aqh0YXyVCiPQNr/GodR8JNKl/xt\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    rHAEq8YL/r1lOGCJNBsFYjcKIAUD5Ade1hVfUQGZDMNM/wcCLCOU3aHhgkaAT6xG\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    3FjZtyIYW2dnpIelHrtSxepQN4yy49qxeuKaf9Cjj6uXJsTi0bCiTw4PcD4RHOTJ\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    Gbm2QLJMr5BaiUyK0ZXHokynQg++McAiRsygeuWilInXPLpEkDcC+G0+i6Z2f3Ki\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    6kOE9edC5YHFSH4mrUeFZwdbdPgPzfP1szJ+h6jMJJt76jSDovAkwScuh2eibvRG\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    wO+O0VZaZW9WdiwX7yD4GQSkCRTZg4XQJ6TSuG+U18T33mOoQbA0DvvYcYYRMVBS\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    q3YVhbGhBwxfxFXRoWYBqyGomP33NL6cEKWnovwPf3OSPDZ8n66nqzQY18tJvr+7\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    XALVYFRpEdOCBjBa1EbB+e0LKeL8LyREq/3aGX7+X5Q=\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  EOT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  provider = google-beta\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"google_secret_manager_secret\" \"secret_data\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  secret_id = \"secret_key_name\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  replication {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    auto {}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`resource \"google_secret_manager_secret_version\" \"secret_data\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  secret = google_secret_manager_secret.secret_data.id\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  secret_data = data.google_kms_secret_asymmetric.secret_data.plaintext\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uB807\\uAC8C Secret Manager\\uC758 Secret \\uAC12\\uC744 \\uC800\\uC7A5\\uD558\\uBA74, Terraform Resource \\uC815\\uC758\\uC5D0\\uC11C \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uC791\\uC131\\uD558\\uC9C0 \\uC54A\\uACE0 runtime\\uACFC\\uC815\\uC5D0\\uC11C kms\\uC744 \\uD1B5\\uD574\\uC11C \\uBCF5\\uD638\\uD654\\uD574\\uC11C \\uC800\\uC7A5\\uD558\\uAC8C \\uB41C\\uB2E4. Git\\uC5D0\\uB294 \\uD3C9\\uC11C\\uBB38 \\uB300\\uC2E0\\uC5D0 \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uB41C \\uAC12\\uC744 \\uC800\\uC7A5\\uD558\\uBA74 \\uB41C\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uACF5\\uC2DD\\uBB38\\uC11C\\uC5D0 \\uB098\\uC628 \\uAC83\\uCC98\\uB7FC Secret\\uAC12\\uC774 log, plan, state \\uCD9C\\uB825\\uAC12\\uC5D0 \\uB178\\uCD9C\\uB418\\uB294 \\uAC83\\uC5D0 \\uB300\\uD574\\uC11C\\uB294 \\uC8FC\\uC758\\uB97C \\uD574\\uC57C \\uD55C\\uB2E4.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Using this data provider will allow you to conceal secret data within your resource definitions, but it does not take care of protecting that data in the logging output, plan output, or state output. Please take care to secure your secret data outside of resource definitions.\"})}),(0,e.jsx)(n.p,{children:'Terraform\\uC73C\\uB85C apply\\uD558\\uACE0 \\uC0DD\\uC131\\uB41C state \\uD30C\\uC77C\\uC744 \\uBCF4\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 plaintext\\uAC12\\uC774 \"hello\"\\uB85C \\uB178\\uCD9C\\uB418\\uC5B4 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.'}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property\",children:'\"attributes\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"ciphertext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"crc32\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"crypto_key_version\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\uC0DD\\uB7B5\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"plaintext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"hello\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Terraform\\uC5D0\\uC11C\\uB294 remote state\\uB85C S3\\uC640 \\uAC19\\uC740 Object Storage\\uC5D0 \\uC800\\uC7A5\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC774 \\uAC00\\uB2A5\\uD558\\uACE0, S3\\uC758 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uBB3C\\uB9AC\\uC801\\uC778 \\uACF5\\uAC04\\uC5D0 \\uC800\\uC7A5\\uB420 \\uB54C \\uC554\\uD638\\uD654\\uAC00 \\uB418\\uC5B4\\uC11C \\uC800\\uC7A5\\uB41C\\uB2E4. \\uD558\\uC9C0\\uB9CC S3\\uC5D0 \\uC800\\uC7A5\\uB418\\uB294 state \\uD30C\\uC77C object\\uB294 \\uB3D9\\uC77C\\uD558\\uAC8C \\uBE44\\uBC00\\uAC12\\uC774 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uB178\\uCD9C\\uB418\\uC5B4 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uD574\\uB2F9 \\uBE44\\uBC00\\uAC12\\uC774 \\uB178\\uCD9C\\uB418\\uC9C0 \\uC54A\\uB3C4\\uB85D S3 bucket\\uC5D0 \\uC811\\uADFC\\uC744 \\uC798 \\uAD00\\uB9AC\\uD574\\uC57C \\uD55C\\uB2E4.\"}),(0,e.jsxs)(n.h2,{id:\"opentofu-state-\\uC554\\uD638\\uD654\",children:[(0,e.jsx)(n.a,{href:\"#opentofu-state-\\uC554\\uD638\\uD654\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"OpenTofu State \\uC554\\uD638\\uD654\"]}),(0,e.jsx)(n.p,{children:\"OpenTofu\\uB97C \\uC0AC\\uC6A9\\uD560 \\uB54C\\uB294 state \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD558\\uB294 \\uC635\\uC158\\uC744 \\uC774\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uC544\\uB798\\uC640 \\uAC19\\uC774 GCP Key Management Service\\uB97C \\uD1B5\\uD574\\uC11C State \\uD30C\\uC77C\\uC744 \\uC554\\uD638\\uD654\\uD558\\uC5EC \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB2E4. Cloud Key Managerment Service\\uB97C \\uC774\\uC6A9\\uD560 \\uB54C\\uB294 \\uD0A4\\uB97C \\uC783\\uC5B4\\uBC84\\uB9B4 \\uAC00\\uB2A5\\uC131\\uC774 \\uAC70\\uC758 \\uC5C6\\uACE0, \\uC2E4\\uC218\\uB85C \\uC0AD\\uC81C\\uD558\\uB354\\uB77C\\uB3C4 \\uC77C\\uC815\\uAE30\\uAC04 \\uBCF4\\uC874\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uBCF5\\uAD6C\\uD560 \\uC218 \\uC788\\uB294 \\uC635\\uC158\\uC774 \\uC874\\uC7AC\\uD55C\\uB2E4. \\uB530\\uB77C\\uC11C State \\uD30C\\uC77C\\uC744 KMS\\uB85C \\uC554\\uD638\\uD654\\uD558\\uC5EC \\uBCF4\\uAD00\\uD560 \\uB54C, \\uD0A4\\uB97C \\uC783\\uC5B4\\uBC84\\uB824\\uC11C \\uB2E4\\uC2DC \\uBCF5\\uD638\\uD654\\uB97C \\uBABB\\uD558\\uB294 \\uBB38\\uC81C\\uC5D0 \\uB300\\uD574\\uC11C \\uB35C \\uAC71\\uC815\\uD574\\uB3C4 \\uB41C\\uB2E4\\uACE0 \\uC0DD\\uAC01\\uB41C\\uB2E4.\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-tf\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  encryption {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    key_provider \"gcp_kms\" \"basic\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      kms_encryption_key = \"KMS key \\uACBD\\uB85C \\uAC12\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      key_length = 32\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    method \"aes_gcm\" \"secure_method\" {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      keys = key_provider.gcp_kms.basic\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    method \"unencrypted\" \"migrate\" {}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    state {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      method = method.aes_gcm.secure_method\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      fallback {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        method = method.unencrypted.migrate\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  required_providers {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    google-beta = {\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      source = \"hashicorp/google-beta\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      version = \"6.14.1\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  }\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`})]})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(n.p,{children:\"GCP Secret Manager\\uC758 \\uBE44\\uBC00\\uAC12\\uC744 Terraform\\uC73C\\uB85C \\uAD00\\uB9AC\\uD560 \\uB54C, google_kms_secret_asymmetric data source\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uACF5\\uAC1C\\uD0A4\\uB85C \\uC554\\uD638\\uD654\\uB41C \\uAC12\\uC73C\\uB85C \\uCF54\\uB4DC \\uAD00\\uB9AC\\uB97C \\uD560 \\uC218 \\uC788\\uB2E4. \\uD558\\uC9C0\\uB9CC State, Output \\uAC19\\uC740 \\uACBD\\uB85C\\uB85C \\uBCF5\\uD638\\uD654\\uB41C \\uD3C9\\uC11C\\uBB38\\uC774 \\uB178\\uCD9C\\uB420 \\uC218 \\uC788\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC774\\uC810\\uC5D0 \\uB300\\uD574\\uC11C \\uC8FC\\uC758\\uB97C \\uD574\\uC57C \\uD55C\\uB2E4. Terraform\\uC758 remote state\\uB97C \\uC0AC\\uC6A9\\uD560 \\uACBD\\uC6B0\\uC5D0\\uB294 state \\uD30C\\uC77C\\uC5D0\\uB294 \\uD3C9\\uC11C\\uBB38\\uC73C\\uB85C \\uC800\\uC7A5\\uB418\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uD574\\uB2F9 \\uD30C\\uC77C\\uC774 \\uB178\\uCD9C\\uB418\\uC9C0 \\uC54A\\uB3C4\\uB85D \\uC8FC\\uC758\\uD574\\uC57C \\uD55C\\uB2E4. OpenTofu\\uB97C \\uC774\\uC6A9\\uD560 \\uACBD\\uC6B0\\uC5D0\\uB294 State \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD574\\uC11C \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB294 \\uC635\\uC158\\uC774 \\uC788\\uB2E4. Cloud Key Management Service\\uB97C \\uC774\\uC6A9\\uD558\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uD0A4\\uB97C \\uC783\\uC5B4\\uBC84\\uB824\\uC11C \\uB2E4\\uC2DC \\uBCF5\\uD638\\uD654\\uD558\\uC9C0 \\uBABB\\uD558\\uB294 \\uBB38\\uC81C\\uAC00 \\uBC1C\\uC0DD\\uD560 \\uAC00\\uB2A5\\uC131\\uC774 \\uC0C1\\uB2F9\\uD788 \\uC801\\uAE30 \\uB54C\\uBB38\\uC5D0, OpenTofu\\uB97C \\uD1B5\\uD574\\uC11C State \\uD30C\\uC77C \\uC790\\uCCB4\\uB97C \\uC554\\uD638\\uD654\\uD558\\uC5EC \\uC800\\uC7A5\\uD558\\uB294 \\uAC83\\uB3C4 \\uACE0\\uB824\\uD574\\uBCFC \\uC218 \\uC788\\uACA0\\uB2E4.\"})]})}}var f=y;return b;})();\n;return Component;","toc":[{"value":"kms_secret_asymmetric","url":"#kms_secret_asymmetric","depth":2},{"value":"OpenTofu State 암호화","url":"#opentofu-state-암호화","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.805,"time":288300,"words":961},"slug":"20250105-opentofu","fileName":"20250105-opentofu.md","title":"GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기","date":"2025-01-05T00:00:00.000Z","tags":["gcp","terraform","opentofu"],"images":["/static/images/social-banner.png"],"summary":"GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"secrets-store-csi-driver-provider-gcp 사용해보기","date":"2025-01-05T00:00:00.000Z","tags":["gcp","kubernetes"],"images":["/static/images/social-banner.png"],"summary":"GKE에서 add-on 기능으로 관리형 서비스인 Google Secret Manager을 Kubernetes Secrets Store CSI Driver로 쉽게 사용할 수 있다. 하지만 add-on 버전에서는 Sync as Kubernetes Secret 기능을 제공하지 않기 때문에, Kubernetes Secret을 환경변수로 설정하는데 제약사항이 있다. 직접 Kubernetes Secrets Store CSI driver와 GCP provider driver를 설치하여 Sync as Kubernetes Secret 기능을 사용할 수 있다. 이렇게 Sync된 Kubernetes Secret을 환경변수로 주입하도록 설정할 수 있다. Google Secret Manager는 아쉽게도 하나의 Secret에 복수의 key value를 제공하지 않는다. 이번 글에서는 Google Secret Manager를 Kubernetes Secret Object와 Sync해서 사용하는 것이 바람직할지 고민해본다.","slug":"20250105-secrets-store-csi-driver-provider-gcp"},"next":null},"__N_SSG":true}