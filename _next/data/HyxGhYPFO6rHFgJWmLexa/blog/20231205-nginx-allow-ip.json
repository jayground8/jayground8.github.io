{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=>k(i(l(a!=null?o(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var t=u((P,r)=>{r.exports=_jsx_runtime});var _={};N(_,{default:()=>b,frontmatter:()=>y});var e=g(t()),y={title:\"Kubernetes\\uC5D0\\uC11C Nginx\\uB85C IP allow list \\uC81C\\uC5B4\",date:\"2023-12-05\",tags:[\"Kubernetes\",\"Nginx\"],images:[\"/static/images/social-banner.png\"],summary:\"Kubernetes cluster\\uC5D0\\uC11C Nginx\\uB85C \\uD5C8\\uC6A9 \\uAC00\\uB2A5\\uD55C IP\\uB97C \\uC124\\uC815\\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. \\uAC04\\uB2E8\\uD558\\uAC8C \\uB05D\\uB0A0 \\uC904 \\uC54C\\uC558\\uB358 \\uC791\\uC5C5\\uC740 \\uB610\\uB2E4\\uB978 \\uC0BD\\uC9C8\\uAE30\\uAC00 \\uB418\\uC5C8\\uB2E4.\\u{1F62D} Kubernetes\\uC5D0\\uC11C SNAT\\uC774 \\uB418\\uB294 \\uACFC\\uC815\\uC744 \\uC774\\uD574\\uD558\\uACE0 externalTrafficPolicy\\uB97C Local\\uB85C \\uC124\\uC815\\uD588\\uB2E4. \\uADF8\\uB9AC\\uACE0 External Load balancer\\uC5D0\\uC11C\\uB294 client IP\\uB97C \\uC804\\uB2EC\\uD558\\uAE30 \\uC704\\uD574\\uC11C Proxy Protocol\\uC640 \\uAC19\\uC740 \\uAC83\\uC744 \\uC124\\uC815\\uD558\\uACE0, Nginx\\uC5D0\\uC11C \\uADF8 Proxy protocol\\uB85C \\uC804\\uB2EC\\uB41C IP address\\uB85C Access control\\uC744 \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"};function x(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",pre:\"pre\",code:\"code\",blockquote:\"blockquote\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"nginx-allow-ip-address\",children:[(0,e.jsx)(n.a,{href:\"#nginx-allow-ip-address\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Nginx allow IP address\"]}),(0,e.jsxs)(n.p,{children:[\"Kubernetes cluster\\uC5D0\\uC11C Nginx\\uB97C \\uD1B5\\uD574\\uC11C \\uD5C8\\uC6A9\\uB41C IP\\uB85C\\uB9CC \\uC811\\uADFC \\uAC00\\uB2A5\\uD558\\uAC8C \\uAD6C\\uC131\\uD558\\uACE0 \\uC2F6\\uC5C8\\uB2E4. Nginx\\uC758 \",(0,e.jsx)(n.a,{href:\"https://nginx.org/en/docs/http/ngx_http_access_module.html\",children:\"http_access_module\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \\uAC04\\uB2E8\\uD558\\uAC8C IP allow list\\uB098 deny list\\uB97C \\uC14B\\uD305\\uD560 \\uC218 \\uC788\\uC744 \\uAC83\\uC774\\uB77C \\uAE30\\uB300\\uB97C \\uD588\\uB2E4. \\uB530\\uB77C\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 Kubernetes object\\uB97C \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uD14C\\uC2A4\\uD2B8\\uB97C \\uD574\\uBCF4\\uC558\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ConfigMap\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"clone\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nginx.conf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    user nginx;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    worker_processes  auto;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    error_log  /var/log/nginx/error.log;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    events {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      worker_connections  1024;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    }\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`    http {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      log_format  main\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'remote_addr:$remote_addr\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'time_local:$time_local\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'method:$request_method\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'uri:$request_uri\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'host:$host\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'status:$status\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'bytes_sent:$body_bytes_sent\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'referer:$http_referer\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'useragent:$http_user_agent\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'forwardedfor:$http_x_forwarded_for\\\\t'\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`              'request_time:$request_time';\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      access_log /dev/stdout main;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      server {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        listen 80 default_server;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        location / {\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          allow 40.150.119.175;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          deny all;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          proxy_pass http://example.com/;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`          proxy_http_version 1.1;\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`        }\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string scalar\",children:`      }\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string scalar\",children:\"    }\"}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /etc/nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /var/log/nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` log\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"configMap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"clone\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"items\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"key\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx.conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"path\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx.conf\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` log\n`]})]})}),(0,e.jsx)(n.p,{children:\"Naver Cloud\\uC758 Network Proxy Loadbalancer\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD558\\uC5EC \\uC544\\uB798\\uCC98\\uB7FC annotation\\uC744 \\uC815\\uC758\\uD558\\uC600\\uB2E4. Network Proxy Load balancer\\uC5D0\\uC11C TLS termination\\uC744 \\uD558\\uACE0, upstream\\uC5D0\\uB294 http\\uB85C \\uC811\\uADFC\\uC744 \\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-layer-type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nplb\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-ssl-certificate-no\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'8857'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-tls-ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'443'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-tls-min-version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` TLSV10\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` LoadBalancer\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"443\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"targetPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:\"allow 40.150.119.175;\"}),\" \\uC815\\uC758\\uB41C \\uAC83\\uCC98\\uB7FC \\uC811\\uC18D\\uD558\\uB294 client IP\\uAC00 \",(0,e.jsx)(n.code,{children:\"40.150.119.175\"}),\"\\uC778\\uB370, 403 response\\uB97C \\uBC1B\\uC558\\uB2E4. stdout\\uC73C\\uB85C \\uC124\\uC815\\uD55C access log\\uB97C \\uD655\\uC778\\uD574\\uBCF4\\uB2C8 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uAC00 Kubernetes cluster \\uB0B4\\uBD80\\uC758 IP address\\uB85C \\uCC0D\\uD614\\uB2E4. (\\uC608 \",(0,e.jsx)(n.code,{children:\"192.18.7.140\"}),\", \",(0,e.jsx)(n.code,{children:\"192.18.0.55\"}),\") \\uACE0\\uBBFC\\uD574\\uBCF4\\uB2C8 Kubernetes\\uC5D0\\uC11C\\uB294 kube-proxy\\uAC00 SNAT\\uC744 \\uD558\\uB294 \\uBD80\\uBD84\\uC774 \\uC0DD\\uAE38 \\uC218 \\uC788\\uB2E4\\uB77C\\uB294 \\uAC83\\uC774 \\uC0DD\\uAC01\\uB0AC\\uB2E4. Node port\\uB098 Load Balancer type\\uC758 \\uC11C\\uBE44\\uC2A4\\uC5D0 \\uC811\\uADFC\\uD560 \\uB54C, Worker node\\uC758 port\\uB85C \\uC811\\uADFC\\uD558\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB7F0\\uB370 \\uC811\\uADFC\\uD558\\uB294 Worker node\\uC5D0 \\uD1B5\\uC2E0\\uD558\\uB824\\uB294 Pod\\uAC00 \\uC788\\uC744 \\uC218\\uB3C4 \\uC788\\uACE0 \\uC5C6\\uC744 \\uC218\\uB3C4 \\uC788\\uB2E4. \\uC5C6\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB3C4 kube-proxy\\uB97C \\uD1B5\\uD574\\uC11C \\uC788\\uB294 Node \\uCABD\\uC73C\\uB85C routing\\uC774 \\uB420 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 Iptable\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uACBD\\uC6B0\\uC5D0\\uB294 \\uC544\\uB798\\uCC98\\uB7FC traffic\\uC744 random\\uD558\\uAC8C \\uBD84\\uBC30\\uD574\\uC904 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB798\\uC11C pod\\uAC00 \\uC5EC\\uB7EC \\uAC1C \\uC788\\uC744 \\uB54C kube-proxy\\uB97C \\uD1B5\\uD574\\uC11C load balancing\\uB3C4 \\uB41C\\uB2E4. \\uADF8\\uB7EC\\uB294 \\uACFC\\uC815\\uC5D0\\uC11C SNAT\\uC73C\\uB85C client ip\\uAC00 \\uC720\\uC2E4 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" iptables -t nat -A OUTPUT -d \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.99\"}),\".99.32 -j DNAT --to-destination \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.244\"}),`.15.196\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" iptables -t nat -A OUTPUT -p tcp -d \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.99\"}),\".99.32 --dport \",(0,e.jsx)(n.span,{className:\"token number\",children:\"27017\"}),\" -m statistic --mode random --probability \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.50000000000\"}),\" -j DNAT --to-destination \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.244\"}),`.14.195:8090\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" iptables -t nat -A OUTPUT -p tcp -d \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.99\"}),\".99.32 --dport \",(0,e.jsx)(n.span,{className:\"token number\",children:\"27017\"}),\" -j DNAT --to-destination \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10.244\"}),`.14.196:8090\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uAE30\\uBCF8\\uC801\\uC73C\\uB85C \",(0,e.jsx)(n.code,{children:\"service.spec.externalTrafficPolicy\"}),\"\\uB294 Cluster\\uB85C \\uC124\\uC815\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4. \\uC704\\uC5D0\\uC11C \\uC124\\uBA85\\uD55C \\uAC83\\uCC98\\uB7FC \\uC791\\uB3D9\\uC774 \\uB41C\\uB2E4. \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC\\uC5D0\\uC11C\\uB294 CNI\\uB85C cilium\\uC744 \\uC4F0\\uACE0 \\uC788\\uB294\\uB370, access log\\uC5D0 \\uCC0D\\uD614\\uB358 \",(0,e.jsx)(n.code,{children:\"192.18.7.140\"}),\", \",(0,e.jsx)(n.code,{children:\"192.18.0.55\"}),\"\\uB294 cilium host ip\\uC600\\uB2E4. \",(0,e.jsx)(n.code,{children:\"kubectl describe node\"}),\"\\uB97C \\uBCF4\\uB2C8 \",(0,e.jsx)(n.code,{children:\"io.cilium.network.ipv4-cilium-host\"}),\" annotation\\uC774 \\uBD99\\uC5B4 \\uC788\\uC5C8\\uACE0, \\uC774 \\uAC12\\uC774 log\\uC5D0 \\uCC0D\\uD614\\uB358 IP address\\uC600\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB7FC \\uC774\\uC81C client ip\\uB97C \\uC720\\uC9C0\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,e.jsx)(n.code,{children:\"service.spec.externalTrafficPolicy\"}),\"\\uB97C Local\\uB85C \\uBCC0\\uACBD\\uD558\\uC600\\uB2E4. \\uC774\\uC81C Load balancer\\uC758 CIDR\\uC758 IP address\\uAC00 access log\\uC5D0 \\uCC0D\\uD788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"Local\"}),\"\\uB85C \\uD588\\uC744 \\uB54C\\uB294 \\uC774\\uC81C \\uC5F0\\uACB0\\uB41C Node\\uB0B4\\uC758 pod endpoint\\uB9CC \\uC811\\uC18D\\uC744 \\uC2DC\\uB3C4\\uD558\\uACE0 \\uC5C6\\uC73C\\uBA74 packet\\uC774 drop\\uB41C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"Load balancer\"}),\" type\\uC73C\\uB85C \\uC11C\\uBE44\\uC2A4\\uB97C \\uC0DD\\uC131\\uD558\\uACE0, Node\\uAC00 \\uC138 \\uAC1C\\uB77C\\uACE0 \\uD55C\\uB2E4\\uACE0 \\uD558\\uBA74 Load balancer\\uC758 Target\\uC73C\\uB85C \\uC138 \\uAC1C\\uC758 Node\\uAC00 \\uBD99\\uC744 \\uAC83\\uC774\\uB2E4. \\uADF8\\uB7F0\\uB370 service\\uC758 endpoint\\uAC00 \\uD558\\uB098\\uB9CC \\uC874\\uC7AC\\uD55C\\uB2E4\\uACE0 \\uD558\\uBA74(running\\uC911\\uC778 pod\\uAC00 \\uD558\\uB098\\uB77C\\uBA74), \\uADF8 pod\\uAC00 \\uC788\\uB294 Node\\uC740 health check\\uB97C \\uC131\\uACF5\\uD558\\uACE0 \\uB098\\uBA38\\uC9C0 Node\\uC5D0\\uC11C\\uB294 \\uC2E4\\uD328\\uD55C\\uB2E4. Load balancer\\uC5D0\\uC11C healthy\\uD55C Node\\uC5D0\\uB9CC traffic\\uC744 \\uBCF4\\uB0B4\\uAE30 \\uB54C\\uBB38\\uC5D0, \",(0,e.jsx)(n.code,{children:\"Local\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uC5EC\\uB3C4 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uD2B8\\uB798\\uD53D\\uC744 \\uC804\\uB2EC\\uD560 \\uC218\\uAC00 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \\uC544\\uC9C1\\uB3C4 \\uBB38\\uC81C\\uAC00 \\uC788\\uB2E4. Load balancer\\uC758 IP address\\uB294 \\uCD5C\\uCD08\\uC758 \\uC694\\uCCAD\\uD558\\uB294 client IP\\uAC00 \\uC544\\uB2C8\\uAE30 \\uB54C\\uBB38\\uC5D0 \",(0,e.jsx)(n.code,{children:\"allow 40.150.119.175;\"}),\"\\uB97C \\uB9CC\\uC871\\uD558\\uC9C0 \\uC54A\\uB294\\uB2E4. \\uB3D9\\uC77C\\uD558\\uAC8C 403 \\uC5D0\\uB7EC\\uAC00 \\uBC1C\\uC0DD\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"x-forwared-for--proxy-protocol\",children:[(0,e.jsx)(n.a,{href:\"#x-forwared-for--proxy-protocol\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"X-Forwared-For & Proxy Protocol\"]}),(0,e.jsxs)(n.p,{children:[\"source ip\\uB97C \\uC804\\uB2EC\\uD558\\uB294 \\uBC29\\uBC95\\uC73C\\uB85C Header\\uC5D0 \",(0,e.jsx)(n.code,{children:\"X-Forwarded-For\"}),\", \",(0,e.jsx)(n.code,{children:\"X-Real-IP\"}),\"\\uC5D0 hop\\uD558\\uB294 Ip address\\uB97C \\uB2F4\\uC544\\uC11C \\uBCF4\\uB0B4\\uB294 \\uAC83\\uB3C4 \\uC788\\uACE0, L4\\uC5D0\\uC11C \\uC804\\uB2EC\\uD560 \\uB54C Proxy Protocol\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC804\\uB2EC\\uD560 \\uC218\\uB3C4 \\uC788\\uB2E4. \\uC774\\uC81C \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC Load balancer\\uC5D0\\uC11C\\uB3C4 proxy protocol\\uB97C \\uC9C0\\uC6D0\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uC544\\uB798\\uCC98\\uB7FC annotation\\uC744 \\uCD94\\uAC00\\uD558\\uC5EC source ip\\uB97C \\uC804\\uB2EC\\uD558\\uB3C4\\uB85D \\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`clone\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"service.beta.kubernetes.io/ncloud-load-balancer-proxy-protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'true'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 Nginx\\uC5D0\\uC11C Proxy protocol\\uC744 \\uBC1B\\uC744 \\uC218 \\uC788\\uACE0, \\uADF8\\uAC83\\uC744 access log\\uC5D0 \\uBCF4\\uC5EC \\uC904 \\uC218 \\uC788\\uB3C4\\uB85D \\uC218\\uC815\\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"$proxy_protocol_add\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C source ip\\uB97C \\uBCF4\\uC5EC\\uC904 \\uC218 \\uC788\\uACE0, proxy protocol\\uC744 accept\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \",(0,e.jsx)(n.code,{children:\"listen 80 proxy_protocol\"}),\"\\uB85C \\uC815\\uC758\\uB97C \\uD574\\uC900\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"http \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  log_format  main\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'remote_addr:$remote_addr\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'time_local:$time_local\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'method:$request_method\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'uri:$request_uri\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'host:$host\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'status:$status\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'bytes_sent:$body_bytes_sent\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'referer:$http_referer\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'useragent:$http_user_agent\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'forwardedfor:$http_x_forwarded_for\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'proxy_addr:$proxy_protocol_addr\\\\t'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'request_time:$request_time'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  access_log /dev/stdout main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    listen \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),\" proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    location / \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uB807\\uAC8C \\uD574\\uC8FC\\uBA74 \\uB420 \\uC904 \\uC54C\\uC558\\uC9C0\\uB9CC, \\uC5EC\\uC804\\uD788 403\\uB97C \\uBC49\\uC5B4 \\uB0B4\\uC5C8\\uB2E4. \\u{1F62D}\\u{1F62D} \",(0,e.jsx)(n.code,{children:\"$proxy_protocol_addr\"}),\"\\uB294 \\uC774\\uC81C client Ip\\uAC00 \\uCC0D\\uD614\\uC9C0\\uB9CC, \\uC5EC\\uC804\\uD788 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uB294 Load balancer\\uC758 Ip\\uAC00 \\uCC0D\\uD614\\uB2E4. \\uADF8\\uB798\\uC11C \\uC21C\\uAC04 Lua\\uB85C module\\uC744 \\uB9CC\\uB4E4\\uC5B4\\uC11C \\uD574\\uB2F9 \\uC815\\uBCF4\\uB97C \\uBB54\\uAC00 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uC5D0 \\uC124\\uC815\\uD574\\uC918\\uC57C \\uD558\\uB294\\uAC74\\uAC00 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"nginx-ingress-controller\",children:[(0,e.jsx)(n.a,{href:\"#nginx-ingress-controller\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Nginx Ingress Controller\"]}),(0,e.jsxs)(n.p,{children:[\"\\uB9C8\\uCE68 \",(0,e.jsx)(n.code,{children:\"Nginx Ingress Controller\"}),\"\\uB3C4 \\uAC19\\uC774 \\uD14C\\uC2A4\\uD2B8\\uD574\\uBCF4\\uACE0 \\uC788\\uB294 \\uC0C1\\uD669\\uC774\\uC5B4\\uC11C \",(0,e.jsx)(n.code,{children:\"Nginx Ingress Controller\"}),\"\\uC5D0\\uC11C\\uB294 Proxy protocol\\uB85C \\uBCF4\\uB0B8 client ip\\uB85C allow list \\uD655\\uC778\\uC744 \\uC5B4\\uB5BB\\uAC8C \\uD558\\uB294\\uC9C0 \\uCC3E\\uC544\\uBCF4\\uAE30 \\uC2DC\\uC791\\uD588\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://github.com/kubernetes/ingress-nginx/issues/4305\",children:\"Nginx Ingress Controller \\uAE43\\uD5D9\\uC758 \\uC774\\uC288\"}),\"\\uC5D0\\uC11C \\uC0AC\\uBB34\\uC2E4 IP CIDR\\uB85C \\uC811\\uADFC \\uC81C\\uC5B4\\uAC00 \\uB418\\uC5C8\\uB2E4\\uB77C\\uB294 \\uC774\\uC57C\\uAE30\\uAC00 \\uB098\\uC654\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[\"Nginx Ingress Controller\\uC758 Resource\\uB4E4\\uC744 \\uB9CC\\uB4E4\\uB54C, ConfigMap\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"use-proxy-protocol\"}),\"\\uC744 \",(0,e.jsx)(n.code,{children:\"true\"}),\"\\uB85C \\uC124\\uC815\\uC744 \\uD574\\uC92C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"allow-snippet-annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"use-proxy-protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ConfigMap\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/component\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` controller\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/instance\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/part-of\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app.kubernetes.io/version\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` 1.8.2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`controller\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ingress\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uADF8\\uB9AC\\uACE0 Ingress\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uC774 annotation\\uC744 \\uCD94\\uAC00\\uD558\\uC5EC Ip allow list\\uB97C \\uC124\\uC815\\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"language-yaml code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` networking.k8s.io/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Ingress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" nginx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`ingress\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kubernetes.io/ingress.class\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'nginx'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"nginx.ingress.kubernetes.io/whitelist-source-range\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'40.150.119.175'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uB9CC\\uB4E4\\uC5B4\\uC9C4 Load balancer\\uC758 proxy protocol \\uC124\\uC815\\uC744 enable\\uD574\\uC8FC\\uACE0, \\uC811\\uC18D\\uD558\\uB2C8\\uAE50 \\uC774\\uC81C \\uB4DC\\uB514\\uC5B4 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC811\\uC18D\\uC774 \\uB418\\uC5C8\\uB2E4. \",(0,e.jsx)(n.code,{children:\"whitelist-source-range\"}),\"\\uB97C \\uBCC0\\uACBD\\uD558\\uB2C8\\uAE50 \\uC774\\uC81C \\uB2E4\\uC2DC 403 \\uC5D0\\uB7EC\\uB97C \\uB9AC\\uD134 \\uBC1B\\uC558\\uB2E4. \\u{1F642}\"]}),(0,e.jsxs)(n.h2,{id:\"nginxconf-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{href:\"#nginxconf-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Nginx.conf \\uD655\\uC778\"]}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB798\\uC11C \\uC774\\uC81C \\uC774\\uACFC\\uC815\\uC5D0\\uC11C \\uB9CC\\uB4E4\\uC5B4\\uC9C4 nginx pod\\uC5D0 \\uC811\\uC18D\\uD558\\uC5EC \",(0,e.jsx)(n.code,{children:\"nginx.conf\"}),\" \\uAC12\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4. \\uCC98\\uC74C\\uC5D0 Lua script\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294\\uAC8C \\uBCF4\\uC5EC\\uC11C, Lua script\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uD574\\uACB0\\uD55C \\uAC83\\uC778\\uAC00 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uCB49 \\uC0B4\\uD3B4\\uBCF4\\uB2E4\\uAC00 \\uC544\\uB798\\uC758 \\uC124\\uC815\\uB4E4\\uC744 \\uBCF4\\uAC8C \\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"real_ip_header      proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"real_ip_recursive   on\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uBB54\\uAC00 \",(0,e.jsx)(n.code,{children:\"\\uC544\\uD558!\"}),\"\\uD558\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uACE0, \",(0,e.jsx)(n.a,{href:\"https://nginx.org/en/docs/http/ngx_http_realip_module.html\",children:\"Nginx http_realip_module\"}),\"\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uB2C8 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Defines the request header field whose value will be used to replace the client address.\"})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uB290\\uB08C\\uC774 \\uC640\\uC11C \\uC2E0\\uB098\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uCD94\\uAC00\\uD588\\uC9C0\\uB9CC, \\uC5EC\\uC804\\uD788 403 \\uC5D0\\uB7EC\\uB97C \\uB9AC\\uD134\\uD588\\uB2E4. \\u{1F607}\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"http \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  real_ip_header proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC880\\uB354 \",(0,e.jsx)(n.code,{children:\"nginx.conf\"}),\"\\uB97C \\uBCF4\\uB2C8 \",(0,e.jsx)(n.code,{children:\"set_real_ip_from\"}),\"\\uAC00 \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4. \\uC774\\uC81C \\uC544\\uB798\\uCC98\\uB7FC \\uC124\\uC815\\uD558\\uACE0 \\uB098\\uB2C8 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C allow list\\uC5D0 \\uC801\\uC6A9\\uB418\\uC5B4 \\uB370\\uC774\\uD130\\uB97C \\uBC1B\\uC544\\uC654\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.code,{children:\"$remote_addr\"}),\"\\uC5D0\\uB3C4 client ip\\uAC00 \\uCC0D\\uD788\\uAC8C \\uB418\\uC5C8\\uB2E4. \\u{1F62D}\\u{1F62D}\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"http \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  real_ip_header proxy_protocol\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  real_ip_recursive on\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  set_real_ip_from \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.0\"}),\".0.0/0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uC81C \",(0,e.jsx)(n.code,{children:\"set_real_ip_from\"}),\"\\uC740 load balancer\\uAC00 internal\\uD558\\uAC8C \\uB9CC\\uB4E4\\uC5B4\\uC9C0\\uB294 IP address\\uB97C \\uC54C\\uACE0 \\uC788\\uC73C\\uB2C8\\uAE50, \",(0,e.jsx)(n.code,{children:\"0.0.0.0/0\"}),\" \\uB300\\uC2E0\\uC5D0 \",(0,e.jsx)(n.code,{children:\"10.200.5.0/24\"}),\"\\uCC98\\uB7FC \\uB123\\uC5B4\\uC11C \\uB9C8\\uBB34\\uB9AC\\uB97C \\uD588\\uB2E4.\"]})]})}}var b=x;return _;})();\n;return Component;","toc":[{"value":"Nginx allow IP address","url":"#nginx-allow-ip-address","depth":2},{"value":"X-Forwared-For & Proxy Protocol","url":"#x-forwared-for--proxy-protocol","depth":2},{"value":"Nginx Ingress Controller","url":"#nginx-ingress-controller","depth":2},{"value":"Nginx.conf 확인","url":"#nginxconf-확인","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.425,"time":445500,"words":1485},"slug":"20231205-nginx-allow-ip","fileName":"20231205-nginx-allow-ip.md","title":"Kubernetes에서 Nginx로 IP allow list 제어","date":"2023-12-05T00:00:00.000Z","tags":["Kubernetes","Nginx"],"images":["/static/images/social-banner.png"],"summary":"Kubernetes cluster에서 Nginx로 허용 가능한 IP를 설정하고 싶었다. 간단하게 끝날 줄 알았던 작업은 또다른 삽질기가 되었다.😭 Kubernetes에서 SNAT이 되는 과정을 이해하고 externalTrafficPolicy를 Local로 설정했다. 그리고 External Load balancer에서는 client IP를 전달하기 위해서 Proxy Protocol와 같은 것을 설정하고, Nginx에서 그 Proxy protocol로 전달된 IP address로 Access control을 할 수 있도록 설정하였다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.155,"time":9300,"words":31},"slug":["default"],"fileName":"default.md","name":"Jaemyun Lee","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"CNAME flattening","date":"2023-11-22T00:00:00.000Z","tags":["DNS"],"images":["/static/images/social-banner.png"],"summary":"CNAME flattening이 어떻게 작동하고, 왜 사용하게 되었는지 이해하게 되었다.","slug":"20231122-cname-flattening"},"next":null},"__N_SSG":true}