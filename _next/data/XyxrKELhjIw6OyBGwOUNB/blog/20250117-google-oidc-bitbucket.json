{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=>i(a,\"__esModule\",{value:!0});var m=(a,c)=>()=>(c||a((c={exports:{}}).exports,c),c.exports),k=(a,c)=>{t(a);for(var s in c)i(a,s,{get:c[s],enumerable:!0})},N=(a,c,s)=>{if(c&&typeof c==\"object\"||typeof c==\"function\")for(let n of p(c))!h.call(a,n)&&n!==\"default\"&&i(a,n,{get:()=>c[n],enumerable:!(s=d(c,n))||s.enumerable});return a},b=a=>N(t(i(a!=null?r(u(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((f,l)=>{l.exports=_jsx_runtime});var C={};k(C,{default:()=>_,frontmatter:()=>g});var e=b(o()),g={title:\"Bitbucket OIDC with GCP\",date:\"2025-01-17\",tags:[\"gcp\",\"oidc\",\"bitbucket\"],images:[\"/static/images/social-banner.png\"],summary:\"Bitbucket OIDC\\uB97C \\uC774\\uC6A9\\uD558\\uC5EC GCP \\uB9AC\\uC18C\\uC2A4\\uB97C \\uC811\\uADFC\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC124\\uBA85\\uD55C\\uB2E4. Bitbucket Pipeline\\uC73C\\uB85C GCP \\uB9AC\\uC18C\\uC2A4\\uB97C \\uBC30\\uD3EC/\\uBCC0\\uACBD\\uD560 \\uB54C OIDC\\uB97C \\uD1B5\\uD574\\uC11C \\uC784\\uC2DC Credential\\uB97C \\uBC1C\\uAE09\\uD560 \\uC218 \\uC788\\uB2E4. \\uB2E4\\uB978 \\uC0AC\\uB78C\\uC774 \\uB3D9\\uC77C\\uD55C \\uC791\\uC5C5\\uC744 \\uD560 \\uB54C, \\uC0BD\\uC9C8\\uD558\\uC9C0 \\uC54A\\uB3C4\\uB85D \\uC644\\uC804\\uD55C \\uC608\\uC81C\\uB97C \\uACF5\\uC720\\uD558\\uACE0\\uC790 \\uC791\\uC131\\uD55C\\uB2E4.\"};function y(a={}){let{wrapper:c}=a.components||{};return c?(0,e.jsx)(c,Object.assign({},a,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",blockquote:\"blockquote\",pre:\"pre\",code:\"code\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"\\uC774\\uBC88\\uC5D0\\uB294 Bitbucket Pipeline\\uB97C \\uC774\\uC6A9\\uD560 \\uB54C OIDC\\uB97C \\uD1B5\\uD574\\uC11C GCP Resource\\uC5D0 \\uC811\\uADFC\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC124\\uBA85\\uD55C\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://github.com/GoogleCloudPlatform/gcp-bitbucket-wif\",children:\"Bitbucket OIDC\\uB97C \\uD1B5\\uD574\\uC11C GCP\\uC5D0 \\uC811\\uADFC\\uD558\\uB294 \\uC608\\uC81C\"}),\"\\uB97C \\uCC38\\uACE0\\uD558\\uC5EC \\uC124\\uC815\\uC744 \\uC644\\uB8CC\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.h2,{id:\"workload-identity-pool-\\uC0DD\\uC131\",children:[(0,e.jsx)(n.a,{href:\"#workload-identity-pool-\\uC0DD\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"workload identity pool \\uC0DD\\uC131\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"A workload identity pool is an entity that lets you manage external identities.\"})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud iam workload-identity-pools create bitbucket-pool \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--location\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"global\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--display-name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"bitbucket-pool\"'}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"bitbucket-oidc-\\uC124\\uC815\\uAC12\\uB4E4-\\uD655\\uC778\",children:[(0,e.jsx)(n.a,{href:\"#bitbucket-oidc-\\uC124\\uC815\\uAC12\\uB4E4-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"bitbucket OIDC \\uC124\\uC815\\uAC12\\uB4E4 \\uD655\\uC778\"]}),(0,e.jsxs)(n.p,{children:[\"Bitbucket Repository \\uD654\\uBA74\\uC5D0\\uC11C \\uC67C\\uCABD \\uC544\\uB798 \",(0,e.jsx)(n.code,{children:\"Repository settings\"}),\" \\uBA54\\uB274\\uB97C \\uD074\\uB9AD\\uD558\\uBA74, \\uC544\\uB798\\uC640 \\uAC19\\uC774 OpenID Connect\\uB77C\\uB294 \\uBA54\\uB274\\uC5D0 \\uC811\\uADFC\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/bitbucket-settings-oidc.png\",alt:\"bitbucket oidc settings\"}),(0,e.jsxs)(n.p,{children:[\"issuer-uri\\uC640 allowed-audiences \\uC124\\uC815\\uAC12\\uC744 \\uC704\\uC5D0\\uC11C \\uD655\\uC778\\uD55C \\uAC12\\uC73C\\uB85C \\uC124\\uC815\\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(n.a,{href:\"https://cloud.google.com/iam/docs/workload-identity-federation#mapping\",children:\"attribute-mapping\\uC740 GCP \\uBB38\\uC11C\\uC5D0 \\uC124\\uBA85\\uD55C \\uB300\\uB85C\"}),\" \\uC124\\uC815\\uC744 \\uD55C\\uB2E4. Bitbucket\\uC5D0\\uC11C \\uBC1C\\uAE09\\uD558\\uB294 Token\\uC758 payload\\uC5D0 sub, workspaceUuid, respositoryUuid\\uB4F1\\uC774 claims\\uB85C \\uC800\\uC7A5\\uB418\\uC5B4 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://support.atlassian.com/bitbucket-cloud/docs/integrate-pipelines-with-resource-servers-using-oidc/\",children:\"\\uC774 \\uAE00\\uC744 \\uD655\\uC778\\uD558\\uBA74 \\uC5B4\\uB5A4 claims\\uB4E4\\uC774 \\uC788\\uB294\\uC9C0 \\uC608\\uC81C\\uB97C \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),\" custom attribute\\uB85C attribute.repository_uuid\\uB97C \\uC124\\uC815\\uD588\\uB294\\uB370, \\uD574\\uB2F9 attribute\\uB85C \\uD2B9\\uC815 repository\\uB9CC \\uAD8C\\uD55C\\uC744 \\uBC1B\\uC744 \\uC218 \\uC788\\uAC8C \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud iam workload-identity-pools providers create-oidc bitbucket-provider \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--location\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"global\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--workload-identity-pool\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"bitbucket-pool\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--issuer-uri\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"https://api.bitbucket.org/2.0/workspaces/myworkspace/pipelines-config/identity/oidc\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--allowed-audiences\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"ari:cloud:bitbucket::workspace/31c366db-0cb6-454a-8c0a-6d174be5c298\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--attribute-mapping\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.subject=assertion.sub,attribute.workspace_uuid=assertion.workspaceUuid,attribute.repository_uuid=assertion.repositoryUuid\"'}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"service-account-\\uC0DD\\uC131-\\uBC0F-\\uAD8C\\uD55C-\\uBD80\\uC5EC\",children:[(0,e.jsx)(n.a,{href:\"#service-account-\\uC0DD\\uC131-\\uBC0F-\\uAD8C\\uD55C-\\uBD80\\uC5EC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Service Account \\uC0DD\\uC131 \\uBC0F \\uAD8C\\uD55C \\uBD80\\uC5EC\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`gcloud iam service-accounts create bitbucket-sa\n`})})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uBC88 \\uC608\\uC81C\\uC5D0\\uC11C\\uB294 GCP Artifact Registry\\uC5D0 Container Image\\uB97C push\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D Role\\uC744 \\uBD80\\uC5EC\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud artifacts repositories add-iam-policy-binding \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"${REPO_NAME}\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--location us-west1 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--member serviceAccount:bitbucket-sa@\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"${MY_PRJ_NAME}\"}),\".iam.gserviceaccount.com \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`--role roles/artifactregistry.writer\n`})]})}),(0,e.jsxs)(n.h2,{id:\"repository\\uBCC4\\uB85C-role-binding\",children:[(0,e.jsx)(n.a,{href:\"#repository\\uBCC4\\uB85C-role-binding\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Repository\\uBCC4\\uB85C role binding\"]}),(0,e.jsxs)(n.p,{children:[\"\\uC704\\uC5D0\\uC11C custom attribute \",(0,e.jsx)(n.code,{children:\"resposiory_uuid\"}),\"\\uB97C \\uCD94\\uAC00\\uD588\\uC5C8\\uB2E4. \\uB530\\uB77C\\uC11C \\uD2B9\\uC815 Bitbucket Repository\\uC758 UUID\\uC640 \\uB3D9\\uC77C\\uD55C \\uACBD\\uC6B0\\uC5D0\\uB9CC Service Account impersonation\\uC73C\\uB85C Access Token\\uC744 \\uBC1C\\uAE09\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uD55C\\uB2E4. \\uC5EC\\uAE30\\uC11C \\uC8FC\\uC758\\uD574\\uC57C\\uD560 \\uC810\\uC740 repository_uuid\\uAC00 \",(0,e.jsx)(n.code,{children:\"{}\"}),\"\\uB3C4 \\uD3EC\\uD568\\uB41C\\uB2E4\\uB294 \\uC810\\uC774\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"gcloud iam service-accounts add-iam-policy-binding \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--role roles/iam.serviceAccountTokenCreator \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"--member \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"principalSet://iam.googleapis.com/projects/',(0,e.jsx)(n.span,{className:\"token variable\",children:\"${MY_PRJ_ID}\"}),'/locations/global/workloadIdentityPools/bitbucket-pool/attribute.repository_uuid/{02ac571e-4a7f-415a-bc5a-10fec861d9a6}\"']}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"bitbucket-sa@\",(0,e.jsx)(n.span,{className:\"token variable\",children:\"${MY_PRJ_NAME}\"}),`.iam.gserviceaccount.com\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"bitbucket-pipeline-yaml-\\uC791\\uC131\",children:[(0,e.jsx)(n.a,{href:\"#bitbucket-pipeline-yaml-\\uC791\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Bitbucket Pipeline YAML \\uC791\\uC131\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"bitbucket-pipelines.yml\"}),\"\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC791\\uC131\\uD55C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"BITBUCKET_STEP_OIDC_TOKEN\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD558\\uB824\\uBA74 \",(0,e.jsx)(n.code,{children:\"oidc: true\"}),\"\\uB97C \\uC124\\uC815\\uD574\\uC57C \\uD55C\\uB2E4. \\uC704\\uC5D0\\uC11C IAM Policy Binding\\uC744 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC9C4\\uD589\\uD558\\uC9C0 \\uC54A\\uC73C\\uBA74, Access Token\\uC744 \\uBC1C\\uAE09\\uD558\\uC9C0 \\uBABB\\uD558\\uC5EC \\uC5D0\\uB7EC\\uAC00 \\uBC1C\\uC0DD\\uD55C\\uB2E4. \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC124\\uC815\\uC774 \\uC644\\uB8CC\\uB418\\uC5C8\\uB2E4\\uBA74 Artifact Repository\\uC5D0 \\uC0C8\\uB85C \\uBE4C\\uB4DC\\uB41C \\uCEE8\\uD14C\\uC774\\uB108 \\uC774\\uBBF8\\uC9C0\\uB97C Push\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"pipelines\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"branches\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"step\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Example\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"oidc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" google/cloud\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sdk\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"script\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" echo $\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_STEP_OIDC_TOKEN\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"}),` /tmp/gcp_access_token.out\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" gcloud iam workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"pools create\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cred\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"config projects/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_ID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/locations/global/workloadIdentityPools/bitbucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"pool/providers/bitbucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"provider \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"service\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),'account=\"bitbucket',(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"sa@$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),'.iam.gserviceaccount.com\" ',(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"output\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"file=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_CLONE_DIR\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/gcp_temp_cred.json \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"credential\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`file=/tmp/gcp_access_token.out\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" gcloud auth login \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"cred\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"file=$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_CLONE_DIR\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`/gcp_temp_cred.json\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" gcloud auth configure\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker us\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"west1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker.pkg.dev \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`quiet\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" docker build \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"t us\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"west1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker.pkg.dev/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"REPO_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/tutorial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_COMMIT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),` .\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" docker push us\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"west1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"docker.pkg.dev/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"MY_PRJ_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"REPO_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"/tutorial\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"$\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"BITBUCKET_COMMIT\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"services\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),` docker\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(n.p,{children:\"Service Account\\uC758 key\\uB97C \\uBC1C\\uAE09\\uD574\\uC11C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC744 \\uC9C0\\uC591\\uD558\\uACE0, \\uC784\\uC2DC credential\\uB97C \\uC0AC\\uC6A9\\uD558\\uB294 \\uAC83\\uC774 \\uBC14\\uB78C\\uC9C1\\uD558\\uB2E4. Github Action\\uC774\\uB098 Bitbucket Pipeline\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC Cloud\\uC5D0 \\uB9AC\\uC18C\\uC2A4\\uB97C \\uBC30\\uD3EC/\\uBCC0\\uACBD\\uD560 \\uB54C, \\uB9CC\\uB8CC\\uAE30\\uAC04\\uC774 \\uC5C6\\uB294 Key \\uBC1C\\uAE09\\uD558\\uC5EC \\uC0AC\\uC6A9\\uD558\\uB294 \\uB300\\uC2E0\\uC5D0 OIDC\\uB97C \\uD1B5\\uD574\\uC11C \\uC784\\uC2DC credential\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. \\uC774\\uBC88 \\uAE00\\uC5D0\\uC11C\\uB294 \\uB2E4\\uB978 \\uB204\\uAD70\\uAC00 Bitbucket OIDC\\uB85C GCP\\uC5D0 \\uC811\\uADFC\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD560 \\uB54C, \\uCC38\\uACE0\\uD560 \\uC218 \\uC788\\uB294 \\uC644\\uC804\\uD55C \\uC608\\uC81C\\uB97C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4.\"})]})}}var _=y;return C;})();\n;return Component;","toc":[{"value":"workload identity pool 생성","url":"#workload-identity-pool-생성","depth":2},{"value":"bitbucket OIDC 설정값들 확인","url":"#bitbucket-oidc-설정값들-확인","depth":2},{"value":"Service Account 생성 및 권한 부여","url":"#service-account-생성-및-권한-부여","depth":2},{"value":"Repository별로 role binding","url":"#repository별로-role-binding","depth":2},{"value":"Bitbucket Pipeline YAML 작성","url":"#bitbucket-pipeline-yaml-작성","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"3 min read","minutes":2.815,"time":168900,"words":563},"slug":"20250117-google-oidc-bitbucket","fileName":"20250117-google-oidc-bitbucket.md","title":"Bitbucket OIDC with GCP","date":"2025-01-17T00:00:00.000Z","tags":["gcp","oidc","bitbucket"],"images":["/static/images/social-banner.png"],"summary":"Bitbucket OIDC를 이용하여 GCP 리소스를 접근하는 방법을 설명한다. Bitbucket Pipeline으로 GCP 리소스를 배포/변경할 때 OIDC를 통해서 임시 Credential를 발급할 수 있다. 다른 사람이 동일한 작업을 할 때, 삽질하지 않도록 완전한 예제를 공유하고자 작성한다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"GCP Secret Manager에서 비밀값을 OpenTofu로 관리하기","date":"2025-01-05T00:00:00.000Z","tags":["gcp","terraform","opentofu"],"images":["/static/images/social-banner.png"],"summary":"GCP Secret Manager를 IaS로 관리할 때, 저장하는 Secret 값을 Key Management Service의 비대칭키와 Terraform의 google_kms_secret_asymmetric data source로 관리할 수 있다. 공개키로 암호화한 비밀 값을 Terraform resource definition에 정의하고, 런타임 과정에서 복호화하여 Secret Manager의 비밀값으로 설정할 수 있다. 따라서 Git에 평서문 대신에 공개키로 암호화한 비밀 값으로 정의한 Terraform 파일을 저장하여 관리할 수 있다. 하지만 해당 비밀 값은 State output 같은 곳에 평서문으로 그대로 노출 될 수 있기 때문에, remote state로 관리할 때는 해당 state 파일이 노출되지 않도록 관리를 잘해야 한다. OpenTofu를 이용할 때는 State 파일을 암호화 하는 옵션을 사용하여 State 파일 자체를 암호화해서 관리할 수도 있다.","slug":"20250105-opentofu"},"next":null},"__N_SSG":true}