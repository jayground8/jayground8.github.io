{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var o=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=n=>c(n,\"__esModule\",{value:!0});var m=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports),N=(n,s)=>{t(n);for(var l in s)c(n,l,{get:s[l],enumerable:!0})},k=(n,s,l)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let a of p(s))!u.call(n,a)&&a!==\"default\"&&c(n,a,{get:()=>s[a],enumerable:!(l=d(s,a))||l.enumerable});return n},g=n=>k(t(c(n!=null?o(h(n)):{},\"default\",n&&n.__esModule&&\"default\"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var r=m((A,i)=>{i.exports=_jsx_runtime});var f={};N(f,{default:()=>b,frontmatter:()=>v});var e=g(r()),v={title:\"vault secrets operator \\uC0AC\\uC6A9\\uD574\\uBCF4\\uAE30\",date:\"2023-12-22\",tags:[\"Kubernetes\",\"vault\"],images:[\"/static/images/social-banner.png\"],summary:\"GitOps\\uC5D0\\uC11C Secret\\uC744 \\uC5B4\\uB5BB\\uAC8C \\uAD00\\uB9AC\\uD560\\uC9C0 \\uACE0\\uBBFC\\uC744 \\uD558\\uC600\\uACE0, \\uAC1C\\uBC1C\\uC790\\uB4E4\\uC758 \\uC778\\uC9C0\\uBD80\\uD558\\uB97C \\uC904\\uC774\\uAE30 \\uC704\\uD574\\uC11C Vault UI\\uB85C \\uC790\\uC2E0\\uC758 \\uC571\\uC758 \\uBE44\\uBC00\\uAC12\\uC744 \\uAD00\\uB9AC\\uD558\\uB294 \\uAC83\\uC774 \\uC81C\\uC77C \\uD6A8\\uC728\\uC801\\uC774\\uB77C\\uB294 \\uD310\\uB2E8\\uC744 \\uD588\\uB2E4. Vault secrets operator\\uAC00 GA\\uB85C \\uACF5\\uC720\\uAC00 \\uB418\\uC5C8\\uACE0, Secrets Store CSI\\uB098 External secrets \\uD504\\uB85C\\uC81D\\uD2B8\\uBCF4\\uB2E4 \\uAE54\\uB054\\uD55C \\uBC29\\uC2DD\\uC774\\uB77C\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. Vault secrets operator\\uC758 CRD\\uB85C vault secret\\uACFC kubernetes secret\\uC758 sync\\uB97C \\uB9DE\\uCD94\\uACE0, reloader\\uB85C secret\\uC774 \\uBCC0\\uACBD\\uB418\\uC5C8\\uC744 \\uB54C \\uB2E4\\uC2DC pod\\uB97C \\uBC30\\uD3EC\\uD558\\uB294 \\uAC83\\uC744 \\uD14C\\uC2A4\\uD2B8\\uD574\\uBCF4\\uC558\\uB2E4.\"};function y(n={}){let{wrapper:s}=n.components||{};return s?(0,e.jsx)(s,Object.assign({},n,{children:(0,e.jsx)(l,{})})):l();function l(){let a=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",h2:\"h2\",span:\"span\",h3:\"h3\",code:\"code\",pre:\"pre\"},n.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a.p,{children:[\"GitOps\\uB85C Secret\\uC744 \\uAD00\\uB9AC\\uD560 \\uB54C, Secret\\uC744 \\uC554\\uD638\\uD654\\uD574\\uC11C Git\\uC5D0 \\uC62C\\uB9AC\\uB294 \\uBC29\\uBC95\\uACFC Secret management tool\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uB3D9\\uAE30\\uD654\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uC0DD\\uAC01\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://www.redhat.com/en/blog/a-guide-to-secrets-management-with-gitops-and-kubernetes\",children:\"Red Hat \\uBE14\\uB85C\\uADF8\\uC5D0\\uC11C GitOps\\uC5D0\\uC11C Secret\\uC744 \\uAD00\\uB9AC\\uD558\\uB294 \\uB2E4\\uC591\\uD55C \\uBC29\\uBC95\\uB4E4\\uC744 \\uC798 \\uC124\\uBA85\\uD558\\uACE0 \\uC788\\uB2E4.\"})]}),(0,e.jsx)(a.p,{children:\"\\uAC1C\\uBC1C\\uC790\\uB4E4\\uC758 \\uC778\\uC9C0\\uBD80\\uD558\\uB97C \\uCD5C\\uC18C\\uD55C\\uD654 \\uD558\\uACE0 \\uAC1C\\uBC1C\\uC5D0 \\uC9D1\\uC911\\uD560 \\uC218 \\uC788\\uB294 \\uD658\\uACBD\\uC744 \\uB9CC\\uB4DC\\uB294 \\uAC83\\uC744 \\uC911\\uC694\\uD558\\uAC8C \\uC0DD\\uAC01\\uD55C\\uB2E4. \\uADF8\\uB798\\uC11C \\uAC1C\\uBC1C\\uC790\\uB4E4\\uC774 \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4\\uC5D0 \\uB300\\uD574\\uC11C \\uCD5C\\uC18C\\uD55C\\uC73C\\uB85C \\uC54C\\uACE0 \\uAC1C\\uBC1C\\uC744 \\uD560 \\uC218 \\uC788\\uAC8C \\uD658\\uACBD\\uC744 \\uB9CC\\uB4E4\\uACE0\\uC790 \\uD588\\uB2E4. Vault\\uB294 Web UI\\uB97C \\uC81C\\uACF5\\uD558\\uACE0, \\uC138\\uBD80\\uC801\\uC73C\\uB85C \\uAD8C\\uD55C \\uC124\\uC815\\uC744 \\uD560 \\uC218 \\uC788\\uB2E4. \\uB530\\uB77C\\uC11C \\uAC1C\\uBC1C\\uC790\\uB4E4\\uC740 Web UI\\uC5D0\\uB9CC \\uC811\\uADFC\\uD558\\uC5EC \\uC790\\uC2E0\\uC758 \\uC5B4\\uD50C\\uB9AC\\uCF00\\uC774\\uC158\\uACFC \\uAD00\\uB828\\uB41C secret \\uC815\\uBCF4\\uB97C \\uBC14\\uAFC0 \\uC218 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 vault\\uC758 \\uB2E4\\uC591\\uD55C engine\\uC744 \\uD1B5\\uD574\\uC11C \\uC784\\uC2DC credential \\uBC1C\\uAE09 \\uD558\\uAC70\\uB098 rotation\\uC744 \\uD558\\uB294 \\uAC83\\uC744 \\uC27D\\uAC8C \\uAD6C\\uD604\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.p,{children:\"\\uC62C\\uD574 Hashicorp\\uAC00 \\uC81C\\uACF5\\uD558\\uB294 Product\\uB4E4\\uC758 License\\uAC00 BSL(Business Source License)\\uB85C \\uBCC0\\uACBD\\uB418\\uC5C8\\uB2E4. \\uB77C\\uC774\\uC13C\\uC2A4 \\uBCC0\\uACBD \\uB54C\\uBB38\\uC5D0 Terraform\\uC744 fork\\uD55C \\uC624\\uD508 \\uC18C\\uC2A4 \\uD504\\uB85C\\uC81D\\uD2B8\\uC778 OpenTofu\\uAC00 \\uD0C4\\uC0DD\\uD558\\uAE30\\uB3C4 \\uD588\\uB2E4. \\uAE30\\uC874\\uC758 Vault version\\uB4E4\\uC740 \\uC5EC\\uC804\\uD788 MPL(Mozilla Public License) 2.0\\uB85C \\uC0AC\\uC6A9\\uAC00\\uB2A5\\uD558\\uACE0, Hashicorp\\uC640 \\uACBD\\uC7C1\\uC801\\uC778 \\uD504\\uB85C\\uB355\\uD2B8\\uB97C \\uB9CC\\uB4DC\\uB294 \\uACF3\\uC774 \\uC544\\uB2C8\\uB77C\\uBA74 \\uC5EC\\uC804\\uD788 Vault\\uB97C \\uB77C\\uC774\\uC13C\\uC2A4 \\uAD6C\\uB9E4 \\uC5C6\\uC774 \\uC0AC\\uC6A9 \\uAC00\\uB2A5\\uD558\\uB2E4.\"}),(0,e.jsx)(a.p,{children:\"Vault\\uB97C \\uD65C\\uC6A9\\uD558\\uC5EC Kubernetes\\uC5D0\\uC11C secret management\\uB97C \\uD560 \\uC218 \\uC788\\uB294 \\uBC29\\uBC95\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uB098\\uC5F4\\uD574\\uBCFC \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsxs)(a.ul,{children:[(0,e.jsx)(a.li,{children:\"Secrets Store CSI + Vault Provider\"}),(0,e.jsx)(a.li,{children:\"External Secrets\"}),(0,e.jsx)(a.li,{children:\"Vault secrets operator\"})]}),(0,e.jsxs)(a.p,{children:[\"Secrets Store CSI\\uB294 vault\\uC758 secret\\uACFC kubernetes secret\\uC758 sync\\uB97C \\uB9DE\\uCD94\\uB294 \",(0,e.jsx)(a.a,{href:\"https://secrets-store-csi-driver.sigs.k8s.io/topics/secret-auto-rotation\",children:\"secret-auto-rotation\"}),\" \\uAE30\\uB2A5\\uC774 \\uC544\\uC9C1\\uB3C4 alpha feature\\uB85C \\uB0A8\\uC544 \\uC788\\uB2E4. \\uADF8\\uB9AC\\uACE0 node-driver-registrar\\uB85C kubelet\\uC5D0 binary\\uB97C \\uCD94\\uAC00\\uD558\\uB294 \\uC124\\uC815\\uB3C4 \\uD574\\uC57C \\uD55C\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://jayground8.github.io/blog/20230730-k8s-controller-external-secrets\",children:\"External Secrets\\uC740 \\uC774\\uC804\\uC5D0 \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB97C \\uC0B4\\uD3B4\\uBCF8\\uC801\\uC774 \\uC788\\uB294\\uB370\"}),\", \\uC774 \\uD504\\uB85C\\uC81D\\uD2B8\\uB3C4 \\uC88B\\uC740 \\uC635\\uC158\\uC774\\uB77C\\uACE0 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5C8\\uB2E4. \\uD558\\uC9C0\\uB9CC Vault\\uB9CC \\uC0AC\\uC6A9\\uD560 \\uACC4\\uD68D\\uC774\\uACE0, Hashicorp\\uC5D0\\uC11C \\uC81C\\uACF5\\uD558\\uB294 vault secrets operator\\uC758 CRD\\uAC00 \\uB354 \\uC9C1\\uAD00\\uC801\\uC774\\uACE0 \\uAE54\\uB054\\uD588\\uB2E4. \\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(a.a,{href:\"https://www.hashicorp.com/blog/vault-secrets-operator-for-kubernetes-now-ga\",children:\"GA\\uB85C \\uC81C\\uACF5\\uD55C\\uB2E4\\uB294 \\uACF5\\uC9C0\\uB3C4\"}),\" \\uC788\\uC5C8\\uACE0, \\uC55E\\uC73C\\uB85C \\uAD00\\uB9AC \\uCE21\\uBA74\\uC5D0\\uC11C\\uB3C4 \\uC720\\uB9AC\\uD558\\uB2E4\\uACE0 \\uD310\\uB2E8\\uD558\\uC600\\uB2E4.\"]}),(0,e.jsxs)(a.h2,{id:\"vault\",children:[(0,e.jsx)(a.a,{href:\"#vault\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault\"]}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-raft-deployment-guide\",children:\"HashCorp \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C \\uCE5C\\uC808\\uD558\\uAC8C \\uC5B4\\uB5BB\\uAC8C Vault\\uC744 Production \\uD658\\uACBD\\uC5D0\\uC11C \\uC124\\uCE58\\uD560 \\uC218 \\uC788\\uB294\\uC9C0 \\uC124\\uBA85\\uD574\\uC8FC\\uACE0 \\uC788\\uB2E4.\"]}),(0,e.jsxs)(a.h3,{id:\"certificate-\\uC900\\uBE44\",children:[(0,e.jsx)(a.a,{href:\"#certificate-\\uC900\\uBE44\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Certificate \\uC900\\uBE44\"]}),(0,e.jsxs)(a.p,{children:[\"openssl\\uB85C key\\uC640 csr\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4. \",(0,e.jsx)(a.a,{href:\"https://kubernetes.io/docs/reference/access-authn-authz/certificate-signing-requests/\",children:\"Kubernetes \\uBB38\\uC11C\"}),\"\\uC5D0\\uC11C CN\\uACFC Organizationd\\uC744 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uD574\\uC57C \\uB41C\\uB2E4\\uACE0 \\uB098\\uC628\\uB2E4. \\uB530\\uB77C\\uC11C \",(0,e.jsx)(a.code,{children:\"vault-csr.conf\"}),\"\\uC5D0 \\uD574\\uB2F9 \\uB0B4\\uC6A9\\uC774 \\uBC18\\uC601\\uB418\\uC5B4 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{children:(0,e.jsx)(a.code,{className:\"code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`Permitted subjects - organizations are exactly [\"system:nodes\"], common name starts with \"system:node:\".\n`})})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"openssl genrsa -out vault.key \",(0,e.jsx)(a.span,{className:\"token number\",children:\"2048\"}),`\n`]})})}),(0,e.jsxs)(a.p,{children:[\"Helm\\uC73C\\uB85C resource\\uB97C \\uC0DD\\uC131\\uD560 \\uB54C headless service\\uB85C \",(0,e.jsx)(a.code,{children:\"vault-internal\"}),\"\\uC774 \\uC0DD\\uC131\\uB41C\\uB2E4. Raft\\uB85C Vault node\\uB4E4\\uC774 cluster\\uB97C \\uD615\\uC131\\uD560 \\uB54C \\uC774 headless service\\uC758 DNS \\uC774\\uB984\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0 \",(0,e.jsx)(a.code,{children:\"vault-csr.conf\"}),\"\\uC5D0 \\uCD94\\uAC00\\uB418\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"vault-csr.conf\"})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"req\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"default_bits \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"2048\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"prompt \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` no\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"encrypt_key \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token function\",children:\"yes\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"default_md \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` sha256\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"distinguished_name \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` kubelet_serving\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"req_extensions \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` v3_req\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" kubelet_serving \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"O \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` system:nodes\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"CN \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` system:node:*.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\" v3_req \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"basicConstraints \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` CA:FALSE\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"keyUsage \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"extendedKeyUsage \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` serverAuth, clientAuth\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"subjectAltName \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` @alt_names\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"alt_names\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.1 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault-internal\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.2 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault-internal.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.3 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.4 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"DNS.5 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` *.vault.svc\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"IP.1 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"127.0\"}),`.0.1\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`openssl req -new -key vault.key -out vault.csr -config vault-csr.conf\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),\" vault.csr\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\"base64\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token function\",children:\"tr\"}),\" -d \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'\\\\n'\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C Kubernetes Root CA\\uB85C Sign\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"CertificateSigningRequest\"}),\" resource\\uB97C \\uB9CC\\uB4E0\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"csr.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` certificates.k8s.io/v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` CertificateSigningRequest\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault.svc\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"signerName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" kubernetes.io/kubelet\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`serving\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"expirationSeconds\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8640000\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"request\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'{vault.csr base64 \\uC778\\uCF54\\uB529 \\uAC12}'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"usages\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` digital signature\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` key encipherment\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` server auth\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f csr.yml\n`})})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uB807\\uAC8C \\uC0DD\\uC131\\uD558\\uACE0 \\uB098\\uBA74 \",(0,e.jsx)(a.code,{children:\"CONDITION\"}),\"\\uC774 \",(0,e.jsx)(a.code,{children:\"Pending\"}),\"\\uC73C\\uB85C \\uBCF4\\uC774\\uAC8C \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get certificatesigningrequest\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME        AGE   SIGNERNAME                      REQUESTOR    REQUESTEDDURATION   CONDITION\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`vault.svc   62s   kubernetes.io/kubelet-serving   example      100d                Pending\n`})]})}),(0,e.jsxs)(a.p,{children:[\"\\uCD5C\\uC885\\uC801\\uC73C\\uB85C approve \\uBA85\\uB839\\uC5B4\\uB97C \\uC0AC\\uC6A9\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"Approved,Issued\"}),\" \\uC0C1\\uD0DC\\uAC00 \\uB418\\uB3C4\\uB85D \\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl certificate approve vault.svc\n`})})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C Certificate\\uC640 Kubernetes CA Certificate\\uB97C \\uBC1B\\uB294\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl get csr vault.svc -o \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"jsonpath\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'{.status.certificate}'\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),` openssl base64 -d -A -out vault.crt\n`]})})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl config view \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"--raw \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"--minify \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"--flatten \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"-o \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"jsonpath\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'{.clusters[].cluster.certificate-authority-data}'\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" base64 -d \",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),` vault.ca\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"secret\\uC73C\\uB85C-\\uC900\\uBE44\",children:[(0,e.jsx)(a.a,{href:\"#secret\\uC73C\\uB85C-\\uC900\\uBE44\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Secret\\uC73C\\uB85C \\uC900\\uBE44\"]}),(0,e.jsx)(a.p,{children:\"Kutomize\\uC640 sealed-secret\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC secret\\uB97C GitOps \\uBC29\\uC2DD\\uC73C\\uB85C \\uC800\\uC7A5\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"kustomization.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"secretGenerator\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"files\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault.ca\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault.crt\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault.key\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kustomize build \",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),` secret.yml\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),\" secret.yml\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" kubeseal --controller-namespace kube-system --controller-name sealed-secrets-controller --format yaml \",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),` sealed-secret.yml\n`]})]})}),(0,e.jsx)(a.p,{children:\"namespace\\uB97C \\uCD94\\uAC00\\uD558\\uACE0, sealed-secret\\uC73C\\uB85C encryption\\uB41C yaml \\uD30C\\uC77C\\uB85C secret resource\\uB97C \\uCD94\\uAC00\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl create namespace vault\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl ns vault\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f sealed-secret.yml\n`})]})}),(0,e.jsx)(a.p,{children:\"sealed-secret\\uC5D0\\uC11C decrypt\\uD558\\uC5EC secret resource\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC0DD\\uC131\\uB418\\uC5C8\\uB294\\uC9C0 \\uD655\\uC778\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl get secret\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME                      TYPE     DATA   AGE\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-ha-tls-ad6d57g7t2   Opaque   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"3\"}),`      13s\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"argocd\\uB85C-\\uBC30\\uD3EC\",children:[(0,e.jsx)(a.a,{href:\"#argocd\\uB85C-\\uBC30\\uD3EC\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"ArgoCD\\uB85C \\uBC30\\uD3EC\"]}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.a,{href:\"https://argo-cd.readthedocs.io/en/stable/user-guide/helm/\",children:\"ArgoCD \\uBB38\\uC11C\"}),\"\\uCC98\\uB7FC Helm charts\\uB97C \\uD1B5\\uD574\\uC11C ArgoCD CRD\\uB97C \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. Helm\\uC73C\\uB85C \\uBC30\\uD3EC\\uD560 \\uB54C \",(0,e.jsx)(a.code,{children:\"values\"}),\"\\uC5D0 override\\uD560 \\uC124\\uC815\\uAC12\\uB4E4\\uC744 \\uC815\\uC758\\uD560 \\uC218 \\uC788\\uB2E4. Vault\\uC758 secret\\uC744 template\\uC73C\\uB85C \\uC6D0\\uD558\\uB294 \\uD615\\uC2DD\\uC73C\\uB85C volume\\uC5D0 \\uC800\\uC7A5\\uD560 \\uC218 \\uC788\\uB294 \",(0,e.jsx)(a.code,{children:\"Vault agent injector\"}),\"\\uB294 \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uC744 \\uAC70\\uB77C \",(0,e.jsx)(a.code,{children:\"enabled\"}),\"\\uC744 \",(0,e.jsx)(a.code,{children:\"false\"}),\"\\uB85C \\uC9C0\\uC815\\uD588\\uB2E4. High Avability Mode\\uB85C \\uC124\\uC815\\uC744 \\uD558\\uC600\\uACE0, 3\\uAC1C \\uC911\\uC5D0 \\uD558\\uB098\\uC758 Node\\uAC00 Active \\uC0C1\\uD0DC\\uB85C \\uC788\\uACE0, \\uB098\\uBA38\\uC9C0\\uB4E4\\uC740 Stand By \\uC0C1\\uD0DC\\uB85C \\uC788\\uAC8C \\uB41C\\uB2E4. Raft Protocol\\uB85C \\uBAA8\\uB4E0 \\uB178\\uB4DC\\uB4E4\\uC5D0 data\\uB97C \\uC798 replication\\uD55C\\uB2E4. Vault\\uC758 UI\\uB3C4 \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uAC8C NodePort type\\uC73C\\uB85C service resource\\uB97C \\uC0DD\\uC131\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"argocd-vault.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"project\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'https://kubernetes.default.svc'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`//helm.releases.hashicorp.com\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 0.27.0\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"values\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        global:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          tlsDisable: false\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        injector:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          enabled: false\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          image:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            repository: \"hashicorp/vault-k8s\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            tag: \"1.3\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        server:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          standalone:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: false\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          image:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            repository: \"hashicorp/vault\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            tag: \"1.15.2\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          resources:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            requests:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              memory: 1Gi\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              cpu: 500m\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            limit:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              memory: 2Gi\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          affinity: null\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          readinessProbe:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            path: \"/v1/sys/health?standbyok=true&sealedcode=204&uninitcode=204\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          livenessProbe:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            path: \"/v1/sys/health?standbyok=true\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            initialDelaySeconds: 60\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          extraEnvironmentVars:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            VAULT_CACERT: /vault/userconfig/vault-ha-tls/vault.ca\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            VAULT_TLSCERT: /vault/userconfig/vault-ha-tls/vault.crt\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            VAULT_TLSKEY: /vault/userconfig/vault-ha-tls/vault.key\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          volumes:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            - name: userconfig-vault-ha-tls\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              secret:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                defaultMode: 420\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                secretName: vault-ha-tls-ad6d57g7t2\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          volumeMounts:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            - mountPath: /vault/userconfig/vault-ha-tls\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              name: userconfig-vault-ha-tls\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              readOnly: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          auditStorage:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          ha:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            replicas: 3\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`            raft:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`              enabled: true\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"              setNodeId: true\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"config\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                ui = true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                listener \"tcp\" {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_disable = 0\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  address = \"[::]:8200\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  cluster_address = \"[::]:8201\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_cert_file = \"/vault/userconfig/vault-ha-tls/vault.crt\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_key_file  = \"/vault/userconfig/vault-ha-tls/vault.key\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`                  tls_client_ca_file = \"/vault/userconfig/vault-ha-tls/vault.ca\"\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"                }\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                storage \"raft\" ',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`                  path = \"/vault/data\"\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                    retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_api_addr = \"https',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"0.vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"internal\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8200\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_ca_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.ca\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.crt\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_key_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.key\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_api_addr = \"https',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"1.vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"internal\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8200\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_ca_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.ca\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.crt\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_key_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.key\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_api_addr = \"https',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"2.vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"internal\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`8200\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_ca_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.ca\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_cert_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.crt\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                    leader_client_key_file = \"/vault/userconfig/vault',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"ha\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`tls/vault.key\"\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:['                service_registration \"kubernetes\" ',(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"ui\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"enabled\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"serviceType\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"NodePort\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"externalPort\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8200\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"ArgoCD\\uC758 \",(0,e.jsx)(a.code,{children:\"Application\"}),\" CRD \\uC124\\uC815\\uC5D0\\uC11C source \\uBD80\\uBD84\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uD558\\uBA74 \\uB41C\\uB2E4. helm command\\uB85C repo\\uB97C \\uCD94\\uAC00\\uD560 \\uB54C URL\\uC774 \",(0,e.jsx)(a.code,{children:\"repoURL\"}),\"\\uC5D0 \\uC124\\uC815\\uC774 \\uB418\\uC5B4\\uC57C \\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"helm repo \",(0,e.jsx)(a.span,{className:\"token function\",children:\"add\"}),` hashicorp https://helm.releases.hashicorp.com\n`]})})}),(0,e.jsxs)(a.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \",(0,e.jsx)(a.code,{children:\"targetRevision\"}),\"\\uC740 \",(0,e.jsx)(a.code,{children:\"CHART VERSION\"}),\"\\uC744 \\uC124\\uC815\\uD558\\uBA74 \\uB418\\uACE0, chart\\uB294 chart\\uC774\\uB984\\uC744 \\uCD94\\uAC00\\uD558\\uBA74 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ helm search repo\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME             CHART VERSION   APP VERSION   DESCRIPTION\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"hashicorp/vault  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0.27\"}),\".0          \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1.15\"}),`.2        Official HashiCorp Vault Chart\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uB9C8\\uC9C0\\uB9C9\\uC73C\\uB85C \",(0,e.jsx)(a.code,{children:\"releaseName\"}),\"\\uC740 helm install \\uBA85\\uB839\\uC5B4\\uB97C \\uC4F8 \\uB54C \\uC0AC\\uC6A9\\uD558\\uB294 \\uC774\\uB984\\uC744 \\uC124\\uC815\\uD558\\uBA74 \\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"helm \",(0,e.jsx)(a.span,{className:\"token function\",children:\"install\"}),` vault hashcorp/vault\n`]})})}),(0,e.jsx)(a.p,{children:\"\\uADF8\\uB807\\uAC8C \\uBC18\\uC601\\uC744 \\uD558\\uBA74 vault\\uC758 \\uACBD\\uC6B0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC791\\uC131\\uD560 \\uC218\\uAC00 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`//helm.releases.hashicorp.com\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 0.27.0\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C ArgoCD CRD\\uB97C \\uBC30\\uD3EC\\uD558\\uACE0, argocd application\\uB97C Sync\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f argocd-vault.yml\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"argocd app \",(0,e.jsx)(a.span,{className:\"token function\",children:\"sync\"}),` vault\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"vault-init--unseal\",children:[(0,e.jsx)(a.a,{href:\"#vault-init--unseal\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Vault init & unseal\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C StatefulSet\\uC73C\\uB85C \\uC544\\uB798\\uCC98\\uB7FC pod\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC798 \\uB72C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get pod\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME      READY   STATUS    RESTARTS   AGE\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-0   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),`          57s\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-1   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),`          57s\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-2   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\"/1     Running   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),`          57s\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB3D9\\uC791\\uD558\\uAE30 \\uC704\\uD574\\uC11C init\\uC744 \\uD574\\uC918\\uC57C \\uD55C\\uB2E4. \\uADF8\\uB9AC\\uACE0 \\uC774\\uB807\\uAC8C init\\uC744 \\uD558\\uBA74 root key\\uB97C \\uC0DD\\uC131\\uD558\\uAC8C \\uB418\\uB294\\uB370, \\uC608\\uC81C\\uC5D0\\uC11C\\uB294 \\uD3B8\\uC758\\uB97C \\uC704\\uD574\\uC11C \",(0,e.jsx)(a.code,{children:\"-key-shares=1\"}),\"\\uB85C \\uD558\\uC5EC \\uD558\\uB098\\uB9CC \\uBC1C\\uAE09\\uD558\\uAC8C \\uD55C\\uB2E4. \\uC2E4\\uC81C\\uB85C \\uC6B4\\uC601\\uD560 \\uB54C\\uB294 \\uBCF5\\uC218\\uC758 key\\uB97C \\uBD84\\uB9AC\\uD558\\uACE0 \",(0,e.jsx)(a.code,{children:\"-key-threshold\"}),\" \\uAC2F\\uC218\\uB9CC\\uD07C key\\uB85C unseal\\uC744 \\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uD560 \\uC218 \\uC788\\uB2E4. \\uD574\\uB2F9 \\uAC12\\uC73C\\uB85C unseal\\uAE4C\\uC9C0 \\uC644\\uB8CC\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-0 -- vault operator init -key-shares\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" -key-threshold\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" -format\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"json \",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),` cluster-keys-0.json\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-0 -- vault operator unseal \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"unseal_keys_b64 \\uAC12\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[(0,e.jsx)(a.code,{children:\"etc/resolve.conf\"}),\"\\uC5D0\\uB294 \\uC774\\uB807\\uAC8C \\uC791\\uC131\\uC774 \\uB418\\uC5B4 \\uC788\\uACE0, \",(0,e.jsx)(a.code,{children:\"vault-0.vault-internal\"}),\"\\uB85C\\uB9CC DNS lookup\\uC744 \\uD558\\uB354\\uB77C\\uB3C4 \\uD574\\uB2F9 pod\\uC758 IP\\uB97C resolve\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),` /etc/resolv.conf\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`search vault.svc.cluster.local svc.cluster.local cluster.local\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"nameserver \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`options ndots:5\n`})]})}),(0,e.jsxs)(a.p,{children:[\"Raft\\uB85C \\uC774\\uC81C Standby node\\uAC00 cluster join\\uD560 \\uB54C, \",(0,e.jsx)(a.code,{children:\"https://vault-0.vault-internal:8200\"}),\"\\uB85C URL\\uB97C \\uC815\\uC758\\uD588\\uB2E4. \\uADF8\\uB7F0\\uB370 \\uC774\\uC0C1\\uD558\\uAC8C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC804\\uCCB4 Domain\\uC744 lookup\\uD560 \\uB54C\\uB294 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB418\\uC5C8\\uC9C0\\uB9CC,\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it vault-0 -- \",(0,e.jsx)(a.span,{className:\"token function\",children:\"nslookup\"}),` vault-0.vault-internal.vault.svc.cluster.local\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Server:         \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address:        \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10:53\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Name:   vault-0.vault-internal.vault.svc.cluster.local\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address: \",(0,e.jsx)(a.span,{className:\"token number\",children:\"198.18\"}),`.9.169\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC904\\uC5EC\\uC11C \\uD560 \\uB54C\\uB294 \\uB418\\uC9C0 \\uC54A\\uC558\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it vault-0 -- \",(0,e.jsx)(a.span,{className:\"token function\",children:\"nslookup\"}),` vault-0.vault-internal.vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Server:         \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address:        \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10:53\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"** server can\",(0,e.jsx)(a.span,{className:\"token string\",children:`'t find vault-0.vault-internal.vault: NXDOMAIN\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string\",children:\"** server can'\"}),\"t \",(0,e.jsx)(a.span,{className:\"token function\",children:\"find\"}),` vault-0.vault-internal.vault: NXDOMAIN\n`]})]})}),(0,e.jsx)(a.p,{children:\"CoreDns\\uC758 ConfigMap\\uC5D0\\uC11C log\\uB97C \\uCD94\\uAC00\\uD588\\uACE0, \\uC5EC\\uAE30\\uC5D0 \\uB85C\\uADF8\\uAC00 \\uB0A8\\uC9C0\\uAC00 \\uC54A\\uC558\\uB2E4. \\uC544\\uB798\\uCC98\\uB7FC dnsutils\\uAC00 \\uC788\\uB294 pod\\uB97C \\uC2E4\\uD589\\uD574\\uC11C lookup\\uC744 \\uD574\\uBCF4\\uB2C8 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB418\\uC5C8\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Pod\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dnsutils\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dnsutils\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" registry.k8s.io/e2e\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"test\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"images/jessie\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"dnsutils\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1.3\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` sleep\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'infinity'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` IfNotPresent\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"restartPolicy\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Always\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -it dnsutils -- \",(0,e.jsx)(a.span,{className:\"token function\",children:\"nslookup\"}),` vault-0.vault-internal.vault\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Server:         \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),`.25.10\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address:        \",(0,e.jsx)(a.span,{className:\"token number\",children:\"169.254\"}),\".25.10\",(0,e.jsx)(a.span,{className:\"token comment\",children:\"#53\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Name:   vault-0.vault-internal.vault.svc.cluster.local\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Address: \",(0,e.jsx)(a.span,{className:\"token number\",children:\"198.18\"}),`.9.169\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC65C Vault pod\\uC5D0\\uC11C\\uB294 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB418\\uB294\\uC9C0 \\uD30C\\uC545\\uD560 \\uC218 \\uC5C6\\uC5C8\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC218\\uC815\\uC744 \\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"storage \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"raft\"'}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  path \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/data\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_api_addr \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://vault-0.vault-internal.vault.svc.cluster.local:8200\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_ca_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.ca\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.crt\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_key_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.key\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_api_addr \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://vault-1.vault-internal.vault.svc.cluster.local:8200\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_ca_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.ca\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.crt\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_key_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.key\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  retry_join \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_api_addr \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://vault-2.vault-internal.vault.svc.cluster.local:8200\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_ca_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.ca\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_cert_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.crt\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    leader_client_key_file \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:'\"/vault/userconfig/vault-ha-tls/vault.key\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault-1\\uACFC vault-2\\uC5D0\\uC11C\\uB3C4 unseal\\uC744 \\uD574\\uC8FC\\uACE0, raft\\uC5D0 join \\uD55C \\uAC83\\uB3C4 \\uD655\\uC778\\uC744 \\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-1 -- vault operator unseal \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"unseal_keys_b64 \\uAC12\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exec\"}),\" vault-2 -- vault operator unseal \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"unseal_keys_b64 \\uAC12\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ vault operator raft list-peers\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Node       Address                        State       Voter\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`----       -------                        -----       -----\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-0    vault-0.vault-internal:8201    leader      \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-1    vault-1.vault-internal:8201    follower    \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault-2    vault-2.vault-internal:8201    follower    \",(0,e.jsx)(a.span,{className:\"token boolean\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(a.h3,{id:\"vault-auth-engine-policy-role-\\uC124\\uC815\",children:[(0,e.jsx)(a.a,{href:\"#vault-auth-engine-policy-role-\\uC124\\uC815\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault auth, engine, policy, role \\uC124\\uC815\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC2E4\\uD589\\uC774 \\uB418\\uC5C8\\uC73C\\uB2C8, \\uC608\\uC81C\\uCC98\\uB7FC vault\\uC5D0 \\uD544\\uC694\\uD55C \\uAC83\\uB4E4\\uC744 \\uC124\\uC815\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault auth \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"enable\"}),` -path dev-auth-mount kubernetes\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault \",(0,e.jsx)(a.span,{className:\"token function\",children:\"write\"}),\" auth/dev-auth-mount/config \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"kubernetes_host\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"https://kubernetes.default.svc\"'}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault secrets \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"enable\"}),\" -path\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),`dev kv-v2\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault policy \",(0,e.jsx)(a.span,{className:\"token function\",children:\"write\"}),\" dev - \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<<\"}),(0,e.jsx)(a.span,{className:\"token string\",children:`EOF\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`path \"dev/*\" {\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`   capabilities = [\"read\"]\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string\",children:`}\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string\",children:\"EOF\"}),`\n`]})]})}),(0,e.jsx)(a.pre,{children:(0,e.jsxs)(a.code,{className:\"code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`vault write auth/dev-auth-mount/role/dev \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   bound_service_account_names=default \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   bound_service_account_namespaces=dev \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   policies=dev \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   audience=vault \\\\\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   ttl=24h\n`})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault kv put dev/webapp/config \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"username\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-user\"'}),\" \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"password\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-password\"'}),`\n`]})})}),(0,e.jsxs)(a.h2,{id:\"vault-secrets-operator\",children:[(0,e.jsx)(a.a,{href:\"#vault-secrets-operator\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault secrets operator\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C CRD\\uB85C \\uAD00\\uB9AC\\uD558\\uACE0, vault\\uC758 secret\\uC744 Kubernetes secret\\uC73C\\uB85C sync\\uD574\\uC8FC\\uB294 vault-secrets-operator\\uB97C \\uC124\\uCE58\\uD55C\\uB2E4. \\uBA3C\\uC800 ca.crt\\uAC00 Secret\\uC5D0 \\uC788\\uC5B4\\uC57C \\uB418\\uC11C \\uB3D9\\uC77C\\uD558\\uAC8C Kustomize\\uB85C Secret Manifest\\uB97C \\uC0DD\\uC131\\uD558\\uACE0, sealed-secret\\uC73C\\uB85C \\uBC30\\uD3EC\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"kustomization.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"secretGenerator\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`ca\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"files\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` ca.crt=vault.ca\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl create namespace vault-secrets-operator\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl ns vault-secrets-operator\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"cat\"}),\" secret-ca.yml\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"|\"}),\" kubeseal --controller-namespace kube-system --controller-name sealed-secrets-controller --format yaml \",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),` sealed-secret-ca.yml\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f sealed-secret-ca.yml\n`})]})}),(0,e.jsx)(a.p,{children:\"\\uADF8\\uB9AC\\uACE0 ArgoCD Application resource\\uB97C \\uC0DD\\uC131\\uD55C\\uB2E4.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"argocd-vault-secrets-operator.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"project\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'https://kubernetes.default.svc'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`//helm.releases.hashicorp.com\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 0.4.2\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"secrets\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`operator\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"values\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(a.span,{className:\"token string scalar\",children:`\n`})]}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`        defaultVaultConnection:\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          enabled: true\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          address: \"https://vault.vault.svc.cluster.local:8200\"\n`})}),(0,e.jsx)(a.span,{className:\"code-line\",children:(0,e.jsx)(a.span,{className:\"token string scalar\",children:`          skipTLSVerify: false\n`})}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token string scalar\",children:\"          caCertSecret: vault-ca-a2dh3972mm\"}),`\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f argocd-vault-secrets-operator.yml\n`})})}),(0,e.jsx)(a.p,{children:\"ArgoCD\\uB85C sync\\uB97C \\uB9DE\\uCDB0\\uC11C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C resource\\uB4E4\\uC774 \\uBC30\\uD3EC\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD55C\\uB2E4.\"}),(0,e.jsxs)(a.h3,{id:\"vault-secrets-operator-test\",children:[(0,e.jsx)(a.a,{href:\"#vault-secrets-operator-test\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"vault secrets operator test\"]}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault secrets operator\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC124\\uCE58\\uB418\\uC5C8\\uC73C\\uB2C8, CRD\\uB97C \\uC0DD\\uC131\\uD558\\uC5EC namespace dev\\uC5D0\\uC11C vault secret\\uC5D0 \\uB530\\uB77C\\uC11C Kubernetes secret\\uC774 \\uC0DD\\uC131\\uB418\\uB294 \\uAC83\\uC744 \\uD655\\uC778\\uD574\\uBCF8\\uB2E4.\"}),(0,e.jsx)(a.p,{children:\"\\uC704\\uC5D0\\uC11C vault\\uC5D0 \\uB2E4\\uC74C\\uACFC \\uAC19\\uC774 \\uCD94\\uAC00\\uD558\\uC600\\uB2E4.\"}),(0,e.jsxs)(a.ul,{children:[(0,e.jsx)(a.li,{children:\"kubernetes auth: dev-auth-mount\"}),(0,e.jsx)(a.li,{children:\"role: dev\"}),(0,e.jsx)(a.li,{children:\"kv-v2: dev/webapp/config\"})]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"example-auth.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` secrets.hashicorp.com/v1beta1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` VaultAuth\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" static\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`auth\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"method\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` kubernetes\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"mount\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" dev\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"auth\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`mount\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kubernetes\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"role\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"serviceAccount\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"audiences\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` vault\n`]})]})}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"example-secret.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` secrets.hashicorp.com/v1beta1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` VaultStaticSecret\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" vault\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\"kv\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`app\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" kv\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`v2\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"mount\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"path\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` webapp/config\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" dev\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`secret\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"create\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"refreshAfter\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 30s\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"vaultAuthRef\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" static\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`auth\n`]})]})}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f example-auth.yml\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`kubectl apply -f example-secret.yml\n`})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C Kubernetes namespace dev\\uC5D0 \",(0,e.jsx)(a.code,{children:\"devSecret\"}),\" Secret resource\\uAC00 \\uC0DD\\uC131\\uB41C\\uB2E4.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl get secret -n dev\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`NAME              TYPE                             DATA   AGE\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"dev-secret        Opaque                           \",(0,e.jsx)(a.span,{className:\"token number\",children:\"3\"}),`      3s\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uC774\\uC81C secret\\uC774 \\uBCC0\\uACBD\\uB418\\uBA74 \\uC790\\uB3D9\\uC73C\\uB85C Deployment\\uC758 pod\\uB97C Rolling Update\\uD560 \\uC218 \\uC788\\uB3C4\\uB85D, \",(0,e.jsx)(a.a,{href:\"https://github.com/stakater/Reloader\",children:\"Reloader\"}),\"\\uC744 helm\\uC73C\\uB85C \\uC124\\uCE58\\uD55C\\uB2E4.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.code,{children:\"argocd-reloader.yml\"})}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argoproj.io/v1alpha1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Application\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` argocd\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"project\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"syncPolicy\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"syncOptions\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),` CreateNamespace=true\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"destination\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"server\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'https://kubernetes.default.svc'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"source\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"chart\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"repoURL\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\"//stakater.github.io/stakater\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`charts\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"targetRevision\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` 1.0.56\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"helm\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"releaseName\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` reloader\n`]})]})}),(0,e.jsx)(a.p,{children:\"\\uB3D9\\uC77C\\uD558\\uAC8C ArgoCD\\uB85C \\uBC30\\uD3EC\\uB97C \\uD558\\uACE0, \\uADF8\\uB0E5 secret\\uC73C\\uB85C\\uBD80\\uD130 \\uAC12\\uC744 stdout\\uC73C\\uB85C \\uB0A8\\uAE30\\uB294 Pod\\uB97C \\uC0DD\\uC131\\uD558\\uB294 Deployment Resource\\uB97C \\uBC30\\uD3EC\\uD55C\\uB2E4. \\uC774\\uB54C annotation\\uC744 \\uD1B5\\uD574\\uC11C \\uC124\\uCE58\\uD55C reloader\\uAC00 \\uBCC0\\uACBD\\uB41C secret\\uB97C watch\\uD558\\uACE0 rolling update\\uB97C \\uD560 \\uC218 \\uC788\\uB3C4\\uB85D \\uD55C\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-yaml\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"annotations\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"reloader.stakater.com/auto\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'true'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),` ubuntu\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" ubuntu\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token comment\",children:\"# Just spin & wait forever\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"command\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'/bin/bash'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'-c'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'--'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"args\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token string\",children:\"'while true; echo ${username}; do sleep 30; done;'\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"envFrom\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"secretRef\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(a.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\":\"}),\" dev\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"-\"}),`secret\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"\\uBC30\\uD3EC\\uD558\\uACE0 \\uB098\\uC11C log\\uB97C \\uD655\\uC778\\uD558\\uBA74 \",(0,e.jsx)(a.code,{children:\"dev-secret\"}),\"\\uC5D0 \\uC788\\uB294 username \\uAC12\\uC774 \\uCC0D\\uD788\\uB294 \\uAC78 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(a.pre,{children:(0,e.jsxs)(a.code,{className:\"code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`$ kubectl logs -f --selector app=ubuntu\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`static-user\n`})]})}),(0,e.jsx)(a.p,{children:\"\\uC774\\uC81C vault\\uC5D0\\uC11C secret\\uAC12\\uC744 \\uBCC0\\uACBD\\uD558\\uBA74, rolling update\\uAC00 \\uB418\\uACE0 static-user3\\uAC00 log\\uB85C \\uB0A8\\uB294 \\uAC78 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsx)(a.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"vault kv put dev/webapp/config \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"username\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-user3\"'}),\" \",(0,e.jsx)(a.span,{className:\"token assign-left variable\",children:\"password\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token string\",children:'\"static-password\"'}),`\n`]})})}),(0,e.jsxs)(a.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(a.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(a.p,{children:\"GitOps\\uB85C Kubernetes manifest file\\uB97C \\uAD00\\uB9AC\\uD558\\uB294 \\uC0C1\\uD669\\uC5D0\\uC11C Secret\\uC740 \\uC5B4\\uB5BB\\uAC8C \\uAD00\\uB9AC\\uD558\\uB294 \\uAC83\\uC774 \\uC88B\\uC744\\uAE4C \\uACE0\\uBBFC\\uC744 \\uD588\\uC5C8\\uB2E4. \\uC608\\uC804\\uBD80\\uD130 Vault\\uB97C \\uD3B8\\uB9AC\\uD558\\uAC8C \\uC0AC\\uC6A9\\uD574\\uC654\\uACE0, Kubernetes\\uC5D0\\uC11C vault\\uB97C \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC788\\uB294 \\uC635\\uC158\\uB4E4\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uC558\\uB2E4. \\uADF8\\uC911\\uC5D0\\uC11C Vault secrets operator\\uAC00 \\uAC00\\uC7A5 \\uC801\\uD569\\uD558\\uB2E4\\uACE0 \\uD310\\uB2E8\\uD558\\uC5EC, ArgoCD, Kustomize, sealed-secret \\uB4F1\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC14B\\uD305\\uC744 \\uD574\\uBCF4\\uC558\\uB2E4. Hashicorp \\uB9CC\\uC138! \\u{1F44D}\\u{1F44D}\"})]})}}var b=y;return f;})();\n;return Component;","toc":[{"value":"vault","url":"#vault","depth":2},{"value":"Certificate ","url":"#certificate-","depth":3},{"value":"Secret ","url":"#secret-","depth":3},{"value":"ArgoCD ","url":"#argocd-","depth":3},{"value":"Vault init & unseal","url":"#vault-init--unseal","depth":3},{"value":"vault auth, engine, policy, role ","url":"#vault-auth-engine-policy-role-","depth":3},{"value":"vault secrets operator","url":"#vault-secrets-operator","depth":2},{"value":"vault secrets operator test","url":"#vault-secrets-operator-test","depth":3},{"value":"","url":"#","depth":2}],"frontMatter":{"readingTime":{"text":"15 min read","minutes":14.89,"time":893400,"words":2978},"slug":"20231222-vault-on-k8s","fileName":"20231222-vault-on-k8s.md","title":"vault secrets operator ","date":"2023-12-22T00:00:00.000Z","tags":["Kubernetes","vault"],"images":["/static/images/social-banner.png"],"summary":"GitOps Secret    ,     Vault UI         . Vault secrets operator GA  , Secrets Store CSI External secrets     . Vault secrets operator CRD vault secret kubernetes secret sync , reloader secret    pod   ."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"AWS SAM  Lambda   Secret Manager    ","date":"2023-12-17T00:00:00.000Z","tags":["AWS"],"images":["/static/images/social-banner.png"],"summary":"AWS Cloudformation Secret Manager     . AWS SAM   Lambda  Secret Manager    .  Secret manager       Lambda    . AWS SAM   Issue ,   .       .","slug":"20231217-aws-sam-resolve-issue"},"next":{"title":"Vault custom secret engine ","date":"2023-12-28T00:00:00.000Z","tags":["vault","ncloud"],"images":["/static/images/social-banner.png"],"summary":"Vault secret engine       .  AWS, Azure builtin plugin  .  custom secret engine vault framework SDK     .   STS API  , custom secret engine        .      , Vault Tutorial        .","slug":"20231228-vault-custom-secret-engine"}},"__N_SSG":true}