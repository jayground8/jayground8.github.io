{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var u=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!h.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=>k(i(l(a!=null?r(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((x,t)=>{t.exports=_jsx_runtime});var f={};N(f,{default:()=>P,frontmatter:()=>y});var e=g(o()),y={title:\"Cilium CNI\\uC640 HostPort\",date:\"2024-02-07\",tags:[\"kubernetes\",\"cilium\"],images:[\"/static/images/social-banner.png\"],summary:\"\\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4 \\uC11C\\uBE44\\uC2A4\\uC5D0\\uC11C HostPort\\uB97C \\uC124\\uC815\\uD558\\uC600\\uB294\\uB370, \\uC815\\uC0C1\\uC801\\uC73C\\uB85C Node Port\\uB97C \\uD1B5\\uD574\\uC11C Container\\uC5D0 \\uC811\\uADFC\\uD560 \\uC218\\uAC00 \\uC5C6\\uC5C8\\uB2E4. Cilium\\uC758 \\uAE30\\uBCF8 \\uC124\\uC815\\uC73C\\uB85C\\uB294 HostPort\\uB97C \\uC9C0\\uC6D0\\uD558\\uC9C0 \\uC54A\\uC558\\uB2E4. Cilium\\uC740 eBPF\\uB85C HostPort\\uAC00 \\uB3D9\\uC791\\uD558\\uB3C4\\uB85D \\uC9C0\\uC6D0\\uD558\\uB294\\uB370, \\uC774 \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D Cilium \\uC124\\uC815\\uC744 \\uBCC0\\uACBD\\uD588\\uB2E4. \\uD558\\uC9C0\\uB9CC Worker Node\\uC758 \\uCEE4\\uB110 \\uBC84\\uC804\\uC774 \\uD544\\uC218 \\uBC84\\uC804\\uBCF4\\uB2E4 \\uB0AE\\uC544\\uC11C \\uC774 \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD560 \\uC218 \\uC5C6\\uC5C8\\uB2E4. \\uADF8\\uB798\\uC11C \\uCD5C\\uC885\\uC801\\uC73C\\uB85C chainMode\\uB97C \\uD1B5\\uD574\\uC11C portmap CNI plugin\\uC744 \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC744 \\uD558\\uC600\\uB2E4. \\uC774\\uBC88\\uC5D0\\uB294 portmap binary file\\uC774 Worker Node\\uC5D0 \\uAE30\\uBCF8\\uC801\\uC73C\\uB85C \\uC5C6\\uC5B4\\uC11C \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB85C build\\uD574\\uC11C \\uC9D1\\uC5B4 \\uB123\\uC5C8\\uB2E4. \\uCD5C\\uC885\\uC801\\uC73C\\uB85C Iptable Rule\\uC744 \\uD1B5\\uD574\\uC11C Port binding\\uC774 \\uC801\\uC6A9\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD558\\uC600\\uB2E4.\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",p:\"p\",code:\"code\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"\\uD14C\\uC2A4\\uD2B8-\\uD658\\uACBD\",children:[(0,e.jsx)(n.a,{href:\"#\\uD14C\\uC2A4\\uD2B8-\\uD658\\uACBD\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uD14C\\uC2A4\\uD2B8 \\uD658\\uACBD\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"\\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4 \\uC11C\\uBE44\\uC2A4 \\uBC84\\uC804: 1.26\"}),(0,e.jsx)(n.li,{children:\"Cilium \\uBC84\\uC804: 1.10.16\"}),(0,e.jsx)(n.li,{children:\"\\uCEE4\\uB110 \\uBC84\\uC804: 5.4.0-163-generic\"})]}),(0,e.jsxs)(n.h2,{id:\"\\uC774\\uC288-\\uC0AC\\uD56D\",children:[(0,e.jsx)(n.a,{href:\"#\\uC774\\uC288-\\uC0AC\\uD56D\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uC774\\uC288 \\uC0AC\\uD56D\"]}),(0,e.jsx)(n.p,{children:\"OpenTelemetry collector\\uB97C DaemonSet\\uC73C\\uB85C \\uC124\\uCE58\\uB97C \\uD558\\uC600\\uB2E4. \\uADF8\\uB9AC\\uACE0 Web server\\uAC00 \\uB3CC\\uACE0 \\uC788\\uB294 Pod\\uAC00 Trace \\uC815\\uBCF4\\uB97C Collector\\uC5D0 \\uBCF4\\uB0B4\\uACE0\\uC790 \\uD588\\uB2E4. OpenTelemetry Collector\\uAC00 HostPort\\uB85C \\uC124\\uC815\\uC774 \\uB418\\uC5B4 \\uC788\\uC5C8\\uACE0, Pod\\uB294 \\uC774 HostPort\\uB85C \\uC5F0\\uACB0\\uC744 \\uC2DC\\uB3C4\\uD588\\uB2E4.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"opentelemetry collector \\uC124\\uC815\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" 4317/TCP\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` 4318/TCP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"Host Ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" 4317/TCP\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),` 4318/TCP\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"Web server\\uAC00 \\uB3CC\\uACE0 \\uC788\\uB294 Pod\\uC758 Deployment \\uC124\\uC815\"})}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` NODE_IP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"valueFrom\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"fieldRef\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"fieldPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` status.hostIP\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"OpenTelemetry SDK\\uB97C \\uD1B5\\uD574\\uC11C Trace\\uB97C \\uC804\\uC1A1\"})}),(0,e.jsx)(n.pre,{className:\"language-js\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-js\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"traceExporter\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"OTLPTraceExporter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  url\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"http://\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"NODE_IP\"}),(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\":4318/v1/traces\"}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC OpenTelemetry Collector\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC2E4\\uD589\\uB418\\uACE0 \\uC788\\uC5C8\\uC9C0\\uB9CC, Node\\uC5D0\\uC11C \\uD574\\uB2F9 collector\\uB85C \\uC5F0\\uACB0\\uD558\\uC9C0 \\uBABB\\uD558\\uACE0 Connection refused\\uAC00 \\uBC1C\\uC0DD\\uD558\\uC600\\uB2E4. \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4\\uC5D0\\uC11C Cilium\\uC774 CNI\\uB85C \\uC124\\uC815\\uC774 \\uB418\\uC5B4 \\uC788\\uC5C8\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC774 cilium cli\\uB97C \\uD1B5\\uD574\\uC11C service \\uBAA9\\uB85D\\uC744 \\uD655\\uC778\\uD558\\uC600\\uB2E4. \\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:\"HostPort\"}),\" Service Type\\uC740 \\uBAA9\\uB85D\\uC5D0\\uC11C \\uBCF4\\uC774\\uC9C0 \\uC54A\\uC558\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kubectl \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"exec\"}),\" -it cilium-4d93a -n kube-system -- cilium \",(0,e.jsx)(n.span,{className:\"token function\",children:\"service\"}),` list\n`]})})}),(0,e.jsxs)(n.h2,{id:\"hostport\",children:[(0,e.jsx)(n.a,{href:\"#hostport\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"HostPort\"]}),(0,e.jsxs)(n.p,{children:[\"Kubernetes\\uC5D0\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,e.jsx)(n.code,{children:\"HostPort\"}),\"\\uB97C \\uC124\\uC815\\uD558\\uBA74, Pod\\uAC00 Node\\uC758 Port\\uC5D0\\uC11C listening\\uD560 \\uC218 \\uC788\\uB2E4. \\uC544\\uB798\\uC758 \\uACBD\\uC6B0\\uB294 Node\\uC758 8080 Port\\uC5D0 \\uC694\\uCCAD\\uD558\\uBA74 Container\\uC758 80 Port\\uC5D0 \\uC5F0\\uACB0\\uD560 \\uC218 \\uC788\\uB2E4. \\uC77C\\uBC18\\uC801\\uC73C\\uB85C Iptable\\uC758 nat table\\uC5D0 Rule\\uB4E4\\uC774 \\uC0DD\\uC131\\uB418\\uC5B4 \\uC774\\uB807\\uAC8C \\uC791\\uB3D9\\uB41C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"hostPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"hostport-with-ciliums-ebpf\",children:[(0,e.jsx)(n.a,{href:\"#hostport-with-ciliums-ebpf\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"HostPort with Cilium's eBPF\"]}),(0,e.jsxs)(n.p,{children:[\"Cilium\\uC744 CNI\\uB85C \\uC0AC\\uC6A9\\uD560 \\uB54C Linux Kernel\\uC758 \\uBC84\\uC804\\uC5D0 \\uB530\\uB77C\\uC11C Iptable\\uB97C \\uC774\\uC6A9\\uD558\\uB294 kube-proxy\\uB97C \\uB300\\uCCB4\\uD560 \\uC218 \\uC788\\uB294 \\uBD80\\uBD84\\uC774 \\uC788\\uACE0, \\uC5C6\\uB294 \\uBD80\\uBD84\\uC774 \\uC788\\uB2E4. \",(0,e.jsx)(n.a,{href:\"https://docs.cilium.io/en/stable/operations/system_requirements/#required-kernel-versions-for-advanced-features\",children:\"\\uBB38\\uC11C\"}),\"\\uB97C \\uBCF4\\uBA74 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uBA85\\uC774 \\uB418\\uC5B4 \\uC788\\uB2E4. \",(0,e.jsx)(n.code,{children:\"BPF-based host routing\"}),\"\\uC744 \\uAE30\\uB2A5\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C\\uB294 Kernel \\uBC84\\uC804\\uC774 \\uCD5C\\uC18C \",(0,e.jsx)(n.code,{children:\"5.19\"}),\" \\uC774\\uC0C1\\uC774\\uC5B4\\uC57C \\uD558\\uB294 \\uAC83\\uC744 \\uC54C \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(\"img\",{src:\"/static/images/cilium-required-kernel-version\",alt:\"cilium required kernel version\"}),(0,e.jsxs)(n.p,{children:[\"Helm chart\\uB85C Cilium\\uC744 \\uC124\\uCE58\\uD558\\uBA74 \",(0,e.jsx)(n.code,{children:\"cilium-config\"}),\"\\uAC00 ConfigMap object\\uB85C \\uC0DD\\uC131\\uB418\\uB294\\uB370, \",(0,e.jsx)(n.a,{href:\"https://github.com/cilium/cilium/blob/v1.10.16/install/kubernetes/cilium/templates/cilium-configmap.yaml\",children:\"ConfigMap\\uC758 \\uAC12\\uC73C\\uB85C Cilium\\uC758 \\uC124\\uC815\\uC774 \\uACB0\\uC815\\uB41C\\uB2E4.\"}),\". \",(0,e.jsx)(n.a,{href:\"https://docs.cilium.io/en/stable/network/kubernetes/kubeproxy-free/#container-hostport-support\",children:\"Cilium eBPF kube-proxy\\uAC00 HostPort\\uB3C4 \\uB300\\uCCB4\\uD560 \\uC218 \\uC788\\uB294\\uB370,\"}),\" HostPort\\uC640 \\uAD00\\uB828\\uB41C \\uC124\\uC815\\uAC12\\uC740 \\uC544\\uB798\\uC640 \\uAC19\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kube-proxy-replacement\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" $kubeProxyReplacement \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),\" quote \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),' if hasKey .Values \"hostPort\" ',(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),' if eq $kubeProxyReplacement \"partial\" ',(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enable-host-port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" .Values.hostPort.enabled \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),\" quote \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" end \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" end \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"kube-proxy-relacement\"}),\" \\uC124\\uC815\\uAC12\\uC744 \",(0,e.jsx)(n.code,{children:\"true\"}),\"\\uB85C \\uC124\\uC815\\uD574\\uC11C \\uBAA8\\uB4E0 \\uBD80\\uBD84\\uC744 \\uB300\\uCCB4\\uD560 \\uC218\\uB3C4 \\uC788\\uACE0, \",(0,e.jsx)(n.code,{children:\"kube-proxy-relacement\"}),\"\\uC744 \",(0,e.jsx)(n.code,{children:\"partial\"}),\"\\uB85C \\uC124\\uC815\\uD558\\uC5EC \\uAC1C\\uBCC4\\uC801\\uC73C\\uB85C \\uC124\\uC815\\uC744 \\uD560 \\uC218 \\uC788\\uB2E4. \\uB098\\uB294 HostPort\\uBD80\\uBD84\\uB9CC \\uB300\\uCCB4\\uD558\\uAE30 \\uC704\\uD574\\uC11C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \",(0,e.jsx)(n.code,{children:\"cilium-config\"}),\"\\uB97C \\uC218\\uC815\\uD558\\uACE0, Daemonset\\uC73C\\uB85C \\uB3CC\\uACE0 \\uC788\\uB294 \",(0,e.jsx)(n.code,{children:\"cilium agent\"}),\"\\uB97C restart\\uD588\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ConfigMap\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"...\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kube-proxy-replacement\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` partial\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"enable-host-port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"true\"'}),`\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`kubectl rollout restart daemonset/cilium -n kube-system\n`})})}),(0,e.jsxs)(n.p,{children:[\"\\uD558\\uC9C0\\uB9CC \",(0,e.jsx)(n.code,{children:\"cilium status\"}),\" CLI \\uBA85\\uB839\\uC5B4\\uB85C \\uD655\\uC778\\uC744 \\uD558\\uBA74, HostPort\\uAC00 Disabled\\uB85C \\uB098\\uC628\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ kubectl \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"exec\"}),` -it cilium-4d93a -n kube-system -- cilium status --verbose\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\\uC0DD\\uB7B5\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`KubeProxyReplacement Details:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Services:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    - ClusterIP:      Enabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    - NodePort:       Disabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    - LoadBalancer:   Disabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    - externalIPs:    Disabled\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    - HostPort:       Disabled\n`})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB798\\uC11C \",(0,e.jsx)(n.code,{children:\"cilium agent\"}),\"\\uC758 log\\uC744 \\uD655\\uC778\\uD574\\uBCF4\\uB2C8 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uB0A8\\uC544 \\uC788\\uC5C8\\uB2E4. HostPort\\uB97C eBPF\\uB85C \\uB300\\uCCB4\\uD558\\uAE30 \\uC704\\uD55C \\uC2DC\\uC2A4\\uD15C requirement\\uAC00 \\uB9DE\\uC9C0 \\uC54A\\uC73C\\uBA74 \\uC790\\uB3D9\\uC73C\\uB85C \\uAE30\\uC874 kube-proxy\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC774 \\uB41C\\uB2E4. \\uC704\\uC5D0\\uC11C \\uC124\\uBA85\\uD55C \\uAC83\\uCC98\\uB7FC Linux Kernel \\uBC84\\uC804\\uC774 \\uB0AE\\uC544\\uC11C \",(0,e.jsx)(n.code,{children:\"cilium-config\"}),\"\\uB85C HostPort\\uB97C Cilium\\uC758 eBPF\\uB85C \\uB300\\uCCB4\\uD558\\uB824\\uACE0 \\uC124\\uC815\\uD574\\uB3C4 \\uC790\\uB3D9\\uC73C\\uB85C disable \\uB418\\uC5C8\\uB358 \\uAC83\\uC774\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-bash\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"level\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"info \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"msg\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"Auto-disabling ',(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"enable-node-port\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\", \",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"enable-external-ips\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\", \",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"enable-host-reachable-services\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\", \",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"enable-host-port\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\", \",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"enable-session-affinity\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\" features and falling back to \",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"enable-host-legacy-routing\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),'\"']}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"subsys\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`daemon\n`]})})}),(0,e.jsxs)(n.h2,{id:\"hostport-with-portmap-plugin\",children:[(0,e.jsx)(n.a,{href:\"#hostport-with-portmap-plugin\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"HostPort with portmap plugin\"]}),(0,e.jsxs)(n.p,{children:[\"Cilium\\uC758 eBPF\\uB97C \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C System \\uC0AC\\uC591\\uC744 \\uB2E4 \\uB9DE\\uCD94\\uB294 \\uB300\\uC2E0\\uC5D0 \",(0,e.jsx)(n.a,{href:\"https://docs.cilium.io/en/latest/installation/cni-chaining-portmap/#portmap-hostport\",children:\"CNI chaining\\uC73C\\uB85C PortMap\\uC744 \\uC0AC\\uC6A9\"}),\"\\uD560 \\uC218 \\uC788\\uC5C8\\uB2E4.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"cilium-config\"}),\" ConfigMap\\uC5D0\\uC11C \",(0,e.jsx)(n.code,{children:\"cni-chaining-mode\"}),\"\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC124\\uC815\\uD558\\uACE0, Opentelemetry Collector\\uB97C restart\\uD55C\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-yml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ConfigMap\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"...\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"...\"}),`\\uC0DD\\uB7B5\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"cni-chaining-mode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` portmap\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uB807\\uAC8C \\uC801\\uC6A9\\uD558\\uACE0 \\uB098\\uBA74 \",(0,e.jsx)(n.code,{children:\"/etc/cni/net.d/05-cilium.conflist\"}),\"\\uC5D0 cni \\uC124\\uC815 \\uD30C\\uC77C\\uC774 \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC0DD\\uC131\\uB41C\\uB2E4. \",(0,e.jsx)(n.code,{children:\"portmap\"}),\"\\uC774 plugin\\uC5D0 \\uCD94\\uAC00\\uB41C \\uAC83\\uC744 \\uD655\\uC778 \\uD560 \\uC218 \\uC788\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"cniVersion\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0.3.1\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"portmap\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"plugins\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"name\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"cilium\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"cilium-cni\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"enable-debug\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"portmap\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"capabilities\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"portMappings\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C \\uB2E4\\uC2DC HostPort\\uAC00 \\uC124\\uC815\\uB41C Deployment Object\\uC744 \\uC0DD\\uC131\\uD55C\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` nginx\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"              \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"hostPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"\\uC774\\uBC88\\uC5D0\\uB294 \\uC544\\uB798\\uC640 \\uAC19\\uC774 cni plugin \",(0,e.jsx)(n.code,{children:\"portmap\"}),\" binary \\uD30C\\uC77C\\uC774 \\uC5C6\\uC5B4\\uC11C Pod\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC2E4\\uD589\\uB418\\uC9C0 \\uBABB \\uD588\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-log\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-log\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token property\",children:\"error killing pod:\"}),\" failed to \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"KillPodSandbox\"'}),\" for \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"1055faa0-7449-49ba-9e25-b6e46de342b1\"'}),\" \",(0,e.jsx)(n.span,{className:\"token property\",children:\"with KillPodSandboxError:\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"rpc error: code = Unknown desc = failed to destroy network for sandbox \\\\\"79eade222dddaff28fcb79d001a47e581acfc501fe4b1c220c9f99b1415cfae3\\\\\": plugin type=\\\\\"portmap\\\\\" failed (delete): failed to find plugin \\\\\"portmap\\\\\" in path [/opt/cni/bin]\"'}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"Worker Node\\uC5D0 \\uB4E4\\uC5B4\\uAC00\\uC11C cni plugin binary\\uB97C \\uD655\\uC778\\uD558\\uB2C8 \\uC544\\uB798\\uCC98\\uB7FC \\uB450 \\uAC1C\\uB9CC \\uC874\\uC7AC\\uD558\\uC600\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),` /opt/cni/bin\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`cilium-cni\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`loopback\n`})]})}),(0,e.jsxs)(n.p,{children:[\"\\uADF8\\uB798\\uC11C Go\\uB97C \\uC124\\uCE58\\uD558\\uACE0 cni plugin \\uC18C\\uC2A4\\uCF54\\uB4DC\\uB97C clone\\uD558\\uC5EC\\uC11C build\\uD558\\uC5EC\\uC11C \",(0,e.jsx)(n.code,{children:\"/opt/cni/bin\"}),\"\\uC5D0 \\uCD94\\uAC00\\uD574\\uC8FC\\uC5C8\\uB2E4.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),` -OL https://golang.org/dl/go1.20.4.linux-amd64.tar.gz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"tar\"}),` -C /usr/local -xvf go1.20.4.linux-amd64.tar.gz\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"PATH\"})}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token constant environment\",children:\"$PATH\"}),`:/usr/local/go/bin\n`]})]})}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"git\"}),` clone https://github.com/containernetworking/plugins.git\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"cd\"}),` plugins\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`./build_linux.sh\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"cp\"}),` bin/portmap /opt/cni/bin/\n`]})]})}),(0,e.jsx)(n.p,{children:\"\\uC774\\uC81C Pod\\uAC00 \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uC791\\uB3D9\\uD558\\uACE0, Iptable\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 Rule\\uC774 \\uCD94\\uAC00\\uB41C \\uAC83\\uC744 \\uD655\\uC778\\uD560 \\uC218 \\uC788\\uB2E4.\\u{1F979} \\uC774\\uC81C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C Node\\uC5D0\\uC11C 8080 \\uD3EC\\uD2B8\\uB85C \\uD574\\uB2F9 \\uCEE8\\uD14C\\uC774\\uB108\\uC5D0 \\uC811\\uADFC\\uD560 \\uC218 \\uC788\\uAC8C \\uB418\\uC5C8\\uB2E4.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ iptables-save \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),` HOSTPORT\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\":CNI-HOSTPORT-DNAT - \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\":0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\":CNI-HOSTPORT-MASQ - \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\":0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\":CNI-HOSTPORT-SETMARK - \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\":0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-A PREROUTING -m addrtype --dst-type LOCAL -j CNI-HOSTPORT-DNAT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-A OUTPUT -m addrtype --dst-type LOCAL -j CNI-HOSTPORT-DNAT\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-A POSTROUTING -m comment --comment \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"CNI portfwd requiring masquerade\"'}),` -j CNI-HOSTPORT-MASQ\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-A CNI-DN-dae2e2caa00ed8d022728 -s \",(0,e.jsx)(n.span,{className:\"token number\",children:\"198.18\"}),\".2.27/32 -p tcp -m tcp --dport \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),` -j CNI-HOSTPORT-SETMARK\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-A CNI-DN-dae2e2caa00ed8d022728 -s \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),\".0.1/32 -p tcp -m tcp --dport \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),` -j CNI-HOSTPORT-SETMARK\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-A CNI-HOSTPORT-DNAT -p tcp -m comment --comment \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"dnat name: ',(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"portmap\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\" id: \",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"d629b42b837dcb40bc6a45f2486e76616c72ca15a3dc5cefe2f881ebd0d8222c\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),'\"']}),\" -m multiport --dports \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),` -j CNI-DN-dae2e2caa00ed8d022728\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-A CNI-HOSTPORT-MASQ -m mark --mark 0x2000/0x2000 -j MASQUERADE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-A CNI-HOSTPORT-SETMARK -m comment --comment \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"CNI portfwd masquerade mark\"'}),` -j MARK --set-xmark 0x2000/0x2000\n`]})]})}),(0,e.jsxs)(n.h2,{id:\"\\uACB0\\uB860\",children:[(0,e.jsx)(n.a,{href:\"#\\uACB0\\uB860\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"\\uACB0\\uB860\"]}),(0,e.jsx)(n.p,{children:\"\\uC774\\uBC88\\uC5D0\\uB3C4 \\uAC04\\uB2E8\\uD558\\uAC8C \\uB05D\\uB0A0\\uC904 \\uC54C\\uC558\\uB358 \\uC791\\uC5C5\\uC5D0\\uC11C \\uC0BD\\uC9C8\\uC744 \\uD558\\uAC8C \\uB418\\uC5C8\\uB2E4.\\u{1F62D} \\uB124\\uC774\\uBC84 \\uD074\\uB77C\\uC6B0\\uB4DC \\uCFE0\\uBC84\\uB124\\uD2F0\\uC2A4 \\uC11C\\uBE44\\uC2A4\\uC5D0\\uC11C\\uB294 Node pool\\uB97C Custom Image\\uB85C \\uC124\\uC815\\uD560 \\uC218\\uAC00 \\uC5C6\\uB2E4. \\uB530\\uB77C\\uC11C \\uAE30\\uC874 Node Image\\uC5D0\\uC11C \\uC2DC\\uC2A4\\uD15C \\uBCC0\\uACBD\\uC0AC\\uD56D\\uC774 \\uC788\\uC73C\\uBA74 \\uADF8\\uAC83\\uC744 \\uBC18\\uC601\\uD558\\uC5EC Custom Image\\uB97C \\uB9CC\\uB4DC\\uB294 \\uB300\\uC2E0\\uC5D0 Init Script\\uB85C \\uBCC0\\uACBD\\uC0AC\\uD56D\\uC744 \\uBC18\\uC601\\uD574\\uC57C \\uD55C\\uB2E4. \\uADF8\\uB798\\uC57C\\uC9C0 Node Pool\\uC5D0\\uC11C \\uC0C8\\uB85C\\uC6B4 Node\\uAC00 \\uC2DC\\uC791\\uB420 \\uB54C \\uBCC0\\uACBD\\uB41C \\uC0AC\\uD56D\\uC744 \\uC790\\uB3D9\\uC73C\\uB85C \\uC801\\uC6A9\\uD560 \\uC218 \\uC788\\uB2E4. Cilium\\uC744 CNI\\uB85C Default\\uB85C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uB418\\uC5B4 \\uC788\\uB294 \\uC0C1\\uD669\\uC5D0\\uC11C HostPort\\uAC00 \\uD604\\uC7AC \\uC2DC\\uC2A4\\uD15C\\uC5D0\\uC11C \\uC815\\uC0C1\\uC801\\uC73C\\uB85C \\uB3D9\\uC791\\uD558\\uB3C4\\uB85D \\uC124\\uC815\\uC774 \\uC548\\uB418\\uC5B4 \\uC788\\uB294 \\uC774\\uC720\\uAC00 \\uBB34\\uC5C7\\uC77C\\uAE4C?\\u{1F914}\"})]})}}var P=b;return f;})();\n;return Component;","toc":[{"value":"테스트 환경","url":"#테스트-환경","depth":2},{"value":"이슈 사항","url":"#이슈-사항","depth":2},{"value":"HostPort","url":"#hostport","depth":2},{"value":"HostPort with Cilium's eBPF","url":"#hostport-with-ciliums-ebpf","depth":2},{"value":"HostPort with portmap plugin","url":"#hostport-with-portmap-plugin","depth":2},{"value":"결론","url":"#결론","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.84,"time":410400,"words":1368},"slug":"20240207-cilium-host-port","fileName":"20240207-cilium-host-port.md","title":"Cilium CNI와 HostPort","date":"2024-02-07T00:00:00.000Z","tags":["kubernetes","cilium"],"images":["/static/images/social-banner.png"],"summary":"네이버 클라우드 쿠버네티스 서비스에서 HostPort를 설정하였는데, 정상적으로 Node Port를 통해서 Container에 접근할 수가 없었다. Cilium의 기본 설정으로는 HostPort를 지원하지 않았다. Cilium은 eBPF로 HostPort가 동작하도록 지원하는데, 이 기능을 사용하도록 Cilium 설정을 변경했다. 하지만 Worker Node의 커널 버전이 필수 버전보다 낮아서 이 기능을 사용할 수 없었다. 그래서 최종적으로 chainMode를 통해서 portmap CNI plugin을 사용하도록 설정을 하였다. 이번에는 portmap binary file이 Worker Node에 기본적으로 없어서 소스코드로 build해서 집어 넣었다. 최종적으로 Iptable Rule을 통해서 Port binding이 적용된 것을 확인하였다."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Cert Manager Webhook 작성하여 Naver Cloud에서 DNS-01 challeng로 Lets Encrypt 인증서 발급하기","date":"2024-01-24T00:00:00.000Z","tags":["kubernetes","ncloud"],"images":["/static/images/social-banner.png"],"summary":"Cert Manager의 DNS provider 목록에 Naver Cloud DNS는 없었다. 하지만 Cert Manager에서 새로운 DNS provider를 직접 연결해서 사용할 수 있도록 webhook solver라는 것을 제공한다. 따라서 Naver Cloud API를 사용하여 webhook 코드를 작성하고, Github Action을 통해서 Image와 Helm chart를 배포해서 사용했다. Cert Manager에서 Boilerplate code와 test framework를 제공하여 비교적 쉽게 작성해서 사용할 수 있었다.","slug":"20240124-cert-manager-webhook"},"next":null},"__N_SSG":true}