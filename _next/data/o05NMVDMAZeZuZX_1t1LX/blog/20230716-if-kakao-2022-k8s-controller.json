{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var r=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var t=a=>l(a,\"__esModule\",{value:!0});var m=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of d(s))!h.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(c=p(s,e))||c.enumerable});return a},g=a=>k(t(l(a!=null?r(u(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=m((w,i)=>{i.exports=_jsx_runtime});var v={};N(v,{default:()=>f,frontmatter:()=>b});var n=g(o()),b={title:\"if(kakao)2022 Testing Kubernetes Controller \\uBC1C\\uD45C \\uB530\\uB77C \\uB9CC\\uB4E4\\uAE30\",date:\"2023-07-16\",tags:[\"kubernetes\"],summary:\"\\uC5B4\\uC81C\\uB294 Programming Kubernetes\\uC5D0 \\uB098\\uC624\\uB294 \\uC608\\uC81C\\uB97C kubebuilder\\uB85C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4. if(kakao)2022\\uC5D0\\uC11C controller\\uB97C \\uD14C\\uC2A4\\uD2B8\\uD558\\uB294 \\uBC29\\uBC95\\uC5D0 \\uB300\\uD574\\uC11C \\uC124\\uBA85\\uD55C \\uBC1C\\uD45C\\uAC00 \\uC788\\uC5C8\\uB2E4. \\uC5B4\\uC81C \\uC774\\uD574\\uD55C \\uB0B4\\uC6A9\\uC744 \\uBC14\\uD0D5\\uC73C\\uB85C \\uC774 \\uBC1C\\uD45C\\uC5D0\\uC11C \\uC0AC\\uC6A9\\uD55C BlueGreen controller \\uC608\\uC81C\\uB97C \\uB530\\uB77C\\uC11C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4.\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",a:\"a\",code:\"code\",pre:\"pre\",span:\"span\",h2:\"h2\",h3:\"h3\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://youtu.be/B80-GByJFEA\",children:\"if(kakao)2022 \\uC601\\uC0C1\\uB4E4 \\uC911\\uC5D0 Controller \\uAD00\\uB828 \\uC601\\uC0C1\"}),\"\\uC774 \\uC788\\uC5B4\\uC11C \\uB530\\uB77C\\uC11C Controller\\uB97C \\uC791\\uC131\\uD574\\uBCF4\\uC558\\uB2E4. \\uC544\\uB798\\uC640 \\uAC19\\uC774 Custom Resource BlueGreen\\uC744 \\uB9CC\\uB4E4\\uBA74, \",(0,n.jsx)(e.code,{children:\"spec.routeTo\"}),\"\\uC5D0 \\uB530\\uB77C\\uC11C ClusterIP service\\uAC00 blue pod\\uC5D0 \\uAC08\\uC9C0 green pod\\uC5D0 \\uAC08\\uC9C0 \\uACB0\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` app.demo.kakao.com/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` BlueGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` demo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"routeTo\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"blueSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" demo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"greenSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` green\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" demo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"version\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`green\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"kubebuilder\\uB85C-api-\\uC0DD\\uC131\",children:[(0,n.jsx)(e.a,{href:\"#kubebuilder\\uB85C-api-\\uC0DD\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"kubebuilder\\uB85C API \\uC0DD\\uC131\"]}),(0,n.jsx)(e.p,{children:\"\\uBC1C\\uD45C\\uC5D0\\uC11C \\uACF5\\uC720\\uB41C CRD\\uB97C \\uBC14\\uD0D5\\uC73C\\uB85C kubebuilder\\uB97C \\uD1B5\\uD574\\uC11C api\\uB97C \\uB9CC\\uB4E4\\uC5C8\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`go mod init blue_green_controller\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubebuilder init --domain demo.kakao.com\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`kubebuilder create api --group app --version v1 --kind BlueGreen\n`})]})}),(0,n.jsxs)(e.h2,{id:\"type-\\uC791\\uC131\",children:[(0,n.jsx)(e.a,{href:\"#type-\\uC791\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"type \\uC791\\uC131\"]}),(0,n.jsxs)(e.p,{children:[\"\\uC774\\uC81C \",(0,n.jsx)(e.code,{children:\"bluegreen_types.go\"}),\"\\uB97C CRD\\uC5D0 \\uB9DE\\uCDB0\\uC11C \\uC791\\uC131\\uC744 \\uD55C\\uB2E4. \\uC774\\uC81C RouteTo\\uB294 Blue\\uC640 Green \\uAC12\\uB9CC \\uAC00\\uC9C8\\uC218 \\uC788\\uB2E4\\uB77C\\uB294 \\uAC00\\uC815\\uD558\\uC5D0 \\uC544\\uB798\\uC640 \\uAC19\\uC774 Constant\\uB97C \\uC815\\uC758\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueOrGreen \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tBlue  BlueOrGreen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Blue\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tGreen BlueOrGreen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Green\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\\uADF8\\uB9AC\\uACE0 BlueGreen Kind\\uC758 spec\\uACFC status\\uB97C \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uC815\\uC758\\uD558\\uC600\\uB2E4\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tRouteTo   \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"routeTo\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tBlueSpec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"blueSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tGreenSpec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"greenSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenStatus \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tRouteTo \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"routeTo\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"crd-\\uC0DD\\uC131\",children:[(0,n.jsx)(e.a,{href:\"#crd-\\uC0DD\\uC131\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"CRD \\uC0DD\\uC131\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make install\"}),\"\\uB85C \\uD574\\uB2F9 type\\uC73C\\uB85C \\uC0DD\\uC131\\uB41C CRD\\uB97C Minikube cluser\\uC5D0 \\uC801\\uC6A9\\uD55C\\uB2E4. \\uD558\\uC9C0\\uB9CC \",(0,n.jsx)(e.code,{children:\"v1.PodSpec\"}),\"\\uB54C\\uBB38\\uC5D0 \\uC0DD\\uC131\\uB41C CRD file\\uC758 size\\uAC00 \\uCEE4\\uC84C\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC740 \\uC5D0\\uB7EC\\uAC00 \\uBC1C\\uC0DD\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"The CustomResourceDefinition \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"bluegreens.app.demo.kakao.com\"'}),\" is invalid: metadata.annotations: Too long: must have at \",(0,n.jsx)(e.span,{className:\"token function\",children:\"most\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"262144\"}),` bytes\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"make: *** \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"install\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" Error \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make install\"}),\"\\uC740 \",(0,n.jsx)(e.code,{children:\"kustomize build config/crd | kubectl apply -f -\"}),\"\\uB97C \\uC2E4\\uD589\\uD558\\uAC8C \\uB418\\uB294\\uB370, kubectl apply\\uB294 client-side apply\\uB85C \",(0,n.jsx)(e.code,{children:\"last-applied-configuration\"}),\" annotation\\uC744 \\uCD94\\uAC00\\uD558\\uACE0 \\uC774 \\uC815\\uBCF4\\uB97C \\uBC14\\uD0D5\\uC73C\\uB85C \\uD604\\uC7AC resource\\uC758 state\\uC5D0\\uC11C \\uC5B4\\uB5A4 \\uAC83\\uC744 update\\uD560\\uC9C0 \\uD310\\uB2E8\\uD558\\uAC8C \\uB41C\\uB2E4. \\uADF8\\uB7F0\\uB370 client-side\\uB294 \\uC774\\uC81C kubectl apply\\uB85C \\uD558\\uB294 \\uB3D9\\uC548 controller\\uB098 \\uB2E4\\uB978 agent\\uC5D0 \\uC758\\uD574\\uC11C resource state\\uAC00 \\uBCC0\\uACBD\\uB418\\uBA74 detect\\uB97C \\uD558\\uC9C0 \\uBABB\\uD558\\uACE0, \\uADF8\\uB0E5 overwrite\\uB97C \\uD560 \\uC218 \\uC788\\uAC8C \\uB41C\\uB2E4. \",(0,n.jsx)(e.a,{href:\"https://kubernetes.io/docs/reference/using-api/server-side-apply/\",children:\"Kubernetes v1.22\\uC5D0\\uC11C stable \\uC0C1\\uD0DC\\uAC00 \\uB41C server-side apply\"}),\"\\uB97C \\uC801\\uC6A9\\uD558\\uBA74, \\uC774\\uC81C conflict\\uB97C detect\\uD574\\uC11C \\uC774\\uC81C update\\uB97C \\uB418\\uB294 \\uAC83\\uC744 \\uB9C9\\uC744 \\uC218 \\uC788\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"v1.PodSpec\"}),\"\\uB54C\\uBB38\\uC5D0 CRD\\uC758 \\uD06C\\uAE30\\uAC00 \\uCEE4\\uC84C\\uACE0, \",(0,n.jsx)(e.code,{children:\"kubectl apply\"}),\"\\uB97C \\uD1B5\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"annotation\"}),\"\\uC774 \\uCD94\\uAC00\\uB418\\uB2C8 \\uC0AC\\uC774\\uC988 \\uC81C\\uD55C\\uC744 \\uB118\\uC5B4\\uC11C\\uAC8C \\uB41C \\uAC83\\uC774\\uB2E4. \\uB530\\uB77C\\uC11C \",(0,n.jsx)(e.code,{children:\"client-side apply\"}),\" \\uB300\\uC2E0\\uC5D0 \",(0,n.jsx)(e.code,{children:\"server-side apply\"}),\"\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC \\uC774\\uB7EC\\uD55C \",(0,n.jsx)(e.code,{children:\"annotation\"}),\" \\uC0DD\\uC131\\uC5C6\\uC774 CRD\\uB97C \\uC0DD\\uC131\\uD558\\uB3C4\\uB85D \\uD574\\uC11C \\uD574\\uACB0 \\uD560 \\uC218 \\uC788\\uB2E4. \",(0,n.jsx)(e.code,{children:\"make manifests\"}),\"\\uB85C CRD file\\uC744 \\uC0DD\\uC131\\uD558\\uACE0, \\uC544\\uB798\\uC640 \\uAC19\\uC774 \\uBCC4\\uB3C4\\uB85C CRD\\uB97C cluster\\uC5D0 \\uC0DD\\uC131\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-bash\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"kustomize build config/crd \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" kubectl apply --server-side\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`true -f -\n`]})})}),(0,n.jsxs)(e.h2,{id:\"controller-business-logic-\\uCD94\\uAC00\",children:[(0,n.jsx)(e.a,{href:\"#controller-business-logic-\\uCD94\\uAC00\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Controller Business logic \\uCD94\\uAC00\"]}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB9AC\\uACE0 \\uC774\\uC81C BlueGreen resource\\uB97C contoller\\uD558\\uAE30 \\uC704\\uD574\\uC11C \",(0,n.jsx)(e.code,{children:\"bluegreen_controller.go\"}),\"\\uC5D0 business logic\\uC744 \\uCD94\\uAC00\\uD55C\\uB2E4. \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C \\uC774 business logic\\uC744 \\uACF5\\uC720\\uD574\\uC8FC\\uC5C8\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uB3D9\\uC77C\\uD558\\uAC8C \\uC791\\uC131\\uC744 \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsxs)(e.h3,{id:\"\\uBA54\\uBAA8\\uB9AC-\\uD560\\uB2F9-new-vs-something\",children:[(0,n.jsx)(e.a,{href:\"#\\uBA54\\uBAA8\\uB9AC-\\uD560\\uB2F9-new-vs-something\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uBA54\\uBAA8\\uB9AC \\uD560\\uB2F9 new vs &something\"]}),(0,n.jsxs)(e.p,{children:[\"Custom resource \",(0,n.jsx)(e.code,{children:\"At\"}),\"\\uC744 control\\uD558\\uB294 business logic\\uC744 \\uC791\\uC131\\uD560 \\uB54C\\uB294, \\uC544\\uB798\\uC640 \\uAC19\\uC774 instance \\uBCC0\\uC218\\uC5D0 \\uBA54\\uBAA8\\uB9AC\\uB97C \\uD560\\uB2F9\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"instance \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// return a pointer\"}),`\n`]})})}),(0,n.jsx)(e.p,{children:\"\\uD558\\uC9C0\\uB9CC \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC new function\\uC744 \\uC0AC\\uC6A9\\uD588\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"instance \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"new\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"struct-promoted-field\",children:[(0,n.jsx)(e.a,{href:\"#struct-promoted-field\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"struct promoted field\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"At Controller\"}),\"\\uC5D0\\uC11C\\uB294 \\uC544\\uB798\\uCC98\\uB7FC struct type\\uAC00 \\uC815\\uC758\\uAC00 \\uB418\\uC5C8\\uC744 \\uB54C, \",(0,n.jsx)(e.code,{children:\"client.Client\"}),\"\\uAC00 promoted field\\uAC00 \\uB418\\uC5B4\\uC11C Client\\uB97C \\uD1B5\\uD574\\uC11C resource\\uB97C GET\\uD560 \\uB54C \",(0,n.jsx)(e.code,{children:\"r.Get()\"}),\"\\uC73C\\uB85C \\uC791\\uC131\\uD588\\uB2E4. \\uD558\\uC9C0\\uB9CC \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 \",(0,n.jsx)(e.code,{children:\"r.Client.Get()\"}),\"\\uB85C name\\uC744 \\uBA85\\uC2DC\\uC801\\uC73C\\uB85C \\uC791\\uC131\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenReconciler \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tclient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Client\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tScheme \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"runtime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Scheme\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"initialization-statement\",children:[(0,n.jsx)(e.a,{href:\"#initialization-statement\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"initialization statement\"]}),(0,n.jsxs)(e.p,{children:[\"\\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 \",(0,n.jsx)(e.code,{children:\"initialization statement\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD588\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NamespacedName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IgnoreNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"clientignorenotfound\",children:[(0,n.jsx)(e.a,{href:\"#clientignorenotfound\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Client.IgnoreNotFound\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"At Controller\"}),\"\\uC5D0\\uC11C\\uB294 resource\\uB97C \\uCC3E\\uC744 \\uC218 \\uC5C6\\uB294 \\uC5D0\\uB7EC\\uC778\\uC9C0 \\uC774\\uB807\\uAC8C errors package\\uB97C \\uD1B5\\uD574\\uC11C \\uD655\\uC778\\uC744 \\uD588\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" errors\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IsNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" reconcile\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uD558\\uC9C0\\uB9CC \\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C\\uB294 Client\\uC758 \",(0,n.jsx)(e.code,{children:\"IgnoreNotFound\"}),\"\\uC744 \\uC0AC\\uC6A9\\uD558\\uC5EC, NotFound Error\\uC77C \\uB54C\\uB294 nil\\uB97C \\uBC18\\uD658\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IgnoreNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"declarative-error\",children:[(0,n.jsx)(e.a,{href:\"#declarative-error\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"declarative error\"]}),(0,n.jsxs)(e.p,{children:[\"\\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C \",(0,n.jsx)(e.code,{children:\"fmt.Errorf\"}),\" \\uD568\\uC218\\uB97C \\uC0AC\\uC6A9\\uD558\\uC5EC custom message\\uB97C \\uC5D0\\uB7EC\\uC5D0 \\uCD94\\uAC00\\uD558\\uC5EC \\uC5B4\\uB5A4 \\uC5D0\\uB7EC\\uC778\\uC9C0 \\uC54C\\uAE30 \\uC27D\\uAC8C \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"language-go code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to set owner reference for a service: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.h3,{id:\"pointer-type\",children:[(0,n.jsx)(e.a,{href:\"#pointer-type\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"pointer type\"]}),(0,n.jsxs)(e.p,{children:[\"\\uBC1C\\uD45C\\uC790\\uB8CC\\uC5D0\\uC11C range\\uB97C \\uD1B5\\uD574\\uC11C for loop iteration\\uC744 \\uD558\\uB3C4\\uB85D \\uC791\\uC131\\uD558\\uC600\\uB2E4. \\uADF8\\uB7F0\\uB370 struct\\uC5D0 Spec\\uC758 Type\\uC774 \",(0,n.jsx)(e.code,{children:\"*corev1.PodSpec\"}),\"\\uC73C\\uB85C \\uC815\\uC758\\uB418\\uC5B4\\uC11C pointer\\uB97C \\uC0AC\\uC6A9\\uD558\\uB3C4\\uB85D \\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tgt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Phase v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`BlueOrGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Spec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PodSpec\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Blue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Green\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GreenSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uB530\\uB77C\\uC11C \",(0,n.jsx)(e.code,{children:\"BlueGreenSpec\"}),\"\\uC5D0\\uC11C\\uB3C4 \\uB3D9\\uC77C\\uD558\\uAC8C type\\uC744 \\uC815\\uC758\\uD558\\uC600\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenSpec \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tRouteTo   \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"routeTo\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tBlueSpec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"blueSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tGreenSpec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodSpec \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"greenSpec,omitempty\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"\\uADF8\\uB798\\uC11C value\\uB97C \\uAC00\\uC838\\uC624\\uAE30 \\uC704\\uD574\\uC11C \\uC544\\uB798\\uCC98\\uB7FC \",(0,n.jsx)(e.code,{children:\"*tgt.Spec\"}),\"\\uC73C\\uB85C \\uC791\\uC131\\uB418\\uC5C8\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"deploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Template \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodTemplateSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Labels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"\\uC804\\uCCB4-business-logic-code\",children:[(0,n.jsx)(e.a,{href:\"#\\uC804\\uCCB4-business-logic-code\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uC804\\uCCB4 business logic code\"]}),(0,n.jsx)(e.p,{children:\"Service\\uB97C CreateOrUpdate \\uD568\\uC218\\uB85C \\uC0DD\\uC131\\uD558\\uAC70\\uB098 \\uC5C5\\uB370\\uC774\\uD2B8\\uB97C \\uD558\\uACE0, CRD\\uC5D0\\uC11C BlueSpec, GreenSpec\\uC5D0 \\uC815\\uC758\\uB41C container image\\uB85C Deployment resource\\uB97C \\uB450 \\uAC1C \\uC0DD\\uC131\\uD558\\uAC70\\uB098 \\uC5C5\\uB370\\uC774\\uD2B8\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC774\\uC81C service\\uC758 selector\\uB97C \\uD1B5\\uD574\\uC11C blue pod \\uC694\\uCCAD\\uD560\\uC9C0 green pod\\uC5D0 \\uC694\\uCCAD\\uD560\\uC9C0 \\uACB0\\uC815\\uD558\\uAC8C \\uB41C\\uB2E4.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"language-go code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` controller\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"fmt\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"strings\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tappsv1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/api/apps/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tcorev1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/api/core/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tmetav1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/apis/meta/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"k8s.io/apimachinery/pkg/runtime\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tctrl \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/client\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sigs.k8s.io/controller-runtime/pkg/log\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tv1 \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"blue_green_controller/api/v1\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// BlueGreenReconciler reconciles a BlueGreen object\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" BlueGreenReconciler \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tclient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Client\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tScheme \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"runtime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Scheme\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens,verbs=get;list;watch;create;update;patch;delete\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens/status,verbs=get;update;patch\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//+kubebuilder:rbac:groups=app.demo.kakao.com,resources=bluegreens/finalizers,verbs=update\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Reconcile is part of the main kubernetes reconciliation loop which aims to\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// move the current state of the cluster closer to the desired state.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// TODO(user): Modify the Reconcile function to compare the state specified by\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// the BlueGreen object against the actual cluster state, and then\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// perform operations to make the cluster state reflect the state specified by\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// the user.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"//\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// For more details, check Reconcile and its Result here:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.15.0/pkg/reconcile\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"BlueGreenReconciler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Reconcile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" log\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"FromContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"=== Reconciling BlueGreen\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tblueGreen \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"new\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"NamespacedName\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"IgnoreNotFound\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tsvc \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Service\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"CreateOrUpdate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" svc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetControllerReference\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" svc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scheme\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to set owner reference for a service: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tsvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Ports \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ServicePort\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"http\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Protocol\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ProtocolTCP\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Port\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"80\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tsvc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Selector \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/managed-by\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.demo.kakao.com\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/phase\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RouteTo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to create (or update) service: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tgt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tPhase v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`BlueOrGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tSpec  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`PodSpec\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Blue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Green\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GreenSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"continue\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tdeploy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"appsv1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Deployment\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Namespace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" strings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ToLower\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"-deployment\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"CreateOrUpdate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" deploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"SetControllerReference\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" deploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scheme\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to set owner reference for a deployment: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tlabel \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/managed-by\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.demo.kakao.com\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/name\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       req\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"app.kubernetes.io/phase\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Phase\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tdeploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Selector \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"LabelSelector\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"MatchLabels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tdeploy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Template \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" corev1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PodTemplateSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" metav1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ObjectMeta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Labels\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" label\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\tSpec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"tgt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to create (or update) deployment: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tblueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Status \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreenStatus\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tRouteTo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Spec\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RouteTo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Status\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Update\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" blueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"fail to update bluegreen status: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Result\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// SetupWithManager sets up the controller with the Manager.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"BlueGreenReconciler\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SetupWithManager\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mgr ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Manager\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" ctrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewControllerManagedBy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"mgr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"For\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"v1\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"BlueGreen\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"Complete\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"\\uB85C\\uCEEC\\uC5D0\\uC11C-\\uB3D9\\uC791-\\uD655\\uC778\",children:[(0,n.jsx)(e.a,{href:\"#\\uB85C\\uCEEC\\uC5D0\\uC11C-\\uB3D9\\uC791-\\uD655\\uC778\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\uB85C\\uCEEC\\uC5D0\\uC11C \\uB3D9\\uC791 \\uD655\\uC778\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"make run\"}),\"\\uC73C\\uB85C \\uC774\\uC81C \\uD574\\uB2F9 controller\\uC744 local\\uC5D0\\uC11C \\uC2E4\\uD589\\uD558\\uACE0, custom resource BlueGreen\\uC744 Minikube cluster\\uC5D0 \\uC0DD\\uC131\\uD55C\\uB2E4. \",(0,n.jsx)(e.code,{children:\"routeTo\"}),\"\\uB97C Blue\\uB85C \\uC120\\uD0DD\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0 echo server\\uAC00 \\uC2E4\\uD589\\uB418\\uACE0 \\uC788\\uB294 container\\uB85C \\uC694\\uCCAD\\uD558\\uAC8C \\uB41C\\uB2E4. \\uC774\\uC81C Green\\uC73C\\uB85C \\uBCC0\\uACBD\\uD558\\uBA74 Terminated\\uB41C busybox container\\uB85C \\uC694\\uCCAD\\uD558\\uC5EC \\uC815\\uC0C1\\uC801\\uC778 \\uC751\\uB2F5\\uC744 \\uBABB \\uBC1B\\uAC8C \\uB41C\\uB2E4.\"]}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-yaml\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` app.demo.kakao.com/v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"kind\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` BlueGreen\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"metadata\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` demo\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"spec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"routeTo\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"blueSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` blue\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ealen/echo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"greenSpec\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"containers\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` green\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token atrule key\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` busybox\n`]})]})})]})}}var f=y;return v;})();\n;return Component;","toc":[{"value":"kubebuilder API ","url":"#kubebuilder-api-","depth":2},{"value":"type ","url":"#type-","depth":2},{"value":"CRD ","url":"#crd-","depth":2},{"value":"Controller Business logic ","url":"#controller-business-logic-","depth":2},{"value":"  new vs &something","url":"#--new-vs-something","depth":3},{"value":"struct promoted field","url":"#struct-promoted-field","depth":3},{"value":"initialization statement","url":"#initialization-statement","depth":3},{"value":"Client.IgnoreNotFound","url":"#clientignorenotfound","depth":3},{"value":"declarative error","url":"#declarative-error","depth":3},{"value":"pointer type","url":"#pointer-type","depth":3},{"value":" business logic code","url":"#-business-logic-code","depth":2},{"value":"  ","url":"#--","depth":2}],"frontMatter":{"readingTime":{"text":"10 min read","minutes":9.735,"time":584100,"words":1947},"slug":"20230716-if-kakao-2022-k8s-controller","fileName":"20230716-if-kakao-2022-k8s-controller.mdx","title":"if(kakao)2022 Testing Kubernetes Controller   ","date":"2023-07-16T00:00:00.000Z","tags":["kubernetes"],"summary":" Programming Kubernetes   kubebuilder . if(kakao)2022 controller      .        BlueGreen controller   ."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.15,"time":9000,"words":30},"slug":["default"],"fileName":"default.md","name":"Jay","avatar":"profile.png","occupation":"Software Engineer","date":null}],"prev":{"title":"Kubernetes custom controller ","date":"2023-07-15T00:00:00.000Z","tags":["kubernetes"],"summary":"Programming Kubernetes     custom controller . CustomResourceDefinition  , kubebuilder   business logic      .","slug":"20230715-k8s-controller"},"next":{"title":"   <>, <>","date":"2023-07-17T00:00:00.000Z","tags":["book"],"summary":"      <> .        <>  . <> 2014     ,          . , ,  ,                 .     PM .","slug":"20230717-book-review-indistractable-hooked"}},"__N_SSG":true}